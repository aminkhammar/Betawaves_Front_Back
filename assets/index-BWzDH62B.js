var GP=i=>{throw TypeError(i)};var i2=(i,o,u)=>o.has(i)||GP("Cannot "+u);var Xe=(i,o,u)=>(i2(i,o,"read from private field"),u?u.call(i):o.get(i)),tr=(i,o,u)=>o.has(i)?GP("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(i):o.set(i,u),Ci=(i,o,u,m)=>(i2(i,o,"write to private field"),m?m.call(i,u):o.set(i,u),u),Vr=(i,o,u)=>(i2(i,o,"access private method"),u);var M0=(i,o,u,m)=>({set _(w){Ci(i,o,w,u)},get _(){return Xe(i,o,m)}});function x4(i,o){for(var u=0;u<o.length;u++){const m=o[u];if(typeof m!="string"&&!Array.isArray(m)){for(const w in m)if(w!=="default"&&!(w in i)){const E=Object.getOwnPropertyDescriptor(m,w);E&&Object.defineProperty(i,w,E.get?E:{enumerable:!0,get:()=>m[w]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))m(w);new MutationObserver(w=>{for(const E of w)if(E.type==="childList")for(const P of E.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&m(P)}).observe(document,{childList:!0,subtree:!0});function u(w){const E={};return w.integrity&&(E.integrity=w.integrity),w.referrerPolicy&&(E.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?E.credentials="include":w.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function m(w){if(w.ep)return;w.ep=!0;const E=u(w);fetch(w.href,E)}})();var v4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vT(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var sk={exports:{}},b1={},ok={exports:{}},nn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var by=Symbol.for("react.element"),w4=Symbol.for("react.portal"),b4=Symbol.for("react.fragment"),S4=Symbol.for("react.strict_mode"),T4=Symbol.for("react.profiler"),E4=Symbol.for("react.provider"),C4=Symbol.for("react.context"),I4=Symbol.for("react.forward_ref"),A4=Symbol.for("react.suspense"),P4=Symbol.for("react.memo"),M4=Symbol.for("react.lazy"),$P=Symbol.iterator;function R4(i){return i===null||typeof i!="object"?null:(i=$P&&i[$P]||i["@@iterator"],typeof i=="function"?i:null)}var ak={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},lk=Object.assign,ck={};function Am(i,o,u){this.props=i,this.context=o,this.refs=ck,this.updater=u||ak}Am.prototype.isReactComponent={};Am.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};Am.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function uk(){}uk.prototype=Am.prototype;function wT(i,o,u){this.props=i,this.context=o,this.refs=ck,this.updater=u||ak}var bT=wT.prototype=new uk;bT.constructor=wT;lk(bT,Am.prototype);bT.isPureReactComponent=!0;var qP=Array.isArray,hk=Object.prototype.hasOwnProperty,ST={current:null},dk={key:!0,ref:!0,__self:!0,__source:!0};function pk(i,o,u){var m,w={},E=null,P=null;if(o!=null)for(m in o.ref!==void 0&&(P=o.ref),o.key!==void 0&&(E=""+o.key),o)hk.call(o,m)&&!dk.hasOwnProperty(m)&&(w[m]=o[m]);var s=arguments.length-2;if(s===1)w.children=u;else if(1<s){for(var D=Array(s),O=0;O<s;O++)D[O]=arguments[O+2];w.children=D}if(i&&i.defaultProps)for(m in s=i.defaultProps,s)w[m]===void 0&&(w[m]=s[m]);return{$$typeof:by,type:i,key:E,ref:P,props:w,_owner:ST.current}}function k4(i,o){return{$$typeof:by,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function TT(i){return typeof i=="object"&&i!==null&&i.$$typeof===by}function D4(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(u){return o[u]})}var HP=/\/+/g;function r2(i,o){return typeof i=="object"&&i!==null&&i.key!=null?D4(""+i.key):o.toString(36)}function nv(i,o,u,m,w){var E=typeof i;(E==="undefined"||E==="boolean")&&(i=null);var P=!1;if(i===null)P=!0;else switch(E){case"string":case"number":P=!0;break;case"object":switch(i.$$typeof){case by:case w4:P=!0}}if(P)return P=i,w=w(P),i=m===""?"."+r2(P,0):m,qP(w)?(u="",i!=null&&(u=i.replace(HP,"$&/")+"/"),nv(w,o,u,"",function(O){return O})):w!=null&&(TT(w)&&(w=k4(w,u+(!w.key||P&&P.key===w.key?"":(""+w.key).replace(HP,"$&/")+"/")+i)),o.push(w)),1;if(P=0,m=m===""?".":m+":",qP(i))for(var s=0;s<i.length;s++){E=i[s];var D=m+r2(E,s);P+=nv(E,o,u,D,w)}else if(D=R4(i),typeof D=="function")for(i=D.call(i),s=0;!(E=i.next()).done;)E=E.value,D=m+r2(E,s++),P+=nv(E,o,u,D,w);else if(E==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return P}function R0(i,o,u){if(i==null)return i;var m=[],w=0;return nv(i,m,"","",function(E){return o.call(u,E,w++)}),m}function N4(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(u){(i._status===0||i._status===-1)&&(i._status=1,i._result=u)},function(u){(i._status===0||i._status===-1)&&(i._status=2,i._result=u)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var So={current:null},sv={transition:null},j4={ReactCurrentDispatcher:So,ReactCurrentBatchConfig:sv,ReactCurrentOwner:ST};function fk(){throw Error("act(...) is not supported in production builds of React.")}nn.Children={map:R0,forEach:function(i,o,u){R0(i,function(){o.apply(this,arguments)},u)},count:function(i){var o=0;return R0(i,function(){o++}),o},toArray:function(i){return R0(i,function(o){return o})||[]},only:function(i){if(!TT(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};nn.Component=Am;nn.Fragment=b4;nn.Profiler=T4;nn.PureComponent=wT;nn.StrictMode=S4;nn.Suspense=A4;nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j4;nn.act=fk;nn.cloneElement=function(i,o,u){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var m=lk({},i.props),w=i.key,E=i.ref,P=i._owner;if(o!=null){if(o.ref!==void 0&&(E=o.ref,P=ST.current),o.key!==void 0&&(w=""+o.key),i.type&&i.type.defaultProps)var s=i.type.defaultProps;for(D in o)hk.call(o,D)&&!dk.hasOwnProperty(D)&&(m[D]=o[D]===void 0&&s!==void 0?s[D]:o[D])}var D=arguments.length-2;if(D===1)m.children=u;else if(1<D){s=Array(D);for(var O=0;O<D;O++)s[O]=arguments[O+2];m.children=s}return{$$typeof:by,type:i.type,key:w,ref:E,props:m,_owner:P}};nn.createContext=function(i){return i={$$typeof:C4,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:E4,_context:i},i.Consumer=i};nn.createElement=pk;nn.createFactory=function(i){var o=pk.bind(null,i);return o.type=i,o};nn.createRef=function(){return{current:null}};nn.forwardRef=function(i){return{$$typeof:I4,render:i}};nn.isValidElement=TT;nn.lazy=function(i){return{$$typeof:M4,_payload:{_status:-1,_result:i},_init:N4}};nn.memo=function(i,o){return{$$typeof:P4,type:i,compare:o===void 0?null:o}};nn.startTransition=function(i){var o=sv.transition;sv.transition={};try{i()}finally{sv.transition=o}};nn.unstable_act=fk;nn.useCallback=function(i,o){return So.current.useCallback(i,o)};nn.useContext=function(i){return So.current.useContext(i)};nn.useDebugValue=function(){};nn.useDeferredValue=function(i){return So.current.useDeferredValue(i)};nn.useEffect=function(i,o){return So.current.useEffect(i,o)};nn.useId=function(){return So.current.useId()};nn.useImperativeHandle=function(i,o,u){return So.current.useImperativeHandle(i,o,u)};nn.useInsertionEffect=function(i,o){return So.current.useInsertionEffect(i,o)};nn.useLayoutEffect=function(i,o){return So.current.useLayoutEffect(i,o)};nn.useMemo=function(i,o){return So.current.useMemo(i,o)};nn.useReducer=function(i,o,u){return So.current.useReducer(i,o,u)};nn.useRef=function(i){return So.current.useRef(i)};nn.useState=function(i){return So.current.useState(i)};nn.useSyncExternalStore=function(i,o,u){return So.current.useSyncExternalStore(i,o,u)};nn.useTransition=function(){return So.current.useTransition()};nn.version="18.3.1";ok.exports=nn;var W=ok.exports;const fi=vT(W),mk=x4({__proto__:null,default:fi},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z4=W,L4=Symbol.for("react.element"),F4=Symbol.for("react.fragment"),O4=Object.prototype.hasOwnProperty,B4=z4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V4={key:!0,ref:!0,__self:!0,__source:!0};function gk(i,o,u){var m,w={},E=null,P=null;u!==void 0&&(E=""+u),o.key!==void 0&&(E=""+o.key),o.ref!==void 0&&(P=o.ref);for(m in o)O4.call(o,m)&&!V4.hasOwnProperty(m)&&(w[m]=o[m]);if(i&&i.defaultProps)for(m in o=i.defaultProps,o)w[m]===void 0&&(w[m]=o[m]);return{$$typeof:L4,type:i,key:E,ref:P,props:w,_owner:B4.current}}b1.Fragment=F4;b1.jsx=gk;b1.jsxs=gk;sk.exports=b1;var _=sk.exports,_k={exports:{}},ma={},yk={exports:{}},xk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(ct,Vt){var Gt=ct.length;ct.push(Vt);e:for(;0<Gt;){var ti=Gt-1>>>1,vi=ct[ti];if(0<w(vi,Vt))ct[ti]=Vt,ct[Gt]=vi,Gt=ti;else break e}}function u(ct){return ct.length===0?null:ct[0]}function m(ct){if(ct.length===0)return null;var Vt=ct[0],Gt=ct.pop();if(Gt!==Vt){ct[0]=Gt;e:for(var ti=0,vi=ct.length,Ki=vi>>>1;ti<Ki;){var Zi=2*(ti+1)-1,Hi=ct[Zi],Ii=Zi+1,hi=ct[Ii];if(0>w(Hi,Gt))Ii<vi&&0>w(hi,Hi)?(ct[ti]=hi,ct[Ii]=Gt,ti=Ii):(ct[ti]=Hi,ct[Zi]=Gt,ti=Zi);else if(Ii<vi&&0>w(hi,Gt))ct[ti]=hi,ct[Ii]=Gt,ti=Ii;else break e}}return Vt}function w(ct,Vt){var Gt=ct.sortIndex-Vt.sortIndex;return Gt!==0?Gt:ct.id-Vt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var E=performance;i.unstable_now=function(){return E.now()}}else{var P=Date,s=P.now();i.unstable_now=function(){return P.now()-s}}var D=[],O=[],H=1,G=null,U=3,he=!1,de=!1,Y=!1,le=typeof setTimeout=="function"?setTimeout:null,re=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _e(ct){for(var Vt=u(O);Vt!==null;){if(Vt.callback===null)m(O);else if(Vt.startTime<=ct)m(O),Vt.sortIndex=Vt.expirationTime,o(D,Vt);else break;Vt=u(O)}}function Ne(ct){if(Y=!1,_e(ct),!de)if(u(D)!==null)de=!0,Zt(Ge);else{var Vt=u(O);Vt!==null&&Ni(Ne,Vt.startTime-ct)}}function Ge(ct,Vt){de=!1,Y&&(Y=!1,re(dt),dt=-1),he=!0;var Gt=U;try{for(_e(Vt),G=u(D);G!==null&&(!(G.expirationTime>Vt)||ct&&!Ht());){var ti=G.callback;if(typeof ti=="function"){G.callback=null,U=G.priorityLevel;var vi=ti(G.expirationTime<=Vt);Vt=i.unstable_now(),typeof vi=="function"?G.callback=vi:G===u(D)&&m(D),_e(Vt)}else m(D);G=u(D)}if(G!==null)var Ki=!0;else{var Zi=u(O);Zi!==null&&Ni(Ne,Zi.startTime-Vt),Ki=!1}return Ki}finally{G=null,U=Gt,he=!1}}var pt=!1,ot=null,dt=-1,Bt=5,Wt=-1;function Ht(){return!(i.unstable_now()-Wt<Bt)}function ei(){if(ot!==null){var ct=i.unstable_now();Wt=ct;var Vt=!0;try{Vt=ot(!0,ct)}finally{Vt?xi():(pt=!1,ot=null)}}else pt=!1}var xi;if(typeof oe=="function")xi=function(){oe(ei)};else if(typeof MessageChannel<"u"){var It=new MessageChannel,ui=It.port2;It.port1.onmessage=ei,xi=function(){ui.postMessage(null)}}else xi=function(){le(ei,0)};function Zt(ct){ot=ct,pt||(pt=!0,xi())}function Ni(ct,Vt){dt=le(function(){ct(i.unstable_now())},Vt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ct){ct.callback=null},i.unstable_continueExecution=function(){de||he||(de=!0,Zt(Ge))},i.unstable_forceFrameRate=function(ct){0>ct||125<ct?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bt=0<ct?Math.floor(1e3/ct):5},i.unstable_getCurrentPriorityLevel=function(){return U},i.unstable_getFirstCallbackNode=function(){return u(D)},i.unstable_next=function(ct){switch(U){case 1:case 2:case 3:var Vt=3;break;default:Vt=U}var Gt=U;U=Vt;try{return ct()}finally{U=Gt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ct,Vt){switch(ct){case 1:case 2:case 3:case 4:case 5:break;default:ct=3}var Gt=U;U=ct;try{return Vt()}finally{U=Gt}},i.unstable_scheduleCallback=function(ct,Vt,Gt){var ti=i.unstable_now();switch(typeof Gt=="object"&&Gt!==null?(Gt=Gt.delay,Gt=typeof Gt=="number"&&0<Gt?ti+Gt:ti):Gt=ti,ct){case 1:var vi=-1;break;case 2:vi=250;break;case 5:vi=1073741823;break;case 4:vi=1e4;break;default:vi=5e3}return vi=Gt+vi,ct={id:H++,callback:Vt,priorityLevel:ct,startTime:Gt,expirationTime:vi,sortIndex:-1},Gt>ti?(ct.sortIndex=Gt,o(O,ct),u(D)===null&&ct===u(O)&&(Y?(re(dt),dt=-1):Y=!0,Ni(Ne,Gt-ti))):(ct.sortIndex=vi,o(D,ct),de||he||(de=!0,Zt(Ge))),ct},i.unstable_shouldYield=Ht,i.unstable_wrapCallback=function(ct){var Vt=U;return function(){var Gt=U;U=Vt;try{return ct.apply(this,arguments)}finally{U=Gt}}}})(xk);yk.exports=xk;var U4=yk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G4=W,fa=U4;function Qt(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var vk=new Set,Y_={};function ap(i,o){xm(i,o),xm(i+"Capture",o)}function xm(i,o){for(Y_[i]=o,i=0;i<o.length;i++)vk.add(o[i])}var Fc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),q2=Object.prototype.hasOwnProperty,$4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,WP={},ZP={};function q4(i){return q2.call(ZP,i)?!0:q2.call(WP,i)?!1:$4.test(i)?ZP[i]=!0:(WP[i]=!0,!1)}function H4(i,o,u,m){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:u!==null?!u.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function W4(i,o,u,m){if(o===null||typeof o>"u"||H4(i,o,u,m))return!0;if(m)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function To(i,o,u,m,w,E,P){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=w,this.mustUseProperty=u,this.propertyName=i,this.type=o,this.sanitizeURL=E,this.removeEmptyString=P}var Ws={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Ws[i]=new To(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];Ws[o]=new To(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Ws[i]=new To(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Ws[i]=new To(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Ws[i]=new To(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Ws[i]=new To(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Ws[i]=new To(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Ws[i]=new To(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Ws[i]=new To(i,5,!1,i.toLowerCase(),null,!1,!1)});var ET=/[\-:]([a-z])/g;function CT(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(ET,CT);Ws[o]=new To(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(ET,CT);Ws[o]=new To(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(ET,CT);Ws[o]=new To(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Ws[i]=new To(i,1,!1,i.toLowerCase(),null,!1,!1)});Ws.xlinkHref=new To("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Ws[i]=new To(i,1,!1,i.toLowerCase(),null,!0,!0)});function IT(i,o,u,m){var w=Ws.hasOwnProperty(o)?Ws[o]:null;(w!==null?w.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(W4(o,u,w,m)&&(u=null),m||w===null?q4(o)&&(u===null?i.removeAttribute(o):i.setAttribute(o,""+u)):w.mustUseProperty?i[w.propertyName]=u===null?w.type===3?!1:"":u:(o=w.attributeName,m=w.attributeNamespace,u===null?i.removeAttribute(o):(w=w.type,u=w===3||w===4&&u===!0?"":""+u,m?i.setAttributeNS(m,o,u):i.setAttribute(o,u))))}var Hc=G4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k0=Symbol.for("react.element"),Lf=Symbol.for("react.portal"),Ff=Symbol.for("react.fragment"),AT=Symbol.for("react.strict_mode"),H2=Symbol.for("react.profiler"),wk=Symbol.for("react.provider"),bk=Symbol.for("react.context"),PT=Symbol.for("react.forward_ref"),W2=Symbol.for("react.suspense"),Z2=Symbol.for("react.suspense_list"),MT=Symbol.for("react.memo"),Uu=Symbol.for("react.lazy"),Sk=Symbol.for("react.offscreen"),XP=Symbol.iterator;function S_(i){return i===null||typeof i!="object"?null:(i=XP&&i[XP]||i["@@iterator"],typeof i=="function"?i:null)}var Kn=Object.assign,n2;function D_(i){if(n2===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);n2=o&&o[1]||""}return`
`+n2+i}var s2=!1;function o2(i,o){if(!i||s2)return"";s2=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(O){var m=O}Reflect.construct(i,[],o)}else{try{o.call()}catch(O){m=O}i.call(o.prototype)}else{try{throw Error()}catch(O){m=O}i()}}catch(O){if(O&&m&&typeof O.stack=="string"){for(var w=O.stack.split(`
`),E=m.stack.split(`
`),P=w.length-1,s=E.length-1;1<=P&&0<=s&&w[P]!==E[s];)s--;for(;1<=P&&0<=s;P--,s--)if(w[P]!==E[s]){if(P!==1||s!==1)do if(P--,s--,0>s||w[P]!==E[s]){var D=`
`+w[P].replace(" at new "," at ");return i.displayName&&D.includes("<anonymous>")&&(D=D.replace("<anonymous>",i.displayName)),D}while(1<=P&&0<=s);break}}}finally{s2=!1,Error.prepareStackTrace=u}return(i=i?i.displayName||i.name:"")?D_(i):""}function Z4(i){switch(i.tag){case 5:return D_(i.type);case 16:return D_("Lazy");case 13:return D_("Suspense");case 19:return D_("SuspenseList");case 0:case 2:case 15:return i=o2(i.type,!1),i;case 11:return i=o2(i.type.render,!1),i;case 1:return i=o2(i.type,!0),i;default:return""}}function X2(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Ff:return"Fragment";case Lf:return"Portal";case H2:return"Profiler";case AT:return"StrictMode";case W2:return"Suspense";case Z2:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case bk:return(i.displayName||"Context")+".Consumer";case wk:return(i._context.displayName||"Context")+".Provider";case PT:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case MT:return o=i.displayName||null,o!==null?o:X2(i.type)||"Memo";case Uu:o=i._payload,i=i._init;try{return X2(i(o))}catch{}}return null}function X4(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return X2(o);case 8:return o===AT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function fh(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Tk(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Y4(i){var o=Tk(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),m=""+i[o];if(!i.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var w=u.get,E=u.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return w.call(this)},set:function(P){m=""+P,E.call(this,P)}}),Object.defineProperty(i,o,{enumerable:u.enumerable}),{getValue:function(){return m},setValue:function(P){m=""+P},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function D0(i){i._valueTracker||(i._valueTracker=Y4(i))}function Ek(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return i&&(m=Tk(i)?i.checked?"true":"false":i.value),i=m,i!==u?(o.setValue(i),!0):!1}function Rv(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Y2(i,o){var u=o.checked;return Kn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??i._wrapperState.initialChecked})}function YP(i,o){var u=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;u=fh(o.value!=null?o.value:u),i._wrapperState={initialChecked:m,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Ck(i,o){o=o.checked,o!=null&&IT(i,"checked",o,!1)}function K2(i,o){Ck(i,o);var u=fh(o.value),m=o.type;if(u!=null)m==="number"?(u===0&&i.value===""||i.value!=u)&&(i.value=""+u):i.value!==""+u&&(i.value=""+u);else if(m==="submit"||m==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?Q2(i,o.type,u):o.hasOwnProperty("defaultValue")&&Q2(i,o.type,fh(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function KP(i,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,u||o===i.value||(i.value=o),i.defaultValue=o}u=i.name,u!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,u!==""&&(i.name=u)}function Q2(i,o,u){(o!=="number"||Rv(i.ownerDocument)!==i)&&(u==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+u&&(i.defaultValue=""+u))}var N_=Array.isArray;function Xf(i,o,u,m){if(i=i.options,o){o={};for(var w=0;w<u.length;w++)o["$"+u[w]]=!0;for(u=0;u<i.length;u++)w=o.hasOwnProperty("$"+i[u].value),i[u].selected!==w&&(i[u].selected=w),w&&m&&(i[u].defaultSelected=!0)}else{for(u=""+fh(u),o=null,w=0;w<i.length;w++){if(i[w].value===u){i[w].selected=!0,m&&(i[w].defaultSelected=!0);return}o!==null||i[w].disabled||(o=i[w])}o!==null&&(o.selected=!0)}}function J2(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Qt(91));return Kn({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function QP(i,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(Qt(92));if(N_(u)){if(1<u.length)throw Error(Qt(93));u=u[0]}o=u}o==null&&(o=""),u=o}i._wrapperState={initialValue:fh(u)}}function Ik(i,o){var u=fh(o.value),m=fh(o.defaultValue);u!=null&&(u=""+u,u!==i.value&&(i.value=u),o.defaultValue==null&&i.defaultValue!==u&&(i.defaultValue=u)),m!=null&&(i.defaultValue=""+m)}function JP(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function Ak(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function eS(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?Ak(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var N0,Pk=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,m,w){MSApp.execUnsafeLocalFunction(function(){return i(o,u,m,w)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(N0=N0||document.createElement("div"),N0.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=N0.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function K_(i,o){if(o){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=o;return}}i.textContent=o}var B_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},K4=["Webkit","ms","Moz","O"];Object.keys(B_).forEach(function(i){K4.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),B_[o]=B_[i]})});function Mk(i,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||B_.hasOwnProperty(i)&&B_[i]?(""+o).trim():o+"px"}function Rk(i,o){i=i.style;for(var u in o)if(o.hasOwnProperty(u)){var m=u.indexOf("--")===0,w=Mk(u,o[u],m);u==="float"&&(u="cssFloat"),m?i.setProperty(u,w):i[u]=w}}var Q4=Kn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tS(i,o){if(o){if(Q4[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Qt(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Qt(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Qt(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Qt(62))}}function iS(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rS=null;function RT(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var nS=null,Yf=null,Kf=null;function eM(i){if(i=Ey(i)){if(typeof nS!="function")throw Error(Qt(280));var o=i.stateNode;o&&(o=I1(o),nS(i.stateNode,i.type,o))}}function kk(i){Yf?Kf?Kf.push(i):Kf=[i]:Yf=i}function Dk(){if(Yf){var i=Yf,o=Kf;if(Kf=Yf=null,eM(i),o)for(i=0;i<o.length;i++)eM(o[i])}}function Nk(i,o){return i(o)}function jk(){}var a2=!1;function zk(i,o,u){if(a2)return i(o,u);a2=!0;try{return Nk(i,o,u)}finally{a2=!1,(Yf!==null||Kf!==null)&&(jk(),Dk())}}function Q_(i,o){var u=i.stateNode;if(u===null)return null;var m=I1(u);if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(Qt(231,o,typeof u));return u}var sS=!1;if(Fc)try{var T_={};Object.defineProperty(T_,"passive",{get:function(){sS=!0}}),window.addEventListener("test",T_,T_),window.removeEventListener("test",T_,T_)}catch{sS=!1}function J4(i,o,u,m,w,E,P,s,D){var O=Array.prototype.slice.call(arguments,3);try{o.apply(u,O)}catch(H){this.onError(H)}}var V_=!1,kv=null,Dv=!1,oS=null,eB={onError:function(i){V_=!0,kv=i}};function tB(i,o,u,m,w,E,P,s,D){V_=!1,kv=null,J4.apply(eB,arguments)}function iB(i,o,u,m,w,E,P,s,D){if(tB.apply(this,arguments),V_){if(V_){var O=kv;V_=!1,kv=null}else throw Error(Qt(198));Dv||(Dv=!0,oS=O)}}function lp(i){var o=i,u=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(u=o.return),i=o.return;while(i)}return o.tag===3?u:null}function Lk(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function tM(i){if(lp(i)!==i)throw Error(Qt(188))}function rB(i){var o=i.alternate;if(!o){if(o=lp(i),o===null)throw Error(Qt(188));return o!==i?null:i}for(var u=i,m=o;;){var w=u.return;if(w===null)break;var E=w.alternate;if(E===null){if(m=w.return,m!==null){u=m;continue}break}if(w.child===E.child){for(E=w.child;E;){if(E===u)return tM(w),i;if(E===m)return tM(w),o;E=E.sibling}throw Error(Qt(188))}if(u.return!==m.return)u=w,m=E;else{for(var P=!1,s=w.child;s;){if(s===u){P=!0,u=w,m=E;break}if(s===m){P=!0,m=w,u=E;break}s=s.sibling}if(!P){for(s=E.child;s;){if(s===u){P=!0,u=E,m=w;break}if(s===m){P=!0,m=E,u=w;break}s=s.sibling}if(!P)throw Error(Qt(189))}}if(u.alternate!==m)throw Error(Qt(190))}if(u.tag!==3)throw Error(Qt(188));return u.stateNode.current===u?i:o}function Fk(i){return i=rB(i),i!==null?Ok(i):null}function Ok(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=Ok(i);if(o!==null)return o;i=i.sibling}return null}var Bk=fa.unstable_scheduleCallback,iM=fa.unstable_cancelCallback,nB=fa.unstable_shouldYield,sB=fa.unstable_requestPaint,hs=fa.unstable_now,oB=fa.unstable_getCurrentPriorityLevel,kT=fa.unstable_ImmediatePriority,Vk=fa.unstable_UserBlockingPriority,Nv=fa.unstable_NormalPriority,aB=fa.unstable_LowPriority,Uk=fa.unstable_IdlePriority,S1=null,Zl=null;function lB(i){if(Zl&&typeof Zl.onCommitFiberRoot=="function")try{Zl.onCommitFiberRoot(S1,i,void 0,(i.current.flags&128)===128)}catch{}}var cl=Math.clz32?Math.clz32:hB,cB=Math.log,uB=Math.LN2;function hB(i){return i>>>=0,i===0?32:31-(cB(i)/uB|0)|0}var j0=64,z0=4194304;function j_(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function jv(i,o){var u=i.pendingLanes;if(u===0)return 0;var m=0,w=i.suspendedLanes,E=i.pingedLanes,P=u&268435455;if(P!==0){var s=P&~w;s!==0?m=j_(s):(E&=P,E!==0&&(m=j_(E)))}else P=u&~w,P!==0?m=j_(P):E!==0&&(m=j_(E));if(m===0)return 0;if(o!==0&&o!==m&&!(o&w)&&(w=m&-m,E=o&-o,w>=E||w===16&&(E&4194240)!==0))return o;if(m&4&&(m|=u&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=m;0<o;)u=31-cl(o),w=1<<u,m|=i[u],o&=~w;return m}function dB(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pB(i,o){for(var u=i.suspendedLanes,m=i.pingedLanes,w=i.expirationTimes,E=i.pendingLanes;0<E;){var P=31-cl(E),s=1<<P,D=w[P];D===-1?(!(s&u)||s&m)&&(w[P]=dB(s,o)):D<=o&&(i.expiredLanes|=s),E&=~s}}function aS(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Gk(){var i=j0;return j0<<=1,!(j0&4194240)&&(j0=64),i}function l2(i){for(var o=[],u=0;31>u;u++)o.push(i);return o}function Sy(i,o,u){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-cl(o),i[o]=u}function fB(i,o){var u=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var m=i.eventTimes;for(i=i.expirationTimes;0<u;){var w=31-cl(u),E=1<<w;o[w]=0,m[w]=-1,i[w]=-1,u&=~E}}function DT(i,o){var u=i.entangledLanes|=o;for(i=i.entanglements;u;){var m=31-cl(u),w=1<<m;w&o|i[m]&o&&(i[m]|=o),u&=~w}}var En=0;function $k(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var qk,NT,Hk,Wk,Zk,lS=!1,L0=[],nh=null,sh=null,oh=null,J_=new Map,ey=new Map,$u=[],mB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rM(i,o){switch(i){case"focusin":case"focusout":nh=null;break;case"dragenter":case"dragleave":sh=null;break;case"mouseover":case"mouseout":oh=null;break;case"pointerover":case"pointerout":J_.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ey.delete(o.pointerId)}}function E_(i,o,u,m,w,E){return i===null||i.nativeEvent!==E?(i={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:E,targetContainers:[w]},o!==null&&(o=Ey(o),o!==null&&NT(o)),i):(i.eventSystemFlags|=m,o=i.targetContainers,w!==null&&o.indexOf(w)===-1&&o.push(w),i)}function gB(i,o,u,m,w){switch(o){case"focusin":return nh=E_(nh,i,o,u,m,w),!0;case"dragenter":return sh=E_(sh,i,o,u,m,w),!0;case"mouseover":return oh=E_(oh,i,o,u,m,w),!0;case"pointerover":var E=w.pointerId;return J_.set(E,E_(J_.get(E)||null,i,o,u,m,w)),!0;case"gotpointercapture":return E=w.pointerId,ey.set(E,E_(ey.get(E)||null,i,o,u,m,w)),!0}return!1}function Xk(i){var o=jd(i.target);if(o!==null){var u=lp(o);if(u!==null){if(o=u.tag,o===13){if(o=Lk(u),o!==null){i.blockedOn=o,Zk(i.priority,function(){Hk(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ov(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var u=cS(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(u===null){u=i.nativeEvent;var m=new u.constructor(u.type,u);rS=m,u.target.dispatchEvent(m),rS=null}else return o=Ey(u),o!==null&&NT(o),i.blockedOn=u,!1;o.shift()}return!0}function nM(i,o,u){ov(i)&&u.delete(o)}function _B(){lS=!1,nh!==null&&ov(nh)&&(nh=null),sh!==null&&ov(sh)&&(sh=null),oh!==null&&ov(oh)&&(oh=null),J_.forEach(nM),ey.forEach(nM)}function C_(i,o){i.blockedOn===o&&(i.blockedOn=null,lS||(lS=!0,fa.unstable_scheduleCallback(fa.unstable_NormalPriority,_B)))}function ty(i){function o(w){return C_(w,i)}if(0<L0.length){C_(L0[0],i);for(var u=1;u<L0.length;u++){var m=L0[u];m.blockedOn===i&&(m.blockedOn=null)}}for(nh!==null&&C_(nh,i),sh!==null&&C_(sh,i),oh!==null&&C_(oh,i),J_.forEach(o),ey.forEach(o),u=0;u<$u.length;u++)m=$u[u],m.blockedOn===i&&(m.blockedOn=null);for(;0<$u.length&&(u=$u[0],u.blockedOn===null);)Xk(u),u.blockedOn===null&&$u.shift()}var Qf=Hc.ReactCurrentBatchConfig,zv=!0;function yB(i,o,u,m){var w=En,E=Qf.transition;Qf.transition=null;try{En=1,jT(i,o,u,m)}finally{En=w,Qf.transition=E}}function xB(i,o,u,m){var w=En,E=Qf.transition;Qf.transition=null;try{En=4,jT(i,o,u,m)}finally{En=w,Qf.transition=E}}function jT(i,o,u,m){if(zv){var w=cS(i,o,u,m);if(w===null)y2(i,o,m,Lv,u),rM(i,m);else if(gB(w,i,o,u,m))m.stopPropagation();else if(rM(i,m),o&4&&-1<mB.indexOf(i)){for(;w!==null;){var E=Ey(w);if(E!==null&&qk(E),E=cS(i,o,u,m),E===null&&y2(i,o,m,Lv,u),E===w)break;w=E}w!==null&&m.stopPropagation()}else y2(i,o,m,null,u)}}var Lv=null;function cS(i,o,u,m){if(Lv=null,i=RT(m),i=jd(i),i!==null)if(o=lp(i),o===null)i=null;else if(u=o.tag,u===13){if(i=Lk(o),i!==null)return i;i=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return Lv=i,null}function Yk(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oB()){case kT:return 1;case Vk:return 4;case Nv:case aB:return 16;case Uk:return 536870912;default:return 16}default:return 16}}var th=null,zT=null,av=null;function Kk(){if(av)return av;var i,o=zT,u=o.length,m,w="value"in th?th.value:th.textContent,E=w.length;for(i=0;i<u&&o[i]===w[i];i++);var P=u-i;for(m=1;m<=P&&o[u-m]===w[E-m];m++);return av=w.slice(i,1<m?1-m:void 0)}function lv(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function F0(){return!0}function sM(){return!1}function ga(i){function o(u,m,w,E,P){this._reactName=u,this._targetInst=w,this.type=m,this.nativeEvent=E,this.target=P,this.currentTarget=null;for(var s in i)i.hasOwnProperty(s)&&(u=i[s],this[s]=u?u(E):E[s]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?F0:sM,this.isPropagationStopped=sM,this}return Kn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=F0)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=F0)},persist:function(){},isPersistent:F0}),o}var Pm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},LT=ga(Pm),Ty=Kn({},Pm,{view:0,detail:0}),vB=ga(Ty),c2,u2,I_,T1=Kn({},Ty,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:FT,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==I_&&(I_&&i.type==="mousemove"?(c2=i.screenX-I_.screenX,u2=i.screenY-I_.screenY):u2=c2=0,I_=i),c2)},movementY:function(i){return"movementY"in i?i.movementY:u2}}),oM=ga(T1),wB=Kn({},T1,{dataTransfer:0}),bB=ga(wB),SB=Kn({},Ty,{relatedTarget:0}),h2=ga(SB),TB=Kn({},Pm,{animationName:0,elapsedTime:0,pseudoElement:0}),EB=ga(TB),CB=Kn({},Pm,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),IB=ga(CB),AB=Kn({},Pm,{data:0}),aM=ga(AB),PB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kB(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=RB[i])?!!o[i]:!1}function FT(){return kB}var DB=Kn({},Ty,{key:function(i){if(i.key){var o=PB[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=lv(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?MB[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:FT,charCode:function(i){return i.type==="keypress"?lv(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?lv(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),NB=ga(DB),jB=Kn({},T1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lM=ga(jB),zB=Kn({},Ty,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:FT}),LB=ga(zB),FB=Kn({},Pm,{propertyName:0,elapsedTime:0,pseudoElement:0}),OB=ga(FB),BB=Kn({},T1,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),VB=ga(BB),UB=[9,13,27,32],OT=Fc&&"CompositionEvent"in window,U_=null;Fc&&"documentMode"in document&&(U_=document.documentMode);var GB=Fc&&"TextEvent"in window&&!U_,Qk=Fc&&(!OT||U_&&8<U_&&11>=U_),cM=" ",uM=!1;function Jk(i,o){switch(i){case"keyup":return UB.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eD(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Of=!1;function $B(i,o){switch(i){case"compositionend":return eD(o);case"keypress":return o.which!==32?null:(uM=!0,cM);case"textInput":return i=o.data,i===cM&&uM?null:i;default:return null}}function qB(i,o){if(Of)return i==="compositionend"||!OT&&Jk(i,o)?(i=Kk(),av=zT=th=null,Of=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Qk&&o.locale!=="ko"?null:o.data;default:return null}}var HB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hM(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!HB[i.type]:o==="textarea"}function tD(i,o,u,m){kk(m),o=Fv(o,"onChange"),0<o.length&&(u=new LT("onChange","change",null,u,m),i.push({event:u,listeners:o}))}var G_=null,iy=null;function WB(i){dD(i,0)}function E1(i){var o=Uf(i);if(Ek(o))return i}function ZB(i,o){if(i==="change")return o}var iD=!1;if(Fc){var d2;if(Fc){var p2="oninput"in document;if(!p2){var dM=document.createElement("div");dM.setAttribute("oninput","return;"),p2=typeof dM.oninput=="function"}d2=p2}else d2=!1;iD=d2&&(!document.documentMode||9<document.documentMode)}function pM(){G_&&(G_.detachEvent("onpropertychange",rD),iy=G_=null)}function rD(i){if(i.propertyName==="value"&&E1(iy)){var o=[];tD(o,iy,i,RT(i)),zk(WB,o)}}function XB(i,o,u){i==="focusin"?(pM(),G_=o,iy=u,G_.attachEvent("onpropertychange",rD)):i==="focusout"&&pM()}function YB(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return E1(iy)}function KB(i,o){if(i==="click")return E1(o)}function QB(i,o){if(i==="input"||i==="change")return E1(o)}function JB(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var hl=typeof Object.is=="function"?Object.is:JB;function ry(i,o){if(hl(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var u=Object.keys(i),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var w=u[m];if(!q2.call(o,w)||!hl(i[w],o[w]))return!1}return!0}function fM(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function mM(i,o){var u=fM(i);i=0;for(var m;u;){if(u.nodeType===3){if(m=i+u.textContent.length,i<=o&&m>=o)return{node:u,offset:o-i};i=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=fM(u)}}function nD(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?nD(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function sD(){for(var i=window,o=Rv();o instanceof i.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)i=o.contentWindow;else break;o=Rv(i.document)}return o}function BT(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function e5(i){var o=sD(),u=i.focusedElem,m=i.selectionRange;if(o!==u&&u&&u.ownerDocument&&nD(u.ownerDocument.documentElement,u)){if(m!==null&&BT(u)){if(o=m.start,i=m.end,i===void 0&&(i=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(i,u.value.length);else if(i=(o=u.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var w=u.textContent.length,E=Math.min(m.start,w);m=m.end===void 0?E:Math.min(m.end,w),!i.extend&&E>m&&(w=m,m=E,E=w),w=mM(u,E);var P=mM(u,m);w&&P&&(i.rangeCount!==1||i.anchorNode!==w.node||i.anchorOffset!==w.offset||i.focusNode!==P.node||i.focusOffset!==P.offset)&&(o=o.createRange(),o.setStart(w.node,w.offset),i.removeAllRanges(),E>m?(i.addRange(o),i.extend(P.node,P.offset)):(o.setEnd(P.node,P.offset),i.addRange(o)))}}for(o=[],i=u;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)i=o[u],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var t5=Fc&&"documentMode"in document&&11>=document.documentMode,Bf=null,uS=null,$_=null,hS=!1;function gM(i,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;hS||Bf==null||Bf!==Rv(m)||(m=Bf,"selectionStart"in m&&BT(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),$_&&ry($_,m)||($_=m,m=Fv(uS,"onSelect"),0<m.length&&(o=new LT("onSelect","select",null,o,u),i.push({event:o,listeners:m}),o.target=Bf)))}function O0(i,o){var u={};return u[i.toLowerCase()]=o.toLowerCase(),u["Webkit"+i]="webkit"+o,u["Moz"+i]="moz"+o,u}var Vf={animationend:O0("Animation","AnimationEnd"),animationiteration:O0("Animation","AnimationIteration"),animationstart:O0("Animation","AnimationStart"),transitionend:O0("Transition","TransitionEnd")},f2={},oD={};Fc&&(oD=document.createElement("div").style,"AnimationEvent"in window||(delete Vf.animationend.animation,delete Vf.animationiteration.animation,delete Vf.animationstart.animation),"TransitionEvent"in window||delete Vf.transitionend.transition);function C1(i){if(f2[i])return f2[i];if(!Vf[i])return i;var o=Vf[i],u;for(u in o)if(o.hasOwnProperty(u)&&u in oD)return f2[i]=o[u];return i}var aD=C1("animationend"),lD=C1("animationiteration"),cD=C1("animationstart"),uD=C1("transitionend"),hD=new Map,_M="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vh(i,o){hD.set(i,o),ap(o,[i])}for(var m2=0;m2<_M.length;m2++){var g2=_M[m2],i5=g2.toLowerCase(),r5=g2[0].toUpperCase()+g2.slice(1);vh(i5,"on"+r5)}vh(aD,"onAnimationEnd");vh(lD,"onAnimationIteration");vh(cD,"onAnimationStart");vh("dblclick","onDoubleClick");vh("focusin","onFocus");vh("focusout","onBlur");vh(uD,"onTransitionEnd");xm("onMouseEnter",["mouseout","mouseover"]);xm("onMouseLeave",["mouseout","mouseover"]);xm("onPointerEnter",["pointerout","pointerover"]);xm("onPointerLeave",["pointerout","pointerover"]);ap("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ap("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ap("onBeforeInput",["compositionend","keypress","textInput","paste"]);ap("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ap("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ap("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var z_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n5=new Set("cancel close invalid load scroll toggle".split(" ").concat(z_));function yM(i,o,u){var m=i.type||"unknown-event";i.currentTarget=u,iB(m,o,void 0,i),i.currentTarget=null}function dD(i,o){o=(o&4)!==0;for(var u=0;u<i.length;u++){var m=i[u],w=m.event;m=m.listeners;e:{var E=void 0;if(o)for(var P=m.length-1;0<=P;P--){var s=m[P],D=s.instance,O=s.currentTarget;if(s=s.listener,D!==E&&w.isPropagationStopped())break e;yM(w,s,O),E=D}else for(P=0;P<m.length;P++){if(s=m[P],D=s.instance,O=s.currentTarget,s=s.listener,D!==E&&w.isPropagationStopped())break e;yM(w,s,O),E=D}}}if(Dv)throw i=oS,Dv=!1,oS=null,i}function Un(i,o){var u=o[gS];u===void 0&&(u=o[gS]=new Set);var m=i+"__bubble";u.has(m)||(pD(o,i,2,!1),u.add(m))}function _2(i,o,u){var m=0;o&&(m|=4),pD(u,i,m,o)}var B0="_reactListening"+Math.random().toString(36).slice(2);function ny(i){if(!i[B0]){i[B0]=!0,vk.forEach(function(u){u!=="selectionchange"&&(n5.has(u)||_2(u,!1,i),_2(u,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[B0]||(o[B0]=!0,_2("selectionchange",!1,o))}}function pD(i,o,u,m){switch(Yk(o)){case 1:var w=yB;break;case 4:w=xB;break;default:w=jT}u=w.bind(null,o,u,i),w=void 0,!sS||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(w=!0),m?w!==void 0?i.addEventListener(o,u,{capture:!0,passive:w}):i.addEventListener(o,u,!0):w!==void 0?i.addEventListener(o,u,{passive:w}):i.addEventListener(o,u,!1)}function y2(i,o,u,m,w){var E=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var P=m.tag;if(P===3||P===4){var s=m.stateNode.containerInfo;if(s===w||s.nodeType===8&&s.parentNode===w)break;if(P===4)for(P=m.return;P!==null;){var D=P.tag;if((D===3||D===4)&&(D=P.stateNode.containerInfo,D===w||D.nodeType===8&&D.parentNode===w))return;P=P.return}for(;s!==null;){if(P=jd(s),P===null)return;if(D=P.tag,D===5||D===6){m=E=P;continue e}s=s.parentNode}}m=m.return}zk(function(){var O=E,H=RT(u),G=[];e:{var U=hD.get(i);if(U!==void 0){var he=LT,de=i;switch(i){case"keypress":if(lv(u)===0)break e;case"keydown":case"keyup":he=NB;break;case"focusin":de="focus",he=h2;break;case"focusout":de="blur",he=h2;break;case"beforeblur":case"afterblur":he=h2;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=oM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=bB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=LB;break;case aD:case lD:case cD:he=EB;break;case uD:he=OB;break;case"scroll":he=vB;break;case"wheel":he=VB;break;case"copy":case"cut":case"paste":he=IB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=lM}var Y=(o&4)!==0,le=!Y&&i==="scroll",re=Y?U!==null?U+"Capture":null:U;Y=[];for(var oe=O,_e;oe!==null;){_e=oe;var Ne=_e.stateNode;if(_e.tag===5&&Ne!==null&&(_e=Ne,re!==null&&(Ne=Q_(oe,re),Ne!=null&&Y.push(sy(oe,Ne,_e)))),le)break;oe=oe.return}0<Y.length&&(U=new he(U,de,null,u,H),G.push({event:U,listeners:Y}))}}if(!(o&7)){e:{if(U=i==="mouseover"||i==="pointerover",he=i==="mouseout"||i==="pointerout",U&&u!==rS&&(de=u.relatedTarget||u.fromElement)&&(jd(de)||de[Oc]))break e;if((he||U)&&(U=H.window===H?H:(U=H.ownerDocument)?U.defaultView||U.parentWindow:window,he?(de=u.relatedTarget||u.toElement,he=O,de=de?jd(de):null,de!==null&&(le=lp(de),de!==le||de.tag!==5&&de.tag!==6)&&(de=null)):(he=null,de=O),he!==de)){if(Y=oM,Ne="onMouseLeave",re="onMouseEnter",oe="mouse",(i==="pointerout"||i==="pointerover")&&(Y=lM,Ne="onPointerLeave",re="onPointerEnter",oe="pointer"),le=he==null?U:Uf(he),_e=de==null?U:Uf(de),U=new Y(Ne,oe+"leave",he,u,H),U.target=le,U.relatedTarget=_e,Ne=null,jd(H)===O&&(Y=new Y(re,oe+"enter",de,u,H),Y.target=_e,Y.relatedTarget=le,Ne=Y),le=Ne,he&&de)t:{for(Y=he,re=de,oe=0,_e=Y;_e;_e=Df(_e))oe++;for(_e=0,Ne=re;Ne;Ne=Df(Ne))_e++;for(;0<oe-_e;)Y=Df(Y),oe--;for(;0<_e-oe;)re=Df(re),_e--;for(;oe--;){if(Y===re||re!==null&&Y===re.alternate)break t;Y=Df(Y),re=Df(re)}Y=null}else Y=null;he!==null&&xM(G,U,he,Y,!1),de!==null&&le!==null&&xM(G,le,de,Y,!0)}}e:{if(U=O?Uf(O):window,he=U.nodeName&&U.nodeName.toLowerCase(),he==="select"||he==="input"&&U.type==="file")var Ge=ZB;else if(hM(U))if(iD)Ge=QB;else{Ge=YB;var pt=XB}else(he=U.nodeName)&&he.toLowerCase()==="input"&&(U.type==="checkbox"||U.type==="radio")&&(Ge=KB);if(Ge&&(Ge=Ge(i,O))){tD(G,Ge,u,H);break e}pt&&pt(i,U,O),i==="focusout"&&(pt=U._wrapperState)&&pt.controlled&&U.type==="number"&&Q2(U,"number",U.value)}switch(pt=O?Uf(O):window,i){case"focusin":(hM(pt)||pt.contentEditable==="true")&&(Bf=pt,uS=O,$_=null);break;case"focusout":$_=uS=Bf=null;break;case"mousedown":hS=!0;break;case"contextmenu":case"mouseup":case"dragend":hS=!1,gM(G,u,H);break;case"selectionchange":if(t5)break;case"keydown":case"keyup":gM(G,u,H)}var ot;if(OT)e:{switch(i){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else Of?Jk(i,u)&&(dt="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(dt="onCompositionStart");dt&&(Qk&&u.locale!=="ko"&&(Of||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&Of&&(ot=Kk()):(th=H,zT="value"in th?th.value:th.textContent,Of=!0)),pt=Fv(O,dt),0<pt.length&&(dt=new aM(dt,i,null,u,H),G.push({event:dt,listeners:pt}),ot?dt.data=ot:(ot=eD(u),ot!==null&&(dt.data=ot)))),(ot=GB?$B(i,u):qB(i,u))&&(O=Fv(O,"onBeforeInput"),0<O.length&&(H=new aM("onBeforeInput","beforeinput",null,u,H),G.push({event:H,listeners:O}),H.data=ot))}dD(G,o)})}function sy(i,o,u){return{instance:i,listener:o,currentTarget:u}}function Fv(i,o){for(var u=o+"Capture",m=[];i!==null;){var w=i,E=w.stateNode;w.tag===5&&E!==null&&(w=E,E=Q_(i,u),E!=null&&m.unshift(sy(i,E,w)),E=Q_(i,o),E!=null&&m.push(sy(i,E,w))),i=i.return}return m}function Df(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function xM(i,o,u,m,w){for(var E=o._reactName,P=[];u!==null&&u!==m;){var s=u,D=s.alternate,O=s.stateNode;if(D!==null&&D===m)break;s.tag===5&&O!==null&&(s=O,w?(D=Q_(u,E),D!=null&&P.unshift(sy(u,D,s))):w||(D=Q_(u,E),D!=null&&P.push(sy(u,D,s)))),u=u.return}P.length!==0&&i.push({event:o,listeners:P})}var s5=/\r\n?/g,o5=/\u0000|\uFFFD/g;function vM(i){return(typeof i=="string"?i:""+i).replace(s5,`
`).replace(o5,"")}function V0(i,o,u){if(o=vM(o),vM(i)!==o&&u)throw Error(Qt(425))}function Ov(){}var dS=null,pS=null;function fS(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var mS=typeof setTimeout=="function"?setTimeout:void 0,a5=typeof clearTimeout=="function"?clearTimeout:void 0,wM=typeof Promise=="function"?Promise:void 0,l5=typeof queueMicrotask=="function"?queueMicrotask:typeof wM<"u"?function(i){return wM.resolve(null).then(i).catch(c5)}:mS;function c5(i){setTimeout(function(){throw i})}function x2(i,o){var u=o,m=0;do{var w=u.nextSibling;if(i.removeChild(u),w&&w.nodeType===8)if(u=w.data,u==="/$"){if(m===0){i.removeChild(w),ty(o);return}m--}else u!=="$"&&u!=="$?"&&u!=="$!"||m++;u=w}while(u);ty(o)}function ah(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function bM(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return i;o--}else u==="/$"&&o++}i=i.previousSibling}return null}var Mm=Math.random().toString(36).slice(2),Hl="__reactFiber$"+Mm,oy="__reactProps$"+Mm,Oc="__reactContainer$"+Mm,gS="__reactEvents$"+Mm,u5="__reactListeners$"+Mm,h5="__reactHandles$"+Mm;function jd(i){var o=i[Hl];if(o)return o;for(var u=i.parentNode;u;){if(o=u[Oc]||u[Hl]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(i=bM(i);i!==null;){if(u=i[Hl])return u;i=bM(i)}return o}i=u,u=i.parentNode}return null}function Ey(i){return i=i[Hl]||i[Oc],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Uf(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Qt(33))}function I1(i){return i[oy]||null}var _S=[],Gf=-1;function wh(i){return{current:i}}function Gn(i){0>Gf||(i.current=_S[Gf],_S[Gf]=null,Gf--)}function zn(i,o){Gf++,_S[Gf]=i.current,i.current=o}var mh={},lo=wh(mh),Go=wh(!1),Xd=mh;function vm(i,o){var u=i.type.contextTypes;if(!u)return mh;var m=i.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var w={},E;for(E in u)w[E]=o[E];return m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=w),w}function $o(i){return i=i.childContextTypes,i!=null}function Bv(){Gn(Go),Gn(lo)}function SM(i,o,u){if(lo.current!==mh)throw Error(Qt(168));zn(lo,o),zn(Go,u)}function fD(i,o,u){var m=i.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return u;m=m.getChildContext();for(var w in m)if(!(w in o))throw Error(Qt(108,X4(i)||"Unknown",w));return Kn({},u,m)}function Vv(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||mh,Xd=lo.current,zn(lo,i),zn(Go,Go.current),!0}function TM(i,o,u){var m=i.stateNode;if(!m)throw Error(Qt(169));u?(i=fD(i,o,Xd),m.__reactInternalMemoizedMergedChildContext=i,Gn(Go),Gn(lo),zn(lo,i)):Gn(Go),zn(Go,u)}var kc=null,A1=!1,v2=!1;function mD(i){kc===null?kc=[i]:kc.push(i)}function d5(i){A1=!0,mD(i)}function bh(){if(!v2&&kc!==null){v2=!0;var i=0,o=En;try{var u=kc;for(En=1;i<u.length;i++){var m=u[i];do m=m(!0);while(m!==null)}kc=null,A1=!1}catch(w){throw kc!==null&&(kc=kc.slice(i+1)),Bk(kT,bh),w}finally{En=o,v2=!1}}return null}var $f=[],qf=0,Uv=null,Gv=0,Ra=[],ka=0,Yd=null,Nc=1,jc="";function Dd(i,o){$f[qf++]=Gv,$f[qf++]=Uv,Uv=i,Gv=o}function gD(i,o,u){Ra[ka++]=Nc,Ra[ka++]=jc,Ra[ka++]=Yd,Yd=i;var m=Nc;i=jc;var w=32-cl(m)-1;m&=~(1<<w),u+=1;var E=32-cl(o)+w;if(30<E){var P=w-w%5;E=(m&(1<<P)-1).toString(32),m>>=P,w-=P,Nc=1<<32-cl(o)+w|u<<w|m,jc=E+i}else Nc=1<<E|u<<w|m,jc=i}function VT(i){i.return!==null&&(Dd(i,1),gD(i,1,0))}function UT(i){for(;i===Uv;)Uv=$f[--qf],$f[qf]=null,Gv=$f[--qf],$f[qf]=null;for(;i===Yd;)Yd=Ra[--ka],Ra[ka]=null,jc=Ra[--ka],Ra[ka]=null,Nc=Ra[--ka],Ra[ka]=null}var da=null,ha=null,qn=!1,al=null;function _D(i,o){var u=Da(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=i,o=i.deletions,o===null?(i.deletions=[u],i.flags|=16):o.push(u)}function EM(i,o){switch(i.tag){case 5:var u=i.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,da=i,ha=ah(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,da=i,ha=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=Yd!==null?{id:Nc,overflow:jc}:null,i.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=Da(18,null,null,0),u.stateNode=o,u.return=i,i.child=u,da=i,ha=null,!0):!1;default:return!1}}function yS(i){return(i.mode&1)!==0&&(i.flags&128)===0}function xS(i){if(qn){var o=ha;if(o){var u=o;if(!EM(i,o)){if(yS(i))throw Error(Qt(418));o=ah(u.nextSibling);var m=da;o&&EM(i,o)?_D(m,u):(i.flags=i.flags&-4097|2,qn=!1,da=i)}}else{if(yS(i))throw Error(Qt(418));i.flags=i.flags&-4097|2,qn=!1,da=i}}}function CM(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;da=i}function U0(i){if(i!==da)return!1;if(!qn)return CM(i),qn=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!fS(i.type,i.memoizedProps)),o&&(o=ha)){if(yS(i))throw yD(),Error(Qt(418));for(;o;)_D(i,o),o=ah(o.nextSibling)}if(CM(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Qt(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"){if(o===0){ha=ah(i.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}i=i.nextSibling}ha=null}}else ha=da?ah(i.stateNode.nextSibling):null;return!0}function yD(){for(var i=ha;i;)i=ah(i.nextSibling)}function wm(){ha=da=null,qn=!1}function GT(i){al===null?al=[i]:al.push(i)}var p5=Hc.ReactCurrentBatchConfig;function A_(i,o,u){if(i=u.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(Qt(309));var m=u.stateNode}if(!m)throw Error(Qt(147,i));var w=m,E=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===E?o.ref:(o=function(P){var s=w.refs;P===null?delete s[E]:s[E]=P},o._stringRef=E,o)}if(typeof i!="string")throw Error(Qt(284));if(!u._owner)throw Error(Qt(290,i))}return i}function G0(i,o){throw i=Object.prototype.toString.call(o),Error(Qt(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function IM(i){var o=i._init;return o(i._payload)}function xD(i){function o(re,oe){if(i){var _e=re.deletions;_e===null?(re.deletions=[oe],re.flags|=16):_e.push(oe)}}function u(re,oe){if(!i)return null;for(;oe!==null;)o(re,oe),oe=oe.sibling;return null}function m(re,oe){for(re=new Map;oe!==null;)oe.key!==null?re.set(oe.key,oe):re.set(oe.index,oe),oe=oe.sibling;return re}function w(re,oe){return re=hh(re,oe),re.index=0,re.sibling=null,re}function E(re,oe,_e){return re.index=_e,i?(_e=re.alternate,_e!==null?(_e=_e.index,_e<oe?(re.flags|=2,oe):_e):(re.flags|=2,oe)):(re.flags|=1048576,oe)}function P(re){return i&&re.alternate===null&&(re.flags|=2),re}function s(re,oe,_e,Ne){return oe===null||oe.tag!==6?(oe=I2(_e,re.mode,Ne),oe.return=re,oe):(oe=w(oe,_e),oe.return=re,oe)}function D(re,oe,_e,Ne){var Ge=_e.type;return Ge===Ff?H(re,oe,_e.props.children,Ne,_e.key):oe!==null&&(oe.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===Uu&&IM(Ge)===oe.type)?(Ne=w(oe,_e.props),Ne.ref=A_(re,oe,_e),Ne.return=re,Ne):(Ne=mv(_e.type,_e.key,_e.props,null,re.mode,Ne),Ne.ref=A_(re,oe,_e),Ne.return=re,Ne)}function O(re,oe,_e,Ne){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==_e.containerInfo||oe.stateNode.implementation!==_e.implementation?(oe=A2(_e,re.mode,Ne),oe.return=re,oe):(oe=w(oe,_e.children||[]),oe.return=re,oe)}function H(re,oe,_e,Ne,Ge){return oe===null||oe.tag!==7?(oe=Hd(_e,re.mode,Ne,Ge),oe.return=re,oe):(oe=w(oe,_e),oe.return=re,oe)}function G(re,oe,_e){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=I2(""+oe,re.mode,_e),oe.return=re,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case k0:return _e=mv(oe.type,oe.key,oe.props,null,re.mode,_e),_e.ref=A_(re,null,oe),_e.return=re,_e;case Lf:return oe=A2(oe,re.mode,_e),oe.return=re,oe;case Uu:var Ne=oe._init;return G(re,Ne(oe._payload),_e)}if(N_(oe)||S_(oe))return oe=Hd(oe,re.mode,_e,null),oe.return=re,oe;G0(re,oe)}return null}function U(re,oe,_e,Ne){var Ge=oe!==null?oe.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number")return Ge!==null?null:s(re,oe,""+_e,Ne);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case k0:return _e.key===Ge?D(re,oe,_e,Ne):null;case Lf:return _e.key===Ge?O(re,oe,_e,Ne):null;case Uu:return Ge=_e._init,U(re,oe,Ge(_e._payload),Ne)}if(N_(_e)||S_(_e))return Ge!==null?null:H(re,oe,_e,Ne,null);G0(re,_e)}return null}function he(re,oe,_e,Ne,Ge){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return re=re.get(_e)||null,s(oe,re,""+Ne,Ge);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case k0:return re=re.get(Ne.key===null?_e:Ne.key)||null,D(oe,re,Ne,Ge);case Lf:return re=re.get(Ne.key===null?_e:Ne.key)||null,O(oe,re,Ne,Ge);case Uu:var pt=Ne._init;return he(re,oe,_e,pt(Ne._payload),Ge)}if(N_(Ne)||S_(Ne))return re=re.get(_e)||null,H(oe,re,Ne,Ge,null);G0(oe,Ne)}return null}function de(re,oe,_e,Ne){for(var Ge=null,pt=null,ot=oe,dt=oe=0,Bt=null;ot!==null&&dt<_e.length;dt++){ot.index>dt?(Bt=ot,ot=null):Bt=ot.sibling;var Wt=U(re,ot,_e[dt],Ne);if(Wt===null){ot===null&&(ot=Bt);break}i&&ot&&Wt.alternate===null&&o(re,ot),oe=E(Wt,oe,dt),pt===null?Ge=Wt:pt.sibling=Wt,pt=Wt,ot=Bt}if(dt===_e.length)return u(re,ot),qn&&Dd(re,dt),Ge;if(ot===null){for(;dt<_e.length;dt++)ot=G(re,_e[dt],Ne),ot!==null&&(oe=E(ot,oe,dt),pt===null?Ge=ot:pt.sibling=ot,pt=ot);return qn&&Dd(re,dt),Ge}for(ot=m(re,ot);dt<_e.length;dt++)Bt=he(ot,re,dt,_e[dt],Ne),Bt!==null&&(i&&Bt.alternate!==null&&ot.delete(Bt.key===null?dt:Bt.key),oe=E(Bt,oe,dt),pt===null?Ge=Bt:pt.sibling=Bt,pt=Bt);return i&&ot.forEach(function(Ht){return o(re,Ht)}),qn&&Dd(re,dt),Ge}function Y(re,oe,_e,Ne){var Ge=S_(_e);if(typeof Ge!="function")throw Error(Qt(150));if(_e=Ge.call(_e),_e==null)throw Error(Qt(151));for(var pt=Ge=null,ot=oe,dt=oe=0,Bt=null,Wt=_e.next();ot!==null&&!Wt.done;dt++,Wt=_e.next()){ot.index>dt?(Bt=ot,ot=null):Bt=ot.sibling;var Ht=U(re,ot,Wt.value,Ne);if(Ht===null){ot===null&&(ot=Bt);break}i&&ot&&Ht.alternate===null&&o(re,ot),oe=E(Ht,oe,dt),pt===null?Ge=Ht:pt.sibling=Ht,pt=Ht,ot=Bt}if(Wt.done)return u(re,ot),qn&&Dd(re,dt),Ge;if(ot===null){for(;!Wt.done;dt++,Wt=_e.next())Wt=G(re,Wt.value,Ne),Wt!==null&&(oe=E(Wt,oe,dt),pt===null?Ge=Wt:pt.sibling=Wt,pt=Wt);return qn&&Dd(re,dt),Ge}for(ot=m(re,ot);!Wt.done;dt++,Wt=_e.next())Wt=he(ot,re,dt,Wt.value,Ne),Wt!==null&&(i&&Wt.alternate!==null&&ot.delete(Wt.key===null?dt:Wt.key),oe=E(Wt,oe,dt),pt===null?Ge=Wt:pt.sibling=Wt,pt=Wt);return i&&ot.forEach(function(ei){return o(re,ei)}),qn&&Dd(re,dt),Ge}function le(re,oe,_e,Ne){if(typeof _e=="object"&&_e!==null&&_e.type===Ff&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case k0:e:{for(var Ge=_e.key,pt=oe;pt!==null;){if(pt.key===Ge){if(Ge=_e.type,Ge===Ff){if(pt.tag===7){u(re,pt.sibling),oe=w(pt,_e.props.children),oe.return=re,re=oe;break e}}else if(pt.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===Uu&&IM(Ge)===pt.type){u(re,pt.sibling),oe=w(pt,_e.props),oe.ref=A_(re,pt,_e),oe.return=re,re=oe;break e}u(re,pt);break}else o(re,pt);pt=pt.sibling}_e.type===Ff?(oe=Hd(_e.props.children,re.mode,Ne,_e.key),oe.return=re,re=oe):(Ne=mv(_e.type,_e.key,_e.props,null,re.mode,Ne),Ne.ref=A_(re,oe,_e),Ne.return=re,re=Ne)}return P(re);case Lf:e:{for(pt=_e.key;oe!==null;){if(oe.key===pt)if(oe.tag===4&&oe.stateNode.containerInfo===_e.containerInfo&&oe.stateNode.implementation===_e.implementation){u(re,oe.sibling),oe=w(oe,_e.children||[]),oe.return=re,re=oe;break e}else{u(re,oe);break}else o(re,oe);oe=oe.sibling}oe=A2(_e,re.mode,Ne),oe.return=re,re=oe}return P(re);case Uu:return pt=_e._init,le(re,oe,pt(_e._payload),Ne)}if(N_(_e))return de(re,oe,_e,Ne);if(S_(_e))return Y(re,oe,_e,Ne);G0(re,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"?(_e=""+_e,oe!==null&&oe.tag===6?(u(re,oe.sibling),oe=w(oe,_e),oe.return=re,re=oe):(u(re,oe),oe=I2(_e,re.mode,Ne),oe.return=re,re=oe),P(re)):u(re,oe)}return le}var bm=xD(!0),vD=xD(!1),$v=wh(null),qv=null,Hf=null,$T=null;function qT(){$T=Hf=qv=null}function HT(i){var o=$v.current;Gn($v),i._currentValue=o}function vS(i,o,u){for(;i!==null;){var m=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),i===u)break;i=i.return}}function Jf(i,o){qv=i,$T=Hf=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&(Uo=!0),i.firstContext=null)}function ja(i){var o=i._currentValue;if($T!==i)if(i={context:i,memoizedValue:o,next:null},Hf===null){if(qv===null)throw Error(Qt(308));Hf=i,qv.dependencies={lanes:0,firstContext:i}}else Hf=Hf.next=i;return o}var zd=null;function WT(i){zd===null?zd=[i]:zd.push(i)}function wD(i,o,u,m){var w=o.interleaved;return w===null?(u.next=u,WT(o)):(u.next=w.next,w.next=u),o.interleaved=u,Bc(i,m)}function Bc(i,o){i.lanes|=o;var u=i.alternate;for(u!==null&&(u.lanes|=o),u=i,i=i.return;i!==null;)i.childLanes|=o,u=i.alternate,u!==null&&(u.childLanes|=o),u=i,i=i.return;return u.tag===3?u.stateNode:null}var Gu=!1;function ZT(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bD(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function zc(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function lh(i,o,u){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,_n&2){var w=m.pending;return w===null?o.next=o:(o.next=w.next,w.next=o),m.pending=o,Bc(i,u)}return w=m.interleaved,w===null?(o.next=o,WT(m)):(o.next=w.next,w.next=o),m.interleaved=o,Bc(i,u)}function cv(i,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var m=o.lanes;m&=i.pendingLanes,u|=m,o.lanes=u,DT(i,u)}}function AM(i,o){var u=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var w=null,E=null;if(u=u.firstBaseUpdate,u!==null){do{var P={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};E===null?w=E=P:E=E.next=P,u=u.next}while(u!==null);E===null?w=E=o:E=E.next=o}else w=E=o;u={baseState:m.baseState,firstBaseUpdate:w,lastBaseUpdate:E,shared:m.shared,effects:m.effects},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=o:i.next=o,u.lastBaseUpdate=o}function Hv(i,o,u,m){var w=i.updateQueue;Gu=!1;var E=w.firstBaseUpdate,P=w.lastBaseUpdate,s=w.shared.pending;if(s!==null){w.shared.pending=null;var D=s,O=D.next;D.next=null,P===null?E=O:P.next=O,P=D;var H=i.alternate;H!==null&&(H=H.updateQueue,s=H.lastBaseUpdate,s!==P&&(s===null?H.firstBaseUpdate=O:s.next=O,H.lastBaseUpdate=D))}if(E!==null){var G=w.baseState;P=0,H=O=D=null,s=E;do{var U=s.lane,he=s.eventTime;if((m&U)===U){H!==null&&(H=H.next={eventTime:he,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var de=i,Y=s;switch(U=o,he=u,Y.tag){case 1:if(de=Y.payload,typeof de=="function"){G=de.call(he,G,U);break e}G=de;break e;case 3:de.flags=de.flags&-65537|128;case 0:if(de=Y.payload,U=typeof de=="function"?de.call(he,G,U):de,U==null)break e;G=Kn({},G,U);break e;case 2:Gu=!0}}s.callback!==null&&s.lane!==0&&(i.flags|=64,U=w.effects,U===null?w.effects=[s]:U.push(s))}else he={eventTime:he,lane:U,tag:s.tag,payload:s.payload,callback:s.callback,next:null},H===null?(O=H=he,D=G):H=H.next=he,P|=U;if(s=s.next,s===null){if(s=w.shared.pending,s===null)break;U=s,s=U.next,U.next=null,w.lastBaseUpdate=U,w.shared.pending=null}}while(!0);if(H===null&&(D=G),w.baseState=D,w.firstBaseUpdate=O,w.lastBaseUpdate=H,o=w.shared.interleaved,o!==null){w=o;do P|=w.lane,w=w.next;while(w!==o)}else E===null&&(w.shared.lanes=0);Qd|=P,i.lanes=P,i.memoizedState=G}}function PM(i,o,u){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var m=i[o],w=m.callback;if(w!==null){if(m.callback=null,m=u,typeof w!="function")throw Error(Qt(191,w));w.call(m)}}}var Cy={},Xl=wh(Cy),ay=wh(Cy),ly=wh(Cy);function Ld(i){if(i===Cy)throw Error(Qt(174));return i}function XT(i,o){switch(zn(ly,o),zn(ay,i),zn(Xl,Cy),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:eS(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=eS(o,i)}Gn(Xl),zn(Xl,o)}function Sm(){Gn(Xl),Gn(ay),Gn(ly)}function SD(i){Ld(ly.current);var o=Ld(Xl.current),u=eS(o,i.type);o!==u&&(zn(ay,i),zn(Xl,u))}function YT(i){ay.current===i&&(Gn(Xl),Gn(ay))}var Zn=wh(0);function Wv(i){for(var o=i;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var w2=[];function KT(){for(var i=0;i<w2.length;i++)w2[i]._workInProgressVersionPrimary=null;w2.length=0}var uv=Hc.ReactCurrentDispatcher,b2=Hc.ReactCurrentBatchConfig,Kd=0,Yn=null,Es=null,zs=null,Zv=!1,q_=!1,cy=0,f5=0;function ro(){throw Error(Qt(321))}function QT(i,o){if(o===null)return!1;for(var u=0;u<o.length&&u<i.length;u++)if(!hl(i[u],o[u]))return!1;return!0}function JT(i,o,u,m,w,E){if(Kd=E,Yn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,uv.current=i===null||i.memoizedState===null?y5:x5,i=u(m,w),q_){E=0;do{if(q_=!1,cy=0,25<=E)throw Error(Qt(301));E+=1,zs=Es=null,o.updateQueue=null,uv.current=v5,i=u(m,w)}while(q_)}if(uv.current=Xv,o=Es!==null&&Es.next!==null,Kd=0,zs=Es=Yn=null,Zv=!1,o)throw Error(Qt(300));return i}function eE(){var i=cy!==0;return cy=0,i}function Vl(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zs===null?Yn.memoizedState=zs=i:zs=zs.next=i,zs}function za(){if(Es===null){var i=Yn.alternate;i=i!==null?i.memoizedState:null}else i=Es.next;var o=zs===null?Yn.memoizedState:zs.next;if(o!==null)zs=o,Es=i;else{if(i===null)throw Error(Qt(310));Es=i,i={memoizedState:Es.memoizedState,baseState:Es.baseState,baseQueue:Es.baseQueue,queue:Es.queue,next:null},zs===null?Yn.memoizedState=zs=i:zs=zs.next=i}return zs}function uy(i,o){return typeof o=="function"?o(i):o}function S2(i){var o=za(),u=o.queue;if(u===null)throw Error(Qt(311));u.lastRenderedReducer=i;var m=Es,w=m.baseQueue,E=u.pending;if(E!==null){if(w!==null){var P=w.next;w.next=E.next,E.next=P}m.baseQueue=w=E,u.pending=null}if(w!==null){E=w.next,m=m.baseState;var s=P=null,D=null,O=E;do{var H=O.lane;if((Kd&H)===H)D!==null&&(D=D.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),m=O.hasEagerState?O.eagerState:i(m,O.action);else{var G={lane:H,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};D===null?(s=D=G,P=m):D=D.next=G,Yn.lanes|=H,Qd|=H}O=O.next}while(O!==null&&O!==E);D===null?P=m:D.next=s,hl(m,o.memoizedState)||(Uo=!0),o.memoizedState=m,o.baseState=P,o.baseQueue=D,u.lastRenderedState=m}if(i=u.interleaved,i!==null){w=i;do E=w.lane,Yn.lanes|=E,Qd|=E,w=w.next;while(w!==i)}else w===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function T2(i){var o=za(),u=o.queue;if(u===null)throw Error(Qt(311));u.lastRenderedReducer=i;var m=u.dispatch,w=u.pending,E=o.memoizedState;if(w!==null){u.pending=null;var P=w=w.next;do E=i(E,P.action),P=P.next;while(P!==w);hl(E,o.memoizedState)||(Uo=!0),o.memoizedState=E,o.baseQueue===null&&(o.baseState=E),u.lastRenderedState=E}return[E,m]}function TD(){}function ED(i,o){var u=Yn,m=za(),w=o(),E=!hl(m.memoizedState,w);if(E&&(m.memoizedState=w,Uo=!0),m=m.queue,tE(AD.bind(null,u,m,i),[i]),m.getSnapshot!==o||E||zs!==null&&zs.memoizedState.tag&1){if(u.flags|=2048,hy(9,ID.bind(null,u,m,w,o),void 0,null),Fs===null)throw Error(Qt(349));Kd&30||CD(u,o,w)}return w}function CD(i,o,u){i.flags|=16384,i={getSnapshot:o,value:u},o=Yn.updateQueue,o===null?(o={lastEffect:null,stores:null},Yn.updateQueue=o,o.stores=[i]):(u=o.stores,u===null?o.stores=[i]:u.push(i))}function ID(i,o,u,m){o.value=u,o.getSnapshot=m,PD(o)&&MD(i)}function AD(i,o,u){return u(function(){PD(o)&&MD(i)})}function PD(i){var o=i.getSnapshot;i=i.value;try{var u=o();return!hl(i,u)}catch{return!0}}function MD(i){var o=Bc(i,1);o!==null&&ul(o,i,1,-1)}function MM(i){var o=Vl();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uy,lastRenderedState:i},o.queue=i,i=i.dispatch=_5.bind(null,Yn,i),[o.memoizedState,i]}function hy(i,o,u,m){return i={tag:i,create:o,destroy:u,deps:m,next:null},o=Yn.updateQueue,o===null?(o={lastEffect:null,stores:null},Yn.updateQueue=o,o.lastEffect=i.next=i):(u=o.lastEffect,u===null?o.lastEffect=i.next=i:(m=u.next,u.next=i,i.next=m,o.lastEffect=i)),i}function RD(){return za().memoizedState}function hv(i,o,u,m){var w=Vl();Yn.flags|=i,w.memoizedState=hy(1|o,u,void 0,m===void 0?null:m)}function P1(i,o,u,m){var w=za();m=m===void 0?null:m;var E=void 0;if(Es!==null){var P=Es.memoizedState;if(E=P.destroy,m!==null&&QT(m,P.deps)){w.memoizedState=hy(o,u,E,m);return}}Yn.flags|=i,w.memoizedState=hy(1|o,u,E,m)}function RM(i,o){return hv(8390656,8,i,o)}function tE(i,o){return P1(2048,8,i,o)}function kD(i,o){return P1(4,2,i,o)}function DD(i,o){return P1(4,4,i,o)}function ND(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function jD(i,o,u){return u=u!=null?u.concat([i]):null,P1(4,4,ND.bind(null,o,i),u)}function iE(){}function zD(i,o){var u=za();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&QT(o,m[1])?m[0]:(u.memoizedState=[i,o],i)}function LD(i,o){var u=za();o=o===void 0?null:o;var m=u.memoizedState;return m!==null&&o!==null&&QT(o,m[1])?m[0]:(i=i(),u.memoizedState=[i,o],i)}function FD(i,o,u){return Kd&21?(hl(u,o)||(u=Gk(),Yn.lanes|=u,Qd|=u,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,Uo=!0),i.memoizedState=u)}function m5(i,o){var u=En;En=u!==0&&4>u?u:4,i(!0);var m=b2.transition;b2.transition={};try{i(!1),o()}finally{En=u,b2.transition=m}}function OD(){return za().memoizedState}function g5(i,o,u){var m=uh(i);if(u={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null},BD(i))VD(o,u);else if(u=wD(i,o,u,m),u!==null){var w=bo();ul(u,i,m,w),UD(u,o,m)}}function _5(i,o,u){var m=uh(i),w={lane:m,action:u,hasEagerState:!1,eagerState:null,next:null};if(BD(i))VD(o,w);else{var E=i.alternate;if(i.lanes===0&&(E===null||E.lanes===0)&&(E=o.lastRenderedReducer,E!==null))try{var P=o.lastRenderedState,s=E(P,u);if(w.hasEagerState=!0,w.eagerState=s,hl(s,P)){var D=o.interleaved;D===null?(w.next=w,WT(o)):(w.next=D.next,D.next=w),o.interleaved=w;return}}catch{}finally{}u=wD(i,o,w,m),u!==null&&(w=bo(),ul(u,i,m,w),UD(u,o,m))}}function BD(i){var o=i.alternate;return i===Yn||o!==null&&o===Yn}function VD(i,o){q_=Zv=!0;var u=i.pending;u===null?o.next=o:(o.next=u.next,u.next=o),i.pending=o}function UD(i,o,u){if(u&4194240){var m=o.lanes;m&=i.pendingLanes,u|=m,o.lanes=u,DT(i,u)}}var Xv={readContext:ja,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useInsertionEffect:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useSyncExternalStore:ro,useId:ro,unstable_isNewReconciler:!1},y5={readContext:ja,useCallback:function(i,o){return Vl().memoizedState=[i,o===void 0?null:o],i},useContext:ja,useEffect:RM,useImperativeHandle:function(i,o,u){return u=u!=null?u.concat([i]):null,hv(4194308,4,ND.bind(null,o,i),u)},useLayoutEffect:function(i,o){return hv(4194308,4,i,o)},useInsertionEffect:function(i,o){return hv(4,2,i,o)},useMemo:function(i,o){var u=Vl();return o=o===void 0?null:o,i=i(),u.memoizedState=[i,o],i},useReducer:function(i,o,u){var m=Vl();return o=u!==void 0?u(o):o,m.memoizedState=m.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},m.queue=i,i=i.dispatch=g5.bind(null,Yn,i),[m.memoizedState,i]},useRef:function(i){var o=Vl();return i={current:i},o.memoizedState=i},useState:MM,useDebugValue:iE,useDeferredValue:function(i){return Vl().memoizedState=i},useTransition:function(){var i=MM(!1),o=i[0];return i=m5.bind(null,i[1]),Vl().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,u){var m=Yn,w=Vl();if(qn){if(u===void 0)throw Error(Qt(407));u=u()}else{if(u=o(),Fs===null)throw Error(Qt(349));Kd&30||CD(m,o,u)}w.memoizedState=u;var E={value:u,getSnapshot:o};return w.queue=E,RM(AD.bind(null,m,E,i),[i]),m.flags|=2048,hy(9,ID.bind(null,m,E,u,o),void 0,null),u},useId:function(){var i=Vl(),o=Fs.identifierPrefix;if(qn){var u=jc,m=Nc;u=(m&~(1<<32-cl(m)-1)).toString(32)+u,o=":"+o+"R"+u,u=cy++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=f5++,o=":"+o+"r"+u.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},x5={readContext:ja,useCallback:zD,useContext:ja,useEffect:tE,useImperativeHandle:jD,useInsertionEffect:kD,useLayoutEffect:DD,useMemo:LD,useReducer:S2,useRef:RD,useState:function(){return S2(uy)},useDebugValue:iE,useDeferredValue:function(i){var o=za();return FD(o,Es.memoizedState,i)},useTransition:function(){var i=S2(uy)[0],o=za().memoizedState;return[i,o]},useMutableSource:TD,useSyncExternalStore:ED,useId:OD,unstable_isNewReconciler:!1},v5={readContext:ja,useCallback:zD,useContext:ja,useEffect:tE,useImperativeHandle:jD,useInsertionEffect:kD,useLayoutEffect:DD,useMemo:LD,useReducer:T2,useRef:RD,useState:function(){return T2(uy)},useDebugValue:iE,useDeferredValue:function(i){var o=za();return Es===null?o.memoizedState=i:FD(o,Es.memoizedState,i)},useTransition:function(){var i=T2(uy)[0],o=za().memoizedState;return[i,o]},useMutableSource:TD,useSyncExternalStore:ED,useId:OD,unstable_isNewReconciler:!1};function nl(i,o){if(i&&i.defaultProps){o=Kn({},o),i=i.defaultProps;for(var u in i)o[u]===void 0&&(o[u]=i[u]);return o}return o}function wS(i,o,u,m){o=i.memoizedState,u=u(m,o),u=u==null?o:Kn({},o,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var M1={isMounted:function(i){return(i=i._reactInternals)?lp(i)===i:!1},enqueueSetState:function(i,o,u){i=i._reactInternals;var m=bo(),w=uh(i),E=zc(m,w);E.payload=o,u!=null&&(E.callback=u),o=lh(i,E,w),o!==null&&(ul(o,i,w,m),cv(o,i,w))},enqueueReplaceState:function(i,o,u){i=i._reactInternals;var m=bo(),w=uh(i),E=zc(m,w);E.tag=1,E.payload=o,u!=null&&(E.callback=u),o=lh(i,E,w),o!==null&&(ul(o,i,w,m),cv(o,i,w))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var u=bo(),m=uh(i),w=zc(u,m);w.tag=2,o!=null&&(w.callback=o),o=lh(i,w,m),o!==null&&(ul(o,i,m,u),cv(o,i,m))}};function kM(i,o,u,m,w,E,P){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,E,P):o.prototype&&o.prototype.isPureReactComponent?!ry(u,m)||!ry(w,E):!0}function GD(i,o,u){var m=!1,w=mh,E=o.contextType;return typeof E=="object"&&E!==null?E=ja(E):(w=$o(o)?Xd:lo.current,m=o.contextTypes,E=(m=m!=null)?vm(i,w):mh),o=new o(u,E),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=M1,i.stateNode=o,o._reactInternals=i,m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=w,i.__reactInternalMemoizedMaskedChildContext=E),o}function DM(i,o,u,m){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==i&&M1.enqueueReplaceState(o,o.state,null)}function bS(i,o,u,m){var w=i.stateNode;w.props=u,w.state=i.memoizedState,w.refs={},ZT(i);var E=o.contextType;typeof E=="object"&&E!==null?w.context=ja(E):(E=$o(o)?Xd:lo.current,w.context=vm(i,E)),w.state=i.memoizedState,E=o.getDerivedStateFromProps,typeof E=="function"&&(wS(i,o,E,u),w.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(o=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),o!==w.state&&M1.enqueueReplaceState(w,w.state,null),Hv(i,u,w,m),w.state=i.memoizedState),typeof w.componentDidMount=="function"&&(i.flags|=4194308)}function Tm(i,o){try{var u="",m=o;do u+=Z4(m),m=m.return;while(m);var w=u}catch(E){w=`
Error generating stack: `+E.message+`
`+E.stack}return{value:i,source:o,stack:w,digest:null}}function E2(i,o,u){return{value:i,source:null,stack:u??null,digest:o??null}}function SS(i,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var w5=typeof WeakMap=="function"?WeakMap:Map;function $D(i,o,u){u=zc(-1,u),u.tag=3,u.payload={element:null};var m=o.value;return u.callback=function(){Kv||(Kv=!0,DS=m),SS(i,o)},u}function qD(i,o,u){u=zc(-1,u),u.tag=3;var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var w=o.value;u.payload=function(){return m(w)},u.callback=function(){SS(i,o)}}var E=i.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(u.callback=function(){SS(i,o),typeof m!="function"&&(ch===null?ch=new Set([this]):ch.add(this));var P=o.stack;this.componentDidCatch(o.value,{componentStack:P!==null?P:""})}),u}function NM(i,o,u){var m=i.pingCache;if(m===null){m=i.pingCache=new w5;var w=new Set;m.set(o,w)}else w=m.get(o),w===void 0&&(w=new Set,m.set(o,w));w.has(u)||(w.add(u),i=j5.bind(null,i,o,u),o.then(i,i))}function jM(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function zM(i,o,u,m,w){return i.mode&1?(i.flags|=65536,i.lanes=w,i):(i===o?i.flags|=65536:(i.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=zc(-1,1),o.tag=2,lh(u,o,1))),u.lanes|=1),i)}var b5=Hc.ReactCurrentOwner,Uo=!1;function wo(i,o,u,m){o.child=i===null?vD(o,null,u,m):bm(o,i.child,u,m)}function LM(i,o,u,m,w){u=u.render;var E=o.ref;return Jf(o,w),m=JT(i,o,u,m,E,w),u=eE(),i!==null&&!Uo?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~w,Vc(i,o,w)):(qn&&u&&VT(o),o.flags|=1,wo(i,o,m,w),o.child)}function FM(i,o,u,m,w){if(i===null){var E=u.type;return typeof E=="function"&&!uE(E)&&E.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=E,HD(i,o,E,m,w)):(i=mv(u.type,null,m,o,o.mode,w),i.ref=o.ref,i.return=o,o.child=i)}if(E=i.child,!(i.lanes&w)){var P=E.memoizedProps;if(u=u.compare,u=u!==null?u:ry,u(P,m)&&i.ref===o.ref)return Vc(i,o,w)}return o.flags|=1,i=hh(E,m),i.ref=o.ref,i.return=o,o.child=i}function HD(i,o,u,m,w){if(i!==null){var E=i.memoizedProps;if(ry(E,m)&&i.ref===o.ref)if(Uo=!1,o.pendingProps=m=E,(i.lanes&w)!==0)i.flags&131072&&(Uo=!0);else return o.lanes=i.lanes,Vc(i,o,w)}return TS(i,o,u,m,w)}function WD(i,o,u){var m=o.pendingProps,w=m.children,E=i!==null?i.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},zn(Zf,ca),ca|=u;else{if(!(u&1073741824))return i=E!==null?E.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,zn(Zf,ca),ca|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=E!==null?E.baseLanes:u,zn(Zf,ca),ca|=m}else E!==null?(m=E.baseLanes|u,o.memoizedState=null):m=u,zn(Zf,ca),ca|=m;return wo(i,o,w,u),o.child}function ZD(i,o){var u=o.ref;(i===null&&u!==null||i!==null&&i.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function TS(i,o,u,m,w){var E=$o(u)?Xd:lo.current;return E=vm(o,E),Jf(o,w),u=JT(i,o,u,m,E,w),m=eE(),i!==null&&!Uo?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~w,Vc(i,o,w)):(qn&&m&&VT(o),o.flags|=1,wo(i,o,u,w),o.child)}function OM(i,o,u,m,w){if($o(u)){var E=!0;Vv(o)}else E=!1;if(Jf(o,w),o.stateNode===null)dv(i,o),GD(o,u,m),bS(o,u,m,w),m=!0;else if(i===null){var P=o.stateNode,s=o.memoizedProps;P.props=s;var D=P.context,O=u.contextType;typeof O=="object"&&O!==null?O=ja(O):(O=$o(u)?Xd:lo.current,O=vm(o,O));var H=u.getDerivedStateFromProps,G=typeof H=="function"||typeof P.getSnapshotBeforeUpdate=="function";G||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(s!==m||D!==O)&&DM(o,P,m,O),Gu=!1;var U=o.memoizedState;P.state=U,Hv(o,m,P,w),D=o.memoizedState,s!==m||U!==D||Go.current||Gu?(typeof H=="function"&&(wS(o,u,H,m),D=o.memoizedState),(s=Gu||kM(o,u,s,m,U,D,O))?(G||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(o.flags|=4194308)):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=D),P.props=m,P.state=D,P.context=O,m=s):(typeof P.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{P=o.stateNode,bD(i,o),s=o.memoizedProps,O=o.type===o.elementType?s:nl(o.type,s),P.props=O,G=o.pendingProps,U=P.context,D=u.contextType,typeof D=="object"&&D!==null?D=ja(D):(D=$o(u)?Xd:lo.current,D=vm(o,D));var he=u.getDerivedStateFromProps;(H=typeof he=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(s!==G||U!==D)&&DM(o,P,m,D),Gu=!1,U=o.memoizedState,P.state=U,Hv(o,m,P,w);var de=o.memoizedState;s!==G||U!==de||Go.current||Gu?(typeof he=="function"&&(wS(o,u,he,m),de=o.memoizedState),(O=Gu||kM(o,u,O,m,U,de,D)||!1)?(H||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(m,de,D),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(m,de,D)),typeof P.componentDidUpdate=="function"&&(o.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof P.componentDidUpdate!="function"||s===i.memoizedProps&&U===i.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||s===i.memoizedProps&&U===i.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=de),P.props=m,P.state=de,P.context=D,m=O):(typeof P.componentDidUpdate!="function"||s===i.memoizedProps&&U===i.memoizedState||(o.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||s===i.memoizedProps&&U===i.memoizedState||(o.flags|=1024),m=!1)}return ES(i,o,u,m,E,w)}function ES(i,o,u,m,w,E){ZD(i,o);var P=(o.flags&128)!==0;if(!m&&!P)return w&&TM(o,u,!1),Vc(i,o,E);m=o.stateNode,b5.current=o;var s=P&&typeof u.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,i!==null&&P?(o.child=bm(o,i.child,null,E),o.child=bm(o,null,s,E)):wo(i,o,s,E),o.memoizedState=m.state,w&&TM(o,u,!0),o.child}function XD(i){var o=i.stateNode;o.pendingContext?SM(i,o.pendingContext,o.pendingContext!==o.context):o.context&&SM(i,o.context,!1),XT(i,o.containerInfo)}function BM(i,o,u,m,w){return wm(),GT(w),o.flags|=256,wo(i,o,u,m),o.child}var CS={dehydrated:null,treeContext:null,retryLane:0};function IS(i){return{baseLanes:i,cachePool:null,transitions:null}}function YD(i,o,u){var m=o.pendingProps,w=Zn.current,E=!1,P=(o.flags&128)!==0,s;if((s=P)||(s=i!==null&&i.memoizedState===null?!1:(w&2)!==0),s?(E=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(w|=1),zn(Zn,w&1),i===null)return xS(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(P=m.children,i=m.fallback,E?(m=o.mode,E=o.child,P={mode:"hidden",children:P},!(m&1)&&E!==null?(E.childLanes=0,E.pendingProps=P):E=D1(P,m,0,null),i=Hd(i,m,u,null),E.return=o,i.return=o,E.sibling=i,o.child=E,o.child.memoizedState=IS(u),o.memoizedState=CS,i):rE(o,P));if(w=i.memoizedState,w!==null&&(s=w.dehydrated,s!==null))return S5(i,o,P,m,s,w,u);if(E){E=m.fallback,P=o.mode,w=i.child,s=w.sibling;var D={mode:"hidden",children:m.children};return!(P&1)&&o.child!==w?(m=o.child,m.childLanes=0,m.pendingProps=D,o.deletions=null):(m=hh(w,D),m.subtreeFlags=w.subtreeFlags&14680064),s!==null?E=hh(s,E):(E=Hd(E,P,u,null),E.flags|=2),E.return=o,m.return=o,m.sibling=E,o.child=m,m=E,E=o.child,P=i.child.memoizedState,P=P===null?IS(u):{baseLanes:P.baseLanes|u,cachePool:null,transitions:P.transitions},E.memoizedState=P,E.childLanes=i.childLanes&~u,o.memoizedState=CS,m}return E=i.child,i=E.sibling,m=hh(E,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=u),m.return=o,m.sibling=null,i!==null&&(u=o.deletions,u===null?(o.deletions=[i],o.flags|=16):u.push(i)),o.child=m,o.memoizedState=null,m}function rE(i,o){return o=D1({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function $0(i,o,u,m){return m!==null&&GT(m),bm(o,i.child,null,u),i=rE(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function S5(i,o,u,m,w,E,P){if(u)return o.flags&256?(o.flags&=-257,m=E2(Error(Qt(422))),$0(i,o,P,m)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(E=m.fallback,w=o.mode,m=D1({mode:"visible",children:m.children},w,0,null),E=Hd(E,w,P,null),E.flags|=2,m.return=o,E.return=o,m.sibling=E,o.child=m,o.mode&1&&bm(o,i.child,null,P),o.child.memoizedState=IS(P),o.memoizedState=CS,E);if(!(o.mode&1))return $0(i,o,P,null);if(w.data==="$!"){if(m=w.nextSibling&&w.nextSibling.dataset,m)var s=m.dgst;return m=s,E=Error(Qt(419)),m=E2(E,m,void 0),$0(i,o,P,m)}if(s=(P&i.childLanes)!==0,Uo||s){if(m=Fs,m!==null){switch(P&-P){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=w&(m.suspendedLanes|P)?0:w,w!==0&&w!==E.retryLane&&(E.retryLane=w,Bc(i,w),ul(m,i,w,-1))}return cE(),m=E2(Error(Qt(421))),$0(i,o,P,m)}return w.data==="$?"?(o.flags|=128,o.child=i.child,o=z5.bind(null,i),w._reactRetry=o,null):(i=E.treeContext,ha=ah(w.nextSibling),da=o,qn=!0,al=null,i!==null&&(Ra[ka++]=Nc,Ra[ka++]=jc,Ra[ka++]=Yd,Nc=i.id,jc=i.overflow,Yd=o),o=rE(o,m.children),o.flags|=4096,o)}function VM(i,o,u){i.lanes|=o;var m=i.alternate;m!==null&&(m.lanes|=o),vS(i.return,o,u)}function C2(i,o,u,m,w){var E=i.memoizedState;E===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:w}:(E.isBackwards=o,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=u,E.tailMode=w)}function KD(i,o,u){var m=o.pendingProps,w=m.revealOrder,E=m.tail;if(wo(i,o,m.children,u),m=Zn.current,m&2)m=m&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&VM(i,u,o);else if(i.tag===19)VM(i,u,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}if(zn(Zn,m),!(o.mode&1))o.memoizedState=null;else switch(w){case"forwards":for(u=o.child,w=null;u!==null;)i=u.alternate,i!==null&&Wv(i)===null&&(w=u),u=u.sibling;u=w,u===null?(w=o.child,o.child=null):(w=u.sibling,u.sibling=null),C2(o,!1,w,u,E);break;case"backwards":for(u=null,w=o.child,o.child=null;w!==null;){if(i=w.alternate,i!==null&&Wv(i)===null){o.child=w;break}i=w.sibling,w.sibling=u,u=w,w=i}C2(o,!0,u,null,E);break;case"together":C2(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function dv(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function Vc(i,o,u){if(i!==null&&(o.dependencies=i.dependencies),Qd|=o.lanes,!(u&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(Qt(153));if(o.child!==null){for(i=o.child,u=hh(i,i.pendingProps),o.child=u,u.return=o;i.sibling!==null;)i=i.sibling,u=u.sibling=hh(i,i.pendingProps),u.return=o;u.sibling=null}return o.child}function T5(i,o,u){switch(o.tag){case 3:XD(o),wm();break;case 5:SD(o);break;case 1:$o(o.type)&&Vv(o);break;case 4:XT(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,w=o.memoizedProps.value;zn($v,m._currentValue),m._currentValue=w;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(zn(Zn,Zn.current&1),o.flags|=128,null):u&o.child.childLanes?YD(i,o,u):(zn(Zn,Zn.current&1),i=Vc(i,o,u),i!==null?i.sibling:null);zn(Zn,Zn.current&1);break;case 19:if(m=(u&o.childLanes)!==0,i.flags&128){if(m)return KD(i,o,u);o.flags|=128}if(w=o.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),zn(Zn,Zn.current),m)break;return null;case 22:case 23:return o.lanes=0,WD(i,o,u)}return Vc(i,o,u)}var QD,AS,JD,eN;QD=function(i,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)i.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};AS=function(){};JD=function(i,o,u,m){var w=i.memoizedProps;if(w!==m){i=o.stateNode,Ld(Xl.current);var E=null;switch(u){case"input":w=Y2(i,w),m=Y2(i,m),E=[];break;case"select":w=Kn({},w,{value:void 0}),m=Kn({},m,{value:void 0}),E=[];break;case"textarea":w=J2(i,w),m=J2(i,m),E=[];break;default:typeof w.onClick!="function"&&typeof m.onClick=="function"&&(i.onclick=Ov)}tS(u,m);var P;u=null;for(O in w)if(!m.hasOwnProperty(O)&&w.hasOwnProperty(O)&&w[O]!=null)if(O==="style"){var s=w[O];for(P in s)s.hasOwnProperty(P)&&(u||(u={}),u[P]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(Y_.hasOwnProperty(O)?E||(E=[]):(E=E||[]).push(O,null));for(O in m){var D=m[O];if(s=w!=null?w[O]:void 0,m.hasOwnProperty(O)&&D!==s&&(D!=null||s!=null))if(O==="style")if(s){for(P in s)!s.hasOwnProperty(P)||D&&D.hasOwnProperty(P)||(u||(u={}),u[P]="");for(P in D)D.hasOwnProperty(P)&&s[P]!==D[P]&&(u||(u={}),u[P]=D[P])}else u||(E||(E=[]),E.push(O,u)),u=D;else O==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,s=s?s.__html:void 0,D!=null&&s!==D&&(E=E||[]).push(O,D)):O==="children"?typeof D!="string"&&typeof D!="number"||(E=E||[]).push(O,""+D):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(Y_.hasOwnProperty(O)?(D!=null&&O==="onScroll"&&Un("scroll",i),E||s===D||(E=[])):(E=E||[]).push(O,D))}u&&(E=E||[]).push("style",u);var O=E;(o.updateQueue=O)&&(o.flags|=4)}};eN=function(i,o,u,m){u!==m&&(o.flags|=4)};function P_(i,o){if(!qn)switch(i.tailMode){case"hidden":o=i.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function no(i){var o=i.alternate!==null&&i.alternate.child===i.child,u=0,m=0;if(o)for(var w=i.child;w!==null;)u|=w.lanes|w.childLanes,m|=w.subtreeFlags&14680064,m|=w.flags&14680064,w.return=i,w=w.sibling;else for(w=i.child;w!==null;)u|=w.lanes|w.childLanes,m|=w.subtreeFlags,m|=w.flags,w.return=i,w=w.sibling;return i.subtreeFlags|=m,i.childLanes=u,o}function E5(i,o,u){var m=o.pendingProps;switch(UT(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return no(o),null;case 1:return $o(o.type)&&Bv(),no(o),null;case 3:return m=o.stateNode,Sm(),Gn(Go),Gn(lo),KT(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(i===null||i.child===null)&&(U0(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,al!==null&&(zS(al),al=null))),AS(i,o),no(o),null;case 5:YT(o);var w=Ld(ly.current);if(u=o.type,i!==null&&o.stateNode!=null)JD(i,o,u,m,w),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(Qt(166));return no(o),null}if(i=Ld(Xl.current),U0(o)){m=o.stateNode,u=o.type;var E=o.memoizedProps;switch(m[Hl]=o,m[oy]=E,i=(o.mode&1)!==0,u){case"dialog":Un("cancel",m),Un("close",m);break;case"iframe":case"object":case"embed":Un("load",m);break;case"video":case"audio":for(w=0;w<z_.length;w++)Un(z_[w],m);break;case"source":Un("error",m);break;case"img":case"image":case"link":Un("error",m),Un("load",m);break;case"details":Un("toggle",m);break;case"input":YP(m,E),Un("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!E.multiple},Un("invalid",m);break;case"textarea":QP(m,E),Un("invalid",m)}tS(u,E),w=null;for(var P in E)if(E.hasOwnProperty(P)){var s=E[P];P==="children"?typeof s=="string"?m.textContent!==s&&(E.suppressHydrationWarning!==!0&&V0(m.textContent,s,i),w=["children",s]):typeof s=="number"&&m.textContent!==""+s&&(E.suppressHydrationWarning!==!0&&V0(m.textContent,s,i),w=["children",""+s]):Y_.hasOwnProperty(P)&&s!=null&&P==="onScroll"&&Un("scroll",m)}switch(u){case"input":D0(m),KP(m,E,!0);break;case"textarea":D0(m),JP(m);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(m.onclick=Ov)}m=w,o.updateQueue=m,m!==null&&(o.flags|=4)}else{P=w.nodeType===9?w:w.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Ak(u)),i==="http://www.w3.org/1999/xhtml"?u==="script"?(i=P.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof m.is=="string"?i=P.createElement(u,{is:m.is}):(i=P.createElement(u),u==="select"&&(P=i,m.multiple?P.multiple=!0:m.size&&(P.size=m.size))):i=P.createElementNS(i,u),i[Hl]=o,i[oy]=m,QD(i,o,!1,!1),o.stateNode=i;e:{switch(P=iS(u,m),u){case"dialog":Un("cancel",i),Un("close",i),w=m;break;case"iframe":case"object":case"embed":Un("load",i),w=m;break;case"video":case"audio":for(w=0;w<z_.length;w++)Un(z_[w],i);w=m;break;case"source":Un("error",i),w=m;break;case"img":case"image":case"link":Un("error",i),Un("load",i),w=m;break;case"details":Un("toggle",i),w=m;break;case"input":YP(i,m),w=Y2(i,m),Un("invalid",i);break;case"option":w=m;break;case"select":i._wrapperState={wasMultiple:!!m.multiple},w=Kn({},m,{value:void 0}),Un("invalid",i);break;case"textarea":QP(i,m),w=J2(i,m),Un("invalid",i);break;default:w=m}tS(u,w),s=w;for(E in s)if(s.hasOwnProperty(E)){var D=s[E];E==="style"?Rk(i,D):E==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,D!=null&&Pk(i,D)):E==="children"?typeof D=="string"?(u!=="textarea"||D!=="")&&K_(i,D):typeof D=="number"&&K_(i,""+D):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(Y_.hasOwnProperty(E)?D!=null&&E==="onScroll"&&Un("scroll",i):D!=null&&IT(i,E,D,P))}switch(u){case"input":D0(i),KP(i,m,!1);break;case"textarea":D0(i),JP(i);break;case"option":m.value!=null&&i.setAttribute("value",""+fh(m.value));break;case"select":i.multiple=!!m.multiple,E=m.value,E!=null?Xf(i,!!m.multiple,E,!1):m.defaultValue!=null&&Xf(i,!!m.multiple,m.defaultValue,!0);break;default:typeof w.onClick=="function"&&(i.onclick=Ov)}switch(u){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return no(o),null;case 6:if(i&&o.stateNode!=null)eN(i,o,i.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(Qt(166));if(u=Ld(ly.current),Ld(Xl.current),U0(o)){if(m=o.stateNode,u=o.memoizedProps,m[Hl]=o,(E=m.nodeValue!==u)&&(i=da,i!==null))switch(i.tag){case 3:V0(m.nodeValue,u,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&V0(m.nodeValue,u,(i.mode&1)!==0)}E&&(o.flags|=4)}else m=(u.nodeType===9?u:u.ownerDocument).createTextNode(m),m[Hl]=o,o.stateNode=m}return no(o),null;case 13:if(Gn(Zn),m=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(qn&&ha!==null&&o.mode&1&&!(o.flags&128))yD(),wm(),o.flags|=98560,E=!1;else if(E=U0(o),m!==null&&m.dehydrated!==null){if(i===null){if(!E)throw Error(Qt(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(Qt(317));E[Hl]=o}else wm(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;no(o),E=!1}else al!==null&&(zS(al),al=null),E=!0;if(!E)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(m=m!==null,m!==(i!==null&&i.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(i===null||Zn.current&1?Is===0&&(Is=3):cE())),o.updateQueue!==null&&(o.flags|=4),no(o),null);case 4:return Sm(),AS(i,o),i===null&&ny(o.stateNode.containerInfo),no(o),null;case 10:return HT(o.type._context),no(o),null;case 17:return $o(o.type)&&Bv(),no(o),null;case 19:if(Gn(Zn),E=o.memoizedState,E===null)return no(o),null;if(m=(o.flags&128)!==0,P=E.rendering,P===null)if(m)P_(E,!1);else{if(Is!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(P=Wv(i),P!==null){for(o.flags|=128,P_(E,!1),m=P.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=u,u=o.child;u!==null;)E=u,i=m,E.flags&=14680066,P=E.alternate,P===null?(E.childLanes=0,E.lanes=i,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=P.childLanes,E.lanes=P.lanes,E.child=P.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=P.memoizedProps,E.memoizedState=P.memoizedState,E.updateQueue=P.updateQueue,E.type=P.type,i=P.dependencies,E.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),u=u.sibling;return zn(Zn,Zn.current&1|2),o.child}i=i.sibling}E.tail!==null&&hs()>Em&&(o.flags|=128,m=!0,P_(E,!1),o.lanes=4194304)}else{if(!m)if(i=Wv(P),i!==null){if(o.flags|=128,m=!0,u=i.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),P_(E,!0),E.tail===null&&E.tailMode==="hidden"&&!P.alternate&&!qn)return no(o),null}else 2*hs()-E.renderingStartTime>Em&&u!==1073741824&&(o.flags|=128,m=!0,P_(E,!1),o.lanes=4194304);E.isBackwards?(P.sibling=o.child,o.child=P):(u=E.last,u!==null?u.sibling=P:o.child=P,E.last=P)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=hs(),o.sibling=null,u=Zn.current,zn(Zn,m?u&1|2:u&1),o):(no(o),null);case 22:case 23:return lE(),m=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?ca&1073741824&&(no(o),o.subtreeFlags&6&&(o.flags|=8192)):no(o),null;case 24:return null;case 25:return null}throw Error(Qt(156,o.tag))}function C5(i,o){switch(UT(o),o.tag){case 1:return $o(o.type)&&Bv(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Sm(),Gn(Go),Gn(lo),KT(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return YT(o),null;case 13:if(Gn(Zn),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(Qt(340));wm()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return Gn(Zn),null;case 4:return Sm(),null;case 10:return HT(o.type._context),null;case 22:case 23:return lE(),null;case 24:return null;default:return null}}var q0=!1,oo=!1,I5=typeof WeakSet=="function"?WeakSet:Set,Di=null;function Wf(i,o){var u=i.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(m){rs(i,o,m)}else u.current=null}function PS(i,o,u){try{u()}catch(m){rs(i,o,m)}}var UM=!1;function A5(i,o){if(dS=zv,i=sD(),BT(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var w=m.anchorOffset,E=m.focusNode;m=m.focusOffset;try{u.nodeType,E.nodeType}catch{u=null;break e}var P=0,s=-1,D=-1,O=0,H=0,G=i,U=null;t:for(;;){for(var he;G!==u||w!==0&&G.nodeType!==3||(s=P+w),G!==E||m!==0&&G.nodeType!==3||(D=P+m),G.nodeType===3&&(P+=G.nodeValue.length),(he=G.firstChild)!==null;)U=G,G=he;for(;;){if(G===i)break t;if(U===u&&++O===w&&(s=P),U===E&&++H===m&&(D=P),(he=G.nextSibling)!==null)break;G=U,U=G.parentNode}G=he}u=s===-1||D===-1?null:{start:s,end:D}}else u=null}u=u||{start:0,end:0}}else u=null;for(pS={focusedElem:i,selectionRange:u},zv=!1,Di=o;Di!==null;)if(o=Di,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,Di=i;else for(;Di!==null;){o=Di;try{var de=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(de!==null){var Y=de.memoizedProps,le=de.memoizedState,re=o.stateNode,oe=re.getSnapshotBeforeUpdate(o.elementType===o.type?Y:nl(o.type,Y),le);re.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var _e=o.stateNode.containerInfo;_e.nodeType===1?_e.textContent="":_e.nodeType===9&&_e.documentElement&&_e.removeChild(_e.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Qt(163))}}catch(Ne){rs(o,o.return,Ne)}if(i=o.sibling,i!==null){i.return=o.return,Di=i;break}Di=o.return}return de=UM,UM=!1,de}function H_(i,o,u){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var w=m=m.next;do{if((w.tag&i)===i){var E=w.destroy;w.destroy=void 0,E!==void 0&&PS(o,u,E)}w=w.next}while(w!==m)}}function R1(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&i)===i){var m=u.create;u.destroy=m()}u=u.next}while(u!==o)}}function MS(i){var o=i.ref;if(o!==null){var u=i.stateNode;switch(i.tag){case 5:i=u;break;default:i=u}typeof o=="function"?o(i):o.current=i}}function tN(i){var o=i.alternate;o!==null&&(i.alternate=null,tN(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[Hl],delete o[oy],delete o[gS],delete o[u5],delete o[h5])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function iN(i){return i.tag===5||i.tag===3||i.tag===4}function GM(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||iN(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function RS(i,o,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(i,o):u.insertBefore(i,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(i,u)):(o=u,o.appendChild(i)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Ov));else if(m!==4&&(i=i.child,i!==null))for(RS(i,o,u),i=i.sibling;i!==null;)RS(i,o,u),i=i.sibling}function kS(i,o,u){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?u.insertBefore(i,o):u.appendChild(i);else if(m!==4&&(i=i.child,i!==null))for(kS(i,o,u),i=i.sibling;i!==null;)kS(i,o,u),i=i.sibling}var qs=null,ol=!1;function Lu(i,o,u){for(u=u.child;u!==null;)rN(i,o,u),u=u.sibling}function rN(i,o,u){if(Zl&&typeof Zl.onCommitFiberUnmount=="function")try{Zl.onCommitFiberUnmount(S1,u)}catch{}switch(u.tag){case 5:oo||Wf(u,o);case 6:var m=qs,w=ol;qs=null,Lu(i,o,u),qs=m,ol=w,qs!==null&&(ol?(i=qs,u=u.stateNode,i.nodeType===8?i.parentNode.removeChild(u):i.removeChild(u)):qs.removeChild(u.stateNode));break;case 18:qs!==null&&(ol?(i=qs,u=u.stateNode,i.nodeType===8?x2(i.parentNode,u):i.nodeType===1&&x2(i,u),ty(i)):x2(qs,u.stateNode));break;case 4:m=qs,w=ol,qs=u.stateNode.containerInfo,ol=!0,Lu(i,o,u),qs=m,ol=w;break;case 0:case 11:case 14:case 15:if(!oo&&(m=u.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){w=m=m.next;do{var E=w,P=E.destroy;E=E.tag,P!==void 0&&(E&2||E&4)&&PS(u,o,P),w=w.next}while(w!==m)}Lu(i,o,u);break;case 1:if(!oo&&(Wf(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=u.memoizedProps,m.state=u.memoizedState,m.componentWillUnmount()}catch(s){rs(u,o,s)}Lu(i,o,u);break;case 21:Lu(i,o,u);break;case 22:u.mode&1?(oo=(m=oo)||u.memoizedState!==null,Lu(i,o,u),oo=m):Lu(i,o,u);break;default:Lu(i,o,u)}}function $M(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var u=i.stateNode;u===null&&(u=i.stateNode=new I5),o.forEach(function(m){var w=L5.bind(null,i,m);u.has(m)||(u.add(m),m.then(w,w))})}}function tl(i,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var w=u[m];try{var E=i,P=o,s=P;e:for(;s!==null;){switch(s.tag){case 5:qs=s.stateNode,ol=!1;break e;case 3:qs=s.stateNode.containerInfo,ol=!0;break e;case 4:qs=s.stateNode.containerInfo,ol=!0;break e}s=s.return}if(qs===null)throw Error(Qt(160));rN(E,P,w),qs=null,ol=!1;var D=w.alternate;D!==null&&(D.return=null),w.return=null}catch(O){rs(w,o,O)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)nN(o,i),o=o.sibling}function nN(i,o){var u=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(tl(o,i),Ol(i),m&4){try{H_(3,i,i.return),R1(3,i)}catch(Y){rs(i,i.return,Y)}try{H_(5,i,i.return)}catch(Y){rs(i,i.return,Y)}}break;case 1:tl(o,i),Ol(i),m&512&&u!==null&&Wf(u,u.return);break;case 5:if(tl(o,i),Ol(i),m&512&&u!==null&&Wf(u,u.return),i.flags&32){var w=i.stateNode;try{K_(w,"")}catch(Y){rs(i,i.return,Y)}}if(m&4&&(w=i.stateNode,w!=null)){var E=i.memoizedProps,P=u!==null?u.memoizedProps:E,s=i.type,D=i.updateQueue;if(i.updateQueue=null,D!==null)try{s==="input"&&E.type==="radio"&&E.name!=null&&Ck(w,E),iS(s,P);var O=iS(s,E);for(P=0;P<D.length;P+=2){var H=D[P],G=D[P+1];H==="style"?Rk(w,G):H==="dangerouslySetInnerHTML"?Pk(w,G):H==="children"?K_(w,G):IT(w,H,G,O)}switch(s){case"input":K2(w,E);break;case"textarea":Ik(w,E);break;case"select":var U=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!E.multiple;var he=E.value;he!=null?Xf(w,!!E.multiple,he,!1):U!==!!E.multiple&&(E.defaultValue!=null?Xf(w,!!E.multiple,E.defaultValue,!0):Xf(w,!!E.multiple,E.multiple?[]:"",!1))}w[oy]=E}catch(Y){rs(i,i.return,Y)}}break;case 6:if(tl(o,i),Ol(i),m&4){if(i.stateNode===null)throw Error(Qt(162));w=i.stateNode,E=i.memoizedProps;try{w.nodeValue=E}catch(Y){rs(i,i.return,Y)}}break;case 3:if(tl(o,i),Ol(i),m&4&&u!==null&&u.memoizedState.isDehydrated)try{ty(o.containerInfo)}catch(Y){rs(i,i.return,Y)}break;case 4:tl(o,i),Ol(i);break;case 13:tl(o,i),Ol(i),w=i.child,w.flags&8192&&(E=w.memoizedState!==null,w.stateNode.isHidden=E,!E||w.alternate!==null&&w.alternate.memoizedState!==null||(oE=hs())),m&4&&$M(i);break;case 22:if(H=u!==null&&u.memoizedState!==null,i.mode&1?(oo=(O=oo)||H,tl(o,i),oo=O):tl(o,i),Ol(i),m&8192){if(O=i.memoizedState!==null,(i.stateNode.isHidden=O)&&!H&&i.mode&1)for(Di=i,H=i.child;H!==null;){for(G=Di=H;Di!==null;){switch(U=Di,he=U.child,U.tag){case 0:case 11:case 14:case 15:H_(4,U,U.return);break;case 1:Wf(U,U.return);var de=U.stateNode;if(typeof de.componentWillUnmount=="function"){m=U,u=U.return;try{o=m,de.props=o.memoizedProps,de.state=o.memoizedState,de.componentWillUnmount()}catch(Y){rs(m,u,Y)}}break;case 5:Wf(U,U.return);break;case 22:if(U.memoizedState!==null){HM(G);continue}}he!==null?(he.return=U,Di=he):HM(G)}H=H.sibling}e:for(H=null,G=i;;){if(G.tag===5){if(H===null){H=G;try{w=G.stateNode,O?(E=w.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(s=G.stateNode,D=G.memoizedProps.style,P=D!=null&&D.hasOwnProperty("display")?D.display:null,s.style.display=Mk("display",P))}catch(Y){rs(i,i.return,Y)}}}else if(G.tag===6){if(H===null)try{G.stateNode.nodeValue=O?"":G.memoizedProps}catch(Y){rs(i,i.return,Y)}}else if((G.tag!==22&&G.tag!==23||G.memoizedState===null||G===i)&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===i)break e;for(;G.sibling===null;){if(G.return===null||G.return===i)break e;H===G&&(H=null),G=G.return}H===G&&(H=null),G.sibling.return=G.return,G=G.sibling}}break;case 19:tl(o,i),Ol(i),m&4&&$M(i);break;case 21:break;default:tl(o,i),Ol(i)}}function Ol(i){var o=i.flags;if(o&2){try{e:{for(var u=i.return;u!==null;){if(iN(u)){var m=u;break e}u=u.return}throw Error(Qt(160))}switch(m.tag){case 5:var w=m.stateNode;m.flags&32&&(K_(w,""),m.flags&=-33);var E=GM(i);kS(i,E,w);break;case 3:case 4:var P=m.stateNode.containerInfo,s=GM(i);RS(i,s,P);break;default:throw Error(Qt(161))}}catch(D){rs(i,i.return,D)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function P5(i,o,u){Di=i,sN(i)}function sN(i,o,u){for(var m=(i.mode&1)!==0;Di!==null;){var w=Di,E=w.child;if(w.tag===22&&m){var P=w.memoizedState!==null||q0;if(!P){var s=w.alternate,D=s!==null&&s.memoizedState!==null||oo;s=q0;var O=oo;if(q0=P,(oo=D)&&!O)for(Di=w;Di!==null;)P=Di,D=P.child,P.tag===22&&P.memoizedState!==null?WM(w):D!==null?(D.return=P,Di=D):WM(w);for(;E!==null;)Di=E,sN(E),E=E.sibling;Di=w,q0=s,oo=O}qM(i)}else w.subtreeFlags&8772&&E!==null?(E.return=w,Di=E):qM(i)}}function qM(i){for(;Di!==null;){var o=Di;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:oo||R1(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!oo)if(u===null)m.componentDidMount();else{var w=o.elementType===o.type?u.memoizedProps:nl(o.type,u.memoizedProps);m.componentDidUpdate(w,u.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var E=o.updateQueue;E!==null&&PM(o,E,m);break;case 3:var P=o.updateQueue;if(P!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}PM(o,P,u)}break;case 5:var s=o.stateNode;if(u===null&&o.flags&4){u=s;var D=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":D.autoFocus&&u.focus();break;case"img":D.src&&(u.src=D.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var O=o.alternate;if(O!==null){var H=O.memoizedState;if(H!==null){var G=H.dehydrated;G!==null&&ty(G)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Qt(163))}oo||o.flags&512&&MS(o)}catch(U){rs(o,o.return,U)}}if(o===i){Di=null;break}if(u=o.sibling,u!==null){u.return=o.return,Di=u;break}Di=o.return}}function HM(i){for(;Di!==null;){var o=Di;if(o===i){Di=null;break}var u=o.sibling;if(u!==null){u.return=o.return,Di=u;break}Di=o.return}}function WM(i){for(;Di!==null;){var o=Di;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{R1(4,o)}catch(D){rs(o,u,D)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var w=o.return;try{m.componentDidMount()}catch(D){rs(o,w,D)}}var E=o.return;try{MS(o)}catch(D){rs(o,E,D)}break;case 5:var P=o.return;try{MS(o)}catch(D){rs(o,P,D)}}}catch(D){rs(o,o.return,D)}if(o===i){Di=null;break}var s=o.sibling;if(s!==null){s.return=o.return,Di=s;break}Di=o.return}}var M5=Math.ceil,Yv=Hc.ReactCurrentDispatcher,nE=Hc.ReactCurrentOwner,Na=Hc.ReactCurrentBatchConfig,_n=0,Fs=null,gs=null,Hs=0,ca=0,Zf=wh(0),Is=0,dy=null,Qd=0,k1=0,sE=0,W_=null,Vo=null,oE=0,Em=1/0,Rc=null,Kv=!1,DS=null,ch=null,H0=!1,ih=null,Qv=0,Z_=0,NS=null,pv=-1,fv=0;function bo(){return _n&6?hs():pv!==-1?pv:pv=hs()}function uh(i){return i.mode&1?_n&2&&Hs!==0?Hs&-Hs:p5.transition!==null?(fv===0&&(fv=Gk()),fv):(i=En,i!==0||(i=window.event,i=i===void 0?16:Yk(i.type)),i):1}function ul(i,o,u,m){if(50<Z_)throw Z_=0,NS=null,Error(Qt(185));Sy(i,u,m),(!(_n&2)||i!==Fs)&&(i===Fs&&(!(_n&2)&&(k1|=u),Is===4&&qu(i,Hs)),qo(i,m),u===1&&_n===0&&!(o.mode&1)&&(Em=hs()+500,A1&&bh()))}function qo(i,o){var u=i.callbackNode;pB(i,o);var m=jv(i,i===Fs?Hs:0);if(m===0)u!==null&&iM(u),i.callbackNode=null,i.callbackPriority=0;else if(o=m&-m,i.callbackPriority!==o){if(u!=null&&iM(u),o===1)i.tag===0?d5(ZM.bind(null,i)):mD(ZM.bind(null,i)),l5(function(){!(_n&6)&&bh()}),u=null;else{switch($k(m)){case 1:u=kT;break;case 4:u=Vk;break;case 16:u=Nv;break;case 536870912:u=Uk;break;default:u=Nv}u=pN(u,oN.bind(null,i))}i.callbackPriority=o,i.callbackNode=u}}function oN(i,o){if(pv=-1,fv=0,_n&6)throw Error(Qt(327));var u=i.callbackNode;if(em()&&i.callbackNode!==u)return null;var m=jv(i,i===Fs?Hs:0);if(m===0)return null;if(m&30||m&i.expiredLanes||o)o=Jv(i,m);else{o=m;var w=_n;_n|=2;var E=lN();(Fs!==i||Hs!==o)&&(Rc=null,Em=hs()+500,qd(i,o));do try{D5();break}catch(s){aN(i,s)}while(!0);qT(),Yv.current=E,_n=w,gs!==null?o=0:(Fs=null,Hs=0,o=Is)}if(o!==0){if(o===2&&(w=aS(i),w!==0&&(m=w,o=jS(i,w))),o===1)throw u=dy,qd(i,0),qu(i,m),qo(i,hs()),u;if(o===6)qu(i,m);else{if(w=i.current.alternate,!(m&30)&&!R5(w)&&(o=Jv(i,m),o===2&&(E=aS(i),E!==0&&(m=E,o=jS(i,E))),o===1))throw u=dy,qd(i,0),qu(i,m),qo(i,hs()),u;switch(i.finishedWork=w,i.finishedLanes=m,o){case 0:case 1:throw Error(Qt(345));case 2:Nd(i,Vo,Rc);break;case 3:if(qu(i,m),(m&130023424)===m&&(o=oE+500-hs(),10<o)){if(jv(i,0)!==0)break;if(w=i.suspendedLanes,(w&m)!==m){bo(),i.pingedLanes|=i.suspendedLanes&w;break}i.timeoutHandle=mS(Nd.bind(null,i,Vo,Rc),o);break}Nd(i,Vo,Rc);break;case 4:if(qu(i,m),(m&4194240)===m)break;for(o=i.eventTimes,w=-1;0<m;){var P=31-cl(m);E=1<<P,P=o[P],P>w&&(w=P),m&=~E}if(m=w,m=hs()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*M5(m/1960))-m,10<m){i.timeoutHandle=mS(Nd.bind(null,i,Vo,Rc),m);break}Nd(i,Vo,Rc);break;case 5:Nd(i,Vo,Rc);break;default:throw Error(Qt(329))}}}return qo(i,hs()),i.callbackNode===u?oN.bind(null,i):null}function jS(i,o){var u=W_;return i.current.memoizedState.isDehydrated&&(qd(i,o).flags|=256),i=Jv(i,o),i!==2&&(o=Vo,Vo=u,o!==null&&zS(o)),i}function zS(i){Vo===null?Vo=i:Vo.push.apply(Vo,i)}function R5(i){for(var o=i;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var m=0;m<u.length;m++){var w=u[m],E=w.getSnapshot;w=w.value;try{if(!hl(E(),w))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function qu(i,o){for(o&=~sE,o&=~k1,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var u=31-cl(o),m=1<<u;i[u]=-1,o&=~m}}function ZM(i){if(_n&6)throw Error(Qt(327));em();var o=jv(i,0);if(!(o&1))return qo(i,hs()),null;var u=Jv(i,o);if(i.tag!==0&&u===2){var m=aS(i);m!==0&&(o=m,u=jS(i,m))}if(u===1)throw u=dy,qd(i,0),qu(i,o),qo(i,hs()),u;if(u===6)throw Error(Qt(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,Nd(i,Vo,Rc),qo(i,hs()),null}function aE(i,o){var u=_n;_n|=1;try{return i(o)}finally{_n=u,_n===0&&(Em=hs()+500,A1&&bh())}}function Jd(i){ih!==null&&ih.tag===0&&!(_n&6)&&em();var o=_n;_n|=1;var u=Na.transition,m=En;try{if(Na.transition=null,En=1,i)return i()}finally{En=m,Na.transition=u,_n=o,!(_n&6)&&bh()}}function lE(){ca=Zf.current,Gn(Zf)}function qd(i,o){i.finishedWork=null,i.finishedLanes=0;var u=i.timeoutHandle;if(u!==-1&&(i.timeoutHandle=-1,a5(u)),gs!==null)for(u=gs.return;u!==null;){var m=u;switch(UT(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Bv();break;case 3:Sm(),Gn(Go),Gn(lo),KT();break;case 5:YT(m);break;case 4:Sm();break;case 13:Gn(Zn);break;case 19:Gn(Zn);break;case 10:HT(m.type._context);break;case 22:case 23:lE()}u=u.return}if(Fs=i,gs=i=hh(i.current,null),Hs=ca=o,Is=0,dy=null,sE=k1=Qd=0,Vo=W_=null,zd!==null){for(o=0;o<zd.length;o++)if(u=zd[o],m=u.interleaved,m!==null){u.interleaved=null;var w=m.next,E=u.pending;if(E!==null){var P=E.next;E.next=w,m.next=P}u.pending=m}zd=null}return i}function aN(i,o){do{var u=gs;try{if(qT(),uv.current=Xv,Zv){for(var m=Yn.memoizedState;m!==null;){var w=m.queue;w!==null&&(w.pending=null),m=m.next}Zv=!1}if(Kd=0,zs=Es=Yn=null,q_=!1,cy=0,nE.current=null,u===null||u.return===null){Is=1,dy=o,gs=null;break}e:{var E=i,P=u.return,s=u,D=o;if(o=Hs,s.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){var O=D,H=s,G=H.tag;if(!(H.mode&1)&&(G===0||G===11||G===15)){var U=H.alternate;U?(H.updateQueue=U.updateQueue,H.memoizedState=U.memoizedState,H.lanes=U.lanes):(H.updateQueue=null,H.memoizedState=null)}var he=jM(P);if(he!==null){he.flags&=-257,zM(he,P,s,E,o),he.mode&1&&NM(E,O,o),o=he,D=O;var de=o.updateQueue;if(de===null){var Y=new Set;Y.add(D),o.updateQueue=Y}else de.add(D);break e}else{if(!(o&1)){NM(E,O,o),cE();break e}D=Error(Qt(426))}}else if(qn&&s.mode&1){var le=jM(P);if(le!==null){!(le.flags&65536)&&(le.flags|=256),zM(le,P,s,E,o),GT(Tm(D,s));break e}}E=D=Tm(D,s),Is!==4&&(Is=2),W_===null?W_=[E]:W_.push(E),E=P;do{switch(E.tag){case 3:E.flags|=65536,o&=-o,E.lanes|=o;var re=$D(E,D,o);AM(E,re);break e;case 1:s=D;var oe=E.type,_e=E.stateNode;if(!(E.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(ch===null||!ch.has(_e)))){E.flags|=65536,o&=-o,E.lanes|=o;var Ne=qD(E,s,o);AM(E,Ne);break e}}E=E.return}while(E!==null)}uN(u)}catch(Ge){o=Ge,gs===u&&u!==null&&(gs=u=u.return);continue}break}while(!0)}function lN(){var i=Yv.current;return Yv.current=Xv,i===null?Xv:i}function cE(){(Is===0||Is===3||Is===2)&&(Is=4),Fs===null||!(Qd&268435455)&&!(k1&268435455)||qu(Fs,Hs)}function Jv(i,o){var u=_n;_n|=2;var m=lN();(Fs!==i||Hs!==o)&&(Rc=null,qd(i,o));do try{k5();break}catch(w){aN(i,w)}while(!0);if(qT(),_n=u,Yv.current=m,gs!==null)throw Error(Qt(261));return Fs=null,Hs=0,Is}function k5(){for(;gs!==null;)cN(gs)}function D5(){for(;gs!==null&&!nB();)cN(gs)}function cN(i){var o=dN(i.alternate,i,ca);i.memoizedProps=i.pendingProps,o===null?uN(i):gs=o,nE.current=null}function uN(i){var o=i;do{var u=o.alternate;if(i=o.return,o.flags&32768){if(u=C5(u,o),u!==null){u.flags&=32767,gs=u;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Is=6,gs=null;return}}else if(u=E5(u,o,ca),u!==null){gs=u;return}if(o=o.sibling,o!==null){gs=o;return}gs=o=i}while(o!==null);Is===0&&(Is=5)}function Nd(i,o,u){var m=En,w=Na.transition;try{Na.transition=null,En=1,N5(i,o,u,m)}finally{Na.transition=w,En=m}return null}function N5(i,o,u,m){do em();while(ih!==null);if(_n&6)throw Error(Qt(327));u=i.finishedWork;var w=i.finishedLanes;if(u===null)return null;if(i.finishedWork=null,i.finishedLanes=0,u===i.current)throw Error(Qt(177));i.callbackNode=null,i.callbackPriority=0;var E=u.lanes|u.childLanes;if(fB(i,E),i===Fs&&(gs=Fs=null,Hs=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||H0||(H0=!0,pN(Nv,function(){return em(),null})),E=(u.flags&15990)!==0,u.subtreeFlags&15990||E){E=Na.transition,Na.transition=null;var P=En;En=1;var s=_n;_n|=4,nE.current=null,A5(i,u),nN(u,i),e5(pS),zv=!!dS,pS=dS=null,i.current=u,P5(u),sB(),_n=s,En=P,Na.transition=E}else i.current=u;if(H0&&(H0=!1,ih=i,Qv=w),E=i.pendingLanes,E===0&&(ch=null),lB(u.stateNode),qo(i,hs()),o!==null)for(m=i.onRecoverableError,u=0;u<o.length;u++)w=o[u],m(w.value,{componentStack:w.stack,digest:w.digest});if(Kv)throw Kv=!1,i=DS,DS=null,i;return Qv&1&&i.tag!==0&&em(),E=i.pendingLanes,E&1?i===NS?Z_++:(Z_=0,NS=i):Z_=0,bh(),null}function em(){if(ih!==null){var i=$k(Qv),o=Na.transition,u=En;try{if(Na.transition=null,En=16>i?16:i,ih===null)var m=!1;else{if(i=ih,ih=null,Qv=0,_n&6)throw Error(Qt(331));var w=_n;for(_n|=4,Di=i.current;Di!==null;){var E=Di,P=E.child;if(Di.flags&16){var s=E.deletions;if(s!==null){for(var D=0;D<s.length;D++){var O=s[D];for(Di=O;Di!==null;){var H=Di;switch(H.tag){case 0:case 11:case 15:H_(8,H,E)}var G=H.child;if(G!==null)G.return=H,Di=G;else for(;Di!==null;){H=Di;var U=H.sibling,he=H.return;if(tN(H),H===O){Di=null;break}if(U!==null){U.return=he,Di=U;break}Di=he}}}var de=E.alternate;if(de!==null){var Y=de.child;if(Y!==null){de.child=null;do{var le=Y.sibling;Y.sibling=null,Y=le}while(Y!==null)}}Di=E}}if(E.subtreeFlags&2064&&P!==null)P.return=E,Di=P;else e:for(;Di!==null;){if(E=Di,E.flags&2048)switch(E.tag){case 0:case 11:case 15:H_(9,E,E.return)}var re=E.sibling;if(re!==null){re.return=E.return,Di=re;break e}Di=E.return}}var oe=i.current;for(Di=oe;Di!==null;){P=Di;var _e=P.child;if(P.subtreeFlags&2064&&_e!==null)_e.return=P,Di=_e;else e:for(P=oe;Di!==null;){if(s=Di,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:R1(9,s)}}catch(Ge){rs(s,s.return,Ge)}if(s===P){Di=null;break e}var Ne=s.sibling;if(Ne!==null){Ne.return=s.return,Di=Ne;break e}Di=s.return}}if(_n=w,bh(),Zl&&typeof Zl.onPostCommitFiberRoot=="function")try{Zl.onPostCommitFiberRoot(S1,i)}catch{}m=!0}return m}finally{En=u,Na.transition=o}}return!1}function XM(i,o,u){o=Tm(u,o),o=$D(i,o,1),i=lh(i,o,1),o=bo(),i!==null&&(Sy(i,1,o),qo(i,o))}function rs(i,o,u){if(i.tag===3)XM(i,i,u);else for(;o!==null;){if(o.tag===3){XM(o,i,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ch===null||!ch.has(m))){i=Tm(u,i),i=qD(o,i,1),o=lh(o,i,1),i=bo(),o!==null&&(Sy(o,1,i),qo(o,i));break}}o=o.return}}function j5(i,o,u){var m=i.pingCache;m!==null&&m.delete(o),o=bo(),i.pingedLanes|=i.suspendedLanes&u,Fs===i&&(Hs&u)===u&&(Is===4||Is===3&&(Hs&130023424)===Hs&&500>hs()-oE?qd(i,0):sE|=u),qo(i,o)}function hN(i,o){o===0&&(i.mode&1?(o=z0,z0<<=1,!(z0&130023424)&&(z0=4194304)):o=1);var u=bo();i=Bc(i,o),i!==null&&(Sy(i,o,u),qo(i,u))}function z5(i){var o=i.memoizedState,u=0;o!==null&&(u=o.retryLane),hN(i,u)}function L5(i,o){var u=0;switch(i.tag){case 13:var m=i.stateNode,w=i.memoizedState;w!==null&&(u=w.retryLane);break;case 19:m=i.stateNode;break;default:throw Error(Qt(314))}m!==null&&m.delete(o),hN(i,u)}var dN;dN=function(i,o,u){if(i!==null)if(i.memoizedProps!==o.pendingProps||Go.current)Uo=!0;else{if(!(i.lanes&u)&&!(o.flags&128))return Uo=!1,T5(i,o,u);Uo=!!(i.flags&131072)}else Uo=!1,qn&&o.flags&1048576&&gD(o,Gv,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;dv(i,o),i=o.pendingProps;var w=vm(o,lo.current);Jf(o,u),w=JT(null,o,m,i,w,u);var E=eE();return o.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,$o(m)?(E=!0,Vv(o)):E=!1,o.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,ZT(o),w.updater=M1,o.stateNode=w,w._reactInternals=o,bS(o,m,i,u),o=ES(null,o,m,!0,E,u)):(o.tag=0,qn&&E&&VT(o),wo(null,o,w,u),o=o.child),o;case 16:m=o.elementType;e:{switch(dv(i,o),i=o.pendingProps,w=m._init,m=w(m._payload),o.type=m,w=o.tag=O5(m),i=nl(m,i),w){case 0:o=TS(null,o,m,i,u);break e;case 1:o=OM(null,o,m,i,u);break e;case 11:o=LM(null,o,m,i,u);break e;case 14:o=FM(null,o,m,nl(m.type,i),u);break e}throw Error(Qt(306,m,""))}return o;case 0:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:nl(m,w),TS(i,o,m,w,u);case 1:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:nl(m,w),OM(i,o,m,w,u);case 3:e:{if(XD(o),i===null)throw Error(Qt(387));m=o.pendingProps,E=o.memoizedState,w=E.element,bD(i,o),Hv(o,m,null,u);var P=o.memoizedState;if(m=P.element,E.isDehydrated)if(E={element:m,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},o.updateQueue.baseState=E,o.memoizedState=E,o.flags&256){w=Tm(Error(Qt(423)),o),o=BM(i,o,m,u,w);break e}else if(m!==w){w=Tm(Error(Qt(424)),o),o=BM(i,o,m,u,w);break e}else for(ha=ah(o.stateNode.containerInfo.firstChild),da=o,qn=!0,al=null,u=vD(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(wm(),m===w){o=Vc(i,o,u);break e}wo(i,o,m,u)}o=o.child}return o;case 5:return SD(o),i===null&&xS(o),m=o.type,w=o.pendingProps,E=i!==null?i.memoizedProps:null,P=w.children,fS(m,w)?P=null:E!==null&&fS(m,E)&&(o.flags|=32),ZD(i,o),wo(i,o,P,u),o.child;case 6:return i===null&&xS(o),null;case 13:return YD(i,o,u);case 4:return XT(o,o.stateNode.containerInfo),m=o.pendingProps,i===null?o.child=bm(o,null,m,u):wo(i,o,m,u),o.child;case 11:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:nl(m,w),LM(i,o,m,w,u);case 7:return wo(i,o,o.pendingProps,u),o.child;case 8:return wo(i,o,o.pendingProps.children,u),o.child;case 12:return wo(i,o,o.pendingProps.children,u),o.child;case 10:e:{if(m=o.type._context,w=o.pendingProps,E=o.memoizedProps,P=w.value,zn($v,m._currentValue),m._currentValue=P,E!==null)if(hl(E.value,P)){if(E.children===w.children&&!Go.current){o=Vc(i,o,u);break e}}else for(E=o.child,E!==null&&(E.return=o);E!==null;){var s=E.dependencies;if(s!==null){P=E.child;for(var D=s.firstContext;D!==null;){if(D.context===m){if(E.tag===1){D=zc(-1,u&-u),D.tag=2;var O=E.updateQueue;if(O!==null){O=O.shared;var H=O.pending;H===null?D.next=D:(D.next=H.next,H.next=D),O.pending=D}}E.lanes|=u,D=E.alternate,D!==null&&(D.lanes|=u),vS(E.return,u,o),s.lanes|=u;break}D=D.next}}else if(E.tag===10)P=E.type===o.type?null:E.child;else if(E.tag===18){if(P=E.return,P===null)throw Error(Qt(341));P.lanes|=u,s=P.alternate,s!==null&&(s.lanes|=u),vS(P,u,o),P=E.sibling}else P=E.child;if(P!==null)P.return=E;else for(P=E;P!==null;){if(P===o){P=null;break}if(E=P.sibling,E!==null){E.return=P.return,P=E;break}P=P.return}E=P}wo(i,o,w.children,u),o=o.child}return o;case 9:return w=o.type,m=o.pendingProps.children,Jf(o,u),w=ja(w),m=m(w),o.flags|=1,wo(i,o,m,u),o.child;case 14:return m=o.type,w=nl(m,o.pendingProps),w=nl(m.type,w),FM(i,o,m,w,u);case 15:return HD(i,o,o.type,o.pendingProps,u);case 17:return m=o.type,w=o.pendingProps,w=o.elementType===m?w:nl(m,w),dv(i,o),o.tag=1,$o(m)?(i=!0,Vv(o)):i=!1,Jf(o,u),GD(o,m,w),bS(o,m,w,u),ES(null,o,m,!0,i,u);case 19:return KD(i,o,u);case 22:return WD(i,o,u)}throw Error(Qt(156,o.tag))};function pN(i,o){return Bk(i,o)}function F5(i,o,u,m){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Da(i,o,u,m){return new F5(i,o,u,m)}function uE(i){return i=i.prototype,!(!i||!i.isReactComponent)}function O5(i){if(typeof i=="function")return uE(i)?1:0;if(i!=null){if(i=i.$$typeof,i===PT)return 11;if(i===MT)return 14}return 2}function hh(i,o){var u=i.alternate;return u===null?(u=Da(i.tag,o,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=o,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&14680064,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,o=i.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u}function mv(i,o,u,m,w,E){var P=2;if(m=i,typeof i=="function")uE(i)&&(P=1);else if(typeof i=="string")P=5;else e:switch(i){case Ff:return Hd(u.children,w,E,o);case AT:P=8,w|=8;break;case H2:return i=Da(12,u,o,w|2),i.elementType=H2,i.lanes=E,i;case W2:return i=Da(13,u,o,w),i.elementType=W2,i.lanes=E,i;case Z2:return i=Da(19,u,o,w),i.elementType=Z2,i.lanes=E,i;case Sk:return D1(u,w,E,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case wk:P=10;break e;case bk:P=9;break e;case PT:P=11;break e;case MT:P=14;break e;case Uu:P=16,m=null;break e}throw Error(Qt(130,i==null?i:typeof i,""))}return o=Da(P,u,o,w),o.elementType=i,o.type=m,o.lanes=E,o}function Hd(i,o,u,m){return i=Da(7,i,m,o),i.lanes=u,i}function D1(i,o,u,m){return i=Da(22,i,m,o),i.elementType=Sk,i.lanes=u,i.stateNode={isHidden:!1},i}function I2(i,o,u){return i=Da(6,i,null,o),i.lanes=u,i}function A2(i,o,u){return o=Da(4,i.children!==null?i.children:[],i.key,o),o.lanes=u,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function B5(i,o,u,m,w){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=l2(0),this.expirationTimes=l2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l2(0),this.identifierPrefix=m,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function hE(i,o,u,m,w,E,P,s,D){return i=new B5(i,o,u,s,D),o===1?(o=1,E===!0&&(o|=8)):o=0,E=Da(3,null,null,o),i.current=E,E.stateNode=i,E.memoizedState={element:m,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZT(E),i}function V5(i,o,u){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lf,key:m==null?null:""+m,children:i,containerInfo:o,implementation:u}}function fN(i){if(!i)return mh;i=i._reactInternals;e:{if(lp(i)!==i||i.tag!==1)throw Error(Qt(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if($o(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Qt(171))}if(i.tag===1){var u=i.type;if($o(u))return fD(i,u,o)}return o}function mN(i,o,u,m,w,E,P,s,D){return i=hE(u,m,!0,i,w,E,P,s,D),i.context=fN(null),u=i.current,m=bo(),w=uh(u),E=zc(m,w),E.callback=o??null,lh(u,E,w),i.current.lanes=w,Sy(i,w,m),qo(i,m),i}function N1(i,o,u,m){var w=o.current,E=bo(),P=uh(w);return u=fN(u),o.context===null?o.context=u:o.pendingContext=u,o=zc(E,P),o.payload={element:i},m=m===void 0?null:m,m!==null&&(o.callback=m),i=lh(w,o,P),i!==null&&(ul(i,w,P,E),cv(i,w,P)),P}function e1(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function YM(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<o?u:o}}function dE(i,o){YM(i,o),(i=i.alternate)&&YM(i,o)}function U5(){return null}var gN=typeof reportError=="function"?reportError:function(i){console.error(i)};function pE(i){this._internalRoot=i}j1.prototype.render=pE.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(Qt(409));N1(i,o,null,null)};j1.prototype.unmount=pE.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Jd(function(){N1(null,i,null,null)}),o[Oc]=null}};function j1(i){this._internalRoot=i}j1.prototype.unstable_scheduleHydration=function(i){if(i){var o=Wk();i={blockedOn:null,target:i,priority:o};for(var u=0;u<$u.length&&o!==0&&o<$u[u].priority;u++);$u.splice(u,0,i),u===0&&Xk(i)}};function fE(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function z1(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function KM(){}function G5(i,o,u,m,w){if(w){if(typeof m=="function"){var E=m;m=function(){var O=e1(P);E.call(O)}}var P=mN(o,m,i,0,null,!1,!1,"",KM);return i._reactRootContainer=P,i[Oc]=P.current,ny(i.nodeType===8?i.parentNode:i),Jd(),P}for(;w=i.lastChild;)i.removeChild(w);if(typeof m=="function"){var s=m;m=function(){var O=e1(D);s.call(O)}}var D=hE(i,0,!1,null,null,!1,!1,"",KM);return i._reactRootContainer=D,i[Oc]=D.current,ny(i.nodeType===8?i.parentNode:i),Jd(function(){N1(o,D,u,m)}),D}function L1(i,o,u,m,w){var E=u._reactRootContainer;if(E){var P=E;if(typeof w=="function"){var s=w;w=function(){var D=e1(P);s.call(D)}}N1(o,P,i,w)}else P=G5(u,o,i,w,m);return e1(P)}qk=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var u=j_(o.pendingLanes);u!==0&&(DT(o,u|1),qo(o,hs()),!(_n&6)&&(Em=hs()+500,bh()))}break;case 13:Jd(function(){var m=Bc(i,1);if(m!==null){var w=bo();ul(m,i,1,w)}}),dE(i,1)}};NT=function(i){if(i.tag===13){var o=Bc(i,134217728);if(o!==null){var u=bo();ul(o,i,134217728,u)}dE(i,134217728)}};Hk=function(i){if(i.tag===13){var o=uh(i),u=Bc(i,o);if(u!==null){var m=bo();ul(u,i,o,m)}dE(i,o)}};Wk=function(){return En};Zk=function(i,o){var u=En;try{return En=i,o()}finally{En=u}};nS=function(i,o,u){switch(o){case"input":if(K2(i,u),o=u.name,u.type==="radio"&&o!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==i&&m.form===i.form){var w=I1(m);if(!w)throw Error(Qt(90));Ek(m),K2(m,w)}}}break;case"textarea":Ik(i,u);break;case"select":o=u.value,o!=null&&Xf(i,!!u.multiple,o,!1)}};Nk=aE;jk=Jd;var $5={usingClientEntryPoint:!1,Events:[Ey,Uf,I1,kk,Dk,aE]},M_={findFiberByHostInstance:jd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},q5={bundleType:M_.bundleType,version:M_.version,rendererPackageName:M_.rendererPackageName,rendererConfig:M_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hc.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Fk(i),i===null?null:i.stateNode},findFiberByHostInstance:M_.findFiberByHostInstance||U5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var W0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!W0.isDisabled&&W0.supportsFiber)try{S1=W0.inject(q5),Zl=W0}catch{}}ma.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$5;ma.createPortal=function(i,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fE(o))throw Error(Qt(200));return V5(i,o,null,u)};ma.createRoot=function(i,o){if(!fE(i))throw Error(Qt(299));var u=!1,m="",w=gN;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(w=o.onRecoverableError)),o=hE(i,1,!1,null,null,u,!1,m,w),i[Oc]=o.current,ny(i.nodeType===8?i.parentNode:i),new pE(o)};ma.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(Qt(188)):(i=Object.keys(i).join(","),Error(Qt(268,i)));return i=Fk(o),i=i===null?null:i.stateNode,i};ma.flushSync=function(i){return Jd(i)};ma.hydrate=function(i,o,u){if(!z1(o))throw Error(Qt(200));return L1(null,i,o,!0,u)};ma.hydrateRoot=function(i,o,u){if(!fE(i))throw Error(Qt(405));var m=u!=null&&u.hydratedSources||null,w=!1,E="",P=gN;if(u!=null&&(u.unstable_strictMode===!0&&(w=!0),u.identifierPrefix!==void 0&&(E=u.identifierPrefix),u.onRecoverableError!==void 0&&(P=u.onRecoverableError)),o=mN(o,null,i,1,u??null,w,!1,E,P),i[Oc]=o.current,ny(i),m)for(i=0;i<m.length;i++)u=m[i],w=u._getVersion,w=w(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,w]:o.mutableSourceEagerHydrationData.push(u,w);return new j1(o)};ma.render=function(i,o,u){if(!z1(o))throw Error(Qt(200));return L1(null,i,o,!1,u)};ma.unmountComponentAtNode=function(i){if(!z1(i))throw Error(Qt(40));return i._reactRootContainer?(Jd(function(){L1(null,null,i,!1,function(){i._reactRootContainer=null,i[Oc]=null})}),!0):!1};ma.unstable_batchedUpdates=aE;ma.unstable_renderSubtreeIntoContainer=function(i,o,u,m){if(!z1(u))throw Error(Qt(200));if(i==null||i._reactInternals===void 0)throw Error(Qt(38));return L1(i,o,u,!1,m)};ma.version="18.3.1-next-f1338f8080-20240426";function _N(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_N)}catch(i){console.error(i)}}_N(),_k.exports=ma;var cp=_k.exports;const yN=vT(cp);var xN,QM=cp;xN=QM.createRoot,QM.hydrateRoot;const H5=1,W5=1e6;let P2=0;function Z5(){return P2=(P2+1)%Number.MAX_SAFE_INTEGER,P2.toString()}const M2=new Map,JM=i=>{if(M2.has(i))return;const o=setTimeout(()=>{M2.delete(i),X_({type:"REMOVE_TOAST",toastId:i})},W5);M2.set(i,o)},X5=(i,o)=>{switch(o.type){case"ADD_TOAST":return{...i,toasts:[o.toast,...i.toasts].slice(0,H5)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(u=>u.id===o.toast.id?{...u,...o.toast}:u)};case"DISMISS_TOAST":{const{toastId:u}=o;return u?JM(u):i.toasts.forEach(m=>{JM(m.id)}),{...i,toasts:i.toasts.map(m=>m.id===u||u===void 0?{...m,open:!1}:m)}}case"REMOVE_TOAST":return o.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(u=>u.id!==o.toastId)}}},gv=[];let _v={toasts:[]};function X_(i){_v=X5(_v,i),gv.forEach(o=>{o(_v)})}function qi({...i}){const o=Z5(),u=w=>X_({type:"UPDATE_TOAST",toast:{...w,id:o}}),m=()=>X_({type:"DISMISS_TOAST",toastId:o});return X_({type:"ADD_TOAST",toast:{...i,id:o,open:!0,onOpenChange:w=>{w||m()}}}),{id:o,dismiss:m,update:u}}function Iy(){const[i,o]=W.useState(_v);return W.useEffect(()=>(gv.push(o),()=>{const u=gv.indexOf(o);u>-1&&gv.splice(u,1)}),[i]),{...i,toast:qi,dismiss:u=>X_({type:"DISMISS_TOAST",toastId:u})}}function ir(i,o,{checkForDefaultPrevented:u=!0}={}){return function(w){if(i==null||i(w),u===!1||!w.defaultPrevented)return o==null?void 0:o(w)}}function Y5(i,o){typeof i=="function"?i(o):i!=null&&(i.current=o)}function vN(...i){return o=>i.forEach(u=>Y5(u,o))}function kn(...i){return W.useCallback(vN(...i),i)}function K5(i,o=[]){let u=[];function m(E,P){const s=W.createContext(P),D=u.length;u=[...u,P];function O(G){const{scope:U,children:he,...de}=G,Y=(U==null?void 0:U[i][D])||s,le=W.useMemo(()=>de,Object.values(de));return _.jsx(Y.Provider,{value:le,children:he})}function H(G,U){const he=(U==null?void 0:U[i][D])||s,de=W.useContext(he);if(de)return de;if(P!==void 0)return P;throw new Error(`\`${G}\` must be used within \`${E}\``)}return O.displayName=E+"Provider",[O,H]}const w=()=>{const E=u.map(P=>W.createContext(P));return function(s){const D=(s==null?void 0:s[i])||E;return W.useMemo(()=>({[`__scope${i}`]:{...s,[i]:D}}),[s,D])}};return w.scopeName=i,[m,Q5(w,...o)]}function Q5(...i){const o=i[0];if(i.length===1)return o;const u=()=>{const m=i.map(w=>({useScope:w(),scopeName:w.scopeName}));return function(E){const P=m.reduce((s,{useScope:D,scopeName:O})=>{const G=D(E)[`__scope${O}`];return{...s,...G}},{});return W.useMemo(()=>({[`__scope${o.scopeName}`]:P}),[P])}};return u.scopeName=o.scopeName,u}var ep=W.forwardRef((i,o)=>{const{children:u,...m}=i,w=W.Children.toArray(u),E=w.find(J5);if(E){const P=E.props.children,s=w.map(D=>D===E?W.Children.count(P)>1?W.Children.only(null):W.isValidElement(P)?P.props.children:null:D);return _.jsx(LS,{...m,ref:o,children:W.isValidElement(P)?W.cloneElement(P,void 0,s):null})}return _.jsx(LS,{...m,ref:o,children:u})});ep.displayName="Slot";var LS=W.forwardRef((i,o)=>{const{children:u,...m}=i;if(W.isValidElement(u)){const w=t6(u);return W.cloneElement(u,{...e6(m,u.props),ref:o?vN(o,w):w})}return W.Children.count(u)>1?W.Children.only(null):null});LS.displayName="SlotClone";var wN=({children:i})=>_.jsx(_.Fragment,{children:i});function J5(i){return W.isValidElement(i)&&i.type===wN}function e6(i,o){const u={...o};for(const m in o){const w=i[m],E=o[m];/^on[A-Z]/.test(m)?w&&E?u[m]=(...s)=>{E(...s),w(...s)}:w&&(u[m]=w):m==="style"?u[m]={...w,...E}:m==="className"&&(u[m]=[w,E].filter(Boolean).join(" "))}return{...i,...u}}function t6(i){var m,w;let o=(m=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:m.get,u=o&&"isReactWarning"in o&&o.isReactWarning;return u?i.ref:(o=(w=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:w.get,u=o&&"isReactWarning"in o&&o.isReactWarning,u?i.props.ref:i.props.ref||i.ref)}function mE(i){const o=i+"CollectionProvider",[u,m]=K5(o),[w,E]=u(o,{collectionRef:{current:null},itemMap:new Map}),P=he=>{const{scope:de,children:Y}=he,le=fi.useRef(null),re=fi.useRef(new Map).current;return _.jsx(w,{scope:de,itemMap:re,collectionRef:le,children:Y})};P.displayName=o;const s=i+"CollectionSlot",D=fi.forwardRef((he,de)=>{const{scope:Y,children:le}=he,re=E(s,Y),oe=kn(de,re.collectionRef);return _.jsx(ep,{ref:oe,children:le})});D.displayName=s;const O=i+"CollectionItemSlot",H="data-radix-collection-item",G=fi.forwardRef((he,de)=>{const{scope:Y,children:le,...re}=he,oe=fi.useRef(null),_e=kn(de,oe),Ne=E(O,Y);return fi.useEffect(()=>(Ne.itemMap.set(oe,{ref:oe,...re}),()=>void Ne.itemMap.delete(oe))),_.jsx(ep,{[H]:"",ref:_e,children:le})});G.displayName=O;function U(he){const de=E(i+"CollectionConsumer",he);return fi.useCallback(()=>{const le=de.collectionRef.current;if(!le)return[];const re=Array.from(le.querySelectorAll(`[${H}]`));return Array.from(de.itemMap.values()).sort((Ne,Ge)=>re.indexOf(Ne.ref.current)-re.indexOf(Ge.ref.current))},[de.collectionRef,de.itemMap])}return[{Provider:P,Slot:D,ItemSlot:G},U,m]}function i6(i,o){const u=W.createContext(o),m=E=>{const{children:P,...s}=E,D=W.useMemo(()=>s,Object.values(s));return _.jsx(u.Provider,{value:D,children:P})};m.displayName=i+"Provider";function w(E){const P=W.useContext(u);if(P)return P;if(o!==void 0)return o;throw new Error(`\`${E}\` must be used within \`${i}\``)}return[m,w]}function Rm(i,o=[]){let u=[];function m(E,P){const s=W.createContext(P),D=u.length;u=[...u,P];const O=G=>{var re;const{scope:U,children:he,...de}=G,Y=((re=U==null?void 0:U[i])==null?void 0:re[D])||s,le=W.useMemo(()=>de,Object.values(de));return _.jsx(Y.Provider,{value:le,children:he})};O.displayName=E+"Provider";function H(G,U){var Y;const he=((Y=U==null?void 0:U[i])==null?void 0:Y[D])||s,de=W.useContext(he);if(de)return de;if(P!==void 0)return P;throw new Error(`\`${G}\` must be used within \`${E}\``)}return[O,H]}const w=()=>{const E=u.map(P=>W.createContext(P));return function(s){const D=(s==null?void 0:s[i])||E;return W.useMemo(()=>({[`__scope${i}`]:{...s,[i]:D}}),[s,D])}};return w.scopeName=i,[m,r6(w,...o)]}function r6(...i){const o=i[0];if(i.length===1)return o;const u=()=>{const m=i.map(w=>({useScope:w(),scopeName:w.scopeName}));return function(E){const P=m.reduce((s,{useScope:D,scopeName:O})=>{const G=D(E)[`__scope${O}`];return{...s,...G}},{});return W.useMemo(()=>({[`__scope${o.scopeName}`]:P}),[P])}};return u.scopeName=o.scopeName,u}var n6=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],jr=n6.reduce((i,o)=>{const u=W.forwardRef((m,w)=>{const{asChild:E,...P}=m,s=E?ep:o;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),_.jsx(s,{...P,ref:w})});return u.displayName=`Primitive.${o}`,{...i,[o]:u}},{});function bN(i,o){i&&cp.flushSync(()=>i.dispatchEvent(o))}function Ho(i){const o=W.useRef(i);return W.useEffect(()=>{o.current=i}),W.useMemo(()=>(...u)=>{var m;return(m=o.current)==null?void 0:m.call(o,...u)},[])}function s6(i,o=globalThis==null?void 0:globalThis.document){const u=Ho(i);W.useEffect(()=>{const m=w=>{w.key==="Escape"&&u(w)};return o.addEventListener("keydown",m,{capture:!0}),()=>o.removeEventListener("keydown",m,{capture:!0})},[u,o])}var o6="DismissableLayer",FS="dismissableLayer.update",a6="dismissableLayer.pointerDownOutside",l6="dismissableLayer.focusOutside",eR,SN=W.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ay=W.forwardRef((i,o)=>{const{disableOutsidePointerEvents:u=!1,onEscapeKeyDown:m,onPointerDownOutside:w,onFocusOutside:E,onInteractOutside:P,onDismiss:s,...D}=i,O=W.useContext(SN),[H,G]=W.useState(null),U=(H==null?void 0:H.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,he]=W.useState({}),de=kn(o,ot=>G(ot)),Y=Array.from(O.layers),[le]=[...O.layersWithOutsidePointerEventsDisabled].slice(-1),re=Y.indexOf(le),oe=H?Y.indexOf(H):-1,_e=O.layersWithOutsidePointerEventsDisabled.size>0,Ne=oe>=re,Ge=u6(ot=>{const dt=ot.target,Bt=[...O.branches].some(Wt=>Wt.contains(dt));!Ne||Bt||(w==null||w(ot),P==null||P(ot),ot.defaultPrevented||s==null||s())},U),pt=h6(ot=>{const dt=ot.target;[...O.branches].some(Wt=>Wt.contains(dt))||(E==null||E(ot),P==null||P(ot),ot.defaultPrevented||s==null||s())},U);return s6(ot=>{oe===O.layers.size-1&&(m==null||m(ot),!ot.defaultPrevented&&s&&(ot.preventDefault(),s()))},U),W.useEffect(()=>{if(H)return u&&(O.layersWithOutsidePointerEventsDisabled.size===0&&(eR=U.body.style.pointerEvents,U.body.style.pointerEvents="none"),O.layersWithOutsidePointerEventsDisabled.add(H)),O.layers.add(H),tR(),()=>{u&&O.layersWithOutsidePointerEventsDisabled.size===1&&(U.body.style.pointerEvents=eR)}},[H,U,u,O]),W.useEffect(()=>()=>{H&&(O.layers.delete(H),O.layersWithOutsidePointerEventsDisabled.delete(H),tR())},[H,O]),W.useEffect(()=>{const ot=()=>he({});return document.addEventListener(FS,ot),()=>document.removeEventListener(FS,ot)},[]),_.jsx(jr.div,{...D,ref:de,style:{pointerEvents:_e?Ne?"auto":"none":void 0,...i.style},onFocusCapture:ir(i.onFocusCapture,pt.onFocusCapture),onBlurCapture:ir(i.onBlurCapture,pt.onBlurCapture),onPointerDownCapture:ir(i.onPointerDownCapture,Ge.onPointerDownCapture)})});Ay.displayName=o6;var c6="DismissableLayerBranch",TN=W.forwardRef((i,o)=>{const u=W.useContext(SN),m=W.useRef(null),w=kn(o,m);return W.useEffect(()=>{const E=m.current;if(E)return u.branches.add(E),()=>{u.branches.delete(E)}},[u.branches]),_.jsx(jr.div,{...i,ref:w})});TN.displayName=c6;function u6(i,o=globalThis==null?void 0:globalThis.document){const u=Ho(i),m=W.useRef(!1),w=W.useRef(()=>{});return W.useEffect(()=>{const E=s=>{if(s.target&&!m.current){let D=function(){EN(a6,u,O,{discrete:!0})};const O={originalEvent:s};s.pointerType==="touch"?(o.removeEventListener("click",w.current),w.current=D,o.addEventListener("click",w.current,{once:!0})):D()}else o.removeEventListener("click",w.current);m.current=!1},P=window.setTimeout(()=>{o.addEventListener("pointerdown",E)},0);return()=>{window.clearTimeout(P),o.removeEventListener("pointerdown",E),o.removeEventListener("click",w.current)}},[o,u]),{onPointerDownCapture:()=>m.current=!0}}function h6(i,o=globalThis==null?void 0:globalThis.document){const u=Ho(i),m=W.useRef(!1);return W.useEffect(()=>{const w=E=>{E.target&&!m.current&&EN(l6,u,{originalEvent:E},{discrete:!1})};return o.addEventListener("focusin",w),()=>o.removeEventListener("focusin",w)},[o,u]),{onFocusCapture:()=>m.current=!0,onBlurCapture:()=>m.current=!1}}function tR(){const i=new CustomEvent(FS);document.dispatchEvent(i)}function EN(i,o,u,{discrete:m}){const w=u.originalEvent.target,E=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:u});o&&w.addEventListener(i,o,{once:!0}),m?bN(w,E):w.dispatchEvent(E)}var d6=Ay,p6=TN,co=globalThis!=null&&globalThis.document?W.useLayoutEffect:()=>{},f6="Portal",F1=W.forwardRef((i,o)=>{var s;const{container:u,...m}=i,[w,E]=W.useState(!1);co(()=>E(!0),[]);const P=u||w&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return P?yN.createPortal(_.jsx(jr.div,{...m,ref:o}),P):null});F1.displayName=f6;function m6(i,o){return W.useReducer((u,m)=>o[u][m]??u,i)}var up=i=>{const{present:o,children:u}=i,m=g6(o),w=typeof u=="function"?u({present:m.isPresent}):W.Children.only(u),E=kn(m.ref,_6(w));return typeof u=="function"||m.isPresent?W.cloneElement(w,{ref:E}):null};up.displayName="Presence";function g6(i){const[o,u]=W.useState(),m=W.useRef({}),w=W.useRef(i),E=W.useRef("none"),P=i?"mounted":"unmounted",[s,D]=m6(P,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const O=Z0(m.current);E.current=s==="mounted"?O:"none"},[s]),co(()=>{const O=m.current,H=w.current;if(H!==i){const U=E.current,he=Z0(O);i?D("MOUNT"):he==="none"||(O==null?void 0:O.display)==="none"?D("UNMOUNT"):D(H&&U!==he?"ANIMATION_OUT":"UNMOUNT"),w.current=i}},[i,D]),co(()=>{if(o){let O;const H=o.ownerDocument.defaultView??window,G=he=>{const Y=Z0(m.current).includes(he.animationName);if(he.target===o&&Y&&(D("ANIMATION_END"),!w.current)){const le=o.style.animationFillMode;o.style.animationFillMode="forwards",O=H.setTimeout(()=>{o.style.animationFillMode==="forwards"&&(o.style.animationFillMode=le)})}},U=he=>{he.target===o&&(E.current=Z0(m.current))};return o.addEventListener("animationstart",U),o.addEventListener("animationcancel",G),o.addEventListener("animationend",G),()=>{H.clearTimeout(O),o.removeEventListener("animationstart",U),o.removeEventListener("animationcancel",G),o.removeEventListener("animationend",G)}}else D("ANIMATION_END")},[o,D]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:W.useCallback(O=>{O&&(m.current=getComputedStyle(O)),u(O)},[])}}function Z0(i){return(i==null?void 0:i.animationName)||"none"}function _6(i){var m,w;let o=(m=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:m.get,u=o&&"isReactWarning"in o&&o.isReactWarning;return u?i.ref:(o=(w=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:w.get,u=o&&"isReactWarning"in o&&o.isReactWarning,u?i.props.ref:i.props.ref||i.ref)}function tp({prop:i,defaultProp:o,onChange:u=()=>{}}){const[m,w]=y6({defaultProp:o,onChange:u}),E=i!==void 0,P=E?i:m,s=Ho(u),D=W.useCallback(O=>{if(E){const G=typeof O=="function"?O(i):O;G!==i&&s(G)}else w(O)},[E,i,w,s]);return[P,D]}function y6({defaultProp:i,onChange:o}){const u=W.useState(i),[m]=u,w=W.useRef(m),E=Ho(o);return W.useEffect(()=>{w.current!==m&&(E(m),w.current=m)},[m,w,E]),u}var x6="VisuallyHidden",Py=W.forwardRef((i,o)=>_.jsx(jr.span,{...i,ref:o,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...i.style}}));Py.displayName=x6;var v6=Py,gE="ToastProvider",[_E,w6,b6]=mE("Toast"),[CN,BH]=Rm("Toast",[b6]),[S6,O1]=CN(gE),IN=i=>{const{__scopeToast:o,label:u="Notification",duration:m=5e3,swipeDirection:w="right",swipeThreshold:E=50,children:P}=i,[s,D]=W.useState(null),[O,H]=W.useState(0),G=W.useRef(!1),U=W.useRef(!1);return u.trim()||console.error(`Invalid prop \`label\` supplied to \`${gE}\`. Expected non-empty \`string\`.`),_.jsx(_E.Provider,{scope:o,children:_.jsx(S6,{scope:o,label:u,duration:m,swipeDirection:w,swipeThreshold:E,toastCount:O,viewport:s,onViewportChange:D,onToastAdd:W.useCallback(()=>H(he=>he+1),[]),onToastRemove:W.useCallback(()=>H(he=>he-1),[]),isFocusedToastEscapeKeyDownRef:G,isClosePausedRef:U,children:P})})};IN.displayName=gE;var AN="ToastViewport",T6=["F8"],OS="toast.viewportPause",BS="toast.viewportResume",PN=W.forwardRef((i,o)=>{const{__scopeToast:u,hotkey:m=T6,label:w="Notifications ({hotkey})",...E}=i,P=O1(AN,u),s=w6(u),D=W.useRef(null),O=W.useRef(null),H=W.useRef(null),G=W.useRef(null),U=kn(o,G,P.onViewportChange),he=m.join("+").replace(/Key/g,"").replace(/Digit/g,""),de=P.toastCount>0;W.useEffect(()=>{const le=re=>{var _e;m.length!==0&&m.every(Ne=>re[Ne]||re.code===Ne)&&((_e=G.current)==null||_e.focus())};return document.addEventListener("keydown",le),()=>document.removeEventListener("keydown",le)},[m]),W.useEffect(()=>{const le=D.current,re=G.current;if(de&&le&&re){const oe=()=>{if(!P.isClosePausedRef.current){const pt=new CustomEvent(OS);re.dispatchEvent(pt),P.isClosePausedRef.current=!0}},_e=()=>{if(P.isClosePausedRef.current){const pt=new CustomEvent(BS);re.dispatchEvent(pt),P.isClosePausedRef.current=!1}},Ne=pt=>{!le.contains(pt.relatedTarget)&&_e()},Ge=()=>{le.contains(document.activeElement)||_e()};return le.addEventListener("focusin",oe),le.addEventListener("focusout",Ne),le.addEventListener("pointermove",oe),le.addEventListener("pointerleave",Ge),window.addEventListener("blur",oe),window.addEventListener("focus",_e),()=>{le.removeEventListener("focusin",oe),le.removeEventListener("focusout",Ne),le.removeEventListener("pointermove",oe),le.removeEventListener("pointerleave",Ge),window.removeEventListener("blur",oe),window.removeEventListener("focus",_e)}}},[de,P.isClosePausedRef]);const Y=W.useCallback(({tabbingDirection:le})=>{const oe=s().map(_e=>{const Ne=_e.ref.current,Ge=[Ne,...L6(Ne)];return le==="forwards"?Ge:Ge.reverse()});return(le==="forwards"?oe.reverse():oe).flat()},[s]);return W.useEffect(()=>{const le=G.current;if(le){const re=oe=>{var Ge,pt,ot;const _e=oe.altKey||oe.ctrlKey||oe.metaKey;if(oe.key==="Tab"&&!_e){const dt=document.activeElement,Bt=oe.shiftKey;if(oe.target===le&&Bt){(Ge=O.current)==null||Ge.focus();return}const ei=Y({tabbingDirection:Bt?"backwards":"forwards"}),xi=ei.findIndex(It=>It===dt);R2(ei.slice(xi+1))?oe.preventDefault():Bt?(pt=O.current)==null||pt.focus():(ot=H.current)==null||ot.focus()}};return le.addEventListener("keydown",re),()=>le.removeEventListener("keydown",re)}},[s,Y]),_.jsxs(p6,{ref:D,role:"region","aria-label":w.replace("{hotkey}",he),tabIndex:-1,style:{pointerEvents:de?void 0:"none"},children:[de&&_.jsx(VS,{ref:O,onFocusFromOutsideViewport:()=>{const le=Y({tabbingDirection:"forwards"});R2(le)}}),_.jsx(_E.Slot,{scope:u,children:_.jsx(jr.ol,{tabIndex:-1,...E,ref:U})}),de&&_.jsx(VS,{ref:H,onFocusFromOutsideViewport:()=>{const le=Y({tabbingDirection:"backwards"});R2(le)}})]})});PN.displayName=AN;var MN="ToastFocusProxy",VS=W.forwardRef((i,o)=>{const{__scopeToast:u,onFocusFromOutsideViewport:m,...w}=i,E=O1(MN,u);return _.jsx(Py,{"aria-hidden":!0,tabIndex:0,...w,ref:o,style:{position:"fixed"},onFocus:P=>{var O;const s=P.relatedTarget;!((O=E.viewport)!=null&&O.contains(s))&&m()}})});VS.displayName=MN;var B1="Toast",E6="toast.swipeStart",C6="toast.swipeMove",I6="toast.swipeCancel",A6="toast.swipeEnd",RN=W.forwardRef((i,o)=>{const{forceMount:u,open:m,defaultOpen:w,onOpenChange:E,...P}=i,[s=!0,D]=tp({prop:m,defaultProp:w,onChange:E});return _.jsx(up,{present:u||s,children:_.jsx(R6,{open:s,...P,ref:o,onClose:()=>D(!1),onPause:Ho(i.onPause),onResume:Ho(i.onResume),onSwipeStart:ir(i.onSwipeStart,O=>{O.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ir(i.onSwipeMove,O=>{const{x:H,y:G}=O.detail.delta;O.currentTarget.setAttribute("data-swipe","move"),O.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${H}px`),O.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${G}px`)}),onSwipeCancel:ir(i.onSwipeCancel,O=>{O.currentTarget.setAttribute("data-swipe","cancel"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),O.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ir(i.onSwipeEnd,O=>{const{x:H,y:G}=O.detail.delta;O.currentTarget.setAttribute("data-swipe","end"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),O.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),O.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${H}px`),O.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${G}px`),D(!1)})})})});RN.displayName=B1;var[P6,M6]=CN(B1,{onClose(){}}),R6=W.forwardRef((i,o)=>{const{__scopeToast:u,type:m="foreground",duration:w,open:E,onClose:P,onEscapeKeyDown:s,onPause:D,onResume:O,onSwipeStart:H,onSwipeMove:G,onSwipeCancel:U,onSwipeEnd:he,...de}=i,Y=O1(B1,u),[le,re]=W.useState(null),oe=kn(o,It=>re(It)),_e=W.useRef(null),Ne=W.useRef(null),Ge=w||Y.duration,pt=W.useRef(0),ot=W.useRef(Ge),dt=W.useRef(0),{onToastAdd:Bt,onToastRemove:Wt}=Y,Ht=Ho(()=>{var ui;(le==null?void 0:le.contains(document.activeElement))&&((ui=Y.viewport)==null||ui.focus()),P()}),ei=W.useCallback(It=>{!It||It===1/0||(window.clearTimeout(dt.current),pt.current=new Date().getTime(),dt.current=window.setTimeout(Ht,It))},[Ht]);W.useEffect(()=>{const It=Y.viewport;if(It){const ui=()=>{ei(ot.current),O==null||O()},Zt=()=>{const Ni=new Date().getTime()-pt.current;ot.current=ot.current-Ni,window.clearTimeout(dt.current),D==null||D()};return It.addEventListener(OS,Zt),It.addEventListener(BS,ui),()=>{It.removeEventListener(OS,Zt),It.removeEventListener(BS,ui)}}},[Y.viewport,Ge,D,O,ei]),W.useEffect(()=>{E&&!Y.isClosePausedRef.current&&ei(Ge)},[E,Ge,Y.isClosePausedRef,ei]),W.useEffect(()=>(Bt(),()=>Wt()),[Bt,Wt]);const xi=W.useMemo(()=>le?FN(le):null,[le]);return Y.viewport?_.jsxs(_.Fragment,{children:[xi&&_.jsx(k6,{__scopeToast:u,role:"status","aria-live":m==="foreground"?"assertive":"polite","aria-atomic":!0,children:xi}),_.jsx(P6,{scope:u,onClose:Ht,children:cp.createPortal(_.jsx(_E.ItemSlot,{scope:u,children:_.jsx(d6,{asChild:!0,onEscapeKeyDown:ir(s,()=>{Y.isFocusedToastEscapeKeyDownRef.current||Ht(),Y.isFocusedToastEscapeKeyDownRef.current=!1}),children:_.jsx(jr.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":E?"open":"closed","data-swipe-direction":Y.swipeDirection,...de,ref:oe,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:ir(i.onKeyDown,It=>{It.key==="Escape"&&(s==null||s(It.nativeEvent),It.nativeEvent.defaultPrevented||(Y.isFocusedToastEscapeKeyDownRef.current=!0,Ht()))}),onPointerDown:ir(i.onPointerDown,It=>{It.button===0&&(_e.current={x:It.clientX,y:It.clientY})}),onPointerMove:ir(i.onPointerMove,It=>{if(!_e.current)return;const ui=It.clientX-_e.current.x,Zt=It.clientY-_e.current.y,Ni=!!Ne.current,ct=["left","right"].includes(Y.swipeDirection),Vt=["left","up"].includes(Y.swipeDirection)?Math.min:Math.max,Gt=ct?Vt(0,ui):0,ti=ct?0:Vt(0,Zt),vi=It.pointerType==="touch"?10:2,Ki={x:Gt,y:ti},Zi={originalEvent:It,delta:Ki};Ni?(Ne.current=Ki,X0(C6,G,Zi,{discrete:!1})):iR(Ki,Y.swipeDirection,vi)?(Ne.current=Ki,X0(E6,H,Zi,{discrete:!1}),It.target.setPointerCapture(It.pointerId)):(Math.abs(ui)>vi||Math.abs(Zt)>vi)&&(_e.current=null)}),onPointerUp:ir(i.onPointerUp,It=>{const ui=Ne.current,Zt=It.target;if(Zt.hasPointerCapture(It.pointerId)&&Zt.releasePointerCapture(It.pointerId),Ne.current=null,_e.current=null,ui){const Ni=It.currentTarget,ct={originalEvent:It,delta:ui};iR(ui,Y.swipeDirection,Y.swipeThreshold)?X0(A6,he,ct,{discrete:!0}):X0(I6,U,ct,{discrete:!0}),Ni.addEventListener("click",Vt=>Vt.preventDefault(),{once:!0})}})})})}),Y.viewport)})]}):null}),k6=i=>{const{__scopeToast:o,children:u,...m}=i,w=O1(B1,o),[E,P]=W.useState(!1),[s,D]=W.useState(!1);return j6(()=>P(!0)),W.useEffect(()=>{const O=window.setTimeout(()=>D(!0),1e3);return()=>window.clearTimeout(O)},[]),s?null:_.jsx(F1,{asChild:!0,children:_.jsx(Py,{...m,children:E&&_.jsxs(_.Fragment,{children:[w.label," ",u]})})})},D6="ToastTitle",kN=W.forwardRef((i,o)=>{const{__scopeToast:u,...m}=i;return _.jsx(jr.div,{...m,ref:o})});kN.displayName=D6;var N6="ToastDescription",DN=W.forwardRef((i,o)=>{const{__scopeToast:u,...m}=i;return _.jsx(jr.div,{...m,ref:o})});DN.displayName=N6;var NN="ToastAction",jN=W.forwardRef((i,o)=>{const{altText:u,...m}=i;return u.trim()?_.jsx(LN,{altText:u,asChild:!0,children:_.jsx(yE,{...m,ref:o})}):(console.error(`Invalid prop \`altText\` supplied to \`${NN}\`. Expected non-empty \`string\`.`),null)});jN.displayName=NN;var zN="ToastClose",yE=W.forwardRef((i,o)=>{const{__scopeToast:u,...m}=i,w=M6(zN,u);return _.jsx(LN,{asChild:!0,children:_.jsx(jr.button,{type:"button",...m,ref:o,onClick:ir(i.onClick,w.onClose)})})});yE.displayName=zN;var LN=W.forwardRef((i,o)=>{const{__scopeToast:u,altText:m,...w}=i;return _.jsx(jr.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":m||void 0,...w,ref:o})});function FN(i){const o=[];return Array.from(i.childNodes).forEach(m=>{if(m.nodeType===m.TEXT_NODE&&m.textContent&&o.push(m.textContent),z6(m)){const w=m.ariaHidden||m.hidden||m.style.display==="none",E=m.dataset.radixToastAnnounceExclude==="";if(!w)if(E){const P=m.dataset.radixToastAnnounceAlt;P&&o.push(P)}else o.push(...FN(m))}}),o}function X0(i,o,u,{discrete:m}){const w=u.originalEvent.currentTarget,E=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:u});o&&w.addEventListener(i,o,{once:!0}),m?bN(w,E):w.dispatchEvent(E)}var iR=(i,o,u=0)=>{const m=Math.abs(i.x),w=Math.abs(i.y),E=m>w;return o==="left"||o==="right"?E&&m>u:!E&&w>u};function j6(i=()=>{}){const o=Ho(i);co(()=>{let u=0,m=0;return u=window.requestAnimationFrame(()=>m=window.requestAnimationFrame(o)),()=>{window.cancelAnimationFrame(u),window.cancelAnimationFrame(m)}},[o])}function z6(i){return i.nodeType===i.ELEMENT_NODE}function L6(i){const o=[],u=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const w=m.tagName==="INPUT"&&m.type==="hidden";return m.disabled||m.hidden||w?NodeFilter.FILTER_SKIP:m.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;u.nextNode();)o.push(u.currentNode);return o}function R2(i){const o=document.activeElement;return i.some(u=>u===o?!0:(u.focus(),document.activeElement!==o))}var F6=IN,ON=PN,BN=RN,VN=kN,UN=DN,GN=jN,$N=yE;function qN(i){var o,u,m="";if(typeof i=="string"||typeof i=="number")m+=i;else if(typeof i=="object")if(Array.isArray(i)){var w=i.length;for(o=0;o<w;o++)i[o]&&(u=qN(i[o]))&&(m&&(m+=" "),m+=u)}else for(u in i)i[u]&&(m&&(m+=" "),m+=u);return m}function HN(){for(var i,o,u=0,m="",w=arguments.length;u<w;u++)(i=arguments[u])&&(o=qN(i))&&(m&&(m+=" "),m+=o);return m}const rR=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,nR=HN,My=(i,o)=>u=>{var m;if((o==null?void 0:o.variants)==null)return nR(i,u==null?void 0:u.class,u==null?void 0:u.className);const{variants:w,defaultVariants:E}=o,P=Object.keys(w).map(O=>{const H=u==null?void 0:u[O],G=E==null?void 0:E[O];if(H===null)return null;const U=rR(H)||rR(G);return w[O][U]}),s=u&&Object.entries(u).reduce((O,H)=>{let[G,U]=H;return U===void 0||(O[G]=U),O},{}),D=o==null||(m=o.compoundVariants)===null||m===void 0?void 0:m.reduce((O,H)=>{let{class:G,className:U,...he}=H;return Object.entries(he).every(de=>{let[Y,le]=de;return Array.isArray(le)?le.includes({...E,...s}[Y]):{...E,...s}[Y]===le})?[...O,G,U]:O},[]);return nR(i,P,D,u==null?void 0:u.class,u==null?void 0:u.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O6=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),WN=(...i)=>i.filter((o,u,m)=>!!o&&o.trim()!==""&&m.indexOf(o)===u).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var B6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V6=W.forwardRef(({color:i="currentColor",size:o=24,strokeWidth:u=2,absoluteStrokeWidth:m,className:w="",children:E,iconNode:P,...s},D)=>W.createElement("svg",{ref:D,...B6,width:o,height:o,stroke:i,strokeWidth:m?Number(u)*24/Number(o):u,className:WN("lucide",w),...s},[...P.map(([O,H])=>W.createElement(O,H)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=(i,o)=>{const u=W.forwardRef(({className:m,...w},E)=>W.createElement(V6,{ref:E,iconNode:o,className:WN(`lucide-${O6(i)}`,m),...w}));return u.displayName=`${i}`,u};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yl=Xr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=Xr("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V1=Xr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U6=Xr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=Xr("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const US=Xr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $6=Xr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=Xr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZN=Xr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H6=Xr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=Xr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=Xr("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YN=Xr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=Xr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=Xr("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=Xr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=Xr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wd=Xr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=Xr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=Xr("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=Xr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=Xr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eV=Xr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tV=Xr("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ac=Xr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=Xr("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iV=Xr("Recycle",[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i1=Xr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rV=Xr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nV=Xr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sV=Xr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oV=Xr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QN=Xr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aV=Xr("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lV=Xr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cV=Xr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zd=Xr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U1=Xr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=Xr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),xE="-",uV=i=>{const o=dV(i),{conflictingClassGroups:u,conflictingClassGroupModifiers:m}=i;return{getClassGroupId:P=>{const s=P.split(xE);return s[0]===""&&s.length!==1&&s.shift(),JN(s,o)||hV(P)},getConflictingClassGroupIds:(P,s)=>{const D=u[P]||[];return s&&m[P]?[...D,...m[P]]:D}}},JN=(i,o)=>{var P;if(i.length===0)return o.classGroupId;const u=i[0],m=o.nextPart.get(u),w=m?JN(i.slice(1),m):void 0;if(w)return w;if(o.validators.length===0)return;const E=i.join(xE);return(P=o.validators.find(({validator:s})=>s(E)))==null?void 0:P.classGroupId},aR=/^\[(.+)\]$/,hV=i=>{if(aR.test(i)){const o=aR.exec(i)[1],u=o==null?void 0:o.substring(0,o.indexOf(":"));if(u)return"arbitrary.."+u}},dV=i=>{const{theme:o,prefix:u}=i,m={nextPart:new Map,validators:[]};return fV(Object.entries(i.classGroups),u).forEach(([E,P])=>{$S(P,m,E,o)}),m},$S=(i,o,u,m)=>{i.forEach(w=>{if(typeof w=="string"){const E=w===""?o:lR(o,w);E.classGroupId=u;return}if(typeof w=="function"){if(pV(w)){$S(w(m),o,u,m);return}o.validators.push({validator:w,classGroupId:u});return}Object.entries(w).forEach(([E,P])=>{$S(P,lR(o,E),u,m)})})},lR=(i,o)=>{let u=i;return o.split(xE).forEach(m=>{u.nextPart.has(m)||u.nextPart.set(m,{nextPart:new Map,validators:[]}),u=u.nextPart.get(m)}),u},pV=i=>i.isThemeGetter,fV=(i,o)=>o?i.map(([u,m])=>{const w=m.map(E=>typeof E=="string"?o+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([P,s])=>[o+P,s])):E);return[u,w]}):i,mV=i=>{if(i<1)return{get:()=>{},set:()=>{}};let o=0,u=new Map,m=new Map;const w=(E,P)=>{u.set(E,P),o++,o>i&&(o=0,m=u,u=new Map)};return{get(E){let P=u.get(E);if(P!==void 0)return P;if((P=m.get(E))!==void 0)return w(E,P),P},set(E,P){u.has(E)?u.set(E,P):w(E,P)}}},ej="!",gV=i=>{const{separator:o,experimentalParseClassName:u}=i,m=o.length===1,w=o[0],E=o.length,P=s=>{const D=[];let O=0,H=0,G;for(let le=0;le<s.length;le++){let re=s[le];if(O===0){if(re===w&&(m||s.slice(le,le+E)===o)){D.push(s.slice(H,le)),H=le+E;continue}if(re==="/"){G=le;continue}}re==="["?O++:re==="]"&&O--}const U=D.length===0?s:s.substring(H),he=U.startsWith(ej),de=he?U.substring(1):U,Y=G&&G>H?G-H:void 0;return{modifiers:D,hasImportantModifier:he,baseClassName:de,maybePostfixModifierPosition:Y}};return u?s=>u({className:s,parseClassName:P}):P},_V=i=>{if(i.length<=1)return i;const o=[];let u=[];return i.forEach(m=>{m[0]==="["?(o.push(...u.sort(),m),u=[]):u.push(m)}),o.push(...u.sort()),o},yV=i=>({cache:mV(i.cacheSize),parseClassName:gV(i),...uV(i)}),xV=/\s+/,vV=(i,o)=>{const{parseClassName:u,getClassGroupId:m,getConflictingClassGroupIds:w}=o,E=[],P=i.trim().split(xV);let s="";for(let D=P.length-1;D>=0;D-=1){const O=P[D],{modifiers:H,hasImportantModifier:G,baseClassName:U,maybePostfixModifierPosition:he}=u(O);let de=!!he,Y=m(de?U.substring(0,he):U);if(!Y){if(!de){s=O+(s.length>0?" "+s:s);continue}if(Y=m(U),!Y){s=O+(s.length>0?" "+s:s);continue}de=!1}const le=_V(H).join(":"),re=G?le+ej:le,oe=re+Y;if(E.includes(oe))continue;E.push(oe);const _e=w(Y,de);for(let Ne=0;Ne<_e.length;++Ne){const Ge=_e[Ne];E.push(re+Ge)}s=O+(s.length>0?" "+s:s)}return s};function wV(){let i=0,o,u,m="";for(;i<arguments.length;)(o=arguments[i++])&&(u=tj(o))&&(m&&(m+=" "),m+=u);return m}const tj=i=>{if(typeof i=="string")return i;let o,u="";for(let m=0;m<i.length;m++)i[m]&&(o=tj(i[m]))&&(u&&(u+=" "),u+=o);return u};function bV(i,...o){let u,m,w,E=P;function P(D){const O=o.reduce((H,G)=>G(H),i());return u=yV(O),m=u.cache.get,w=u.cache.set,E=s,s(D)}function s(D){const O=m(D);if(O)return O;const H=vV(D,u);return w(D,H),H}return function(){return E(wV.apply(null,arguments))}}const Vn=i=>{const o=u=>u[i]||[];return o.isThemeGetter=!0,o},ij=/^\[(?:([a-z-]+):)?(.+)\]$/i,SV=/^\d+\/\d+$/,TV=new Set(["px","full","screen"]),EV=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,CV=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,IV=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,AV=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,PV=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Pc=i=>tm(i)||TV.has(i)||SV.test(i),Fu=i=>km(i,"length",LV),tm=i=>!!i&&!Number.isNaN(Number(i)),k2=i=>km(i,"number",tm),R_=i=>!!i&&Number.isInteger(Number(i)),MV=i=>i.endsWith("%")&&tm(i.slice(0,-1)),Dr=i=>ij.test(i),Ou=i=>EV.test(i),RV=new Set(["length","size","percentage"]),kV=i=>km(i,RV,rj),DV=i=>km(i,"position",rj),NV=new Set(["image","url"]),jV=i=>km(i,NV,OV),zV=i=>km(i,"",FV),k_=()=>!0,km=(i,o,u)=>{const m=ij.exec(i);return m?m[1]?typeof o=="string"?m[1]===o:o.has(m[1]):u(m[2]):!1},LV=i=>CV.test(i)&&!IV.test(i),rj=()=>!1,FV=i=>AV.test(i),OV=i=>PV.test(i),BV=()=>{const i=Vn("colors"),o=Vn("spacing"),u=Vn("blur"),m=Vn("brightness"),w=Vn("borderColor"),E=Vn("borderRadius"),P=Vn("borderSpacing"),s=Vn("borderWidth"),D=Vn("contrast"),O=Vn("grayscale"),H=Vn("hueRotate"),G=Vn("invert"),U=Vn("gap"),he=Vn("gradientColorStops"),de=Vn("gradientColorStopPositions"),Y=Vn("inset"),le=Vn("margin"),re=Vn("opacity"),oe=Vn("padding"),_e=Vn("saturate"),Ne=Vn("scale"),Ge=Vn("sepia"),pt=Vn("skew"),ot=Vn("space"),dt=Vn("translate"),Bt=()=>["auto","contain","none"],Wt=()=>["auto","hidden","clip","visible","scroll"],Ht=()=>["auto",Dr,o],ei=()=>[Dr,o],xi=()=>["",Pc,Fu],It=()=>["auto",tm,Dr],ui=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Zt=()=>["solid","dashed","dotted","double","none"],Ni=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ct=()=>["start","end","center","between","around","evenly","stretch"],Vt=()=>["","0",Dr],Gt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ti=()=>[tm,Dr];return{cacheSize:500,separator:":",theme:{colors:[k_],spacing:[Pc,Fu],blur:["none","",Ou,Dr],brightness:ti(),borderColor:[i],borderRadius:["none","","full",Ou,Dr],borderSpacing:ei(),borderWidth:xi(),contrast:ti(),grayscale:Vt(),hueRotate:ti(),invert:Vt(),gap:ei(),gradientColorStops:[i],gradientColorStopPositions:[MV,Fu],inset:Ht(),margin:Ht(),opacity:ti(),padding:ei(),saturate:ti(),scale:ti(),sepia:Vt(),skew:ti(),space:ei(),translate:ei()},classGroups:{aspect:[{aspect:["auto","square","video",Dr]}],container:["container"],columns:[{columns:[Ou]}],"break-after":[{"break-after":Gt()}],"break-before":[{"break-before":Gt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ui(),Dr]}],overflow:[{overflow:Wt()}],"overflow-x":[{"overflow-x":Wt()}],"overflow-y":[{"overflow-y":Wt()}],overscroll:[{overscroll:Bt()}],"overscroll-x":[{"overscroll-x":Bt()}],"overscroll-y":[{"overscroll-y":Bt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Y]}],"inset-x":[{"inset-x":[Y]}],"inset-y":[{"inset-y":[Y]}],start:[{start:[Y]}],end:[{end:[Y]}],top:[{top:[Y]}],right:[{right:[Y]}],bottom:[{bottom:[Y]}],left:[{left:[Y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",R_,Dr]}],basis:[{basis:Ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Dr]}],grow:[{grow:Vt()}],shrink:[{shrink:Vt()}],order:[{order:["first","last","none",R_,Dr]}],"grid-cols":[{"grid-cols":[k_]}],"col-start-end":[{col:["auto",{span:["full",R_,Dr]},Dr]}],"col-start":[{"col-start":It()}],"col-end":[{"col-end":It()}],"grid-rows":[{"grid-rows":[k_]}],"row-start-end":[{row:["auto",{span:[R_,Dr]},Dr]}],"row-start":[{"row-start":It()}],"row-end":[{"row-end":It()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Dr]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Dr]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...ct()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ct(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ct(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[oe]}],px:[{px:[oe]}],py:[{py:[oe]}],ps:[{ps:[oe]}],pe:[{pe:[oe]}],pt:[{pt:[oe]}],pr:[{pr:[oe]}],pb:[{pb:[oe]}],pl:[{pl:[oe]}],m:[{m:[le]}],mx:[{mx:[le]}],my:[{my:[le]}],ms:[{ms:[le]}],me:[{me:[le]}],mt:[{mt:[le]}],mr:[{mr:[le]}],mb:[{mb:[le]}],ml:[{ml:[le]}],"space-x":[{"space-x":[ot]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ot]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Dr,o]}],"min-w":[{"min-w":[Dr,o,"min","max","fit"]}],"max-w":[{"max-w":[Dr,o,"none","full","min","max","fit","prose",{screen:[Ou]},Ou]}],h:[{h:[Dr,o,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Dr,o,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Dr,o,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Dr,o,"auto","min","max","fit"]}],"font-size":[{text:["base",Ou,Fu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",k2]}],"font-family":[{font:[k_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Dr]}],"line-clamp":[{"line-clamp":["none",tm,k2]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Pc,Dr]}],"list-image":[{"list-image":["none",Dr]}],"list-style-type":[{list:["none","disc","decimal",Dr]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[re]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[re]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Zt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Pc,Fu]}],"underline-offset":[{"underline-offset":["auto",Pc,Dr]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ei()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Dr]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Dr]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[re]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ui(),DV]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",kV]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},jV]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[de]}],"gradient-via-pos":[{via:[de]}],"gradient-to-pos":[{to:[de]}],"gradient-from":[{from:[he]}],"gradient-via":[{via:[he]}],"gradient-to":[{to:[he]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[re]}],"border-style":[{border:[...Zt(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[re]}],"divide-style":[{divide:Zt()}],"border-color":[{border:[w]}],"border-color-x":[{"border-x":[w]}],"border-color-y":[{"border-y":[w]}],"border-color-s":[{"border-s":[w]}],"border-color-e":[{"border-e":[w]}],"border-color-t":[{"border-t":[w]}],"border-color-r":[{"border-r":[w]}],"border-color-b":[{"border-b":[w]}],"border-color-l":[{"border-l":[w]}],"divide-color":[{divide:[w]}],"outline-style":[{outline:["",...Zt()]}],"outline-offset":[{"outline-offset":[Pc,Dr]}],"outline-w":[{outline:[Pc,Fu]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:xi()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[re]}],"ring-offset-w":[{"ring-offset":[Pc,Fu]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Ou,zV]}],"shadow-color":[{shadow:[k_]}],opacity:[{opacity:[re]}],"mix-blend":[{"mix-blend":[...Ni(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ni()}],filter:[{filter:["","none"]}],blur:[{blur:[u]}],brightness:[{brightness:[m]}],contrast:[{contrast:[D]}],"drop-shadow":[{"drop-shadow":["","none",Ou,Dr]}],grayscale:[{grayscale:[O]}],"hue-rotate":[{"hue-rotate":[H]}],invert:[{invert:[G]}],saturate:[{saturate:[_e]}],sepia:[{sepia:[Ge]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[u]}],"backdrop-brightness":[{"backdrop-brightness":[m]}],"backdrop-contrast":[{"backdrop-contrast":[D]}],"backdrop-grayscale":[{"backdrop-grayscale":[O]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[H]}],"backdrop-invert":[{"backdrop-invert":[G]}],"backdrop-opacity":[{"backdrop-opacity":[re]}],"backdrop-saturate":[{"backdrop-saturate":[_e]}],"backdrop-sepia":[{"backdrop-sepia":[Ge]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[P]}],"border-spacing-x":[{"border-spacing-x":[P]}],"border-spacing-y":[{"border-spacing-y":[P]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Dr]}],duration:[{duration:ti()}],ease:[{ease:["linear","in","out","in-out",Dr]}],delay:[{delay:ti()}],animate:[{animate:["none","spin","ping","pulse","bounce",Dr]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ne]}],"scale-x":[{"scale-x":[Ne]}],"scale-y":[{"scale-y":[Ne]}],rotate:[{rotate:[R_,Dr]}],"translate-x":[{"translate-x":[dt]}],"translate-y":[{"translate-y":[dt]}],"skew-x":[{"skew-x":[pt]}],"skew-y":[{"skew-y":[pt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Dr]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Dr]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ei()}],"scroll-mx":[{"scroll-mx":ei()}],"scroll-my":[{"scroll-my":ei()}],"scroll-ms":[{"scroll-ms":ei()}],"scroll-me":[{"scroll-me":ei()}],"scroll-mt":[{"scroll-mt":ei()}],"scroll-mr":[{"scroll-mr":ei()}],"scroll-mb":[{"scroll-mb":ei()}],"scroll-ml":[{"scroll-ml":ei()}],"scroll-p":[{"scroll-p":ei()}],"scroll-px":[{"scroll-px":ei()}],"scroll-py":[{"scroll-py":ei()}],"scroll-ps":[{"scroll-ps":ei()}],"scroll-pe":[{"scroll-pe":ei()}],"scroll-pt":[{"scroll-pt":ei()}],"scroll-pr":[{"scroll-pr":ei()}],"scroll-pb":[{"scroll-pb":ei()}],"scroll-pl":[{"scroll-pl":ei()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Dr]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[Pc,Fu,k2]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},VV=bV(BV);function Zr(...i){return VV(HN(i))}const UV=F6,nj=W.forwardRef(({className:i,...o},u)=>_.jsx(ON,{ref:u,className:Zr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...o}));nj.displayName=ON.displayName;const GV=My("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),sj=W.forwardRef(({className:i,variant:o,...u},m)=>_.jsx(BN,{ref:m,className:Zr(GV({variant:o}),i),...u}));sj.displayName=BN.displayName;const $V=W.forwardRef(({className:i,...o},u)=>_.jsx(GN,{ref:u,className:Zr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",i),...o}));$V.displayName=GN.displayName;const oj=W.forwardRef(({className:i,...o},u)=>_.jsx($N,{ref:u,className:Zr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...o,children:_.jsx(U1,{className:"h-4 w-4"})}));oj.displayName=$N.displayName;const aj=W.forwardRef(({className:i,...o},u)=>_.jsx(VN,{ref:u,className:Zr("text-sm font-semibold",i),...o}));aj.displayName=VN.displayName;const lj=W.forwardRef(({className:i,...o},u)=>_.jsx(UN,{ref:u,className:Zr("text-sm opacity-90",i),...o}));lj.displayName=UN.displayName;function qV(){const{toasts:i}=Iy();return _.jsxs(UV,{children:[i.map(function({id:o,title:u,description:m,action:w,...E}){return _.jsxs(sj,{...E,children:[_.jsxs("div",{className:"grid gap-1",children:[u&&_.jsx(aj,{children:u}),m&&_.jsx(lj,{children:m})]}),w,_.jsx(oj,{})]},o)}),_.jsx(nj,{})]})}var cR=["light","dark"],HV="(prefers-color-scheme: dark)",WV=W.createContext(void 0),ZV={setTheme:i=>{},themes:[]},XV=()=>{var i;return(i=W.useContext(WV))!=null?i:ZV};W.memo(({forcedTheme:i,storageKey:o,attribute:u,enableSystem:m,enableColorScheme:w,defaultTheme:E,value:P,attrs:s,nonce:D})=>{let O=E==="system",H=u==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(de=>`'${de}'`).join(",")})`};`:`var d=document.documentElement,n='${u}',s='setAttribute';`,G=w?cR.includes(E)&&E?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${E}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",U=(de,Y=!1,le=!0)=>{let re=P?P[de]:de,oe=Y?de+"|| ''":`'${re}'`,_e="";return w&&le&&!Y&&cR.includes(de)&&(_e+=`d.style.colorScheme = '${de}';`),u==="class"?Y||re?_e+=`c.add(${oe})`:_e+="null":re&&(_e+=`d[s](n,${oe})`),_e},he=i?`!function(){${H}${U(i)}}()`:m?`!function(){try{${H}var e=localStorage.getItem('${o}');if('system'===e||(!e&&${O})){var t='${HV}',m=window.matchMedia(t);if(m.media!==t||m.matches){${U("dark")}}else{${U("light")}}}else if(e){${P?`var x=${JSON.stringify(P)};`:""}${U(P?"x[e]":"e",!0)}}${O?"":"else{"+U(E,!1,!1)+"}"}${G}}catch(e){}}()`:`!function(){try{${H}var e=localStorage.getItem('${o}');if(e){${P?`var x=${JSON.stringify(P)};`:""}${U(P?"x[e]":"e",!0)}}else{${U(E,!1,!1)};}${G}}catch(t){}}();`;return W.createElement("script",{nonce:D,dangerouslySetInnerHTML:{__html:he}})});var YV=i=>{switch(i){case"success":return JV;case"info":return tU;case"warning":return eU;case"error":return iU;default:return null}},KV=Array(12).fill(0),QV=({visible:i})=>fi.createElement("div",{className:"sonner-loading-wrapper","data-visible":i},fi.createElement("div",{className:"sonner-spinner"},KV.map((o,u)=>fi.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${u}`})))),JV=fi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fi.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),eU=fi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},fi.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),tU=fi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fi.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),iU=fi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},fi.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),rU=()=>{let[i,o]=fi.useState(document.hidden);return fi.useEffect(()=>{let u=()=>{o(document.hidden)};return document.addEventListener("visibilitychange",u),()=>window.removeEventListener("visibilitychange",u)},[]),i},qS=1,nU=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let o=this.subscribers.indexOf(i);this.subscribers.splice(o,1)}),this.publish=i=>{this.subscribers.forEach(o=>o(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var o;let{message:u,...m}=i,w=typeof(i==null?void 0:i.id)=="number"||((o=i.id)==null?void 0:o.length)>0?i.id:qS++,E=this.toasts.find(s=>s.id===w),P=i.dismissible===void 0?!0:i.dismissible;return E?this.toasts=this.toasts.map(s=>s.id===w?(this.publish({...s,...i,id:w,title:u}),{...s,...i,id:w,dismissible:P,title:u}):s):this.addToast({title:u,...m,dismissible:P,id:w}),w},this.dismiss=i=>(i||this.toasts.forEach(o=>{this.subscribers.forEach(u=>u({id:o.id,dismiss:!0}))}),this.subscribers.forEach(o=>o({id:i,dismiss:!0})),i),this.message=(i,o)=>this.create({...o,message:i}),this.error=(i,o)=>this.create({...o,message:i,type:"error"}),this.success=(i,o)=>this.create({...o,type:"success",message:i}),this.info=(i,o)=>this.create({...o,type:"info",message:i}),this.warning=(i,o)=>this.create({...o,type:"warning",message:i}),this.loading=(i,o)=>this.create({...o,type:"loading",message:i}),this.promise=(i,o)=>{if(!o)return;let u;o.loading!==void 0&&(u=this.create({...o,promise:i,type:"loading",message:o.loading,description:typeof o.description!="function"?o.description:void 0}));let m=i instanceof Promise?i:i(),w=u!==void 0;return m.then(async E=>{if(oU(E)&&!E.ok){w=!1;let P=typeof o.error=="function"?await o.error(`HTTP error! status: ${E.status}`):o.error,s=typeof o.description=="function"?await o.description(`HTTP error! status: ${E.status}`):o.description;this.create({id:u,type:"error",message:P,description:s})}else if(o.success!==void 0){w=!1;let P=typeof o.success=="function"?await o.success(E):o.success,s=typeof o.description=="function"?await o.description(E):o.description;this.create({id:u,type:"success",message:P,description:s})}}).catch(async E=>{if(o.error!==void 0){w=!1;let P=typeof o.error=="function"?await o.error(E):o.error,s=typeof o.description=="function"?await o.description(E):o.description;this.create({id:u,type:"error",message:P,description:s})}}).finally(()=>{var E;w&&(this.dismiss(u),u=void 0),(E=o.finally)==null||E.call(o)}),u},this.custom=(i,o)=>{let u=(o==null?void 0:o.id)||qS++;return this.create({jsx:i(u),id:u,...o}),u},this.subscribers=[],this.toasts=[]}},la=new nU,sU=(i,o)=>{let u=(o==null?void 0:o.id)||qS++;return la.addToast({title:i,...o,id:u}),u},oU=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",aU=sU,lU=()=>la.toasts;Object.assign(aU,{success:la.success,info:la.info,warning:la.warning,error:la.error,custom:la.custom,message:la.message,promise:la.promise,dismiss:la.dismiss,loading:la.loading},{getHistory:lU});function cU(i,{insertAt:o}={}){if(typeof document>"u")return;let u=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",o==="top"&&u.firstChild?u.insertBefore(m,u.firstChild):u.appendChild(m),m.styleSheet?m.styleSheet.cssText=i:m.appendChild(document.createTextNode(i))}cU(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Y0(i){return i.label!==void 0}var uU=3,hU="32px",dU=4e3,pU=356,fU=14,mU=20,gU=200;function _U(...i){return i.filter(Boolean).join(" ")}var yU=i=>{var o,u,m,w,E,P,s,D,O,H;let{invert:G,toast:U,unstyled:he,interacting:de,setHeights:Y,visibleToasts:le,heights:re,index:oe,toasts:_e,expanded:Ne,removeToast:Ge,defaultRichColors:pt,closeButton:ot,style:dt,cancelButtonStyle:Bt,actionButtonStyle:Wt,className:Ht="",descriptionClassName:ei="",duration:xi,position:It,gap:ui,loadingIcon:Zt,expandByDefault:Ni,classNames:ct,icons:Vt,closeButtonAriaLabel:Gt="Close toast",pauseWhenPageIsHidden:ti,cn:vi}=i,[Ki,Zi]=fi.useState(!1),[Hi,Ii]=fi.useState(!1),[hi,_i]=fi.useState(!1),[ji,Er]=fi.useState(!1),[wr,nr]=fi.useState(0),[dr,Ln]=fi.useState(0),ns=fi.useRef(null),pn=fi.useRef(null),ys=oe===0,Eo=oe+1<=le,Ur=U.type,Fn=U.dismissible!==!1,Co=U.className||"",Io=U.descriptionClassName||"",Os=fi.useMemo(()=>re.findIndex(di=>di.toastId===U.id)||0,[re,U.id]),Qn=fi.useMemo(()=>{var di;return(di=U.closeButton)!=null?di:ot},[U.closeButton,ot]),Wo=fi.useMemo(()=>U.duration||xi||dU,[U.duration,xi]),Ao=fi.useRef(0),On=fi.useRef(0),_a=fi.useRef(0),ds=fi.useRef(null),[Zo,Hn]=It.split("-"),xs=fi.useMemo(()=>re.reduce((di,Yr,rn)=>rn>=Os?di:di+Yr.height,0),[re,Os]),Po=rU(),Mo=U.invert||G,ho=Ur==="loading";On.current=fi.useMemo(()=>Os*ui+xs,[Os,xs]),fi.useEffect(()=>{Zi(!0)},[]),fi.useLayoutEffect(()=>{if(!Ki)return;let di=pn.current,Yr=di.style.height;di.style.height="auto";let rn=di.getBoundingClientRect().height;di.style.height=Yr,Ln(rn),Y(bn=>bn.find(As=>As.toastId===U.id)?bn.map(As=>As.toastId===U.id?{...As,height:rn}:As):[{toastId:U.id,height:rn,position:U.position},...bn])},[Ki,U.title,U.description,Y,U.id]);let ss=fi.useCallback(()=>{Ii(!0),nr(On.current),Y(di=>di.filter(Yr=>Yr.toastId!==U.id)),setTimeout(()=>{Ge(U)},gU)},[U,Ge,Y,On]);fi.useEffect(()=>{if(U.promise&&Ur==="loading"||U.duration===1/0||U.type==="loading")return;let di,Yr=Wo;return Ne||de||ti&&Po?(()=>{if(_a.current<Ao.current){let rn=new Date().getTime()-Ao.current;Yr=Yr-rn}_a.current=new Date().getTime()})():Yr!==1/0&&(Ao.current=new Date().getTime(),di=setTimeout(()=>{var rn;(rn=U.onAutoClose)==null||rn.call(U,U),ss()},Yr)),()=>clearTimeout(di)},[Ne,de,Ni,U,Wo,ss,U.promise,Ur,ti,Po]),fi.useEffect(()=>{let di=pn.current;if(di){let Yr=di.getBoundingClientRect().height;return Ln(Yr),Y(rn=>[{toastId:U.id,height:Yr,position:U.position},...rn]),()=>Y(rn=>rn.filter(bn=>bn.toastId!==U.id))}},[Y,U.id]),fi.useEffect(()=>{U.delete&&ss()},[ss,U.delete]);function ya(){return Vt!=null&&Vt.loading?fi.createElement("div",{className:"sonner-loader","data-visible":Ur==="loading"},Vt.loading):Zt?fi.createElement("div",{className:"sonner-loader","data-visible":Ur==="loading"},Zt):fi.createElement(QV,{visible:Ur==="loading"})}return fi.createElement("li",{"aria-live":U.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:pn,className:vi(Ht,Co,ct==null?void 0:ct.toast,(o=U==null?void 0:U.classNames)==null?void 0:o.toast,ct==null?void 0:ct.default,ct==null?void 0:ct[Ur],(u=U==null?void 0:U.classNames)==null?void 0:u[Ur]),"data-sonner-toast":"","data-rich-colors":(m=U.richColors)!=null?m:pt,"data-styled":!(U.jsx||U.unstyled||he),"data-mounted":Ki,"data-promise":!!U.promise,"data-removed":Hi,"data-visible":Eo,"data-y-position":Zo,"data-x-position":Hn,"data-index":oe,"data-front":ys,"data-swiping":hi,"data-dismissible":Fn,"data-type":Ur,"data-invert":Mo,"data-swipe-out":ji,"data-expanded":!!(Ne||Ni&&Ki),style:{"--index":oe,"--toasts-before":oe,"--z-index":_e.length-oe,"--offset":`${Hi?wr:On.current}px`,"--initial-height":Ni?"auto":`${dr}px`,...dt,...U.style},onPointerDown:di=>{ho||!Fn||(ns.current=new Date,nr(On.current),di.target.setPointerCapture(di.pointerId),di.target.tagName!=="BUTTON"&&(_i(!0),ds.current={x:di.clientX,y:di.clientY}))},onPointerUp:()=>{var di,Yr,rn,bn;if(ji||!Fn)return;ds.current=null;let As=Number(((di=pn.current)==null?void 0:di.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Xo=new Date().getTime()-((Yr=ns.current)==null?void 0:Yr.getTime()),Yo=Math.abs(As)/Xo;if(Math.abs(As)>=mU||Yo>.11){nr(On.current),(rn=U.onDismiss)==null||rn.call(U,U),ss(),Er(!0);return}(bn=pn.current)==null||bn.style.setProperty("--swipe-amount","0px"),_i(!1)},onPointerMove:di=>{var Yr;if(!ds.current||!Fn)return;let rn=di.clientY-ds.current.y,bn=di.clientX-ds.current.x,As=(Zo==="top"?Math.min:Math.max)(0,rn),Xo=di.pointerType==="touch"?10:2;Math.abs(As)>Xo?(Yr=pn.current)==null||Yr.style.setProperty("--swipe-amount",`${rn}px`):Math.abs(bn)>Xo&&(ds.current=null)}},Qn&&!U.jsx?fi.createElement("button",{"aria-label":Gt,"data-disabled":ho,"data-close-button":!0,onClick:ho||!Fn?()=>{}:()=>{var di;ss(),(di=U.onDismiss)==null||di.call(U,U)},className:vi(ct==null?void 0:ct.closeButton,(w=U==null?void 0:U.classNames)==null?void 0:w.closeButton)},fi.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},fi.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),fi.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,U.jsx||fi.isValidElement(U.title)?U.jsx||U.title:fi.createElement(fi.Fragment,null,Ur||U.icon||U.promise?fi.createElement("div",{"data-icon":"",className:vi(ct==null?void 0:ct.icon,(E=U==null?void 0:U.classNames)==null?void 0:E.icon)},U.promise||U.type==="loading"&&!U.icon?U.icon||ya():null,U.type!=="loading"?U.icon||(Vt==null?void 0:Vt[Ur])||YV(Ur):null):null,fi.createElement("div",{"data-content":"",className:vi(ct==null?void 0:ct.content,(P=U==null?void 0:U.classNames)==null?void 0:P.content)},fi.createElement("div",{"data-title":"",className:vi(ct==null?void 0:ct.title,(s=U==null?void 0:U.classNames)==null?void 0:s.title)},U.title),U.description?fi.createElement("div",{"data-description":"",className:vi(ei,Io,ct==null?void 0:ct.description,(D=U==null?void 0:U.classNames)==null?void 0:D.description)},U.description):null),fi.isValidElement(U.cancel)?U.cancel:U.cancel&&Y0(U.cancel)?fi.createElement("button",{"data-button":!0,"data-cancel":!0,style:U.cancelButtonStyle||Bt,onClick:di=>{var Yr,rn;Y0(U.cancel)&&Fn&&((rn=(Yr=U.cancel).onClick)==null||rn.call(Yr,di),ss())},className:vi(ct==null?void 0:ct.cancelButton,(O=U==null?void 0:U.classNames)==null?void 0:O.cancelButton)},U.cancel.label):null,fi.isValidElement(U.action)?U.action:U.action&&Y0(U.action)?fi.createElement("button",{"data-button":!0,"data-action":!0,style:U.actionButtonStyle||Wt,onClick:di=>{var Yr,rn;Y0(U.action)&&(di.defaultPrevented||((rn=(Yr=U.action).onClick)==null||rn.call(Yr,di),ss()))},className:vi(ct==null?void 0:ct.actionButton,(H=U==null?void 0:U.classNames)==null?void 0:H.actionButton)},U.action.label):null))};function uR(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}var xU=i=>{let{invert:o,position:u="bottom-right",hotkey:m=["altKey","KeyT"],expand:w,closeButton:E,className:P,offset:s,theme:D="light",richColors:O,duration:H,style:G,visibleToasts:U=uU,toastOptions:he,dir:de=uR(),gap:Y=fU,loadingIcon:le,icons:re,containerAriaLabel:oe="Notifications",pauseWhenPageIsHidden:_e,cn:Ne=_U}=i,[Ge,pt]=fi.useState([]),ot=fi.useMemo(()=>Array.from(new Set([u].concat(Ge.filter(ti=>ti.position).map(ti=>ti.position)))),[Ge,u]),[dt,Bt]=fi.useState([]),[Wt,Ht]=fi.useState(!1),[ei,xi]=fi.useState(!1),[It,ui]=fi.useState(D!=="system"?D:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Zt=fi.useRef(null),Ni=m.join("+").replace(/Key/g,"").replace(/Digit/g,""),ct=fi.useRef(null),Vt=fi.useRef(!1),Gt=fi.useCallback(ti=>{var vi;(vi=Ge.find(Ki=>Ki.id===ti.id))!=null&&vi.delete||la.dismiss(ti.id),pt(Ki=>Ki.filter(({id:Zi})=>Zi!==ti.id))},[Ge]);return fi.useEffect(()=>la.subscribe(ti=>{if(ti.dismiss){pt(vi=>vi.map(Ki=>Ki.id===ti.id?{...Ki,delete:!0}:Ki));return}setTimeout(()=>{yN.flushSync(()=>{pt(vi=>{let Ki=vi.findIndex(Zi=>Zi.id===ti.id);return Ki!==-1?[...vi.slice(0,Ki),{...vi[Ki],...ti},...vi.slice(Ki+1)]:[ti,...vi]})})})}),[]),fi.useEffect(()=>{if(D!=="system"){ui(D);return}D==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ui("dark"):ui("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:ti})=>{ui(ti?"dark":"light")})},[D]),fi.useEffect(()=>{Ge.length<=1&&Ht(!1)},[Ge]),fi.useEffect(()=>{let ti=vi=>{var Ki,Zi;m.every(Hi=>vi[Hi]||vi.code===Hi)&&(Ht(!0),(Ki=Zt.current)==null||Ki.focus()),vi.code==="Escape"&&(document.activeElement===Zt.current||(Zi=Zt.current)!=null&&Zi.contains(document.activeElement))&&Ht(!1)};return document.addEventListener("keydown",ti),()=>document.removeEventListener("keydown",ti)},[m]),fi.useEffect(()=>{if(Zt.current)return()=>{ct.current&&(ct.current.focus({preventScroll:!0}),ct.current=null,Vt.current=!1)}},[Zt.current]),Ge.length?fi.createElement("section",{"aria-label":`${oe} ${Ni}`,tabIndex:-1},ot.map((ti,vi)=>{var Ki;let[Zi,Hi]=ti.split("-");return fi.createElement("ol",{key:ti,dir:de==="auto"?uR():de,tabIndex:-1,ref:Zt,className:P,"data-sonner-toaster":!0,"data-theme":It,"data-y-position":Zi,"data-x-position":Hi,style:{"--front-toast-height":`${((Ki=dt[0])==null?void 0:Ki.height)||0}px`,"--offset":typeof s=="number"?`${s}px`:s||hU,"--width":`${pU}px`,"--gap":`${Y}px`,...G},onBlur:Ii=>{Vt.current&&!Ii.currentTarget.contains(Ii.relatedTarget)&&(Vt.current=!1,ct.current&&(ct.current.focus({preventScroll:!0}),ct.current=null))},onFocus:Ii=>{Ii.target instanceof HTMLElement&&Ii.target.dataset.dismissible==="false"||Vt.current||(Vt.current=!0,ct.current=Ii.relatedTarget)},onMouseEnter:()=>Ht(!0),onMouseMove:()=>Ht(!0),onMouseLeave:()=>{ei||Ht(!1)},onPointerDown:Ii=>{Ii.target instanceof HTMLElement&&Ii.target.dataset.dismissible==="false"||xi(!0)},onPointerUp:()=>xi(!1)},Ge.filter(Ii=>!Ii.position&&vi===0||Ii.position===ti).map((Ii,hi)=>{var _i,ji;return fi.createElement(yU,{key:Ii.id,icons:re,index:hi,toast:Ii,defaultRichColors:O,duration:(_i=he==null?void 0:he.duration)!=null?_i:H,className:he==null?void 0:he.className,descriptionClassName:he==null?void 0:he.descriptionClassName,invert:o,visibleToasts:U,closeButton:(ji=he==null?void 0:he.closeButton)!=null?ji:E,interacting:ei,position:ti,style:he==null?void 0:he.style,unstyled:he==null?void 0:he.unstyled,classNames:he==null?void 0:he.classNames,cancelButtonStyle:he==null?void 0:he.cancelButtonStyle,actionButtonStyle:he==null?void 0:he.actionButtonStyle,removeToast:Gt,toasts:Ge.filter(Er=>Er.position==Ii.position),heights:dt.filter(Er=>Er.position==Ii.position),setHeights:Bt,expandByDefault:w,gap:Y,loadingIcon:le,expanded:Wt,pauseWhenPageIsHidden:_e,cn:Ne})}))})):null};const vU=({...i})=>{const{theme:o="system"}=XV();return _.jsx(xU,{theme:o,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})};var wU=mk.useId||(()=>{}),bU=0;function dh(i){const[o,u]=W.useState(wU());return co(()=>{u(m=>m??String(bU++))},[i]),o?`radix-${o}`:""}const SU=["top","right","bottom","left"],gh=Math.min,ua=Math.max,r1=Math.round,K0=Math.floor,_h=i=>({x:i,y:i}),TU={left:"right",right:"left",bottom:"top",top:"bottom"},EU={start:"end",end:"start"};function HS(i,o,u){return ua(i,gh(o,u))}function Uc(i,o){return typeof i=="function"?i(o):i}function Gc(i){return i.split("-")[0]}function Dm(i){return i.split("-")[1]}function vE(i){return i==="x"?"y":"x"}function wE(i){return i==="y"?"height":"width"}function yh(i){return["top","bottom"].includes(Gc(i))?"y":"x"}function bE(i){return vE(yh(i))}function CU(i,o,u){u===void 0&&(u=!1);const m=Dm(i),w=bE(i),E=wE(w);let P=w==="x"?m===(u?"end":"start")?"right":"left":m==="start"?"bottom":"top";return o.reference[E]>o.floating[E]&&(P=n1(P)),[P,n1(P)]}function IU(i){const o=n1(i);return[WS(i),o,WS(o)]}function WS(i){return i.replace(/start|end/g,o=>EU[o])}function AU(i,o,u){const m=["left","right"],w=["right","left"],E=["top","bottom"],P=["bottom","top"];switch(i){case"top":case"bottom":return u?o?w:m:o?m:w;case"left":case"right":return o?E:P;default:return[]}}function PU(i,o,u,m){const w=Dm(i);let E=AU(Gc(i),u==="start",m);return w&&(E=E.map(P=>P+"-"+w),o&&(E=E.concat(E.map(WS)))),E}function n1(i){return i.replace(/left|right|bottom|top/g,o=>TU[o])}function MU(i){return{top:0,right:0,bottom:0,left:0,...i}}function cj(i){return typeof i!="number"?MU(i):{top:i,right:i,bottom:i,left:i}}function s1(i){const{x:o,y:u,width:m,height:w}=i;return{width:m,height:w,top:u,left:o,right:o+m,bottom:u+w,x:o,y:u}}function hR(i,o,u){let{reference:m,floating:w}=i;const E=yh(o),P=bE(o),s=wE(P),D=Gc(o),O=E==="y",H=m.x+m.width/2-w.width/2,G=m.y+m.height/2-w.height/2,U=m[s]/2-w[s]/2;let he;switch(D){case"top":he={x:H,y:m.y-w.height};break;case"bottom":he={x:H,y:m.y+m.height};break;case"right":he={x:m.x+m.width,y:G};break;case"left":he={x:m.x-w.width,y:G};break;default:he={x:m.x,y:m.y}}switch(Dm(o)){case"start":he[P]-=U*(u&&O?-1:1);break;case"end":he[P]+=U*(u&&O?-1:1);break}return he}const RU=async(i,o,u)=>{const{placement:m="bottom",strategy:w="absolute",middleware:E=[],platform:P}=u,s=E.filter(Boolean),D=await(P.isRTL==null?void 0:P.isRTL(o));let O=await P.getElementRects({reference:i,floating:o,strategy:w}),{x:H,y:G}=hR(O,m,D),U=m,he={},de=0;for(let Y=0;Y<s.length;Y++){const{name:le,fn:re}=s[Y],{x:oe,y:_e,data:Ne,reset:Ge}=await re({x:H,y:G,initialPlacement:m,placement:U,strategy:w,middlewareData:he,rects:O,platform:P,elements:{reference:i,floating:o}});H=oe??H,G=_e??G,he={...he,[le]:{...he[le],...Ne}},Ge&&de<=50&&(de++,typeof Ge=="object"&&(Ge.placement&&(U=Ge.placement),Ge.rects&&(O=Ge.rects===!0?await P.getElementRects({reference:i,floating:o,strategy:w}):Ge.rects),{x:H,y:G}=hR(O,U,D)),Y=-1)}return{x:H,y:G,placement:U,strategy:w,middlewareData:he}};async function py(i,o){var u;o===void 0&&(o={});const{x:m,y:w,platform:E,rects:P,elements:s,strategy:D}=i,{boundary:O="clippingAncestors",rootBoundary:H="viewport",elementContext:G="floating",altBoundary:U=!1,padding:he=0}=Uc(o,i),de=cj(he),le=s[U?G==="floating"?"reference":"floating":G],re=s1(await E.getClippingRect({element:(u=await(E.isElement==null?void 0:E.isElement(le)))==null||u?le:le.contextElement||await(E.getDocumentElement==null?void 0:E.getDocumentElement(s.floating)),boundary:O,rootBoundary:H,strategy:D})),oe=G==="floating"?{x:m,y:w,width:P.floating.width,height:P.floating.height}:P.reference,_e=await(E.getOffsetParent==null?void 0:E.getOffsetParent(s.floating)),Ne=await(E.isElement==null?void 0:E.isElement(_e))?await(E.getScale==null?void 0:E.getScale(_e))||{x:1,y:1}:{x:1,y:1},Ge=s1(E.convertOffsetParentRelativeRectToViewportRelativeRect?await E.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:oe,offsetParent:_e,strategy:D}):oe);return{top:(re.top-Ge.top+de.top)/Ne.y,bottom:(Ge.bottom-re.bottom+de.bottom)/Ne.y,left:(re.left-Ge.left+de.left)/Ne.x,right:(Ge.right-re.right+de.right)/Ne.x}}const kU=i=>({name:"arrow",options:i,async fn(o){const{x:u,y:m,placement:w,rects:E,platform:P,elements:s,middlewareData:D}=o,{element:O,padding:H=0}=Uc(i,o)||{};if(O==null)return{};const G=cj(H),U={x:u,y:m},he=bE(w),de=wE(he),Y=await P.getDimensions(O),le=he==="y",re=le?"top":"left",oe=le?"bottom":"right",_e=le?"clientHeight":"clientWidth",Ne=E.reference[de]+E.reference[he]-U[he]-E.floating[de],Ge=U[he]-E.reference[he],pt=await(P.getOffsetParent==null?void 0:P.getOffsetParent(O));let ot=pt?pt[_e]:0;(!ot||!await(P.isElement==null?void 0:P.isElement(pt)))&&(ot=s.floating[_e]||E.floating[de]);const dt=Ne/2-Ge/2,Bt=ot/2-Y[de]/2-1,Wt=gh(G[re],Bt),Ht=gh(G[oe],Bt),ei=Wt,xi=ot-Y[de]-Ht,It=ot/2-Y[de]/2+dt,ui=HS(ei,It,xi),Zt=!D.arrow&&Dm(w)!=null&&It!==ui&&E.reference[de]/2-(It<ei?Wt:Ht)-Y[de]/2<0,Ni=Zt?It<ei?It-ei:It-xi:0;return{[he]:U[he]+Ni,data:{[he]:ui,centerOffset:It-ui-Ni,...Zt&&{alignmentOffset:Ni}},reset:Zt}}}),DU=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(o){var u,m;const{placement:w,middlewareData:E,rects:P,initialPlacement:s,platform:D,elements:O}=o,{mainAxis:H=!0,crossAxis:G=!0,fallbackPlacements:U,fallbackStrategy:he="bestFit",fallbackAxisSideDirection:de="none",flipAlignment:Y=!0,...le}=Uc(i,o);if((u=E.arrow)!=null&&u.alignmentOffset)return{};const re=Gc(w),oe=yh(s),_e=Gc(s)===s,Ne=await(D.isRTL==null?void 0:D.isRTL(O.floating)),Ge=U||(_e||!Y?[n1(s)]:IU(s)),pt=de!=="none";!U&&pt&&Ge.push(...PU(s,Y,de,Ne));const ot=[s,...Ge],dt=await py(o,le),Bt=[];let Wt=((m=E.flip)==null?void 0:m.overflows)||[];if(H&&Bt.push(dt[re]),G){const It=CU(w,P,Ne);Bt.push(dt[It[0]],dt[It[1]])}if(Wt=[...Wt,{placement:w,overflows:Bt}],!Bt.every(It=>It<=0)){var Ht,ei;const It=(((Ht=E.flip)==null?void 0:Ht.index)||0)+1,ui=ot[It];if(ui)return{data:{index:It,overflows:Wt},reset:{placement:ui}};let Zt=(ei=Wt.filter(Ni=>Ni.overflows[0]<=0).sort((Ni,ct)=>Ni.overflows[1]-ct.overflows[1])[0])==null?void 0:ei.placement;if(!Zt)switch(he){case"bestFit":{var xi;const Ni=(xi=Wt.filter(ct=>{if(pt){const Vt=yh(ct.placement);return Vt===oe||Vt==="y"}return!0}).map(ct=>[ct.placement,ct.overflows.filter(Vt=>Vt>0).reduce((Vt,Gt)=>Vt+Gt,0)]).sort((ct,Vt)=>ct[1]-Vt[1])[0])==null?void 0:xi[0];Ni&&(Zt=Ni);break}case"initialPlacement":Zt=s;break}if(w!==Zt)return{reset:{placement:Zt}}}return{}}}};function dR(i,o){return{top:i.top-o.height,right:i.right-o.width,bottom:i.bottom-o.height,left:i.left-o.width}}function pR(i){return SU.some(o=>i[o]>=0)}const NU=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(o){const{rects:u}=o,{strategy:m="referenceHidden",...w}=Uc(i,o);switch(m){case"referenceHidden":{const E=await py(o,{...w,elementContext:"reference"}),P=dR(E,u.reference);return{data:{referenceHiddenOffsets:P,referenceHidden:pR(P)}}}case"escaped":{const E=await py(o,{...w,altBoundary:!0}),P=dR(E,u.floating);return{data:{escapedOffsets:P,escaped:pR(P)}}}default:return{}}}}};async function jU(i,o){const{placement:u,platform:m,elements:w}=i,E=await(m.isRTL==null?void 0:m.isRTL(w.floating)),P=Gc(u),s=Dm(u),D=yh(u)==="y",O=["left","top"].includes(P)?-1:1,H=E&&D?-1:1,G=Uc(o,i);let{mainAxis:U,crossAxis:he,alignmentAxis:de}=typeof G=="number"?{mainAxis:G,crossAxis:0,alignmentAxis:null}:{mainAxis:G.mainAxis||0,crossAxis:G.crossAxis||0,alignmentAxis:G.alignmentAxis};return s&&typeof de=="number"&&(he=s==="end"?de*-1:de),D?{x:he*H,y:U*O}:{x:U*O,y:he*H}}const zU=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(o){var u,m;const{x:w,y:E,placement:P,middlewareData:s}=o,D=await jU(o,i);return P===((u=s.offset)==null?void 0:u.placement)&&(m=s.arrow)!=null&&m.alignmentOffset?{}:{x:w+D.x,y:E+D.y,data:{...D,placement:P}}}}},LU=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(o){const{x:u,y:m,placement:w}=o,{mainAxis:E=!0,crossAxis:P=!1,limiter:s={fn:le=>{let{x:re,y:oe}=le;return{x:re,y:oe}}},...D}=Uc(i,o),O={x:u,y:m},H=await py(o,D),G=yh(Gc(w)),U=vE(G);let he=O[U],de=O[G];if(E){const le=U==="y"?"top":"left",re=U==="y"?"bottom":"right",oe=he+H[le],_e=he-H[re];he=HS(oe,he,_e)}if(P){const le=G==="y"?"top":"left",re=G==="y"?"bottom":"right",oe=de+H[le],_e=de-H[re];de=HS(oe,de,_e)}const Y=s.fn({...o,[U]:he,[G]:de});return{...Y,data:{x:Y.x-u,y:Y.y-m,enabled:{[U]:E,[G]:P}}}}}},FU=function(i){return i===void 0&&(i={}),{options:i,fn(o){const{x:u,y:m,placement:w,rects:E,middlewareData:P}=o,{offset:s=0,mainAxis:D=!0,crossAxis:O=!0}=Uc(i,o),H={x:u,y:m},G=yh(w),U=vE(G);let he=H[U],de=H[G];const Y=Uc(s,o),le=typeof Y=="number"?{mainAxis:Y,crossAxis:0}:{mainAxis:0,crossAxis:0,...Y};if(D){const _e=U==="y"?"height":"width",Ne=E.reference[U]-E.floating[_e]+le.mainAxis,Ge=E.reference[U]+E.reference[_e]-le.mainAxis;he<Ne?he=Ne:he>Ge&&(he=Ge)}if(O){var re,oe;const _e=U==="y"?"width":"height",Ne=["top","left"].includes(Gc(w)),Ge=E.reference[G]-E.floating[_e]+(Ne&&((re=P.offset)==null?void 0:re[G])||0)+(Ne?0:le.crossAxis),pt=E.reference[G]+E.reference[_e]+(Ne?0:((oe=P.offset)==null?void 0:oe[G])||0)-(Ne?le.crossAxis:0);de<Ge?de=Ge:de>pt&&(de=pt)}return{[U]:he,[G]:de}}}},OU=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(o){var u,m;const{placement:w,rects:E,platform:P,elements:s}=o,{apply:D=()=>{},...O}=Uc(i,o),H=await py(o,O),G=Gc(w),U=Dm(w),he=yh(w)==="y",{width:de,height:Y}=E.floating;let le,re;G==="top"||G==="bottom"?(le=G,re=U===(await(P.isRTL==null?void 0:P.isRTL(s.floating))?"start":"end")?"left":"right"):(re=G,le=U==="end"?"top":"bottom");const oe=Y-H.top-H.bottom,_e=de-H.left-H.right,Ne=gh(Y-H[le],oe),Ge=gh(de-H[re],_e),pt=!o.middlewareData.shift;let ot=Ne,dt=Ge;if((u=o.middlewareData.shift)!=null&&u.enabled.x&&(dt=_e),(m=o.middlewareData.shift)!=null&&m.enabled.y&&(ot=oe),pt&&!U){const Wt=ua(H.left,0),Ht=ua(H.right,0),ei=ua(H.top,0),xi=ua(H.bottom,0);he?dt=de-2*(Wt!==0||Ht!==0?Wt+Ht:ua(H.left,H.right)):ot=Y-2*(ei!==0||xi!==0?ei+xi:ua(H.top,H.bottom))}await D({...o,availableWidth:dt,availableHeight:ot});const Bt=await P.getDimensions(s.floating);return de!==Bt.width||Y!==Bt.height?{reset:{rects:!0}}:{}}}};function G1(){return typeof window<"u"}function Nm(i){return uj(i)?(i.nodeName||"").toLowerCase():"#document"}function pa(i){var o;return(i==null||(o=i.ownerDocument)==null?void 0:o.defaultView)||window}function ec(i){var o;return(o=(uj(i)?i.ownerDocument:i.document)||window.document)==null?void 0:o.documentElement}function uj(i){return G1()?i instanceof Node||i instanceof pa(i).Node:!1}function dl(i){return G1()?i instanceof Element||i instanceof pa(i).Element:!1}function Kl(i){return G1()?i instanceof HTMLElement||i instanceof pa(i).HTMLElement:!1}function fR(i){return!G1()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof pa(i).ShadowRoot}function Ry(i){const{overflow:o,overflowX:u,overflowY:m,display:w}=pl(i);return/auto|scroll|overlay|hidden|clip/.test(o+m+u)&&!["inline","contents"].includes(w)}function BU(i){return["table","td","th"].includes(Nm(i))}function $1(i){return[":popover-open",":modal"].some(o=>{try{return i.matches(o)}catch{return!1}})}function SE(i){const o=TE(),u=dl(i)?pl(i):i;return u.transform!=="none"||u.perspective!=="none"||(u.containerType?u.containerType!=="normal":!1)||!o&&(u.backdropFilter?u.backdropFilter!=="none":!1)||!o&&(u.filter?u.filter!=="none":!1)||["transform","perspective","filter"].some(m=>(u.willChange||"").includes(m))||["paint","layout","strict","content"].some(m=>(u.contain||"").includes(m))}function VU(i){let o=xh(i);for(;Kl(o)&&!Cm(o);){if(SE(o))return o;if($1(o))return null;o=xh(o)}return null}function TE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Cm(i){return["html","body","#document"].includes(Nm(i))}function pl(i){return pa(i).getComputedStyle(i)}function q1(i){return dl(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function xh(i){if(Nm(i)==="html")return i;const o=i.assignedSlot||i.parentNode||fR(i)&&i.host||ec(i);return fR(o)?o.host:o}function hj(i){const o=xh(i);return Cm(o)?i.ownerDocument?i.ownerDocument.body:i.body:Kl(o)&&Ry(o)?o:hj(o)}function fy(i,o,u){var m;o===void 0&&(o=[]),u===void 0&&(u=!0);const w=hj(i),E=w===((m=i.ownerDocument)==null?void 0:m.body),P=pa(w);if(E){const s=ZS(P);return o.concat(P,P.visualViewport||[],Ry(w)?w:[],s&&u?fy(s):[])}return o.concat(w,fy(w,[],u))}function ZS(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function dj(i){const o=pl(i);let u=parseFloat(o.width)||0,m=parseFloat(o.height)||0;const w=Kl(i),E=w?i.offsetWidth:u,P=w?i.offsetHeight:m,s=r1(u)!==E||r1(m)!==P;return s&&(u=E,m=P),{width:u,height:m,$:s}}function EE(i){return dl(i)?i:i.contextElement}function im(i){const o=EE(i);if(!Kl(o))return _h(1);const u=o.getBoundingClientRect(),{width:m,height:w,$:E}=dj(o);let P=(E?r1(u.width):u.width)/m,s=(E?r1(u.height):u.height)/w;return(!P||!Number.isFinite(P))&&(P=1),(!s||!Number.isFinite(s))&&(s=1),{x:P,y:s}}const UU=_h(0);function pj(i){const o=pa(i);return!TE()||!o.visualViewport?UU:{x:o.visualViewport.offsetLeft,y:o.visualViewport.offsetTop}}function GU(i,o,u){return o===void 0&&(o=!1),!u||o&&u!==pa(i)?!1:o}function ip(i,o,u,m){o===void 0&&(o=!1),u===void 0&&(u=!1);const w=i.getBoundingClientRect(),E=EE(i);let P=_h(1);o&&(m?dl(m)&&(P=im(m)):P=im(i));const s=GU(E,u,m)?pj(E):_h(0);let D=(w.left+s.x)/P.x,O=(w.top+s.y)/P.y,H=w.width/P.x,G=w.height/P.y;if(E){const U=pa(E),he=m&&dl(m)?pa(m):m;let de=U,Y=ZS(de);for(;Y&&m&&he!==de;){const le=im(Y),re=Y.getBoundingClientRect(),oe=pl(Y),_e=re.left+(Y.clientLeft+parseFloat(oe.paddingLeft))*le.x,Ne=re.top+(Y.clientTop+parseFloat(oe.paddingTop))*le.y;D*=le.x,O*=le.y,H*=le.x,G*=le.y,D+=_e,O+=Ne,de=pa(Y),Y=ZS(de)}}return s1({width:H,height:G,x:D,y:O})}function $U(i){let{elements:o,rect:u,offsetParent:m,strategy:w}=i;const E=w==="fixed",P=ec(m),s=o?$1(o.floating):!1;if(m===P||s&&E)return u;let D={scrollLeft:0,scrollTop:0},O=_h(1);const H=_h(0),G=Kl(m);if((G||!G&&!E)&&((Nm(m)!=="body"||Ry(P))&&(D=q1(m)),Kl(m))){const U=ip(m);O=im(m),H.x=U.x+m.clientLeft,H.y=U.y+m.clientTop}return{width:u.width*O.x,height:u.height*O.y,x:u.x*O.x-D.scrollLeft*O.x+H.x,y:u.y*O.y-D.scrollTop*O.y+H.y}}function qU(i){return Array.from(i.getClientRects())}function XS(i,o){const u=q1(i).scrollLeft;return o?o.left+u:ip(ec(i)).left+u}function HU(i){const o=ec(i),u=q1(i),m=i.ownerDocument.body,w=ua(o.scrollWidth,o.clientWidth,m.scrollWidth,m.clientWidth),E=ua(o.scrollHeight,o.clientHeight,m.scrollHeight,m.clientHeight);let P=-u.scrollLeft+XS(i);const s=-u.scrollTop;return pl(m).direction==="rtl"&&(P+=ua(o.clientWidth,m.clientWidth)-w),{width:w,height:E,x:P,y:s}}function WU(i,o){const u=pa(i),m=ec(i),w=u.visualViewport;let E=m.clientWidth,P=m.clientHeight,s=0,D=0;if(w){E=w.width,P=w.height;const O=TE();(!O||O&&o==="fixed")&&(s=w.offsetLeft,D=w.offsetTop)}return{width:E,height:P,x:s,y:D}}function ZU(i,o){const u=ip(i,!0,o==="fixed"),m=u.top+i.clientTop,w=u.left+i.clientLeft,E=Kl(i)?im(i):_h(1),P=i.clientWidth*E.x,s=i.clientHeight*E.y,D=w*E.x,O=m*E.y;return{width:P,height:s,x:D,y:O}}function mR(i,o,u){let m;if(o==="viewport")m=WU(i,u);else if(o==="document")m=HU(ec(i));else if(dl(o))m=ZU(o,u);else{const w=pj(i);m={...o,x:o.x-w.x,y:o.y-w.y}}return s1(m)}function fj(i,o){const u=xh(i);return u===o||!dl(u)||Cm(u)?!1:pl(u).position==="fixed"||fj(u,o)}function XU(i,o){const u=o.get(i);if(u)return u;let m=fy(i,[],!1).filter(s=>dl(s)&&Nm(s)!=="body"),w=null;const E=pl(i).position==="fixed";let P=E?xh(i):i;for(;dl(P)&&!Cm(P);){const s=pl(P),D=SE(P);!D&&s.position==="fixed"&&(w=null),(E?!D&&!w:!D&&s.position==="static"&&!!w&&["absolute","fixed"].includes(w.position)||Ry(P)&&!D&&fj(i,P))?m=m.filter(H=>H!==P):w=s,P=xh(P)}return o.set(i,m),m}function YU(i){let{element:o,boundary:u,rootBoundary:m,strategy:w}=i;const P=[...u==="clippingAncestors"?$1(o)?[]:XU(o,this._c):[].concat(u),m],s=P[0],D=P.reduce((O,H)=>{const G=mR(o,H,w);return O.top=ua(G.top,O.top),O.right=gh(G.right,O.right),O.bottom=gh(G.bottom,O.bottom),O.left=ua(G.left,O.left),O},mR(o,s,w));return{width:D.right-D.left,height:D.bottom-D.top,x:D.left,y:D.top}}function KU(i){const{width:o,height:u}=dj(i);return{width:o,height:u}}function QU(i,o,u){const m=Kl(o),w=ec(o),E=u==="fixed",P=ip(i,!0,E,o);let s={scrollLeft:0,scrollTop:0};const D=_h(0);if(m||!m&&!E)if((Nm(o)!=="body"||Ry(w))&&(s=q1(o)),m){const he=ip(o,!0,E,o);D.x=he.x+o.clientLeft,D.y=he.y+o.clientTop}else w&&(D.x=XS(w));let O=0,H=0;if(w&&!m&&!E){const he=w.getBoundingClientRect();H=he.top+s.scrollTop,O=he.left+s.scrollLeft-XS(w,he)}const G=P.left+s.scrollLeft-D.x-O,U=P.top+s.scrollTop-D.y-H;return{x:G,y:U,width:P.width,height:P.height}}function D2(i){return pl(i).position==="static"}function gR(i,o){if(!Kl(i)||pl(i).position==="fixed")return null;if(o)return o(i);let u=i.offsetParent;return ec(i)===u&&(u=u.ownerDocument.body),u}function mj(i,o){const u=pa(i);if($1(i))return u;if(!Kl(i)){let w=xh(i);for(;w&&!Cm(w);){if(dl(w)&&!D2(w))return w;w=xh(w)}return u}let m=gR(i,o);for(;m&&BU(m)&&D2(m);)m=gR(m,o);return m&&Cm(m)&&D2(m)&&!SE(m)?u:m||VU(i)||u}const JU=async function(i){const o=this.getOffsetParent||mj,u=this.getDimensions,m=await u(i.floating);return{reference:QU(i.reference,await o(i.floating),i.strategy),floating:{x:0,y:0,width:m.width,height:m.height}}};function e8(i){return pl(i).direction==="rtl"}const t8={convertOffsetParentRelativeRectToViewportRelativeRect:$U,getDocumentElement:ec,getClippingRect:YU,getOffsetParent:mj,getElementRects:JU,getClientRects:qU,getDimensions:KU,getScale:im,isElement:dl,isRTL:e8};function i8(i,o){let u=null,m;const w=ec(i);function E(){var s;clearTimeout(m),(s=u)==null||s.disconnect(),u=null}function P(s,D){s===void 0&&(s=!1),D===void 0&&(D=1),E();const{left:O,top:H,width:G,height:U}=i.getBoundingClientRect();if(s||o(),!G||!U)return;const he=K0(H),de=K0(w.clientWidth-(O+G)),Y=K0(w.clientHeight-(H+U)),le=K0(O),oe={rootMargin:-he+"px "+-de+"px "+-Y+"px "+-le+"px",threshold:ua(0,gh(1,D))||1};let _e=!0;function Ne(Ge){const pt=Ge[0].intersectionRatio;if(pt!==D){if(!_e)return P();pt?P(!1,pt):m=setTimeout(()=>{P(!1,1e-7)},1e3)}_e=!1}try{u=new IntersectionObserver(Ne,{...oe,root:w.ownerDocument})}catch{u=new IntersectionObserver(Ne,oe)}u.observe(i)}return P(!0),E}function r8(i,o,u,m){m===void 0&&(m={});const{ancestorScroll:w=!0,ancestorResize:E=!0,elementResize:P=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:D=!1}=m,O=EE(i),H=w||E?[...O?fy(O):[],...fy(o)]:[];H.forEach(re=>{w&&re.addEventListener("scroll",u,{passive:!0}),E&&re.addEventListener("resize",u)});const G=O&&s?i8(O,u):null;let U=-1,he=null;P&&(he=new ResizeObserver(re=>{let[oe]=re;oe&&oe.target===O&&he&&(he.unobserve(o),cancelAnimationFrame(U),U=requestAnimationFrame(()=>{var _e;(_e=he)==null||_e.observe(o)})),u()}),O&&!D&&he.observe(O),he.observe(o));let de,Y=D?ip(i):null;D&&le();function le(){const re=ip(i);Y&&(re.x!==Y.x||re.y!==Y.y||re.width!==Y.width||re.height!==Y.height)&&u(),Y=re,de=requestAnimationFrame(le)}return u(),()=>{var re;H.forEach(oe=>{w&&oe.removeEventListener("scroll",u),E&&oe.removeEventListener("resize",u)}),G==null||G(),(re=he)==null||re.disconnect(),he=null,D&&cancelAnimationFrame(de)}}const n8=zU,s8=LU,o8=DU,a8=OU,l8=NU,_R=kU,c8=FU,u8=(i,o,u)=>{const m=new Map,w={platform:t8,...u},E={...w.platform,_c:m};return RU(i,o,{...w,platform:E})};var yv=typeof document<"u"?W.useLayoutEffect:W.useEffect;function o1(i,o){if(i===o)return!0;if(typeof i!=typeof o)return!1;if(typeof i=="function"&&i.toString()===o.toString())return!0;let u,m,w;if(i&&o&&typeof i=="object"){if(Array.isArray(i)){if(u=i.length,u!==o.length)return!1;for(m=u;m--!==0;)if(!o1(i[m],o[m]))return!1;return!0}if(w=Object.keys(i),u=w.length,u!==Object.keys(o).length)return!1;for(m=u;m--!==0;)if(!{}.hasOwnProperty.call(o,w[m]))return!1;for(m=u;m--!==0;){const E=w[m];if(!(E==="_owner"&&i.$$typeof)&&!o1(i[E],o[E]))return!1}return!0}return i!==i&&o!==o}function gj(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function yR(i,o){const u=gj(i);return Math.round(o*u)/u}function N2(i){const o=W.useRef(i);return yv(()=>{o.current=i}),o}function h8(i){i===void 0&&(i={});const{placement:o="bottom",strategy:u="absolute",middleware:m=[],platform:w,elements:{reference:E,floating:P}={},transform:s=!0,whileElementsMounted:D,open:O}=i,[H,G]=W.useState({x:0,y:0,strategy:u,placement:o,middlewareData:{},isPositioned:!1}),[U,he]=W.useState(m);o1(U,m)||he(m);const[de,Y]=W.useState(null),[le,re]=W.useState(null),oe=W.useCallback(ct=>{ct!==pt.current&&(pt.current=ct,Y(ct))},[]),_e=W.useCallback(ct=>{ct!==ot.current&&(ot.current=ct,re(ct))},[]),Ne=E||de,Ge=P||le,pt=W.useRef(null),ot=W.useRef(null),dt=W.useRef(H),Bt=D!=null,Wt=N2(D),Ht=N2(w),ei=N2(O),xi=W.useCallback(()=>{if(!pt.current||!ot.current)return;const ct={placement:o,strategy:u,middleware:U};Ht.current&&(ct.platform=Ht.current),u8(pt.current,ot.current,ct).then(Vt=>{const Gt={...Vt,isPositioned:ei.current!==!1};It.current&&!o1(dt.current,Gt)&&(dt.current=Gt,cp.flushSync(()=>{G(Gt)}))})},[U,o,u,Ht,ei]);yv(()=>{O===!1&&dt.current.isPositioned&&(dt.current.isPositioned=!1,G(ct=>({...ct,isPositioned:!1})))},[O]);const It=W.useRef(!1);yv(()=>(It.current=!0,()=>{It.current=!1}),[]),yv(()=>{if(Ne&&(pt.current=Ne),Ge&&(ot.current=Ge),Ne&&Ge){if(Wt.current)return Wt.current(Ne,Ge,xi);xi()}},[Ne,Ge,xi,Wt,Bt]);const ui=W.useMemo(()=>({reference:pt,floating:ot,setReference:oe,setFloating:_e}),[oe,_e]),Zt=W.useMemo(()=>({reference:Ne,floating:Ge}),[Ne,Ge]),Ni=W.useMemo(()=>{const ct={position:u,left:0,top:0};if(!Zt.floating)return ct;const Vt=yR(Zt.floating,H.x),Gt=yR(Zt.floating,H.y);return s?{...ct,transform:"translate("+Vt+"px, "+Gt+"px)",...gj(Zt.floating)>=1.5&&{willChange:"transform"}}:{position:u,left:Vt,top:Gt}},[u,s,Zt.floating,H.x,H.y]);return W.useMemo(()=>({...H,update:xi,refs:ui,elements:Zt,floatingStyles:Ni}),[H,xi,ui,Zt,Ni])}const d8=i=>{function o(u){return{}.hasOwnProperty.call(u,"current")}return{name:"arrow",options:i,fn(u){const{element:m,padding:w}=typeof i=="function"?i(u):i;return m&&o(m)?m.current!=null?_R({element:m.current,padding:w}).fn(u):{}:m?_R({element:m,padding:w}).fn(u):{}}}},p8=(i,o)=>({...n8(i),options:[i,o]}),f8=(i,o)=>({...s8(i),options:[i,o]}),m8=(i,o)=>({...c8(i),options:[i,o]}),g8=(i,o)=>({...o8(i),options:[i,o]}),_8=(i,o)=>({...a8(i),options:[i,o]}),y8=(i,o)=>({...l8(i),options:[i,o]}),x8=(i,o)=>({...d8(i),options:[i,o]});var v8="Arrow",_j=W.forwardRef((i,o)=>{const{children:u,width:m=10,height:w=5,...E}=i;return _.jsx(jr.svg,{...E,ref:o,width:m,height:w,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?u:_.jsx("polygon",{points:"0,0 30,0 15,10"})})});_j.displayName=v8;var w8=_j;function b8(i,o=[]){let u=[];function m(E,P){const s=W.createContext(P),D=u.length;u=[...u,P];function O(G){const{scope:U,children:he,...de}=G,Y=(U==null?void 0:U[i][D])||s,le=W.useMemo(()=>de,Object.values(de));return _.jsx(Y.Provider,{value:le,children:he})}function H(G,U){const he=(U==null?void 0:U[i][D])||s,de=W.useContext(he);if(de)return de;if(P!==void 0)return P;throw new Error(`\`${G}\` must be used within \`${E}\``)}return O.displayName=E+"Provider",[O,H]}const w=()=>{const E=u.map(P=>W.createContext(P));return function(s){const D=(s==null?void 0:s[i])||E;return W.useMemo(()=>({[`__scope${i}`]:{...s,[i]:D}}),[s,D])}};return w.scopeName=i,[m,S8(w,...o)]}function S8(...i){const o=i[0];if(i.length===1)return o;const u=()=>{const m=i.map(w=>({useScope:w(),scopeName:w.scopeName}));return function(E){const P=m.reduce((s,{useScope:D,scopeName:O})=>{const G=D(E)[`__scope${O}`];return{...s,...G}},{});return W.useMemo(()=>({[`__scope${o.scopeName}`]:P}),[P])}};return u.scopeName=o.scopeName,u}function yj(i){const[o,u]=W.useState(void 0);return co(()=>{if(i){u({width:i.offsetWidth,height:i.offsetHeight});const m=new ResizeObserver(w=>{if(!Array.isArray(w)||!w.length)return;const E=w[0];let P,s;if("borderBoxSize"in E){const D=E.borderBoxSize,O=Array.isArray(D)?D[0]:D;P=O.inlineSize,s=O.blockSize}else P=i.offsetWidth,s=i.offsetHeight;u({width:P,height:s})});return m.observe(i,{box:"border-box"}),()=>m.unobserve(i)}else u(void 0)},[i]),o}var CE="Popper",[xj,H1]=b8(CE),[T8,vj]=xj(CE),wj=i=>{const{__scopePopper:o,children:u}=i,[m,w]=W.useState(null);return _.jsx(T8,{scope:o,anchor:m,onAnchorChange:w,children:u})};wj.displayName=CE;var bj="PopperAnchor",Sj=W.forwardRef((i,o)=>{const{__scopePopper:u,virtualRef:m,...w}=i,E=vj(bj,u),P=W.useRef(null),s=kn(o,P);return W.useEffect(()=>{E.onAnchorChange((m==null?void 0:m.current)||P.current)}),m?null:_.jsx(jr.div,{...w,ref:s})});Sj.displayName=bj;var IE="PopperContent",[E8,C8]=xj(IE),Tj=W.forwardRef((i,o)=>{var hi,_i,ji,Er,wr,nr;const{__scopePopper:u,side:m="bottom",sideOffset:w=0,align:E="center",alignOffset:P=0,arrowPadding:s=0,avoidCollisions:D=!0,collisionBoundary:O=[],collisionPadding:H=0,sticky:G="partial",hideWhenDetached:U=!1,updatePositionStrategy:he="optimized",onPlaced:de,...Y}=i,le=vj(IE,u),[re,oe]=W.useState(null),_e=kn(o,dr=>oe(dr)),[Ne,Ge]=W.useState(null),pt=yj(Ne),ot=(pt==null?void 0:pt.width)??0,dt=(pt==null?void 0:pt.height)??0,Bt=m+(E!=="center"?"-"+E:""),Wt=typeof H=="number"?H:{top:0,right:0,bottom:0,left:0,...H},Ht=Array.isArray(O)?O:[O],ei=Ht.length>0,xi={padding:Wt,boundary:Ht.filter(A8),altBoundary:ei},{refs:It,floatingStyles:ui,placement:Zt,isPositioned:Ni,middlewareData:ct}=h8({strategy:"fixed",placement:Bt,whileElementsMounted:(...dr)=>r8(...dr,{animationFrame:he==="always"}),elements:{reference:le.anchor},middleware:[p8({mainAxis:w+dt,alignmentAxis:P}),D&&f8({mainAxis:!0,crossAxis:!1,limiter:G==="partial"?m8():void 0,...xi}),D&&g8({...xi}),_8({...xi,apply:({elements:dr,rects:Ln,availableWidth:ns,availableHeight:pn})=>{const{width:ys,height:Eo}=Ln.reference,Ur=dr.floating.style;Ur.setProperty("--radix-popper-available-width",`${ns}px`),Ur.setProperty("--radix-popper-available-height",`${pn}px`),Ur.setProperty("--radix-popper-anchor-width",`${ys}px`),Ur.setProperty("--radix-popper-anchor-height",`${Eo}px`)}}),Ne&&x8({element:Ne,padding:s}),P8({arrowWidth:ot,arrowHeight:dt}),U&&y8({strategy:"referenceHidden",...xi})]}),[Vt,Gt]=Ij(Zt),ti=Ho(de);co(()=>{Ni&&(ti==null||ti())},[Ni,ti]);const vi=(hi=ct.arrow)==null?void 0:hi.x,Ki=(_i=ct.arrow)==null?void 0:_i.y,Zi=((ji=ct.arrow)==null?void 0:ji.centerOffset)!==0,[Hi,Ii]=W.useState();return co(()=>{re&&Ii(window.getComputedStyle(re).zIndex)},[re]),_.jsx("div",{ref:It.setFloating,"data-radix-popper-content-wrapper":"",style:{...ui,transform:Ni?ui.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Hi,"--radix-popper-transform-origin":[(Er=ct.transformOrigin)==null?void 0:Er.x,(wr=ct.transformOrigin)==null?void 0:wr.y].join(" "),...((nr=ct.hide)==null?void 0:nr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:_.jsx(E8,{scope:u,placedSide:Vt,onArrowChange:Ge,arrowX:vi,arrowY:Ki,shouldHideArrow:Zi,children:_.jsx(jr.div,{"data-side":Vt,"data-align":Gt,...Y,ref:_e,style:{...Y.style,animation:Ni?void 0:"none"}})})})});Tj.displayName=IE;var Ej="PopperArrow",I8={top:"bottom",right:"left",bottom:"top",left:"right"},Cj=W.forwardRef(function(o,u){const{__scopePopper:m,...w}=o,E=C8(Ej,m),P=I8[E.placedSide];return _.jsx("span",{ref:E.onArrowChange,style:{position:"absolute",left:E.arrowX,top:E.arrowY,[P]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[E.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[E.placedSide],visibility:E.shouldHideArrow?"hidden":void 0},children:_.jsx(w8,{...w,ref:u,style:{...w.style,display:"block"}})})});Cj.displayName=Ej;function A8(i){return i!==null}var P8=i=>({name:"transformOrigin",options:i,fn(o){var le,re,oe;const{placement:u,rects:m,middlewareData:w}=o,P=((le=w.arrow)==null?void 0:le.centerOffset)!==0,s=P?0:i.arrowWidth,D=P?0:i.arrowHeight,[O,H]=Ij(u),G={start:"0%",center:"50%",end:"100%"}[H],U=(((re=w.arrow)==null?void 0:re.x)??0)+s/2,he=(((oe=w.arrow)==null?void 0:oe.y)??0)+D/2;let de="",Y="";return O==="bottom"?(de=P?G:`${U}px`,Y=`${-D}px`):O==="top"?(de=P?G:`${U}px`,Y=`${m.floating.height+D}px`):O==="right"?(de=`${-D}px`,Y=P?G:`${he}px`):O==="left"&&(de=`${m.floating.width+D}px`,Y=P?G:`${he}px`),{data:{x:de,y:Y}}}});function Ij(i){const[o,u="center"]=i.split("-");return[o,u]}var M8=wj,Aj=Sj,Pj=Tj,Mj=Cj,[W1,VH]=Rm("Tooltip",[H1]),AE=H1(),Rj="TooltipProvider",R8=700,xR="tooltip.open",[k8,kj]=W1(Rj),Dj=i=>{const{__scopeTooltip:o,delayDuration:u=R8,skipDelayDuration:m=300,disableHoverableContent:w=!1,children:E}=i,[P,s]=W.useState(!0),D=W.useRef(!1),O=W.useRef(0);return W.useEffect(()=>{const H=O.current;return()=>window.clearTimeout(H)},[]),_.jsx(k8,{scope:o,isOpenDelayed:P,delayDuration:u,onOpen:W.useCallback(()=>{window.clearTimeout(O.current),s(!1)},[]),onClose:W.useCallback(()=>{window.clearTimeout(O.current),O.current=window.setTimeout(()=>s(!0),m)},[m]),isPointerInTransitRef:D,onPointerInTransitChange:W.useCallback(H=>{D.current=H},[]),disableHoverableContent:w,children:E})};Dj.displayName=Rj;var Nj="Tooltip",[UH,Z1]=W1(Nj),YS="TooltipTrigger",D8=W.forwardRef((i,o)=>{const{__scopeTooltip:u,...m}=i,w=Z1(YS,u),E=kj(YS,u),P=AE(u),s=W.useRef(null),D=kn(o,s,w.onTriggerChange),O=W.useRef(!1),H=W.useRef(!1),G=W.useCallback(()=>O.current=!1,[]);return W.useEffect(()=>()=>document.removeEventListener("pointerup",G),[G]),_.jsx(Aj,{asChild:!0,...P,children:_.jsx(jr.button,{"aria-describedby":w.open?w.contentId:void 0,"data-state":w.stateAttribute,...m,ref:D,onPointerMove:ir(i.onPointerMove,U=>{U.pointerType!=="touch"&&!H.current&&!E.isPointerInTransitRef.current&&(w.onTriggerEnter(),H.current=!0)}),onPointerLeave:ir(i.onPointerLeave,()=>{w.onTriggerLeave(),H.current=!1}),onPointerDown:ir(i.onPointerDown,()=>{O.current=!0,document.addEventListener("pointerup",G,{once:!0})}),onFocus:ir(i.onFocus,()=>{O.current||w.onOpen()}),onBlur:ir(i.onBlur,w.onClose),onClick:ir(i.onClick,w.onClose)})})});D8.displayName=YS;var N8="TooltipPortal",[GH,j8]=W1(N8,{forceMount:void 0}),Im="TooltipContent",jj=W.forwardRef((i,o)=>{const u=j8(Im,i.__scopeTooltip),{forceMount:m=u.forceMount,side:w="top",...E}=i,P=Z1(Im,i.__scopeTooltip);return _.jsx(up,{present:m||P.open,children:P.disableHoverableContent?_.jsx(zj,{side:w,...E,ref:o}):_.jsx(z8,{side:w,...E,ref:o})})}),z8=W.forwardRef((i,o)=>{const u=Z1(Im,i.__scopeTooltip),m=kj(Im,i.__scopeTooltip),w=W.useRef(null),E=kn(o,w),[P,s]=W.useState(null),{trigger:D,onClose:O}=u,H=w.current,{onPointerInTransitChange:G}=m,U=W.useCallback(()=>{s(null),G(!1)},[G]),he=W.useCallback((de,Y)=>{const le=de.currentTarget,re={x:de.clientX,y:de.clientY},oe=B8(re,le.getBoundingClientRect()),_e=V8(re,oe),Ne=U8(Y.getBoundingClientRect()),Ge=$8([..._e,...Ne]);s(Ge),G(!0)},[G]);return W.useEffect(()=>()=>U(),[U]),W.useEffect(()=>{if(D&&H){const de=le=>he(le,H),Y=le=>he(le,D);return D.addEventListener("pointerleave",de),H.addEventListener("pointerleave",Y),()=>{D.removeEventListener("pointerleave",de),H.removeEventListener("pointerleave",Y)}}},[D,H,he,U]),W.useEffect(()=>{if(P){const de=Y=>{const le=Y.target,re={x:Y.clientX,y:Y.clientY},oe=(D==null?void 0:D.contains(le))||(H==null?void 0:H.contains(le)),_e=!G8(re,P);oe?U():_e&&(U(),O())};return document.addEventListener("pointermove",de),()=>document.removeEventListener("pointermove",de)}},[D,H,P,O,U]),_.jsx(zj,{...i,ref:E})}),[L8,F8]=W1(Nj,{isInside:!1}),zj=W.forwardRef((i,o)=>{const{__scopeTooltip:u,children:m,"aria-label":w,onEscapeKeyDown:E,onPointerDownOutside:P,...s}=i,D=Z1(Im,u),O=AE(u),{onClose:H}=D;return W.useEffect(()=>(document.addEventListener(xR,H),()=>document.removeEventListener(xR,H)),[H]),W.useEffect(()=>{if(D.trigger){const G=U=>{const he=U.target;he!=null&&he.contains(D.trigger)&&H()};return window.addEventListener("scroll",G,{capture:!0}),()=>window.removeEventListener("scroll",G,{capture:!0})}},[D.trigger,H]),_.jsx(Ay,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:E,onPointerDownOutside:P,onFocusOutside:G=>G.preventDefault(),onDismiss:H,children:_.jsxs(Pj,{"data-state":D.stateAttribute,...O,...s,ref:o,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[_.jsx(wN,{children:m}),_.jsx(L8,{scope:u,isInside:!0,children:_.jsx(v6,{id:D.contentId,role:"tooltip",children:w||m})})]})})});jj.displayName=Im;var Lj="TooltipArrow",O8=W.forwardRef((i,o)=>{const{__scopeTooltip:u,...m}=i,w=AE(u);return F8(Lj,u).isInside?null:_.jsx(Mj,{...w,...m,ref:o})});O8.displayName=Lj;function B8(i,o){const u=Math.abs(o.top-i.y),m=Math.abs(o.bottom-i.y),w=Math.abs(o.right-i.x),E=Math.abs(o.left-i.x);switch(Math.min(u,m,w,E)){case E:return"left";case w:return"right";case u:return"top";case m:return"bottom";default:throw new Error("unreachable")}}function V8(i,o,u=5){const m=[];switch(o){case"top":m.push({x:i.x-u,y:i.y+u},{x:i.x+u,y:i.y+u});break;case"bottom":m.push({x:i.x-u,y:i.y-u},{x:i.x+u,y:i.y-u});break;case"left":m.push({x:i.x+u,y:i.y-u},{x:i.x+u,y:i.y+u});break;case"right":m.push({x:i.x-u,y:i.y-u},{x:i.x-u,y:i.y+u});break}return m}function U8(i){const{top:o,right:u,bottom:m,left:w}=i;return[{x:w,y:o},{x:u,y:o},{x:u,y:m},{x:w,y:m}]}function G8(i,o){const{x:u,y:m}=i;let w=!1;for(let E=0,P=o.length-1;E<o.length;P=E++){const s=o[E].x,D=o[E].y,O=o[P].x,H=o[P].y;D>m!=H>m&&u<(O-s)*(m-D)/(H-D)+s&&(w=!w)}return w}function $8(i){const o=i.slice();return o.sort((u,m)=>u.x<m.x?-1:u.x>m.x?1:u.y<m.y?-1:u.y>m.y?1:0),q8(o)}function q8(i){if(i.length<=1)return i.slice();const o=[];for(let m=0;m<i.length;m++){const w=i[m];for(;o.length>=2;){const E=o[o.length-1],P=o[o.length-2];if((E.x-P.x)*(w.y-P.y)>=(E.y-P.y)*(w.x-P.x))o.pop();else break}o.push(w)}o.pop();const u=[];for(let m=i.length-1;m>=0;m--){const w=i[m];for(;u.length>=2;){const E=u[u.length-1],P=u[u.length-2];if((E.x-P.x)*(w.y-P.y)>=(E.y-P.y)*(w.x-P.x))u.pop();else break}u.push(w)}return u.pop(),o.length===1&&u.length===1&&o[0].x===u[0].x&&o[0].y===u[0].y?o:o.concat(u)}var H8=Dj,Fj=jj;const W8=H8,Z8=W.forwardRef(({className:i,sideOffset:o=4,...u},m)=>_.jsx(Fj,{ref:m,sideOffset:o,className:Zr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...u}));Z8.displayName=Fj.displayName;var jm=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},rp=typeof window>"u"||"Deno"in globalThis;function Ma(){}function X8(i,o){return typeof i=="function"?i(o):i}function KS(i){return typeof i=="number"&&i>=0&&i!==1/0}function Oj(i,o){return Math.max(i+(o||0)-Date.now(),0)}function rm(i,o){return typeof i=="function"?i(o):i}function ll(i,o){return typeof i=="function"?i(o):i}function vR(i,o){const{type:u="all",exact:m,fetchStatus:w,predicate:E,queryKey:P,stale:s}=i;if(P){if(m){if(o.queryHash!==PE(P,o.options))return!1}else if(!my(o.queryKey,P))return!1}if(u!=="all"){const D=o.isActive();if(u==="active"&&!D||u==="inactive"&&D)return!1}return!(typeof s=="boolean"&&o.isStale()!==s||w&&w!==o.state.fetchStatus||E&&!E(o))}function wR(i,o){const{exact:u,status:m,predicate:w,mutationKey:E}=i;if(E){if(!o.options.mutationKey)return!1;if(u){if(np(o.options.mutationKey)!==np(E))return!1}else if(!my(o.options.mutationKey,E))return!1}return!(m&&o.state.status!==m||w&&!w(o))}function PE(i,o){return((o==null?void 0:o.queryKeyHashFn)||np)(i)}function np(i){return JSON.stringify(i,(o,u)=>QS(u)?Object.keys(u).sort().reduce((m,w)=>(m[w]=u[w],m),{}):u)}function my(i,o){return i===o?!0:typeof i!=typeof o?!1:i&&o&&typeof i=="object"&&typeof o=="object"?!Object.keys(o).some(u=>!my(i[u],o[u])):!1}function Bj(i,o){if(i===o)return i;const u=bR(i)&&bR(o);if(u||QS(i)&&QS(o)){const m=u?i:Object.keys(i),w=m.length,E=u?o:Object.keys(o),P=E.length,s=u?[]:{};let D=0;for(let O=0;O<P;O++){const H=u?O:E[O];(!u&&m.includes(H)||u)&&i[H]===void 0&&o[H]===void 0?(s[H]=void 0,D++):(s[H]=Bj(i[H],o[H]),s[H]===i[H]&&i[H]!==void 0&&D++)}return w===P&&D===w?i:s}return o}function a1(i,o){if(!o||Object.keys(i).length!==Object.keys(o).length)return!1;for(const u in i)if(i[u]!==o[u])return!1;return!0}function bR(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function QS(i){if(!SR(i))return!1;const o=i.constructor;if(o===void 0)return!0;const u=o.prototype;return!(!SR(u)||!u.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function SR(i){return Object.prototype.toString.call(i)==="[object Object]"}function Y8(i){return new Promise(o=>{setTimeout(o,i)})}function JS(i,o,u){return typeof u.structuralSharing=="function"?u.structuralSharing(i,o):u.structuralSharing!==!1?Bj(i,o):o}function K8(i,o,u=0){const m=[...i,o];return u&&m.length>u?m.slice(1):m}function Q8(i,o,u=0){const m=[o,...i];return u&&m.length>u?m.slice(0,-1):m}var ME=Symbol();function Vj(i,o){return!i.queryFn&&(o!=null&&o.initialPromise)?()=>o.initialPromise:!i.queryFn||i.queryFn===ME?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}var Fd,Hu,om,XR,J8=(XR=class extends jm{constructor(){super();tr(this,Fd);tr(this,Hu);tr(this,om);Ci(this,om,o=>{if(!rp&&window.addEventListener){const u=()=>o();return window.addEventListener("visibilitychange",u,!1),()=>{window.removeEventListener("visibilitychange",u)}}})}onSubscribe(){Xe(this,Hu)||this.setEventListener(Xe(this,om))}onUnsubscribe(){var o;this.hasListeners()||((o=Xe(this,Hu))==null||o.call(this),Ci(this,Hu,void 0))}setEventListener(o){var u;Ci(this,om,o),(u=Xe(this,Hu))==null||u.call(this),Ci(this,Hu,o(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()}))}setFocused(o){Xe(this,Fd)!==o&&(Ci(this,Fd,o),this.onFocus())}onFocus(){const o=this.isFocused();this.listeners.forEach(u=>{u(o)})}isFocused(){var o;return typeof Xe(this,Fd)=="boolean"?Xe(this,Fd):((o=globalThis.document)==null?void 0:o.visibilityState)!=="hidden"}},Fd=new WeakMap,Hu=new WeakMap,om=new WeakMap,XR),RE=new J8,am,Wu,lm,YR,eG=(YR=class extends jm{constructor(){super();tr(this,am,!0);tr(this,Wu);tr(this,lm);Ci(this,lm,o=>{if(!rp&&window.addEventListener){const u=()=>o(!0),m=()=>o(!1);return window.addEventListener("online",u,!1),window.addEventListener("offline",m,!1),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",m)}}})}onSubscribe(){Xe(this,Wu)||this.setEventListener(Xe(this,lm))}onUnsubscribe(){var o;this.hasListeners()||((o=Xe(this,Wu))==null||o.call(this),Ci(this,Wu,void 0))}setEventListener(o){var u;Ci(this,lm,o),(u=Xe(this,Wu))==null||u.call(this),Ci(this,Wu,o(this.setOnline.bind(this)))}setOnline(o){Xe(this,am)!==o&&(Ci(this,am,o),this.listeners.forEach(m=>{m(o)}))}isOnline(){return Xe(this,am)}},am=new WeakMap,Wu=new WeakMap,lm=new WeakMap,YR),l1=new eG;function eT(){let i,o;const u=new Promise((w,E)=>{i=w,o=E});u.status="pending",u.catch(()=>{});function m(w){Object.assign(u,w),delete u.resolve,delete u.reject}return u.resolve=w=>{m({status:"fulfilled",value:w}),i(w)},u.reject=w=>{m({status:"rejected",reason:w}),o(w)},u}function tG(i){return Math.min(1e3*2**i,3e4)}function Uj(i){return(i??"online")==="online"?l1.isOnline():!0}var Gj=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function j2(i){return i instanceof Gj}function $j(i){let o=!1,u=0,m=!1,w;const E=eT(),P=Y=>{var le;m||(U(new Gj(Y)),(le=i.abort)==null||le.call(i))},s=()=>{o=!0},D=()=>{o=!1},O=()=>RE.isFocused()&&(i.networkMode==="always"||l1.isOnline())&&i.canRun(),H=()=>Uj(i.networkMode)&&i.canRun(),G=Y=>{var le;m||(m=!0,(le=i.onSuccess)==null||le.call(i,Y),w==null||w(),E.resolve(Y))},U=Y=>{var le;m||(m=!0,(le=i.onError)==null||le.call(i,Y),w==null||w(),E.reject(Y))},he=()=>new Promise(Y=>{var le;w=re=>{(m||O())&&Y(re)},(le=i.onPause)==null||le.call(i)}).then(()=>{var Y;w=void 0,m||(Y=i.onContinue)==null||Y.call(i)}),de=()=>{if(m)return;let Y;const le=u===0?i.initialPromise:void 0;try{Y=le??i.fn()}catch(re){Y=Promise.reject(re)}Promise.resolve(Y).then(G).catch(re=>{var pt;if(m)return;const oe=i.retry??(rp?0:3),_e=i.retryDelay??tG,Ne=typeof _e=="function"?_e(u,re):_e,Ge=oe===!0||typeof oe=="number"&&u<oe||typeof oe=="function"&&oe(u,re);if(o||!Ge){U(re);return}u++,(pt=i.onFail)==null||pt.call(i,u,re),Y8(Ne).then(()=>O()?void 0:he()).then(()=>{o?U(re):de()})})};return{promise:E,cancel:P,continue:()=>(w==null||w(),E),cancelRetry:s,continueRetry:D,canStart:H,start:()=>(H()?de():he().then(de),E)}}function iG(){let i=[],o=0,u=s=>{s()},m=s=>{s()},w=s=>setTimeout(s,0);const E=s=>{o?i.push(s):w(()=>{u(s)})},P=()=>{const s=i;i=[],s.length&&w(()=>{m(()=>{s.forEach(D=>{u(D)})})})};return{batch:s=>{let D;o++;try{D=s()}finally{o--,o||P()}return D},batchCalls:s=>(...D)=>{E(()=>{s(...D)})},schedule:E,setNotifyFunction:s=>{u=s},setBatchNotifyFunction:s=>{m=s},setScheduler:s=>{w=s}}}var Cs=iG(),Od,KR,qj=(KR=class{constructor(){tr(this,Od)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),KS(this.gcTime)&&Ci(this,Od,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(rp?1/0:5*60*1e3))}clearGcTimeout(){Xe(this,Od)&&(clearTimeout(Xe(this,Od)),Ci(this,Od,void 0))}},Od=new WeakMap,KR),cm,um,Pa,so,yy,Bd,sl,Mc,QR,rG=(QR=class extends qj{constructor(o){super();tr(this,sl);tr(this,cm);tr(this,um);tr(this,Pa);tr(this,so);tr(this,yy);tr(this,Bd);Ci(this,Bd,!1),Ci(this,yy,o.defaultOptions),this.setOptions(o.options),this.observers=[],Ci(this,Pa,o.cache),this.queryKey=o.queryKey,this.queryHash=o.queryHash,Ci(this,cm,nG(this.options)),this.state=o.state??Xe(this,cm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var o;return(o=Xe(this,so))==null?void 0:o.promise}setOptions(o){this.options={...Xe(this,yy),...o},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Xe(this,Pa).remove(this)}setData(o,u){const m=JS(this.state.data,o,this.options);return Vr(this,sl,Mc).call(this,{data:m,type:"success",dataUpdatedAt:u==null?void 0:u.updatedAt,manual:u==null?void 0:u.manual}),m}setState(o,u){Vr(this,sl,Mc).call(this,{type:"setState",state:o,setStateOptions:u})}cancel(o){var m,w;const u=(m=Xe(this,so))==null?void 0:m.promise;return(w=Xe(this,so))==null||w.cancel(o),u?u.then(Ma).catch(Ma):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Xe(this,cm))}isActive(){return this.observers.some(o=>ll(o.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ME||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(o=>o.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(o=0){return this.state.isInvalidated||this.state.data===void 0||!Oj(this.state.dataUpdatedAt,o)}onFocus(){var u;const o=this.observers.find(m=>m.shouldFetchOnWindowFocus());o==null||o.refetch({cancelRefetch:!1}),(u=Xe(this,so))==null||u.continue()}onOnline(){var u;const o=this.observers.find(m=>m.shouldFetchOnReconnect());o==null||o.refetch({cancelRefetch:!1}),(u=Xe(this,so))==null||u.continue()}addObserver(o){this.observers.includes(o)||(this.observers.push(o),this.clearGcTimeout(),Xe(this,Pa).notify({type:"observerAdded",query:this,observer:o}))}removeObserver(o){this.observers.includes(o)&&(this.observers=this.observers.filter(u=>u!==o),this.observers.length||(Xe(this,so)&&(Xe(this,Bd)?Xe(this,so).cancel({revert:!0}):Xe(this,so).cancelRetry()),this.scheduleGc()),Xe(this,Pa).notify({type:"observerRemoved",query:this,observer:o}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Vr(this,sl,Mc).call(this,{type:"invalidate"})}fetch(o,u){var D,O,H;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(u!=null&&u.cancelRefetch))this.cancel({silent:!0});else if(Xe(this,so))return Xe(this,so).continueRetry(),Xe(this,so).promise}if(o&&this.setOptions(o),!this.options.queryFn){const G=this.observers.find(U=>U.options.queryFn);G&&this.setOptions(G.options)}const m=new AbortController,w=G=>{Object.defineProperty(G,"signal",{enumerable:!0,get:()=>(Ci(this,Bd,!0),m.signal)})},E=()=>{const G=Vj(this.options,u),U={queryKey:this.queryKey,meta:this.meta};return w(U),Ci(this,Bd,!1),this.options.persister?this.options.persister(G,U,this):G(U)},P={fetchOptions:u,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:E};w(P),(D=this.options.behavior)==null||D.onFetch(P,this),Ci(this,um,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((O=P.fetchOptions)==null?void 0:O.meta))&&Vr(this,sl,Mc).call(this,{type:"fetch",meta:(H=P.fetchOptions)==null?void 0:H.meta});const s=G=>{var U,he,de,Y;j2(G)&&G.silent||Vr(this,sl,Mc).call(this,{type:"error",error:G}),j2(G)||((he=(U=Xe(this,Pa).config).onError)==null||he.call(U,G,this),(Y=(de=Xe(this,Pa).config).onSettled)==null||Y.call(de,this.state.data,G,this)),this.scheduleGc()};return Ci(this,so,$j({initialPromise:u==null?void 0:u.initialPromise,fn:P.fetchFn,abort:m.abort.bind(m),onSuccess:G=>{var U,he,de,Y;if(G===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(G)}catch(le){s(le);return}(he=(U=Xe(this,Pa).config).onSuccess)==null||he.call(U,G,this),(Y=(de=Xe(this,Pa).config).onSettled)==null||Y.call(de,G,this.state.error,this),this.scheduleGc()},onError:s,onFail:(G,U)=>{Vr(this,sl,Mc).call(this,{type:"failed",failureCount:G,error:U})},onPause:()=>{Vr(this,sl,Mc).call(this,{type:"pause"})},onContinue:()=>{Vr(this,sl,Mc).call(this,{type:"continue"})},retry:P.options.retry,retryDelay:P.options.retryDelay,networkMode:P.options.networkMode,canRun:()=>!0})),Xe(this,so).start()}},cm=new WeakMap,um=new WeakMap,Pa=new WeakMap,so=new WeakMap,yy=new WeakMap,Bd=new WeakMap,sl=new WeakSet,Mc=function(o){const u=m=>{switch(o.type){case"failed":return{...m,fetchFailureCount:o.failureCount,fetchFailureReason:o.error};case"pause":return{...m,fetchStatus:"paused"};case"continue":return{...m,fetchStatus:"fetching"};case"fetch":return{...m,...Hj(m.data,this.options),fetchMeta:o.meta??null};case"success":return{...m,data:o.data,dataUpdateCount:m.dataUpdateCount+1,dataUpdatedAt:o.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!o.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const w=o.error;return j2(w)&&w.revert&&Xe(this,um)?{...Xe(this,um),fetchStatus:"idle"}:{...m,error:w,errorUpdateCount:m.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:m.fetchFailureCount+1,fetchFailureReason:w,fetchStatus:"idle",status:"error"};case"invalidate":return{...m,isInvalidated:!0};case"setState":return{...m,...o.state}}};this.state=u(this.state),Cs.batch(()=>{this.observers.forEach(m=>{m.onQueryUpdate()}),Xe(this,Pa).notify({query:this,type:"updated",action:o})})},QR);function Hj(i,o){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Uj(o.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function nG(i){const o=typeof i.initialData=="function"?i.initialData():i.initialData,u=o!==void 0,m=u?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:o,dataUpdateCount:0,dataUpdatedAt:u?m??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:u?"success":"pending",fetchStatus:"idle"}}var Ul,JR,sG=(JR=class extends jm{constructor(o={}){super();tr(this,Ul);this.config=o,Ci(this,Ul,new Map)}build(o,u,m){const w=u.queryKey,E=u.queryHash??PE(w,u);let P=this.get(E);return P||(P=new rG({cache:this,queryKey:w,queryHash:E,options:o.defaultQueryOptions(u),state:m,defaultOptions:o.getQueryDefaults(w)}),this.add(P)),P}add(o){Xe(this,Ul).has(o.queryHash)||(Xe(this,Ul).set(o.queryHash,o),this.notify({type:"added",query:o}))}remove(o){const u=Xe(this,Ul).get(o.queryHash);u&&(o.destroy(),u===o&&Xe(this,Ul).delete(o.queryHash),this.notify({type:"removed",query:o}))}clear(){Cs.batch(()=>{this.getAll().forEach(o=>{this.remove(o)})})}get(o){return Xe(this,Ul).get(o)}getAll(){return[...Xe(this,Ul).values()]}find(o){const u={exact:!0,...o};return this.getAll().find(m=>vR(u,m))}findAll(o={}){const u=this.getAll();return Object.keys(o).length>0?u.filter(m=>vR(o,m)):u}notify(o){Cs.batch(()=>{this.listeners.forEach(u=>{u(o)})})}onFocus(){Cs.batch(()=>{this.getAll().forEach(o=>{o.onFocus()})})}onOnline(){Cs.batch(()=>{this.getAll().forEach(o=>{o.onOnline()})})}},Ul=new WeakMap,JR),Gl,xo,Vd,$l,Bu,ek,oG=(ek=class extends qj{constructor(o){super();tr(this,$l);tr(this,Gl);tr(this,xo);tr(this,Vd);this.mutationId=o.mutationId,Ci(this,xo,o.mutationCache),Ci(this,Gl,[]),this.state=o.state||Wj(),this.setOptions(o.options),this.scheduleGc()}setOptions(o){this.options=o,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(o){Xe(this,Gl).includes(o)||(Xe(this,Gl).push(o),this.clearGcTimeout(),Xe(this,xo).notify({type:"observerAdded",mutation:this,observer:o}))}removeObserver(o){Ci(this,Gl,Xe(this,Gl).filter(u=>u!==o)),this.scheduleGc(),Xe(this,xo).notify({type:"observerRemoved",mutation:this,observer:o})}optionalRemove(){Xe(this,Gl).length||(this.state.status==="pending"?this.scheduleGc():Xe(this,xo).remove(this))}continue(){var o;return((o=Xe(this,Vd))==null?void 0:o.continue())??this.execute(this.state.variables)}async execute(o){var w,E,P,s,D,O,H,G,U,he,de,Y,le,re,oe,_e,Ne,Ge,pt,ot;Ci(this,Vd,$j({fn:()=>this.options.mutationFn?this.options.mutationFn(o):Promise.reject(new Error("No mutationFn found")),onFail:(dt,Bt)=>{Vr(this,$l,Bu).call(this,{type:"failed",failureCount:dt,error:Bt})},onPause:()=>{Vr(this,$l,Bu).call(this,{type:"pause"})},onContinue:()=>{Vr(this,$l,Bu).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Xe(this,xo).canRun(this)}));const u=this.state.status==="pending",m=!Xe(this,Vd).canStart();try{if(!u){Vr(this,$l,Bu).call(this,{type:"pending",variables:o,isPaused:m}),await((E=(w=Xe(this,xo).config).onMutate)==null?void 0:E.call(w,o,this));const Bt=await((s=(P=this.options).onMutate)==null?void 0:s.call(P,o));Bt!==this.state.context&&Vr(this,$l,Bu).call(this,{type:"pending",context:Bt,variables:o,isPaused:m})}const dt=await Xe(this,Vd).start();return await((O=(D=Xe(this,xo).config).onSuccess)==null?void 0:O.call(D,dt,o,this.state.context,this)),await((G=(H=this.options).onSuccess)==null?void 0:G.call(H,dt,o,this.state.context)),await((he=(U=Xe(this,xo).config).onSettled)==null?void 0:he.call(U,dt,null,this.state.variables,this.state.context,this)),await((Y=(de=this.options).onSettled)==null?void 0:Y.call(de,dt,null,o,this.state.context)),Vr(this,$l,Bu).call(this,{type:"success",data:dt}),dt}catch(dt){try{throw await((re=(le=Xe(this,xo).config).onError)==null?void 0:re.call(le,dt,o,this.state.context,this)),await((_e=(oe=this.options).onError)==null?void 0:_e.call(oe,dt,o,this.state.context)),await((Ge=(Ne=Xe(this,xo).config).onSettled)==null?void 0:Ge.call(Ne,void 0,dt,this.state.variables,this.state.context,this)),await((ot=(pt=this.options).onSettled)==null?void 0:ot.call(pt,void 0,dt,o,this.state.context)),dt}finally{Vr(this,$l,Bu).call(this,{type:"error",error:dt})}}finally{Xe(this,xo).runNext(this)}}},Gl=new WeakMap,xo=new WeakMap,Vd=new WeakMap,$l=new WeakSet,Bu=function(o){const u=m=>{switch(o.type){case"failed":return{...m,failureCount:o.failureCount,failureReason:o.error};case"pause":return{...m,isPaused:!0};case"continue":return{...m,isPaused:!1};case"pending":return{...m,context:o.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:o.isPaused,status:"pending",variables:o.variables,submittedAt:Date.now()};case"success":return{...m,data:o.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...m,data:void 0,error:o.error,failureCount:m.failureCount+1,failureReason:o.error,isPaused:!1,status:"error"}}};this.state=u(this.state),Cs.batch(()=>{Xe(this,Gl).forEach(m=>{m.onMutationUpdate(o)}),Xe(this,xo).notify({mutation:this,type:"updated",action:o})})},ek);function Wj(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var aa,xy,tk,aG=(tk=class extends jm{constructor(o={}){super();tr(this,aa);tr(this,xy);this.config=o,Ci(this,aa,new Map),Ci(this,xy,Date.now())}build(o,u,m){const w=new oG({mutationCache:this,mutationId:++M0(this,xy)._,options:o.defaultMutationOptions(u),state:m});return this.add(w),w}add(o){const u=Q0(o),m=Xe(this,aa).get(u)??[];m.push(o),Xe(this,aa).set(u,m),this.notify({type:"added",mutation:o})}remove(o){var m;const u=Q0(o);if(Xe(this,aa).has(u)){const w=(m=Xe(this,aa).get(u))==null?void 0:m.filter(E=>E!==o);w&&(w.length===0?Xe(this,aa).delete(u):Xe(this,aa).set(u,w))}this.notify({type:"removed",mutation:o})}canRun(o){var m;const u=(m=Xe(this,aa).get(Q0(o)))==null?void 0:m.find(w=>w.state.status==="pending");return!u||u===o}runNext(o){var m;const u=(m=Xe(this,aa).get(Q0(o)))==null?void 0:m.find(w=>w!==o&&w.state.isPaused);return(u==null?void 0:u.continue())??Promise.resolve()}clear(){Cs.batch(()=>{this.getAll().forEach(o=>{this.remove(o)})})}getAll(){return[...Xe(this,aa).values()].flat()}find(o){const u={exact:!0,...o};return this.getAll().find(m=>wR(u,m))}findAll(o={}){return this.getAll().filter(u=>wR(o,u))}notify(o){Cs.batch(()=>{this.listeners.forEach(u=>{u(o)})})}resumePausedMutations(){const o=this.getAll().filter(u=>u.state.isPaused);return Cs.batch(()=>Promise.all(o.map(u=>u.continue().catch(Ma))))}},aa=new WeakMap,xy=new WeakMap,tk);function Q0(i){var o;return((o=i.options.scope)==null?void 0:o.id)??String(i.mutationId)}function TR(i){return{onFetch:(o,u)=>{var H,G,U,he,de;const m=o.options,w=(U=(G=(H=o.fetchOptions)==null?void 0:H.meta)==null?void 0:G.fetchMore)==null?void 0:U.direction,E=((he=o.state.data)==null?void 0:he.pages)||[],P=((de=o.state.data)==null?void 0:de.pageParams)||[];let s={pages:[],pageParams:[]},D=0;const O=async()=>{let Y=!1;const le=_e=>{Object.defineProperty(_e,"signal",{enumerable:!0,get:()=>(o.signal.aborted?Y=!0:o.signal.addEventListener("abort",()=>{Y=!0}),o.signal)})},re=Vj(o.options,o.fetchOptions),oe=async(_e,Ne,Ge)=>{if(Y)return Promise.reject();if(Ne==null&&_e.pages.length)return Promise.resolve(_e);const pt={queryKey:o.queryKey,pageParam:Ne,direction:Ge?"backward":"forward",meta:o.options.meta};le(pt);const ot=await re(pt),{maxPages:dt}=o.options,Bt=Ge?Q8:K8;return{pages:Bt(_e.pages,ot,dt),pageParams:Bt(_e.pageParams,Ne,dt)}};if(w&&E.length){const _e=w==="backward",Ne=_e?lG:ER,Ge={pages:E,pageParams:P},pt=Ne(m,Ge);s=await oe(Ge,pt,_e)}else{const _e=i??E.length;do{const Ne=D===0?P[0]??m.initialPageParam:ER(m,s);if(D>0&&Ne==null)break;s=await oe(s,Ne),D++}while(D<_e)}return s};o.options.persister?o.fetchFn=()=>{var Y,le;return(le=(Y=o.options).persister)==null?void 0:le.call(Y,O,{queryKey:o.queryKey,meta:o.options.meta,signal:o.signal},u)}:o.fetchFn=O}}}function ER(i,{pages:o,pageParams:u}){const m=o.length-1;return o.length>0?i.getNextPageParam(o[m],o,u[m],u):void 0}function lG(i,{pages:o,pageParams:u}){var m;return o.length>0?(m=i.getPreviousPageParam)==null?void 0:m.call(i,o[0],o,u[0],u):void 0}var is,Zu,Xu,hm,dm,Yu,pm,fm,ik,cG=(ik=class{constructor(i={}){tr(this,is);tr(this,Zu);tr(this,Xu);tr(this,hm);tr(this,dm);tr(this,Yu);tr(this,pm);tr(this,fm);Ci(this,is,i.queryCache||new sG),Ci(this,Zu,i.mutationCache||new aG),Ci(this,Xu,i.defaultOptions||{}),Ci(this,hm,new Map),Ci(this,dm,new Map),Ci(this,Yu,0)}mount(){M0(this,Yu)._++,Xe(this,Yu)===1&&(Ci(this,pm,RE.subscribe(async i=>{i&&(await this.resumePausedMutations(),Xe(this,is).onFocus())})),Ci(this,fm,l1.subscribe(async i=>{i&&(await this.resumePausedMutations(),Xe(this,is).onOnline())})))}unmount(){var i,o;M0(this,Yu)._--,Xe(this,Yu)===0&&((i=Xe(this,pm))==null||i.call(this),Ci(this,pm,void 0),(o=Xe(this,fm))==null||o.call(this),Ci(this,fm,void 0))}isFetching(i){return Xe(this,is).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return Xe(this,Zu).findAll({...i,status:"pending"}).length}getQueryData(i){var u;const o=this.defaultQueryOptions({queryKey:i});return(u=Xe(this,is).get(o.queryHash))==null?void 0:u.state.data}ensureQueryData(i){const o=this.getQueryData(i.queryKey);if(o===void 0)return this.fetchQuery(i);{const u=this.defaultQueryOptions(i),m=Xe(this,is).build(this,u);return i.revalidateIfStale&&m.isStaleByTime(rm(u.staleTime,m))&&this.prefetchQuery(u),Promise.resolve(o)}}getQueriesData(i){return Xe(this,is).findAll(i).map(({queryKey:o,state:u})=>{const m=u.data;return[o,m]})}setQueryData(i,o,u){const m=this.defaultQueryOptions({queryKey:i}),w=Xe(this,is).get(m.queryHash),E=w==null?void 0:w.state.data,P=X8(o,E);if(P!==void 0)return Xe(this,is).build(this,m).setData(P,{...u,manual:!0})}setQueriesData(i,o,u){return Cs.batch(()=>Xe(this,is).findAll(i).map(({queryKey:m})=>[m,this.setQueryData(m,o,u)]))}getQueryState(i){var u;const o=this.defaultQueryOptions({queryKey:i});return(u=Xe(this,is).get(o.queryHash))==null?void 0:u.state}removeQueries(i){const o=Xe(this,is);Cs.batch(()=>{o.findAll(i).forEach(u=>{o.remove(u)})})}resetQueries(i,o){const u=Xe(this,is),m={type:"active",...i};return Cs.batch(()=>(u.findAll(i).forEach(w=>{w.reset()}),this.refetchQueries(m,o)))}cancelQueries(i={},o={}){const u={revert:!0,...o},m=Cs.batch(()=>Xe(this,is).findAll(i).map(w=>w.cancel(u)));return Promise.all(m).then(Ma).catch(Ma)}invalidateQueries(i={},o={}){return Cs.batch(()=>{if(Xe(this,is).findAll(i).forEach(m=>{m.invalidate()}),i.refetchType==="none")return Promise.resolve();const u={...i,type:i.refetchType??i.type??"active"};return this.refetchQueries(u,o)})}refetchQueries(i={},o){const u={...o,cancelRefetch:(o==null?void 0:o.cancelRefetch)??!0},m=Cs.batch(()=>Xe(this,is).findAll(i).filter(w=>!w.isDisabled()).map(w=>{let E=w.fetch(void 0,u);return u.throwOnError||(E=E.catch(Ma)),w.state.fetchStatus==="paused"?Promise.resolve():E}));return Promise.all(m).then(Ma)}fetchQuery(i){const o=this.defaultQueryOptions(i);o.retry===void 0&&(o.retry=!1);const u=Xe(this,is).build(this,o);return u.isStaleByTime(rm(o.staleTime,u))?u.fetch(o):Promise.resolve(u.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(Ma).catch(Ma)}fetchInfiniteQuery(i){return i.behavior=TR(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(Ma).catch(Ma)}ensureInfiniteQueryData(i){return i.behavior=TR(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return l1.isOnline()?Xe(this,Zu).resumePausedMutations():Promise.resolve()}getQueryCache(){return Xe(this,is)}getMutationCache(){return Xe(this,Zu)}getDefaultOptions(){return Xe(this,Xu)}setDefaultOptions(i){Ci(this,Xu,i)}setQueryDefaults(i,o){Xe(this,hm).set(np(i),{queryKey:i,defaultOptions:o})}getQueryDefaults(i){const o=[...Xe(this,hm).values()];let u={};return o.forEach(m=>{my(i,m.queryKey)&&(u={...u,...m.defaultOptions})}),u}setMutationDefaults(i,o){Xe(this,dm).set(np(i),{mutationKey:i,defaultOptions:o})}getMutationDefaults(i){const o=[...Xe(this,dm).values()];let u={};return o.forEach(m=>{my(i,m.mutationKey)&&(u={...u,...m.defaultOptions})}),u}defaultQueryOptions(i){if(i._defaulted)return i;const o={...Xe(this,Xu).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return o.queryHash||(o.queryHash=PE(o.queryKey,o)),o.refetchOnReconnect===void 0&&(o.refetchOnReconnect=o.networkMode!=="always"),o.throwOnError===void 0&&(o.throwOnError=!!o.suspense),!o.networkMode&&o.persister&&(o.networkMode="offlineFirst"),o.enabled!==!0&&o.queryFn===ME&&(o.enabled=!1),o}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...Xe(this,Xu).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){Xe(this,is).clear(),Xe(this,Zu).clear()}},is=new WeakMap,Zu=new WeakMap,Xu=new WeakMap,hm=new WeakMap,dm=new WeakMap,Yu=new WeakMap,pm=new WeakMap,fm=new WeakMap,ik),Oo,cn,vy,vo,Ud,mm,Ku,ql,wy,gm,_m,Gd,$d,Qu,ym,wn,L_,tT,iT,rT,nT,sT,oT,aT,Zj,rk,uG=(rk=class extends jm{constructor(o,u){super();tr(this,wn);tr(this,Oo);tr(this,cn);tr(this,vy);tr(this,vo);tr(this,Ud);tr(this,mm);tr(this,Ku);tr(this,ql);tr(this,wy);tr(this,gm);tr(this,_m);tr(this,Gd);tr(this,$d);tr(this,Qu);tr(this,ym,new Set);this.options=u,Ci(this,Oo,o),Ci(this,ql,null),Ci(this,Ku,eT()),this.options.experimental_prefetchInRender||Xe(this,Ku).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(u)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Xe(this,cn).addObserver(this),CR(Xe(this,cn),this.options)?Vr(this,wn,L_).call(this):this.updateResult(),Vr(this,wn,nT).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return lT(Xe(this,cn),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return lT(Xe(this,cn),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Vr(this,wn,sT).call(this),Vr(this,wn,oT).call(this),Xe(this,cn).removeObserver(this)}setOptions(o,u){const m=this.options,w=Xe(this,cn);if(this.options=Xe(this,Oo).defaultQueryOptions(o),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ll(this.options.enabled,Xe(this,cn))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Vr(this,wn,aT).call(this),Xe(this,cn).setOptions(this.options),m._defaulted&&!a1(this.options,m)&&Xe(this,Oo).getQueryCache().notify({type:"observerOptionsUpdated",query:Xe(this,cn),observer:this});const E=this.hasListeners();E&&IR(Xe(this,cn),w,this.options,m)&&Vr(this,wn,L_).call(this),this.updateResult(u),E&&(Xe(this,cn)!==w||ll(this.options.enabled,Xe(this,cn))!==ll(m.enabled,Xe(this,cn))||rm(this.options.staleTime,Xe(this,cn))!==rm(m.staleTime,Xe(this,cn)))&&Vr(this,wn,tT).call(this);const P=Vr(this,wn,iT).call(this);E&&(Xe(this,cn)!==w||ll(this.options.enabled,Xe(this,cn))!==ll(m.enabled,Xe(this,cn))||P!==Xe(this,Qu))&&Vr(this,wn,rT).call(this,P)}getOptimisticResult(o){const u=Xe(this,Oo).getQueryCache().build(Xe(this,Oo),o),m=this.createResult(u,o);return dG(this,m)&&(Ci(this,vo,m),Ci(this,mm,this.options),Ci(this,Ud,Xe(this,cn).state)),m}getCurrentResult(){return Xe(this,vo)}trackResult(o,u){const m={};return Object.keys(o).forEach(w=>{Object.defineProperty(m,w,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(w),u==null||u(w),o[w])})}),m}trackProp(o){Xe(this,ym).add(o)}getCurrentQuery(){return Xe(this,cn)}refetch({...o}={}){return this.fetch({...o})}fetchOptimistic(o){const u=Xe(this,Oo).defaultQueryOptions(o),m=Xe(this,Oo).getQueryCache().build(Xe(this,Oo),u);return m.fetch().then(()=>this.createResult(m,u))}fetch(o){return Vr(this,wn,L_).call(this,{...o,cancelRefetch:o.cancelRefetch??!0}).then(()=>(this.updateResult(),Xe(this,vo)))}createResult(o,u){var dt;const m=Xe(this,cn),w=this.options,E=Xe(this,vo),P=Xe(this,Ud),s=Xe(this,mm),O=o!==m?o.state:Xe(this,vy),{state:H}=o;let G={...H},U=!1,he;if(u._optimisticResults){const Bt=this.hasListeners(),Wt=!Bt&&CR(o,u),Ht=Bt&&IR(o,m,u,w);(Wt||Ht)&&(G={...G,...Hj(H.data,o.options)}),u._optimisticResults==="isRestoring"&&(G.fetchStatus="idle")}let{error:de,errorUpdatedAt:Y,status:le}=G;if(u.select&&G.data!==void 0)if(E&&G.data===(P==null?void 0:P.data)&&u.select===Xe(this,wy))he=Xe(this,gm);else try{Ci(this,wy,u.select),he=u.select(G.data),he=JS(E==null?void 0:E.data,he,u),Ci(this,gm,he),Ci(this,ql,null)}catch(Bt){Ci(this,ql,Bt)}else he=G.data;if(u.placeholderData!==void 0&&he===void 0&&le==="pending"){let Bt;if(E!=null&&E.isPlaceholderData&&u.placeholderData===(s==null?void 0:s.placeholderData))Bt=E.data;else if(Bt=typeof u.placeholderData=="function"?u.placeholderData((dt=Xe(this,_m))==null?void 0:dt.state.data,Xe(this,_m)):u.placeholderData,u.select&&Bt!==void 0)try{Bt=u.select(Bt),Ci(this,ql,null)}catch(Wt){Ci(this,ql,Wt)}Bt!==void 0&&(le="success",he=JS(E==null?void 0:E.data,Bt,u),U=!0)}Xe(this,ql)&&(de=Xe(this,ql),he=Xe(this,gm),Y=Date.now(),le="error");const re=G.fetchStatus==="fetching",oe=le==="pending",_e=le==="error",Ne=oe&&re,Ge=he!==void 0,ot={status:le,fetchStatus:G.fetchStatus,isPending:oe,isSuccess:le==="success",isError:_e,isInitialLoading:Ne,isLoading:Ne,data:he,dataUpdatedAt:G.dataUpdatedAt,error:de,errorUpdatedAt:Y,failureCount:G.fetchFailureCount,failureReason:G.fetchFailureReason,errorUpdateCount:G.errorUpdateCount,isFetched:G.dataUpdateCount>0||G.errorUpdateCount>0,isFetchedAfterMount:G.dataUpdateCount>O.dataUpdateCount||G.errorUpdateCount>O.errorUpdateCount,isFetching:re,isRefetching:re&&!oe,isLoadingError:_e&&!Ge,isPaused:G.fetchStatus==="paused",isPlaceholderData:U,isRefetchError:_e&&Ge,isStale:kE(o,u),refetch:this.refetch,promise:Xe(this,Ku)};if(this.options.experimental_prefetchInRender){const Bt=ei=>{ot.status==="error"?ei.reject(ot.error):ot.data!==void 0&&ei.resolve(ot.data)},Wt=()=>{const ei=Ci(this,Ku,ot.promise=eT());Bt(ei)},Ht=Xe(this,Ku);switch(Ht.status){case"pending":o.queryHash===m.queryHash&&Bt(Ht);break;case"fulfilled":(ot.status==="error"||ot.data!==Ht.value)&&Wt();break;case"rejected":(ot.status!=="error"||ot.error!==Ht.reason)&&Wt();break}}return ot}updateResult(o){const u=Xe(this,vo),m=this.createResult(Xe(this,cn),this.options);if(Ci(this,Ud,Xe(this,cn).state),Ci(this,mm,this.options),Xe(this,Ud).data!==void 0&&Ci(this,_m,Xe(this,cn)),a1(m,u))return;Ci(this,vo,m);const w={},E=()=>{if(!u)return!0;const{notifyOnChangeProps:P}=this.options,s=typeof P=="function"?P():P;if(s==="all"||!s&&!Xe(this,ym).size)return!0;const D=new Set(s??Xe(this,ym));return this.options.throwOnError&&D.add("error"),Object.keys(Xe(this,vo)).some(O=>{const H=O;return Xe(this,vo)[H]!==u[H]&&D.has(H)})};(o==null?void 0:o.listeners)!==!1&&E()&&(w.listeners=!0),Vr(this,wn,Zj).call(this,{...w,...o})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Vr(this,wn,nT).call(this)}},Oo=new WeakMap,cn=new WeakMap,vy=new WeakMap,vo=new WeakMap,Ud=new WeakMap,mm=new WeakMap,Ku=new WeakMap,ql=new WeakMap,wy=new WeakMap,gm=new WeakMap,_m=new WeakMap,Gd=new WeakMap,$d=new WeakMap,Qu=new WeakMap,ym=new WeakMap,wn=new WeakSet,L_=function(o){Vr(this,wn,aT).call(this);let u=Xe(this,cn).fetch(this.options,o);return o!=null&&o.throwOnError||(u=u.catch(Ma)),u},tT=function(){Vr(this,wn,sT).call(this);const o=rm(this.options.staleTime,Xe(this,cn));if(rp||Xe(this,vo).isStale||!KS(o))return;const m=Oj(Xe(this,vo).dataUpdatedAt,o)+1;Ci(this,Gd,setTimeout(()=>{Xe(this,vo).isStale||this.updateResult()},m))},iT=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Xe(this,cn)):this.options.refetchInterval)??!1},rT=function(o){Vr(this,wn,oT).call(this),Ci(this,Qu,o),!(rp||ll(this.options.enabled,Xe(this,cn))===!1||!KS(Xe(this,Qu))||Xe(this,Qu)===0)&&Ci(this,$d,setInterval(()=>{(this.options.refetchIntervalInBackground||RE.isFocused())&&Vr(this,wn,L_).call(this)},Xe(this,Qu)))},nT=function(){Vr(this,wn,tT).call(this),Vr(this,wn,rT).call(this,Vr(this,wn,iT).call(this))},sT=function(){Xe(this,Gd)&&(clearTimeout(Xe(this,Gd)),Ci(this,Gd,void 0))},oT=function(){Xe(this,$d)&&(clearInterval(Xe(this,$d)),Ci(this,$d,void 0))},aT=function(){const o=Xe(this,Oo).getQueryCache().build(Xe(this,Oo),this.options);if(o===Xe(this,cn))return;const u=Xe(this,cn);Ci(this,cn,o),Ci(this,vy,o.state),this.hasListeners()&&(u==null||u.removeObserver(this),o.addObserver(this))},Zj=function(o){Cs.batch(()=>{o.listeners&&this.listeners.forEach(u=>{u(Xe(this,vo))}),Xe(this,Oo).getQueryCache().notify({query:Xe(this,cn),type:"observerResultsUpdated"})})},rk);function hG(i,o){return ll(o.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&o.retryOnMount===!1)}function CR(i,o){return hG(i,o)||i.state.data!==void 0&&lT(i,o,o.refetchOnMount)}function lT(i,o,u){if(ll(o.enabled,i)!==!1){const m=typeof u=="function"?u(i):u;return m==="always"||m!==!1&&kE(i,o)}return!1}function IR(i,o,u,m){return(i!==o||ll(m.enabled,i)===!1)&&(!u.suspense||i.state.status!=="error")&&kE(i,u)}function kE(i,o){return ll(o.enabled,i)!==!1&&i.isStaleByTime(rm(o.staleTime,i))}function dG(i,o){return!a1(i.getCurrentResult(),o)}var Ju,eh,Bo,Dc,Lc,xv,cT,nk,pG=(nk=class extends jm{constructor(u,m){super();tr(this,Lc);tr(this,Ju);tr(this,eh);tr(this,Bo);tr(this,Dc);Ci(this,Ju,u),this.setOptions(m),this.bindMethods(),Vr(this,Lc,xv).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(u){var w;const m=this.options;this.options=Xe(this,Ju).defaultMutationOptions(u),a1(this.options,m)||Xe(this,Ju).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Xe(this,Bo),observer:this}),m!=null&&m.mutationKey&&this.options.mutationKey&&np(m.mutationKey)!==np(this.options.mutationKey)?this.reset():((w=Xe(this,Bo))==null?void 0:w.state.status)==="pending"&&Xe(this,Bo).setOptions(this.options)}onUnsubscribe(){var u;this.hasListeners()||(u=Xe(this,Bo))==null||u.removeObserver(this)}onMutationUpdate(u){Vr(this,Lc,xv).call(this),Vr(this,Lc,cT).call(this,u)}getCurrentResult(){return Xe(this,eh)}reset(){var u;(u=Xe(this,Bo))==null||u.removeObserver(this),Ci(this,Bo,void 0),Vr(this,Lc,xv).call(this),Vr(this,Lc,cT).call(this)}mutate(u,m){var w;return Ci(this,Dc,m),(w=Xe(this,Bo))==null||w.removeObserver(this),Ci(this,Bo,Xe(this,Ju).getMutationCache().build(Xe(this,Ju),this.options)),Xe(this,Bo).addObserver(this),Xe(this,Bo).execute(u)}},Ju=new WeakMap,eh=new WeakMap,Bo=new WeakMap,Dc=new WeakMap,Lc=new WeakSet,xv=function(){var m;const u=((m=Xe(this,Bo))==null?void 0:m.state)??Wj();Ci(this,eh,{...u,isPending:u.status==="pending",isSuccess:u.status==="success",isError:u.status==="error",isIdle:u.status==="idle",mutate:this.mutate,reset:this.reset})},cT=function(u){Cs.batch(()=>{var m,w,E,P,s,D,O,H;if(Xe(this,Dc)&&this.hasListeners()){const G=Xe(this,eh).variables,U=Xe(this,eh).context;(u==null?void 0:u.type)==="success"?((w=(m=Xe(this,Dc)).onSuccess)==null||w.call(m,u.data,G,U),(P=(E=Xe(this,Dc)).onSettled)==null||P.call(E,u.data,null,G,U)):(u==null?void 0:u.type)==="error"&&((D=(s=Xe(this,Dc)).onError)==null||D.call(s,u.error,G,U),(H=(O=Xe(this,Dc)).onSettled)==null||H.call(O,void 0,u.error,G,U))}this.listeners.forEach(G=>{G(Xe(this,eh))})})},nk),Xj=W.createContext(void 0),DE=i=>{const o=W.useContext(Xj);if(!o)throw new Error("No QueryClient set, use QueryClientProvider to set one");return o},fG=({client:i,children:o})=>(W.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),_.jsx(Xj.Provider,{value:i,children:o})),Yj=W.createContext(!1),mG=()=>W.useContext(Yj);Yj.Provider;function gG(){let i=!1;return{clearReset:()=>{i=!1},reset:()=>{i=!0},isReset:()=>i}}var _G=W.createContext(gG()),yG=()=>W.useContext(_G);function Kj(i,o){return typeof i=="function"?i(...o):!!i}function Qj(){}var xG=(i,o)=>{(i.suspense||i.throwOnError)&&(o.isReset()||(i.retryOnMount=!1))},vG=i=>{W.useEffect(()=>{i.clearReset()},[i])},wG=({result:i,errorResetBoundary:o,throwOnError:u,query:m})=>i.isError&&!o.isReset()&&!i.isFetching&&m&&Kj(u,[i.error,m]),bG=i=>{i.suspense&&(i.staleTime===void 0&&(i.staleTime=1e3),typeof i.gcTime=="number"&&(i.gcTime=Math.max(i.gcTime,1e3)))},SG=(i,o)=>i.isLoading&&i.isFetching&&!o,TG=(i,o)=>(i==null?void 0:i.suspense)&&o.isPending,AR=(i,o,u)=>o.fetchOptimistic(i).catch(()=>{u.clearReset()});function EG(i,o,u){var H,G,U,he,de;const m=DE(),w=mG(),E=yG(),P=m.defaultQueryOptions(i);(G=(H=m.getDefaultOptions().queries)==null?void 0:H._experimental_beforeQuery)==null||G.call(H,P),P._optimisticResults=w?"isRestoring":"optimistic",bG(P),xG(P,E),vG(E);const s=!m.getQueryCache().get(P.queryHash),[D]=W.useState(()=>new o(m,P)),O=D.getOptimisticResult(P);if(W.useSyncExternalStore(W.useCallback(Y=>{const le=w?()=>{}:D.subscribe(Cs.batchCalls(Y));return D.updateResult(),le},[D,w]),()=>D.getCurrentResult(),()=>D.getCurrentResult()),W.useEffect(()=>{D.setOptions(P,{listeners:!1})},[P,D]),TG(P,O))throw AR(P,D,E);if(wG({result:O,errorResetBoundary:E,throwOnError:P.throwOnError,query:m.getQueryCache().get(P.queryHash)}))throw O.error;if((he=(U=m.getDefaultOptions().queries)==null?void 0:U._experimental_afterQuery)==null||he.call(U,P,O),P.experimental_prefetchInRender&&!rp&&SG(O,w)){const Y=s?AR(P,D,E):(de=m.getQueryCache().get(P.queryHash))==null?void 0:de.promise;Y==null||Y.catch(Qj).finally(()=>{D.updateResult()})}return P.notifyOnChangeProps?O:D.trackResult(O)}function il(i,o){return EG(i,uG)}function Mn(i,o){const u=DE(),[m]=W.useState(()=>new pG(u,i));W.useEffect(()=>{m.setOptions(i)},[m,i]);const w=W.useSyncExternalStore(W.useCallback(P=>m.subscribe(Cs.batchCalls(P)),[m]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),E=W.useCallback((P,s)=>{m.mutate(P,s).catch(Qj)},[m]);if(w.error&&Kj(m.options.throwOnError,[w.error]))throw w.error;return{...w,mutate:E,mutateAsync:w.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function gy(){return gy=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var m in u)Object.prototype.hasOwnProperty.call(u,m)&&(i[m]=u[m])}return i},gy.apply(this,arguments)}var rh;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(rh||(rh={}));const PR="popstate";function CG(i){i===void 0&&(i={});function o(w,E){let{pathname:P="/",search:s="",hash:D=""}=hp(w.location.hash.substr(1));return!P.startsWith("/")&&!P.startsWith(".")&&(P="/"+P),uT("",{pathname:P,search:s,hash:D},E.state&&E.state.usr||null,E.state&&E.state.key||"default")}function u(w,E){let P=w.document.querySelector("base"),s="";if(P&&P.getAttribute("href")){let D=w.location.href,O=D.indexOf("#");s=O===-1?D:D.slice(0,O)}return s+"#"+(typeof E=="string"?E:c1(E))}function m(w,E){NE(w.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(E)+")")}return AG(o,u,m,i)}function _s(i,o){if(i===!1||i===null||typeof i>"u")throw new Error(o)}function NE(i,o){if(!i){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function IG(){return Math.random().toString(36).substr(2,8)}function MR(i,o){return{usr:i.state,key:i.key,idx:o}}function uT(i,o,u,m){return u===void 0&&(u=null),gy({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof o=="string"?hp(o):o,{state:u,key:o&&o.key||m||IG()})}function c1(i){let{pathname:o="/",search:u="",hash:m=""}=i;return u&&u!=="?"&&(o+=u.charAt(0)==="?"?u:"?"+u),m&&m!=="#"&&(o+=m.charAt(0)==="#"?m:"#"+m),o}function hp(i){let o={};if(i){let u=i.indexOf("#");u>=0&&(o.hash=i.substr(u),i=i.substr(0,u));let m=i.indexOf("?");m>=0&&(o.search=i.substr(m),i=i.substr(0,m)),i&&(o.pathname=i)}return o}function AG(i,o,u,m){m===void 0&&(m={});let{window:w=document.defaultView,v5Compat:E=!1}=m,P=w.history,s=rh.Pop,D=null,O=H();O==null&&(O=0,P.replaceState(gy({},P.state,{idx:O}),""));function H(){return(P.state||{idx:null}).idx}function G(){s=rh.Pop;let le=H(),re=le==null?null:le-O;O=le,D&&D({action:s,location:Y.location,delta:re})}function U(le,re){s=rh.Push;let oe=uT(Y.location,le,re);u&&u(oe,le),O=H()+1;let _e=MR(oe,O),Ne=Y.createHref(oe);try{P.pushState(_e,"",Ne)}catch(Ge){if(Ge instanceof DOMException&&Ge.name==="DataCloneError")throw Ge;w.location.assign(Ne)}E&&D&&D({action:s,location:Y.location,delta:1})}function he(le,re){s=rh.Replace;let oe=uT(Y.location,le,re);u&&u(oe,le),O=H();let _e=MR(oe,O),Ne=Y.createHref(oe);P.replaceState(_e,"",Ne),E&&D&&D({action:s,location:Y.location,delta:0})}function de(le){let re=w.location.origin!=="null"?w.location.origin:w.location.href,oe=typeof le=="string"?le:c1(le);return oe=oe.replace(/ $/,"%20"),_s(re,"No window.location.(origin|href) available to create URL for href: "+oe),new URL(oe,re)}let Y={get action(){return s},get location(){return i(w,P)},listen(le){if(D)throw new Error("A history only accepts one active listener");return w.addEventListener(PR,G),D=le,()=>{w.removeEventListener(PR,G),D=null}},createHref(le){return o(w,le)},createURL:de,encodeLocation(le){let re=de(le);return{pathname:re.pathname,search:re.search,hash:re.hash}},push:U,replace:he,go(le){return P.go(le)}};return Y}var RR;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(RR||(RR={}));function PG(i,o,u){return u===void 0&&(u="/"),MG(i,o,u,!1)}function MG(i,o,u,m){let w=typeof o=="string"?hp(o):o,E=jE(w.pathname||"/",u);if(E==null)return null;let P=Jj(i);RG(P);let s=null;for(let D=0;s==null&&D<P.length;++D){let O=UG(E);s=BG(P[D],O,m)}return s}function Jj(i,o,u,m){o===void 0&&(o=[]),u===void 0&&(u=[]),m===void 0&&(m="");let w=(E,P,s)=>{let D={relativePath:s===void 0?E.path||"":s,caseSensitive:E.caseSensitive===!0,childrenIndex:P,route:E};D.relativePath.startsWith("/")&&(_s(D.relativePath.startsWith(m),'Absolute route path "'+D.relativePath+'" nested under path '+('"'+m+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),D.relativePath=D.relativePath.slice(m.length));let O=ph([m,D.relativePath]),H=u.concat(D);E.children&&E.children.length>0&&(_s(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+O+'".')),Jj(E.children,o,H,O)),!(E.path==null&&!E.index)&&o.push({path:O,score:FG(O,E.index),routesMeta:H})};return i.forEach((E,P)=>{var s;if(E.path===""||!((s=E.path)!=null&&s.includes("?")))w(E,P);else for(let D of ez(E.path))w(E,P,D)}),o}function ez(i){let o=i.split("/");if(o.length===0)return[];let[u,...m]=o,w=u.endsWith("?"),E=u.replace(/\?$/,"");if(m.length===0)return w?[E,""]:[E];let P=ez(m.join("/")),s=[];return s.push(...P.map(D=>D===""?E:[E,D].join("/"))),w&&s.push(...P),s.map(D=>i.startsWith("/")&&D===""?"/":D)}function RG(i){i.sort((o,u)=>o.score!==u.score?u.score-o.score:OG(o.routesMeta.map(m=>m.childrenIndex),u.routesMeta.map(m=>m.childrenIndex)))}const kG=/^:[\w-]+$/,DG=3,NG=2,jG=1,zG=10,LG=-2,kR=i=>i==="*";function FG(i,o){let u=i.split("/"),m=u.length;return u.some(kR)&&(m+=LG),o&&(m+=NG),u.filter(w=>!kR(w)).reduce((w,E)=>w+(kG.test(E)?DG:E===""?jG:zG),m)}function OG(i,o){return i.length===o.length&&i.slice(0,-1).every((m,w)=>m===o[w])?i[i.length-1]-o[o.length-1]:0}function BG(i,o,u){let{routesMeta:m}=i,w={},E="/",P=[];for(let s=0;s<m.length;++s){let D=m[s],O=s===m.length-1,H=E==="/"?o:o.slice(E.length)||"/",G=DR({path:D.relativePath,caseSensitive:D.caseSensitive,end:O},H),U=D.route;if(!G&&O&&u&&!m[m.length-1].route.index&&(G=DR({path:D.relativePath,caseSensitive:D.caseSensitive,end:!1},H)),!G)return null;Object.assign(w,G.params),P.push({params:w,pathname:ph([E,G.pathname]),pathnameBase:HG(ph([E,G.pathnameBase])),route:U}),G.pathnameBase!=="/"&&(E=ph([E,G.pathnameBase]))}return P}function DR(i,o){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[u,m]=VG(i.path,i.caseSensitive,i.end),w=o.match(u);if(!w)return null;let E=w[0],P=E.replace(/(.)\/+$/,"$1"),s=w.slice(1);return{params:m.reduce((O,H,G)=>{let{paramName:U,isOptional:he}=H;if(U==="*"){let Y=s[G]||"";P=E.slice(0,E.length-Y.length).replace(/(.)\/+$/,"$1")}const de=s[G];return he&&!de?O[U]=void 0:O[U]=(de||"").replace(/%2F/g,"/"),O},{}),pathname:E,pathnameBase:P,pattern:i}}function VG(i,o,u){o===void 0&&(o=!1),u===void 0&&(u=!0),NE(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let m=[],w="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(P,s,D)=>(m.push({paramName:s,isOptional:D!=null}),D?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(m.push({paramName:"*"}),w+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?w+="\\/*$":i!==""&&i!=="/"&&(w+="(?:(?=\\/|$))"),[new RegExp(w,o?void 0:"i"),m]}function UG(i){try{return i.split("/").map(o=>decodeURIComponent(o).replace(/\//g,"%2F")).join("/")}catch(o){return NE(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),i}}function jE(i,o){if(o==="/")return i;if(!i.toLowerCase().startsWith(o.toLowerCase()))return null;let u=o.endsWith("/")?o.length-1:o.length,m=i.charAt(u);return m&&m!=="/"?null:i.slice(u)||"/"}function GG(i,o){o===void 0&&(o="/");let{pathname:u,search:m="",hash:w=""}=typeof i=="string"?hp(i):i;return{pathname:u?u.startsWith("/")?u:$G(u,o):o,search:WG(m),hash:ZG(w)}}function $G(i,o){let u=o.replace(/\/+$/,"").split("/");return i.split("/").forEach(w=>{w===".."?u.length>1&&u.pop():w!=="."&&u.push(w)}),u.length>1?u.join("/"):"/"}function z2(i,o,u,m){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(m)+"].  Please separate it out to the ")+("`to."+u+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function qG(i){return i.filter((o,u)=>u===0||o.route.path&&o.route.path.length>0)}function tz(i,o){let u=qG(i);return o?u.map((m,w)=>w===u.length-1?m.pathname:m.pathnameBase):u.map(m=>m.pathnameBase)}function iz(i,o,u,m){m===void 0&&(m=!1);let w;typeof i=="string"?w=hp(i):(w=gy({},i),_s(!w.pathname||!w.pathname.includes("?"),z2("?","pathname","search",w)),_s(!w.pathname||!w.pathname.includes("#"),z2("#","pathname","hash",w)),_s(!w.search||!w.search.includes("#"),z2("#","search","hash",w)));let E=i===""||w.pathname==="",P=E?"/":w.pathname,s;if(P==null)s=u;else{let G=o.length-1;if(!m&&P.startsWith("..")){let U=P.split("/");for(;U[0]==="..";)U.shift(),G-=1;w.pathname=U.join("/")}s=G>=0?o[G]:"/"}let D=GG(w,s),O=P&&P!=="/"&&P.endsWith("/"),H=(E||P===".")&&u.endsWith("/");return!D.pathname.endsWith("/")&&(O||H)&&(D.pathname+="/"),D}const ph=i=>i.join("/").replace(/\/\/+/g,"/"),HG=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),WG=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,ZG=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function XG(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const rz=["post","put","patch","delete"];new Set(rz);const YG=["get",...rz];new Set(YG);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _y(){return _y=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var m in u)Object.prototype.hasOwnProperty.call(u,m)&&(i[m]=u[m])}return i},_y.apply(this,arguments)}const zE=W.createContext(null),KG=W.createContext(null),dp=W.createContext(null),X1=W.createContext(null),Sh=W.createContext({outlet:null,matches:[],isDataRoute:!1}),nz=W.createContext(null);function QG(i,o){let{relative:u}=o===void 0?{}:o;ky()||_s(!1);let{basename:m,navigator:w}=W.useContext(dp),{hash:E,pathname:P,search:s}=oz(i,{relative:u}),D=P;return m!=="/"&&(D=P==="/"?m:ph([m,P])),w.createHref({pathname:D,search:s,hash:E})}function ky(){return W.useContext(X1)!=null}function pp(){return ky()||_s(!1),W.useContext(X1).location}function sz(i){W.useContext(dp).static||W.useLayoutEffect(i)}function LE(){let{isDataRoute:i}=W.useContext(Sh);return i?d$():JG()}function JG(){ky()||_s(!1);let i=W.useContext(zE),{basename:o,future:u,navigator:m}=W.useContext(dp),{matches:w}=W.useContext(Sh),{pathname:E}=pp(),P=JSON.stringify(tz(w,u.v7_relativeSplatPath)),s=W.useRef(!1);return sz(()=>{s.current=!0}),W.useCallback(function(O,H){if(H===void 0&&(H={}),!s.current)return;if(typeof O=="number"){m.go(O);return}let G=iz(O,JSON.parse(P),E,H.relative==="path");i==null&&o!=="/"&&(G.pathname=G.pathname==="/"?o:ph([o,G.pathname])),(H.replace?m.replace:m.push)(G,H.state,H)},[o,m,P,E,i])}function e$(){let{matches:i}=W.useContext(Sh),o=i[i.length-1];return o?o.params:{}}function oz(i,o){let{relative:u}=o===void 0?{}:o,{future:m}=W.useContext(dp),{matches:w}=W.useContext(Sh),{pathname:E}=pp(),P=JSON.stringify(tz(w,m.v7_relativeSplatPath));return W.useMemo(()=>iz(i,JSON.parse(P),E,u==="path"),[i,P,E,u])}function t$(i,o){return i$(i,o)}function i$(i,o,u,m){ky()||_s(!1);let{navigator:w}=W.useContext(dp),{matches:E}=W.useContext(Sh),P=E[E.length-1],s=P?P.params:{};P&&P.pathname;let D=P?P.pathnameBase:"/";P&&P.route;let O=pp(),H;if(o){var G;let le=typeof o=="string"?hp(o):o;D==="/"||(G=le.pathname)!=null&&G.startsWith(D)||_s(!1),H=le}else H=O;let U=H.pathname||"/",he=U;if(D!=="/"){let le=D.replace(/^\//,"").split("/");he="/"+U.replace(/^\//,"").split("/").slice(le.length).join("/")}let de=PG(i,{pathname:he}),Y=a$(de&&de.map(le=>Object.assign({},le,{params:Object.assign({},s,le.params),pathname:ph([D,w.encodeLocation?w.encodeLocation(le.pathname).pathname:le.pathname]),pathnameBase:le.pathnameBase==="/"?D:ph([D,w.encodeLocation?w.encodeLocation(le.pathnameBase).pathname:le.pathnameBase])})),E,u,m);return o&&Y?W.createElement(X1.Provider,{value:{location:_y({pathname:"/",search:"",hash:"",state:null,key:"default"},H),navigationType:rh.Pop}},Y):Y}function r$(){let i=h$(),o=XG(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),u=i instanceof Error?i.stack:null,w={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},o),u?W.createElement("pre",{style:w},u):null,null)}const n$=W.createElement(r$,null);class s$ extends W.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,u){return u.location!==o.location||u.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:u.error,location:u.location,revalidation:o.revalidation||u.revalidation}}componentDidCatch(o,u){console.error("React Router caught the following error during render",o,u)}render(){return this.state.error!==void 0?W.createElement(Sh.Provider,{value:this.props.routeContext},W.createElement(nz.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function o$(i){let{routeContext:o,match:u,children:m}=i,w=W.useContext(zE);return w&&w.static&&w.staticContext&&(u.route.errorElement||u.route.ErrorBoundary)&&(w.staticContext._deepestRenderedBoundaryId=u.route.id),W.createElement(Sh.Provider,{value:o},m)}function a$(i,o,u,m){var w;if(o===void 0&&(o=[]),u===void 0&&(u=null),m===void 0&&(m=null),i==null){var E;if(!u)return null;if(u.errors)i=u.matches;else if((E=m)!=null&&E.v7_partialHydration&&o.length===0&&!u.initialized&&u.matches.length>0)i=u.matches;else return null}let P=i,s=(w=u)==null?void 0:w.errors;if(s!=null){let H=P.findIndex(G=>G.route.id&&(s==null?void 0:s[G.route.id])!==void 0);H>=0||_s(!1),P=P.slice(0,Math.min(P.length,H+1))}let D=!1,O=-1;if(u&&m&&m.v7_partialHydration)for(let H=0;H<P.length;H++){let G=P[H];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(O=H),G.route.id){let{loaderData:U,errors:he}=u,de=G.route.loader&&U[G.route.id]===void 0&&(!he||he[G.route.id]===void 0);if(G.route.lazy||de){D=!0,O>=0?P=P.slice(0,O+1):P=[P[0]];break}}}return P.reduceRight((H,G,U)=>{let he,de=!1,Y=null,le=null;u&&(he=s&&G.route.id?s[G.route.id]:void 0,Y=G.route.errorElement||n$,D&&(O<0&&U===0?(de=!0,le=null):O===U&&(de=!0,le=G.route.hydrateFallbackElement||null)));let re=o.concat(P.slice(0,U+1)),oe=()=>{let _e;return he?_e=Y:de?_e=le:G.route.Component?_e=W.createElement(G.route.Component,null):G.route.element?_e=G.route.element:_e=H,W.createElement(o$,{match:G,routeContext:{outlet:H,matches:re,isDataRoute:u!=null},children:_e})};return u&&(G.route.ErrorBoundary||G.route.errorElement||U===0)?W.createElement(s$,{location:u.location,revalidation:u.revalidation,component:Y,error:he,children:oe(),routeContext:{outlet:null,matches:re,isDataRoute:!0}}):oe()},null)}var az=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(az||{}),u1=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(u1||{});function l$(i){let o=W.useContext(zE);return o||_s(!1),o}function c$(i){let o=W.useContext(KG);return o||_s(!1),o}function u$(i){let o=W.useContext(Sh);return o||_s(!1),o}function lz(i){let o=u$(),u=o.matches[o.matches.length-1];return u.route.id||_s(!1),u.route.id}function h$(){var i;let o=W.useContext(nz),u=c$(u1.UseRouteError),m=lz(u1.UseRouteError);return o!==void 0?o:(i=u.errors)==null?void 0:i[m]}function d$(){let{router:i}=l$(az.UseNavigateStable),o=lz(u1.UseNavigateStable),u=W.useRef(!1);return sz(()=>{u.current=!0}),W.useCallback(function(w,E){E===void 0&&(E={}),u.current&&(typeof w=="number"?i.navigate(w):i.navigate(w,_y({fromRouteId:o},E)))},[i,o])}function p$(i,o){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function js(i){_s(!1)}function f$(i){let{basename:o="/",children:u=null,location:m,navigationType:w=rh.Pop,navigator:E,static:P=!1,future:s}=i;ky()&&_s(!1);let D=o.replace(/^\/*/,"/"),O=W.useMemo(()=>({basename:D,navigator:E,static:P,future:_y({v7_relativeSplatPath:!1},s)}),[D,s,E,P]);typeof m=="string"&&(m=hp(m));let{pathname:H="/",search:G="",hash:U="",state:he=null,key:de="default"}=m,Y=W.useMemo(()=>{let le=jE(H,D);return le==null?null:{location:{pathname:le,search:G,hash:U,state:he,key:de},navigationType:w}},[D,H,G,U,he,de,w]);return Y==null?null:W.createElement(dp.Provider,{value:O},W.createElement(X1.Provider,{children:u,value:Y}))}function m$(i){let{children:o,location:u}=i;return t$(hT(o),u)}new Promise(()=>{});function hT(i,o){o===void 0&&(o=[]);let u=[];return W.Children.forEach(i,(m,w)=>{if(!W.isValidElement(m))return;let E=[...o,w];if(m.type===W.Fragment){u.push.apply(u,hT(m.props.children,E));return}m.type!==js&&_s(!1),!m.props.index||!m.props.children||_s(!1);let P={id:m.props.id||E.join("-"),caseSensitive:m.props.caseSensitive,element:m.props.element,Component:m.props.Component,index:m.props.index,path:m.props.path,loader:m.props.loader,action:m.props.action,errorElement:m.props.errorElement,ErrorBoundary:m.props.ErrorBoundary,hasErrorBoundary:m.props.ErrorBoundary!=null||m.props.errorElement!=null,shouldRevalidate:m.props.shouldRevalidate,handle:m.props.handle,lazy:m.props.lazy};m.props.children&&(P.children=hT(m.props.children,E)),u.push(P)}),u}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function dT(){return dT=Object.assign?Object.assign.bind():function(i){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var m in u)Object.prototype.hasOwnProperty.call(u,m)&&(i[m]=u[m])}return i},dT.apply(this,arguments)}function g$(i,o){if(i==null)return{};var u={},m=Object.keys(i),w,E;for(E=0;E<m.length;E++)w=m[E],!(o.indexOf(w)>=0)&&(u[w]=i[w]);return u}function _$(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function y$(i,o){return i.button===0&&(!o||o==="_self")&&!_$(i)}const x$=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],v$="6";try{window.__reactRouterVersion=v$}catch{}const w$="startTransition",NR=mk[w$];function b$(i){let{basename:o,children:u,future:m,window:w}=i,E=W.useRef();E.current==null&&(E.current=CG({window:w,v5Compat:!0}));let P=E.current,[s,D]=W.useState({action:P.action,location:P.location}),{v7_startTransition:O}=m||{},H=W.useCallback(G=>{O&&NR?NR(()=>D(G)):D(G)},[D,O]);return W.useLayoutEffect(()=>P.listen(H),[P,H]),W.useEffect(()=>p$(m),[m]),W.createElement(f$,{basename:o,children:u,location:s.location,navigationType:s.action,navigator:P,future:m})}const S$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",T$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Nr=W.forwardRef(function(o,u){let{onClick:m,relative:w,reloadDocument:E,replace:P,state:s,target:D,to:O,preventScrollReset:H,viewTransition:G}=o,U=g$(o,x$),{basename:he}=W.useContext(dp),de,Y=!1;if(typeof O=="string"&&T$.test(O)&&(de=O,S$))try{let _e=new URL(window.location.href),Ne=O.startsWith("//")?new URL(_e.protocol+O):new URL(O),Ge=jE(Ne.pathname,he);Ne.origin===_e.origin&&Ge!=null?O=Ge+Ne.search+Ne.hash:Y=!0}catch{}let le=QG(O,{relative:w}),re=E$(O,{replace:P,state:s,target:D,preventScrollReset:H,relative:w,viewTransition:G});function oe(_e){m&&m(_e),_e.defaultPrevented||re(_e)}return W.createElement("a",dT({},U,{href:de||le,onClick:Y||E?m:oe,ref:u,target:D}))});var jR;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(jR||(jR={}));var zR;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(zR||(zR={}));function E$(i,o){let{target:u,replace:m,state:w,preventScrollReset:E,relative:P,viewTransition:s}=o===void 0?{}:o,D=LE(),O=pp(),H=oz(i,{relative:P});return W.useCallback(G=>{if(y$(G,u)){G.preventDefault();let U=m!==void 0?m:c1(O)===c1(H);D(i,{replace:U,state:w,preventScrollReset:E,relative:P,viewTransition:s})}},[O,D,H,m,w,u,i,E,P,s])}const cz=W.createContext(void 0),C$=({children:i})=>{const[o,u]=W.useState(!1),[m,w]=W.useState(null),[E,P]=W.useState([]),[s,D]=W.useState(!0);W.useEffect(()=>{const de=localStorage.getItem("admin_session"),Y=localStorage.getItem("admin_info");de==="logged_in"&&Y&&(u(!0),w(JSON.parse(Y))),O(),D(!1)},[]);const O=async()=>{try{const Y=await(await fetch("http://localhost:3000/api/admins")).json();P(Y)}catch(de){console.error("Error fetching admins:",de)}},H=async(de,Y)=>{try{const le=await fetch("http://localhost:3000/api/admins/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:de,password:Y})});if(!le.ok)return!1;const re=await le.json();return localStorage.setItem("admin_session","logged_in"),localStorage.setItem("admin_info",JSON.stringify(re.admin)),u(!0),w(re.admin),!0}catch{return!1}},G=()=>{u(!1),w(null),localStorage.removeItem("admin_session"),localStorage.removeItem("admin_info")},U=async(de,Y,le)=>{try{return(await fetch("http://localhost:3000/api/admins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:de,email:Y,password:le})})).ok?(await O(),!0):!1}catch{return!1}},he=async de=>{if(de===(m==null?void 0:m.id))return!1;try{return(await fetch(`http://localhost:3000/api/admins/${de}`,{method:"DELETE"})).ok?(await O(),!0):!1}catch{return!1}};return _.jsx(cz.Provider,{value:{isAdminLoggedIn:o,currentAdmin:m,admins:E,login:H,logout:G,loading:s,createAdmin:U,deleteAdmin:he},children:i})},Y1=()=>{const i=W.useContext(cz);if(!i)throw new Error("useAdmin must be used within AdminProvider");return i},I$=My("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Yt=W.forwardRef(({className:i,variant:o,size:u,asChild:m=!1,...w},E)=>{const P=m?ep:"button";return _.jsx(P,{className:Zr(I$({variant:o,size:u,className:i})),ref:E,...w})});Yt.displayName="Button";const A$=()=>{const[i,o]=W.useState(!1),u=pp(),{isAdminLoggedIn:m}=Y1(),w=[{name:"Home",path:"/"},{name:"Consulting",path:"/consultings"},{name:"Products",path:"/products"},{name:"Resources",path:"/resources"},{name:"Investment",path:"/fund"},{name:"Portfolio",path:"/case-studies"},{name:"Blog",path:"/blog"}],E=P=>u.pathname===P||P!=="/"&&u.pathname.startsWith(P);return _.jsx("nav",{className:"bg-white shadow-sm sticky top-0 z-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"flex justify-between items-center h-16",children:[_.jsx(Nr,{to:"/",className:"flex items-center space-x-2",children:_.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-Black.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),_.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[w.map(P=>_.jsx(Nr,{to:P.path,className:`text-sm font-medium transition-colors duration-200 ${E(P.path)?"text-primary border-b-2 border-primary pb-1":"text-gray-600 hover:text-primary"}`,children:P.name},P.name)),_.jsx(Yt,{asChild:!0,variant:"outline",size:"sm",className:"ml-4",children:_.jsx(Nr,{to:m?"/admin/dashboard":"/admin",children:_.jsxs("div",{className:"flex items-center space-x-2",children:[_.jsx(i1,{size:16}),_.jsx("span",{children:"Admin"})]})})}),_.jsx(Yt,{asChild:!0,className:"ml-2",children:_.jsx(Nr,{to:"/contact",children:"Contact"})})]}),_.jsx("button",{className:"md:hidden flex items-center justify-center w-8 h-8",onClick:()=>o(!i),"aria-label":"Toggle menu",children:_.jsxs("div",{className:"space-y-1",children:[_.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${i?"rotate-45 translate-y-1.5":""}`}),_.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-opacity ${i?"opacity-0":""}`}),_.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${i?"-rotate-45 -translate-y-1.5":""}`})]})})]}),i&&_.jsx("div",{className:"md:hidden border-t border-gray-200 py-4",children:_.jsxs("div",{className:"flex flex-col space-y-4",children:[w.map(P=>_.jsx(Nr,{to:P.path,className:`text-sm font-medium px-2 py-1 rounded transition-colors ${E(P.path)?"text-primary bg-primary/10":"text-gray-600 hover:text-primary hover:bg-gray-50"}`,onClick:()=>o(!1),children:P.name},P.name)),_.jsxs(Nr,{to:m?"/admin/dashboard":"/admin",className:"flex items-center space-x-2 text-sm font-medium px-2 py-1 rounded transition-colors text-gray-600 hover:text-primary hover:bg-gray-50",onClick:()=>o(!1),children:[_.jsx(i1,{size:16}),_.jsx("span",{children:"Admin"})]}),_.jsx(Yt,{asChild:!0,className:"mt-4 w-fit",children:_.jsx(Nr,{to:"/contact",onClick:()=>o(!1),children:"Contact"})})]})})]})})},P$=()=>{const[i,o]=W.useState(""),[u,m]=W.useState(!1),[w,E]=W.useState(!1),P=async s=>{if(s.preventDefault(),!!i){m(!0);try{(await fetch("http://localhost:3000/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:i,subject:"Newsletter",message:"",status:"unread"})})).ok&&(E(!0),o(""),setTimeout(()=>E(!1),3e3))}catch(D){console.error("Newsletter subscription error:",D)}finally{m(!1)}}};return _.jsx("footer",{className:"bg-gray-900 text-white",children:_.jsxs("div",{className:"container-width section-padding py-12",children:[_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[_.jsxs("div",{className:"col-span-1 md:col-span-2",children:[_.jsx(Nr,{to:"/",className:"flex items-center space-x-2",children:_.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-White.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),_.jsx("p",{className:"text-gray-400 mb-4 max-w-md",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and markets connect."}),_.jsx("div",{className:"flex space-x-4",children:_.jsx("a",{href:"https://www.linkedin.com/company/betawavesstudio/",className:"text-gray-400 hover:text-white transition-colors",children:"LinkedIn"})})]}),_.jsxs("div",{children:[_.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),_.jsxs("ul",{className:"space-y-2 text-gray-400",children:[_.jsx("li",{children:_.jsx(Nr,{to:"/consultings",className:"hover:text-white transition-colors",children:"Innovation Consultings"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/case-studies",className:"hover:text-white transition-colors",children:"Portfolio"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/blog",className:"hover:text-white transition-colors",children:"Blog"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/fund",className:"hover:text-white transition-colors",children:"Investment"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/contact",className:"hover:text-white transition-colors",children:"Contact"})})]})]}),_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-2xl font-semibold mb-4",children:"Stay Updated"}),_.jsx("p",{className:"text-1xl mb-8  opacity-50 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),_.jsxs("form",{onSubmit:P,className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[_.jsx("input",{type:"email",placeholder:"Enter your email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:i,onChange:s=>o(s.target.value),required:!0}),_.jsx("button",{type:"submit",disabled:u,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:u?"Subscribing...":"Subscribe"})]}),w&&_.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]}),_.jsxs("div",{className:"border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center",children:[_.jsx("p",{className:"text-gray-400 text-sm",children:"© 2025 Betawaves. All rights reserved."}),_.jsxs("div",{className:"flex space-x-6 mt-4 md:mt-0",children:[_.jsx("li",{children:_.jsx(Nr,{to:"/privacy-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Privacy Policy"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/terms-of-service",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Terms of Service"})}),_.jsx("li",{children:_.jsx(Nr,{to:"/cookie-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Cookie Policy"})})]})]})]})})},Wi=W.forwardRef(({className:i,...o},u)=>_.jsx("div",{ref:u,className:Zr("rounded-lg border bg-card text-card-foreground shadow-sm",i),...o}));Wi.displayName="Card";const cr=W.forwardRef(({className:i,...o},u)=>_.jsx("div",{ref:u,className:Zr("flex flex-col space-y-1.5 p-6",i),...o}));cr.displayName="CardHeader";const ur=W.forwardRef(({className:i,...o},u)=>_.jsx("h3",{ref:u,className:Zr("text-2xl font-semibold leading-none tracking-tight",i),...o}));ur.displayName="CardTitle";const Rn=W.forwardRef(({className:i,...o},u)=>_.jsx("p",{ref:u,className:Zr("text-sm text-muted-foreground",i),...o}));Rn.displayName="CardDescription";const hr=W.forwardRef(({className:i,...o},u)=>_.jsx("div",{ref:u,className:Zr("p-6 pt-0",i),...o}));hr.displayName="CardContent";const M$=W.forwardRef(({className:i,...o},u)=>_.jsx("div",{ref:u,className:Zr("flex items-center p-6 pt-0",i),...o}));M$.displayName="CardFooter";const J0="http://localhost:3000/api";class Ia extends Error{constructor(o,u){super(o),this.status=u,this.name="APIError"}}const ai={async get(i){try{const o=await fetch(`${J0}${i}`);if(!o.ok)throw new Ia(`HTTP error! status: ${o.status}`,o.status);return await o.json()}catch(o){throw o instanceof Ia?o:new Ia("Network error occurred")}},async post(i,o){try{const u=await fetch(`${J0}${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!u.ok)throw new Ia(`HTTP error! status: ${u.status}`,u.status);return await u.json()}catch(u){throw u instanceof Ia?u:new Ia("Network error occurred")}},async put(i,o){try{const u=await fetch(`${J0}${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!u.ok)throw new Ia(`HTTP error! status: ${u.status}`,u.status);return await u.json()}catch(u){throw u instanceof Ia?u:new Ia("Network error occurred")}},async delete(i){try{const o=await fetch(`${J0}${i}`,{method:"DELETE"});if(!o.ok)throw new Ia(`HTTP error! status: ${o.status}`,o.status);return await o.json()}catch(o){throw o instanceof Ia?o:new Ia("Network error occurred")}}},F_=i=>({id:i.id.toString(),title:i.title,description:i.description,features:typeof i.features=="string"?JSON.parse(i.features):i.features,icon:i.icon,eligibility:i.eligibility,category:i.category,directUrl:i.direct_url||void 0}),h1=i=>({title:i.title,description:i.description,features:JSON.stringify(i.features),icon:i.icon,eligibility:i.eligibility,category:i.category,directUrl:i.directUrl??null}),vv=i=>({id:i.id.toString(),title:i.title,description:i.description,features:typeof i.features=="string"?JSON.parse(i.features):i.features,icon:i.icon,duration:i.duration,eligibility:i.eligibility,category:i.category,presentationUrl:i.presentation_url||void 0}),d1=i=>({title:i.title,description:i.description,features:JSON.stringify(i.features),icon:i.icon,duration:i.duration,eligibility:i.eligibility,category:i.category,presentation_url:i.presentationUrl||null}),wv=i=>({id:i.id.toString(),name:i.name,description:i.description,category:i.category,price:i.price,features:typeof i.features=="string"?JSON.parse(i.features):i.features,image:i.image,status:i.status}),p1=i=>({name:i.name,description:i.description,category:i.category,price:i.price,features:JSON.stringify(i.features),image:i.image,status:i.status}),bv=i=>({id:i.id.toString(),name:i.name,description:i.description,totalSize:i.total_size,currentRaise:i.current_raise,targetCompanies:i.target_companies,stage:i.stage,sectors:typeof i.sectors=="string"?JSON.parse(i.sectors):i.sectors,status:i.status}),f1=i=>({name:i.name,description:i.description,total_size:i.totalSize,current_raise:i.currentRaise,target_companies:i.targetCompanies,stage:i.stage,sectors:JSON.stringify(i.sectors),status:i.status}),Sv=i=>({id:i.id.toString(),companyName:i.company_name,industry:i.industry,description:i.description,challenge:i.challenge,solution:i.solution,results:typeof i.results=="string"?JSON.parse(i.results):i.results,image:i.image,testimonial:typeof i.testimonial=="string"?JSON.parse(i.testimonial):i.testimonial,tags:typeof i.tags=="string"?JSON.parse(i.tags):i.tags}),m1=i=>({company_name:i.companyName,industry:i.industry,description:i.description,challenge:i.challenge,solution:i.solution,results:JSON.stringify(i.results),image:i.image,testimonial:JSON.stringify(i.testimonial),tags:JSON.stringify(i.tags)}),Tv=i=>({id:i.id.toString(),title:i.title,excerpt:i.excerpt,content:i.content,author:i.author,publishDate:i.publish_date,image:i.image,category:i.category,tags:typeof i.tags=="string"?JSON.parse(i.tags):i.tags}),g1=i=>({title:i.title,excerpt:i.excerpt,content:i.content,author:i.author,publish_date:i.publishDate,image:i.image,category:i.category,tags:JSON.stringify(i.tags)}),Ev=i=>({id:i.id.toString(),title:i.title,description:i.description,type:i.type,category:i.category,downloadUrl:i.download_url,image:i.image,tags:typeof i.tags=="string"?JSON.parse(i.tags):i.tags}),_1=i=>({title:i.title,description:i.description,type:i.type,category:i.category,download_url:i.downloadUrl,image:i.image,tags:JSON.stringify(i.tags)}),Cv=i=>({id:i.id.toString(),title:i.title,description:i.description,date:i.date,time:i.time,location:i.location,type:i.type,image:i.image,registrationUrl:i.registration_url}),y1=i=>({title:i.title,description:i.description,date:i.date,time:i.time,location:i.location,type:i.type,image:i.image,registration_url:i.registrationUrl}),Iv=i=>({id:i.id.toString(),name:i.name,email:i.email,subject:i.subject,message:i.message,timestamp:i.timestamp,status:i.status}),LR=i=>({name:i.name,email:i.email,subject:i.subject,message:i.message,timestamp:i.timestamp,status:i.status}),Av=i=>({id:i.id.toString(),name:i.name,position:i.position,bio:i.bio,image:i.image,linkedin_url:i.linkedin_url||void 0}),x1=i=>({name:i.name,position:i.position,bio:i.bio,image:i.image,linkedin_url:i.linkedin_url||null}),R$=[{id:"1",title:"Startup Incubation",description:"Transform your innovative idea into a viable business with our comprehensive incubation program.",features:["Mentorship from industry experts","Access to funding networks","Product development support","Business model validation","Legal and compliance guidance"],icon:"home",duration:"6-12 months",eligibility:"Early-stage startups with innovative ideas",category:"incubation",presentationUrl:"/presentations/startup-incubation.pdf"},{id:"2",title:"Acceleration Program",description:"Scale your startup rapidly with our intensive acceleration program designed for growth-ready companies.",features:["Growth strategy development","Market expansion support","Investor connections","Partnership facilitation","Performance tracking"],icon:"arrow-up",duration:"3-6 months",eligibility:"Startups with proven traction and revenue",category:"acceleration",presentationUrl:"/presentations/acceleration-program.pdf"},{id:"3",title:"Bootcamp Programs",description:"Intensive skill-building bootcamps covering essential startup competencies and technologies.",features:["Technical skill development","Business fundamentals","Pitch training","Team building workshops","Industry-specific training"],icon:"book",duration:"2-8 weeks",eligibility:"Entrepreneurs and startup team members",category:"mentorship"},{id:"4",title:"CXO Academy",description:"Executive leadership development program for startup founders and C-level executives.",features:["Leadership coaching","Strategic planning","Board management","Investor relations","Crisis management"],icon:"users",duration:"3-4 months",eligibility:"Startup founders and senior executives",category:"mentorship"}],k$=[{id:"1",name:"StartupOS Platform",description:"All-in-one platform for managing your startup operations, from funding to team management.",category:"Software",price:"$99/month",features:["Investor dashboard","Team collaboration tools","Financial tracking","Milestone management","Document storage"],image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=600&h=400&fit=crop",status:"active"},{id:"2",name:"Mentorship Marketplace",description:"Connect with experienced mentors and industry experts for personalized guidance.",category:"Service",price:"$149/month",features:["1-on-1 mentorship sessions","Industry expert network","Goal tracking","Progress analytics","Resource library"],image:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=600&h=400&fit=crop",status:"active"},{id:"3",name:"AI Analytics Suite",description:"Advanced AI-powered analytics and insights for data-driven decision making.",category:"Analytics",price:"$199/month",features:["Predictive analytics","Real-time dashboards","Custom reports","Data visualization","API integration"],image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=600&h=400&fit=crop",status:"coming-soon"}],D$=[{id:"1",name:"Betawaves Seed Fund I",description:"Early-stage fund focused on pre-seed and seed investments in innovative startups.",totalSize:"$50M",currentRaise:"$35M",targetCompanies:"25-30",stage:"Pre-seed to Seed",sectors:["FinTech","HealthTech","AI/ML","SaaS"],status:"fundraising"},{id:"2",name:"Betawaves Growth Fund",description:"Growth-stage fund for scaling proven startups with strong market traction.",totalSize:"$100M",currentRaise:"$100M",targetCompanies:"15-20",stage:"Series A to B",sectors:["Enterprise Software","CleanTech","E-commerce","EdTech"],status:"deployed"}],N$=[{id:"1",companyName:"TechFlow AI",industry:"Artificial Intelligence",description:"An AI-powered workflow automation platform for small businesses.",challenge:"TechFlow AI needed to validate their product-market fit and secure Series A funding.",solution:"Through our acceleration program, we helped them refine their go-to-market strategy and connect with key investors.",results:["Secured $2.5M Series A funding","Grew from 50 to 500+ enterprise customers","Expanded to 3 new markets","Built strategic partnerships with major tech companies"],image:"https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=600&h=400&fit=crop",testimonial:{quote:"Betawaves didn't just provide funding - they gave us the strategic guidance and network access that transformed our startup into a market leader.",author:"Sarah Chen",position:"CEO & Founder"},tags:["AI","B2B","Series A","Acceleration"]},{id:"2",companyName:"GreenEnergy Solutions",industry:"Clean Technology",description:"Sustainable energy solutions for residential and commercial properties.",challenge:"Needed technical expertise and regulatory guidance to bring their solar technology to market.",solution:"Our incubation program provided technical mentorship and helped navigate complex energy regulations.",results:["Successfully launched in 5 states","Achieved 40% cost reduction in manufacturing","Installed 1000+ solar systems","Won 3 industry innovation awards"],image:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=600&h=400&fit=crop",testimonial:{quote:"The technical mentorship and industry connections from Betawaves were crucial in helping us overcome regulatory hurdles and scale our operations.",author:"Michael Rodriguez",position:"CTO & Co-founder"},tags:["CleanTech","B2C","Incubation","Sustainability"]},{id:"3",companyName:"HealthTrack Pro",industry:"Healthcare Technology",description:"Digital health platform connecting patients with healthcare providers.",challenge:"Required HIPAA compliance expertise and healthcare industry partnerships.",solution:"Our CXO Academy helped the founders develop healthcare industry expertise and regulatory compliance.",results:["Achieved HIPAA compliance certification","Partnered with 50+ healthcare providers","Served 10,000+ patients","Reduced patient wait times by 60%"],image:"https://images.unsplash.com/photo-1649972904349-6e44c42644a7?w=600&h=400&fit=crop",testimonial:{quote:"The CXO Academy gave us the leadership skills and industry knowledge needed to navigate the complex healthcare landscape successfully.",author:"Dr. Emily Watson",position:"CEO & Founder"},tags:["HealthTech","B2B2C","CXO Academy","Compliance"]}],j$=[{id:"1",title:"The Future of Startup Funding: Trends to Watch in 2024",excerpt:"Explore the emerging trends in startup funding, from AI-driven due diligence to sustainable investing.",content:"The startup funding landscape is evolving rapidly...",author:"Alex Johnson",publishDate:"2024-01-15",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",category:"Funding",tags:["Funding","Trends","Investment","Startups"]},{id:"2",title:"Building a Winning Pitch Deck: A Comprehensive Guide",excerpt:"Learn how to create compelling pitch decks that capture investor attention and secure funding.",content:"A great pitch deck tells a story...",author:"Maria Santos",publishDate:"2024-01-10",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",category:"Resources",tags:["Pitch Deck","Investment","Presentation","Fundraising"]},{id:"3",title:"The Rise of AI in Startup Operations",excerpt:"How artificial intelligence is transforming startup operations and creating new opportunities.",content:"Artificial intelligence is no longer just a buzzword...",author:"David Kim",publishDate:"2024-01-05",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",category:"Technology",tags:["AI","Operations","Automation","Innovation"]}],z$=[{id:"1",title:"Startup Pitch Night",description:"Join us for an evening of innovative pitches from emerging startups seeking funding and partnerships.",date:"2024-02-15",time:"18:00",location:"Betawaves Innovation Hub, San Francisco",type:"pitch",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"2",title:"AI for Startups Workshop",description:"Learn how to integrate AI technologies into your startup to drive growth and efficiency.",date:"2024-02-20",time:"14:00",location:"Virtual Event",type:"workshop",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"3",title:"Founder Networking Mixer",description:"Connect with fellow entrepreneurs, investors, and industry experts in a relaxed networking environment.",date:"2024-02-25",time:"17:30",location:"TechHub Downtown, Austin",type:"networking",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",registrationUrl:"#"}],L$=[{id:"1",title:"Startup Pitch Deck Template",description:"Professional pitch deck template with 15 essential slides for fundraising success.",type:"pitch-deck",category:"Fundraising",downloadUrl:"/resources/pitch-deck-template.pdf",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",tags:["Pitch Deck","Template","Fundraising"]},{id:"2",title:"Financial Model Template",description:"Complete financial modeling spreadsheet with 3-year projections and scenario analysis.",type:"financial-model",category:"Finance",downloadUrl:"/resources/financial-model.xlsx",image:"https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=600&h=400&fit=crop",tags:["Financial Model","Excel","Planning"]},{id:"3",title:"Market Research Guide",description:"Step-by-step guide to conducting effective market research for your startup.",type:"guide",category:"Research",downloadUrl:"/resources/market-research-guide.pdf",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=600&h=400&fit=crop",tags:["Market Research","Guide","Strategy"]}],F$=[{id:"1",name:"Sarah Johnson",position:"CEO & Founder",bio:"Former VP at Google Ventures with 15+ years in startup ecosystem. Led 50+ successful exits.",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/sarahjohnson"},{id:"2",name:"Michael Chen",position:"CTO & Co-founder",bio:"Tech veteran from Meta and Uber. Expert in scaling tech teams and building innovative products.",image:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/michaelchen"},{id:"3",name:"Emily Rodriguez",position:"Head of Programs",bio:"MBA from Stanford. Previously at Y Combinator, managed over 200 startup accelerations.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/emilyrodriguez"},{id:"4",name:"David Park",position:"Investment Director",bio:"Former Goldman Sachs analyst. Specialized in early-stage funding and venture capital.",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/davidpark"}],O$=[{id:"1",name:"Sarah Johnson",email:"sarah.johnson@techstartup.com",subject:"Inquiry about Incubation Program",message:"Hi, I'm interested in learning more about your incubation program. My startup is in the fintech space and we're looking for mentorship and funding opportunities.",timestamp:"2024-01-15T10:30:00Z",status:"unread"},{id:"2",name:"Michael Chen",email:"mike@innovativeai.com",subject:"Partnership Opportunity",message:"Hello, I represent an AI startup that has developed a revolutionary machine learning platform. We'd like to explore potential partnership opportunities with Betawaves.",timestamp:"2024-01-14T14:20:00Z",status:"read"},{id:"3",name:"Emily Rodriguez",email:"emily.r@greentech.io",subject:"Application Status Follow-up",message:"I submitted an application for the Acceleration Program last week and wanted to follow up on the status. Could you please provide an update?",timestamp:"2024-01-13T09:15:00Z",status:"replied"},{id:"4",name:"David Park",email:"david@healthinnovate.com",subject:"Speaking Opportunity",message:"I'd like to propose speaking at one of your upcoming events. I'm the founder of a successful healthtech startup and would love to share our journey.",timestamp:"2024-01-12T16:45:00Z",status:"unread"}],B$=[{id:"1",programId:"1",name:"John Smith",email:"john@startup.com",company:"TechFlow Solutions",phone:"+1234567890",message:"We are an early-stage fintech startup looking for incubation support.",timestamp:"2024-01-15T10:30:00Z",status:"pending"}],ao={async getServices(){try{return(await ai.get("/services")).map(vv)}catch(i){return console.error("Error fetching services:",i),R$}},async createService(i){try{const o=d1(i),u=await ai.post("/services",o);return vv(u)}catch(o){throw console.error("Error creating service:",o),new Error("Failed to create service")}},async updateService(i,o){try{const u=d1(o),m=await ai.put(`/services/${i}`,u);return vv(m)}catch(u){throw console.error("Error updating service:",u),new Error("Failed to update service")}},async deleteService(i){try{await ai.delete(`/services/${i}`)}catch(o){throw console.error("Error deleting service:",o),new Error("Failed to delete service")}},async getConsulting(){try{return(await ai.get("/consulting")).map(F_)}catch(i){return console.error("Error fetching consulting:",i),[]}},async getConsultings(){return(await ai.get("/consultings")).map(F_)},async createConsulting(i){try{const o=h1(i),u=await ai.post("/consulting",o);return F_(u)}catch(o){throw console.error("Error creating consulting entry:",o),new Error("Failed to create consulting")}},async updateConsulting(i,o){try{const u=h1(o),m=await ai.put(`/consulting/${i}`,u);return F_(m)}catch(u){throw console.error("Error updating consulting entry:",u),new Error("Failed to update consulting")}},async deleteConsulting(i){try{await ai.delete(`/consulting/${i}`)}catch(o){throw console.error("Error deleting consulting entry:",o),new Error("Failed to delete consulting")}},async getProducts(){try{return(await ai.get("/products")).map(wv)}catch(i){return console.error("Error fetching products:",i),k$}},async createProduct(i){try{const o=p1(i),u=await ai.post("/products",o);return wv(u)}catch(o){throw console.error("Error creating product:",o),new Error("Failed to create product")}},async updateProduct(i,o){try{const u=p1(o),m=await ai.put(`/products/${i}`,u);return wv(m)}catch(u){throw console.error("Error updating product:",u),new Error("Failed to update product")}},async deleteProduct(i){try{await ai.delete(`/products/${i}`)}catch(o){throw console.error("Error deleting product:",o),new Error("Failed to delete product")}},async getFunds(){try{return(await ai.get("/funds")).map(bv)}catch(i){return console.error("Error fetching funds:",i),D$}},async createFund(i){try{const o=f1(i),u=await ai.post("/funds",o);return bv(u)}catch(o){throw console.error("Error creating fund:",o),new Error("Failed to create fund")}},async updateFund(i,o){try{const u=f1(o),m=await ai.put(`/funds/${i}`,u);return bv(m)}catch(u){throw console.error("Error updating fund:",u),new Error("Failed to update fund")}},async deleteFund(i){try{await ai.delete(`/funds/${i}`)}catch(o){throw console.error("Error deleting fund:",o),new Error("Failed to delete fund")}},async getCaseStudies(){try{return(await ai.get("/case-studies")).map(Sv)}catch(i){return console.error("Error fetching case studies:",i),N$}},async createCaseStudy(i){try{const o=m1(i),u=await ai.post("/case-studies",o);return Sv(u)}catch(o){throw console.error("Error creating case study:",o),new Error("Failed to create case study")}},async updateCaseStudy(i,o){try{const u=m1(o),m=await ai.put(`/case-studies/${i}`,u);return Sv(m)}catch(u){throw console.error("Error updating case study:",u),new Error("Failed to update case study")}},async deleteCaseStudy(i){try{await ai.delete(`/case-studies/${i}`)}catch(o){throw console.error("Error deleting case study:",o),new Error("Failed to delete case study")}},async getBlogPosts(){try{return(await ai.get("/blog-posts")).map(Tv)}catch(i){return console.error("Error fetching blog posts:",i),j$}},async createBlogPost(i){try{const o=g1(i),u=await ai.post("/blog-posts",o);return Tv(u)}catch(o){throw console.error("Error creating blog post:",o),new Error("Failed to create blog post")}},async updateBlogPost(i,o){try{const u=g1(o),m=await ai.put(`/blog-posts/${i}`,u);return Tv(m)}catch(u){throw console.error("Error updating blog post:",u),new Error("Failed to update blog post")}},async deleteBlogPost(i){try{await ai.delete(`/blog-posts/${i}`)}catch(o){throw console.error("Error deleting blog post:",o),new Error("Failed to delete blog post")}},async getEvents(){try{return(await ai.get("/events")).map(Cv)}catch(i){return console.error("Error fetching events:",i),z$}},async createEvent(i){try{const o=y1(i),u=await ai.post("/events",o);return Cv(u)}catch(o){throw console.error("Error creating event:",o),new Error("Failed to create event")}},async updateEvent(i,o){try{const u=y1(o),m=await ai.put(`/events/${i}`,u);return Cv(m)}catch(u){throw console.error("Error updating event:",u),new Error("Failed to update event")}},async deleteEvent(i){try{await ai.delete(`/events/${i}`)}catch(o){throw console.error("Error deleting event:",o),new Error("Failed to delete event")}},async getContactMessages(){try{return(await ai.get("/contact-messages")).map(Iv)}catch(i){return console.error("Error fetching contact messages:",i),O$}},async createContactMessage(i){try{const o=LR(i),u=await ai.post("/contact-messages",o);return Iv(u)}catch(o){throw console.error("Error creating contact message:",o),new Error("Failed to create contact message")}},async updateContactMessage(i,o){try{const u=LR(o),m=await ai.put(`/contact-messages/${i}`,u);return Iv(m)}catch(u){throw console.error("Error updating contact message:",u),new Error("Failed to update contact message")}},async deleteContactMessage(i){try{await ai.delete(`/contact-messages/${i}`)}catch(o){throw console.error("Error deleting contact message:",o),new Error("Failed to delete contact message")}},async getResources(){try{return(await ai.get("/resources")).map(Ev)}catch(i){return console.error("Error fetching resources:",i),L$}},async createResource(i){try{const o=_1(i),u=await ai.post("/resources",o);return Ev(u)}catch(o){throw console.error("Error creating resource:",o),new Error("Failed to create resource")}},async updateResource(i,o){try{const u=_1(o),m=await ai.put(`/resources/${i}`,u);return Ev(m)}catch(u){throw console.error("Error updating resource:",u),new Error("Failed to update resource")}},async deleteResource(i){try{await ai.delete(`/resources/${i}`)}catch(o){throw console.error("Error deleting resource:",o),new Error("Failed to delete resource")}},async getTeamMembers(){try{return(await ai.get("/team-members")).map(Av)}catch(i){return console.error("Error fetching team members:",i),F$}},async createTeamMember(i){try{const o=x1(i),u=await ai.post("/team-members",o);return Av(u)}catch(o){throw console.error("Error creating team member:",o),new Error("Failed to create team member")}},async updateTeamMember(i,o){try{const u=x1(o),m=await ai.put(`/team-members/${i}`,u);return Av(m)}catch(u){throw console.error("Error updating team member:",u),new Error("Failed to update team member")}},async deleteTeamMember(i){try{await ai.delete(`/team-members/${i}`)}catch(o){throw console.error("Error deleting team member:",o),new Error("Failed to delete team member")}},async getProgramApplications(){try{return(await ai.get("/program-applications")).map(o=>({id:o.id.toString(),programId:o.program_id.toString(),name:o.name,email:o.email,company:o.company,phone:o.phone,message:o.message,timestamp:o.timestamp,status:o.status}))}catch(i){return console.error("Error fetching program applications:",i),B$}},async createProgramApplication(i){try{const o={program_id:parseInt(i.programId),name:i.name,email:i.email,company:i.company,phone:i.phone,message:i.message,timestamp:i.timestamp,status:i.status},u=await ai.post("/program-applications",o);return{id:u.id.toString(),programId:u.program_id.toString(),name:u.name,email:u.email,company:u.company,phone:u.phone,message:u.message,timestamp:u.timestamp,status:u.status}}catch(o){throw console.error("Error creating program application:",o),new Error("Failed to create program application")}},async updateProgramApplication(i,o){try{const u={program_id:parseInt(o.programId),name:o.name,email:o.email,company:o.company,phone:o.phone,message:o.message,timestamp:o.timestamp,status:o.status},m=await ai.put(`/program-applications/${i}`,u);return{id:m.id.toString(),programId:m.program_id.toString(),name:m.name,email:m.email,company:m.company,phone:m.phone,message:m.message,timestamp:m.timestamp,status:m.status}}catch(u){throw console.error("Error updating program application:",u),new Error("Failed to update program application")}},async deleteProgramApplication(i){try{await ai.delete(`/program-applications/${i}`)}catch(o){throw console.error("Error deleting program application:",o),new Error("Failed to delete program application")}},async getPopup(){try{return await ai.get("/popup")}catch(i){return console.error("Error fetching popup:",i),null}},updatePopup:async i=>{const o=new FormData;Object.entries(i).forEach(([u,m])=>{u==="image"&&m instanceof File?o.append("image",m):o.append(u,String(m))}),await fetch("http://localhost:3000/api/popup/update",{method:"POST",body:o})}},V$=()=>{const[i,o]=W.useState([]),[u,m]=W.useState(!1),w=W.useRef(null);W.useEffect(()=>{(async()=>{try{const D=(await ao.getTeamMembers()).map(O=>({...O,linkedIn:O.linkedin_url}));o(D)}catch(s){console.error("Error fetching team members:",s)}})()},[]),W.useEffect(()=>{const P=setInterval(()=>{if(w.current){const s=w.current,D=s.scrollWidth-s.clientWidth;s.scrollLeft>=D?s.scrollTo({left:0,behavior:"smooth"}):s.scrollBy({left:300,behavior:"smooth"})}},5e3);return()=>clearInterval(P)},[]);const E=u?i:i.slice(0,4);return _.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:["Meet Our ",_.jsx("span",{className:"gradient-text",children:"Team"})]}),_.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our experienced team of entrepreneurs, investors, and industry experts are dedicated to your startup's success"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:E.map(P=>_.jsx(Wi,{className:"text-center flex flex-col justify-between hover:shadow-lg transition-shadow group",children:_.jsxs(hr,{className:"p-6 flex flex-col flex-grow justify-between",children:[_.jsx("div",{className:"relative mb-6",children:_.jsx("img",{src:P.image,alt:P.name,className:"w-24 h-24 rounded-full mx-auto object-cover group-hover:scale-105 transition-transform"})}),_.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:P.name}),_.jsx("p",{className:"text-primary font-medium mb-3",children:P.position}),_.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:P.bio}),P.linkedin_url&&_.jsx("div",{className:"mt-4",children:_.jsx("a",{href:P.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Connect on LinkedIn →"})})]})},P.id))}),i.length>4&&_.jsx("div",{className:"text-center mt-8",children:_.jsx("button",{onClick:()=>m(P=>!P),className:"text-primary hover:text-primary/80 font-medium text-sm",children:u?"See Less ↑":"See More ↓"})})]})})},U$=({companies:i})=>_.jsxs("div",{className:"bg-[#1872f2] py-4 overflow-hidden",children:[_.jsx("div",{className:"relative w-full",children:_.jsx("div",{className:"marquee-content flex animate-marquee",children:[...i,...i].map((o,u)=>_.jsx("span",{className:"text-lg font-medium text-white mx-8 whitespace-nowrap",children:o},`${o}-${u}`))})}),_.jsx("style",{children:`
          @keyframes marquee {
            0% {
              transform: translateX(0%);
            }
            100% {
              transform: translateX(-50%);
            }
          }

          .marquee-content {
            width: max-content;
          }

          .animate-marquee {
            animation: marquee 15s linear infinite;
            display: flex;
          }
        `})]}),G$=({collaborators:i})=>_.jsx("div",{className:"bg-gray-50 py-6",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center",children:[_.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-6",children:"Our Partners"}),_.jsx("div",{className:"flex flex-wrap justify-center items-center gap-4",children:i.map(o=>_.jsx("a",{href:o.website,target:"_blank",rel:"noopener noreferrer",className:"w-32",children:_.jsx("div",{className:"bg-white rounded-lg shadow p-3 h-24 flex items-center justify-center hover:shadow-md transition-shadow",children:_.jsx("img",{src:o.logo,alt:o.name,className:"max-h-full max-w-full object-contain"})})},o.id))})]})})});var L2="focusScope.autoFocusOnMount",F2="focusScope.autoFocusOnUnmount",FR={bubbles:!1,cancelable:!0},$$="FocusScope",FE=W.forwardRef((i,o)=>{const{loop:u=!1,trapped:m=!1,onMountAutoFocus:w,onUnmountAutoFocus:E,...P}=i,[s,D]=W.useState(null),O=Ho(w),H=Ho(E),G=W.useRef(null),U=kn(o,Y=>D(Y)),he=W.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;W.useEffect(()=>{if(m){let Y=function(_e){if(he.paused||!s)return;const Ne=_e.target;s.contains(Ne)?G.current=Ne:Vu(G.current,{select:!0})},le=function(_e){if(he.paused||!s)return;const Ne=_e.relatedTarget;Ne!==null&&(s.contains(Ne)||Vu(G.current,{select:!0}))},re=function(_e){if(document.activeElement===document.body)for(const Ge of _e)Ge.removedNodes.length>0&&Vu(s)};document.addEventListener("focusin",Y),document.addEventListener("focusout",le);const oe=new MutationObserver(re);return s&&oe.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Y),document.removeEventListener("focusout",le),oe.disconnect()}}},[m,s,he.paused]),W.useEffect(()=>{if(s){BR.add(he);const Y=document.activeElement;if(!s.contains(Y)){const re=new CustomEvent(L2,FR);s.addEventListener(L2,O),s.dispatchEvent(re),re.defaultPrevented||(q$(Y$(uz(s)),{select:!0}),document.activeElement===Y&&Vu(s))}return()=>{s.removeEventListener(L2,O),setTimeout(()=>{const re=new CustomEvent(F2,FR);s.addEventListener(F2,H),s.dispatchEvent(re),re.defaultPrevented||Vu(Y??document.body,{select:!0}),s.removeEventListener(F2,H),BR.remove(he)},0)}}},[s,O,H,he]);const de=W.useCallback(Y=>{if(!u&&!m||he.paused)return;const le=Y.key==="Tab"&&!Y.altKey&&!Y.ctrlKey&&!Y.metaKey,re=document.activeElement;if(le&&re){const oe=Y.currentTarget,[_e,Ne]=H$(oe);_e&&Ne?!Y.shiftKey&&re===Ne?(Y.preventDefault(),u&&Vu(_e,{select:!0})):Y.shiftKey&&re===_e&&(Y.preventDefault(),u&&Vu(Ne,{select:!0})):re===oe&&Y.preventDefault()}},[u,m,he.paused]);return _.jsx(jr.div,{tabIndex:-1,...P,ref:U,onKeyDown:de})});FE.displayName=$$;function q$(i,{select:o=!1}={}){const u=document.activeElement;for(const m of i)if(Vu(m,{select:o}),document.activeElement!==u)return}function H$(i){const o=uz(i),u=OR(o,i),m=OR(o.reverse(),i);return[u,m]}function uz(i){const o=[],u=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:m=>{const w=m.tagName==="INPUT"&&m.type==="hidden";return m.disabled||m.hidden||w?NodeFilter.FILTER_SKIP:m.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;u.nextNode();)o.push(u.currentNode);return o}function OR(i,o){for(const u of i)if(!W$(u,{upTo:o}))return u}function W$(i,{upTo:o}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(o!==void 0&&i===o)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function Z$(i){return i instanceof HTMLInputElement&&"select"in i}function Vu(i,{select:o=!1}={}){if(i&&i.focus){const u=document.activeElement;i.focus({preventScroll:!0}),i!==u&&Z$(i)&&o&&i.select()}}var BR=X$();function X$(){let i=[];return{add(o){const u=i[0];o!==u&&(u==null||u.pause()),i=VR(i,o),i.unshift(o)},remove(o){var u;i=VR(i,o),(u=i[0])==null||u.resume()}}}function VR(i,o){const u=[...i],m=u.indexOf(o);return m!==-1&&u.splice(m,1),u}function Y$(i){return i.filter(o=>o.tagName!=="A")}var O2=0;function hz(){W.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??UR()),document.body.insertAdjacentElement("beforeend",i[1]??UR()),O2++,()=>{O2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(o=>o.remove()),O2--}},[])}function UR(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var Wl=function(){return Wl=Object.assign||function(o){for(var u,m=1,w=arguments.length;m<w;m++){u=arguments[m];for(var E in u)Object.prototype.hasOwnProperty.call(u,E)&&(o[E]=u[E])}return o},Wl.apply(this,arguments)};function dz(i,o){var u={};for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&o.indexOf(m)<0&&(u[m]=i[m]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,m=Object.getOwnPropertySymbols(i);w<m.length;w++)o.indexOf(m[w])<0&&Object.prototype.propertyIsEnumerable.call(i,m[w])&&(u[m[w]]=i[m[w]]);return u}function K$(i,o,u){if(u||arguments.length===2)for(var m=0,w=o.length,E;m<w;m++)(E||!(m in o))&&(E||(E=Array.prototype.slice.call(o,0,m)),E[m]=o[m]);return i.concat(E||Array.prototype.slice.call(o))}var Pv="right-scroll-bar-position",Mv="width-before-scroll-bar",Q$="with-scroll-bars-hidden",J$="--removed-body-scroll-bar-size";function B2(i,o){return typeof i=="function"?i(o):i&&(i.current=o),i}function e9(i,o){var u=W.useState(function(){return{value:i,callback:o,facade:{get current(){return u.value},set current(m){var w=u.value;w!==m&&(u.value=m,u.callback(m,w))}}}})[0];return u.callback=o,u.facade}var t9=typeof window<"u"?W.useLayoutEffect:W.useEffect,GR=new WeakMap;function i9(i,o){var u=e9(null,function(m){return i.forEach(function(w){return B2(w,m)})});return t9(function(){var m=GR.get(u);if(m){var w=new Set(m),E=new Set(i),P=u.current;w.forEach(function(s){E.has(s)||B2(s,null)}),E.forEach(function(s){w.has(s)||B2(s,P)})}GR.set(u,i)},[i]),u}function r9(i){return i}function n9(i,o){o===void 0&&(o=r9);var u=[],m=!1,w={read:function(){if(m)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return u.length?u[u.length-1]:i},useMedium:function(E){var P=o(E,m);return u.push(P),function(){u=u.filter(function(s){return s!==P})}},assignSyncMedium:function(E){for(m=!0;u.length;){var P=u;u=[],P.forEach(E)}u={push:function(s){return E(s)},filter:function(){return u}}},assignMedium:function(E){m=!0;var P=[];if(u.length){var s=u;u=[],s.forEach(E),P=u}var D=function(){var H=P;P=[],H.forEach(E)},O=function(){return Promise.resolve().then(D)};O(),u={push:function(H){P.push(H),O()},filter:function(H){return P=P.filter(H),u}}}};return w}function s9(i){i===void 0&&(i={});var o=n9(null);return o.options=Wl({async:!0,ssr:!1},i),o}var pz=function(i){var o=i.sideCar,u=dz(i,["sideCar"]);if(!o)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var m=o.read();if(!m)throw new Error("Sidecar medium not found");return W.createElement(m,Wl({},u))};pz.isSideCarExport=!0;function o9(i,o){return i.useMedium(o),pz}var fz=s9(),V2=function(){},K1=W.forwardRef(function(i,o){var u=W.useRef(null),m=W.useState({onScrollCapture:V2,onWheelCapture:V2,onTouchMoveCapture:V2}),w=m[0],E=m[1],P=i.forwardProps,s=i.children,D=i.className,O=i.removeScrollBar,H=i.enabled,G=i.shards,U=i.sideCar,he=i.noIsolation,de=i.inert,Y=i.allowPinchZoom,le=i.as,re=le===void 0?"div":le,oe=i.gapMode,_e=dz(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Ne=U,Ge=i9([u,o]),pt=Wl(Wl({},_e),w);return W.createElement(W.Fragment,null,H&&W.createElement(Ne,{sideCar:fz,removeScrollBar:O,shards:G,noIsolation:he,inert:de,setCallbacks:E,allowPinchZoom:!!Y,lockRef:u,gapMode:oe}),P?W.cloneElement(W.Children.only(s),Wl(Wl({},pt),{ref:Ge})):W.createElement(re,Wl({},pt,{className:D,ref:Ge}),s))});K1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};K1.classNames={fullWidth:Mv,zeroRight:Pv};var a9=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function l9(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var o=a9();return o&&i.setAttribute("nonce",o),i}function c9(i,o){i.styleSheet?i.styleSheet.cssText=o:i.appendChild(document.createTextNode(o))}function u9(i){var o=document.head||document.getElementsByTagName("head")[0];o.appendChild(i)}var h9=function(){var i=0,o=null;return{add:function(u){i==0&&(o=l9())&&(c9(o,u),u9(o)),i++},remove:function(){i--,!i&&o&&(o.parentNode&&o.parentNode.removeChild(o),o=null)}}},d9=function(){var i=h9();return function(o,u){W.useEffect(function(){return i.add(o),function(){i.remove()}},[o&&u])}},mz=function(){var i=d9(),o=function(u){var m=u.styles,w=u.dynamic;return i(m,w),null};return o},p9={left:0,top:0,right:0,gap:0},U2=function(i){return parseInt(i||"",10)||0},f9=function(i){var o=window.getComputedStyle(document.body),u=o[i==="padding"?"paddingLeft":"marginLeft"],m=o[i==="padding"?"paddingTop":"marginTop"],w=o[i==="padding"?"paddingRight":"marginRight"];return[U2(u),U2(m),U2(w)]},m9=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return p9;var o=f9(i),u=document.documentElement.clientWidth,m=window.innerWidth;return{left:o[0],top:o[1],right:o[2],gap:Math.max(0,m-u+o[2]-o[0])}},g9=mz(),nm="data-scroll-locked",_9=function(i,o,u,m){var w=i.left,E=i.top,P=i.right,s=i.gap;return u===void 0&&(u="margin"),`
  .`.concat(Q$,` {
   overflow: hidden `).concat(m,`;
   padding-right: `).concat(s,"px ").concat(m,`;
  }
  body[`).concat(nm,`] {
    overflow: hidden `).concat(m,`;
    overscroll-behavior: contain;
    `).concat([o&&"position: relative ".concat(m,";"),u==="margin"&&`
    padding-left: `.concat(w,`px;
    padding-top: `).concat(E,`px;
    padding-right: `).concat(P,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(m,`;
    `),u==="padding"&&"padding-right: ".concat(s,"px ").concat(m,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Pv,` {
    right: `).concat(s,"px ").concat(m,`;
  }
  
  .`).concat(Mv,` {
    margin-right: `).concat(s,"px ").concat(m,`;
  }
  
  .`).concat(Pv," .").concat(Pv,` {
    right: 0 `).concat(m,`;
  }
  
  .`).concat(Mv," .").concat(Mv,` {
    margin-right: 0 `).concat(m,`;
  }
  
  body[`).concat(nm,`] {
    `).concat(J$,": ").concat(s,`px;
  }
`)},$R=function(){var i=parseInt(document.body.getAttribute(nm)||"0",10);return isFinite(i)?i:0},y9=function(){W.useEffect(function(){return document.body.setAttribute(nm,($R()+1).toString()),function(){var i=$R()-1;i<=0?document.body.removeAttribute(nm):document.body.setAttribute(nm,i.toString())}},[])},x9=function(i){var o=i.noRelative,u=i.noImportant,m=i.gapMode,w=m===void 0?"margin":m;y9();var E=W.useMemo(function(){return m9(w)},[w]);return W.createElement(g9,{styles:_9(E,!o,w,u?"":"!important")})},pT=!1;if(typeof window<"u")try{var ev=Object.defineProperty({},"passive",{get:function(){return pT=!0,!0}});window.addEventListener("test",ev,ev),window.removeEventListener("test",ev,ev)}catch{pT=!1}var Nf=pT?{passive:!1}:!1,v9=function(i){return i.tagName==="TEXTAREA"},gz=function(i,o){if(!(i instanceof Element))return!1;var u=window.getComputedStyle(i);return u[o]!=="hidden"&&!(u.overflowY===u.overflowX&&!v9(i)&&u[o]==="visible")},w9=function(i){return gz(i,"overflowY")},b9=function(i){return gz(i,"overflowX")},qR=function(i,o){var u=o.ownerDocument,m=o;do{typeof ShadowRoot<"u"&&m instanceof ShadowRoot&&(m=m.host);var w=_z(i,m);if(w){var E=yz(i,m),P=E[1],s=E[2];if(P>s)return!0}m=m.parentNode}while(m&&m!==u.body);return!1},S9=function(i){var o=i.scrollTop,u=i.scrollHeight,m=i.clientHeight;return[o,u,m]},T9=function(i){var o=i.scrollLeft,u=i.scrollWidth,m=i.clientWidth;return[o,u,m]},_z=function(i,o){return i==="v"?w9(o):b9(o)},yz=function(i,o){return i==="v"?S9(o):T9(o)},E9=function(i,o){return i==="h"&&o==="rtl"?-1:1},C9=function(i,o,u,m,w){var E=E9(i,window.getComputedStyle(o).direction),P=E*m,s=u.target,D=o.contains(s),O=!1,H=P>0,G=0,U=0;do{var he=yz(i,s),de=he[0],Y=he[1],le=he[2],re=Y-le-E*de;(de||re)&&_z(i,s)&&(G+=re,U+=de),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!D&&s!==document.body||D&&(o.contains(s)||o===s));return(H&&(Math.abs(G)<1||!w)||!H&&(Math.abs(U)<1||!w))&&(O=!0),O},tv=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},HR=function(i){return[i.deltaX,i.deltaY]},WR=function(i){return i&&"current"in i?i.current:i},I9=function(i,o){return i[0]===o[0]&&i[1]===o[1]},A9=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},P9=0,jf=[];function M9(i){var o=W.useRef([]),u=W.useRef([0,0]),m=W.useRef(),w=W.useState(P9++)[0],E=W.useState(mz)[0],P=W.useRef(i);W.useEffect(function(){P.current=i},[i]),W.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(w));var Y=K$([i.lockRef.current],(i.shards||[]).map(WR),!0).filter(Boolean);return Y.forEach(function(le){return le.classList.add("allow-interactivity-".concat(w))}),function(){document.body.classList.remove("block-interactivity-".concat(w)),Y.forEach(function(le){return le.classList.remove("allow-interactivity-".concat(w))})}}},[i.inert,i.lockRef.current,i.shards]);var s=W.useCallback(function(Y,le){if("touches"in Y&&Y.touches.length===2||Y.type==="wheel"&&Y.ctrlKey)return!P.current.allowPinchZoom;var re=tv(Y),oe=u.current,_e="deltaX"in Y?Y.deltaX:oe[0]-re[0],Ne="deltaY"in Y?Y.deltaY:oe[1]-re[1],Ge,pt=Y.target,ot=Math.abs(_e)>Math.abs(Ne)?"h":"v";if("touches"in Y&&ot==="h"&&pt.type==="range")return!1;var dt=qR(ot,pt);if(!dt)return!0;if(dt?Ge=ot:(Ge=ot==="v"?"h":"v",dt=qR(ot,pt)),!dt)return!1;if(!m.current&&"changedTouches"in Y&&(_e||Ne)&&(m.current=Ge),!Ge)return!0;var Bt=m.current||Ge;return C9(Bt,le,Y,Bt==="h"?_e:Ne,!0)},[]),D=W.useCallback(function(Y){var le=Y;if(!(!jf.length||jf[jf.length-1]!==E)){var re="deltaY"in le?HR(le):tv(le),oe=o.current.filter(function(Ge){return Ge.name===le.type&&(Ge.target===le.target||le.target===Ge.shadowParent)&&I9(Ge.delta,re)})[0];if(oe&&oe.should){le.cancelable&&le.preventDefault();return}if(!oe){var _e=(P.current.shards||[]).map(WR).filter(Boolean).filter(function(Ge){return Ge.contains(le.target)}),Ne=_e.length>0?s(le,_e[0]):!P.current.noIsolation;Ne&&le.cancelable&&le.preventDefault()}}},[]),O=W.useCallback(function(Y,le,re,oe){var _e={name:Y,delta:le,target:re,should:oe,shadowParent:R9(re)};o.current.push(_e),setTimeout(function(){o.current=o.current.filter(function(Ne){return Ne!==_e})},1)},[]),H=W.useCallback(function(Y){u.current=tv(Y),m.current=void 0},[]),G=W.useCallback(function(Y){O(Y.type,HR(Y),Y.target,s(Y,i.lockRef.current))},[]),U=W.useCallback(function(Y){O(Y.type,tv(Y),Y.target,s(Y,i.lockRef.current))},[]);W.useEffect(function(){return jf.push(E),i.setCallbacks({onScrollCapture:G,onWheelCapture:G,onTouchMoveCapture:U}),document.addEventListener("wheel",D,Nf),document.addEventListener("touchmove",D,Nf),document.addEventListener("touchstart",H,Nf),function(){jf=jf.filter(function(Y){return Y!==E}),document.removeEventListener("wheel",D,Nf),document.removeEventListener("touchmove",D,Nf),document.removeEventListener("touchstart",H,Nf)}},[]);var he=i.removeScrollBar,de=i.inert;return W.createElement(W.Fragment,null,de?W.createElement(E,{styles:A9(w)}):null,he?W.createElement(x9,{gapMode:i.gapMode}):null)}function R9(i){for(var o=null;i!==null;)i instanceof ShadowRoot&&(o=i.host,i=i.host),i=i.parentNode;return o}const k9=o9(fz,M9);var OE=W.forwardRef(function(i,o){return W.createElement(K1,Wl({},i,{ref:o,sideCar:k9}))});OE.classNames=K1.classNames;var D9=function(i){if(typeof document>"u")return null;var o=Array.isArray(i)?i[0]:i;return o.ownerDocument.body},zf=new WeakMap,iv=new WeakMap,rv={},G2=0,xz=function(i){return i&&(i.host||xz(i.parentNode))},N9=function(i,o){return o.map(function(u){if(i.contains(u))return u;var m=xz(u);return m&&i.contains(m)?m:(console.error("aria-hidden",u,"in not contained inside",i,". Doing nothing"),null)}).filter(function(u){return!!u})},j9=function(i,o,u,m){var w=N9(o,Array.isArray(i)?i:[i]);rv[u]||(rv[u]=new WeakMap);var E=rv[u],P=[],s=new Set,D=new Set(w),O=function(G){!G||s.has(G)||(s.add(G),O(G.parentNode))};w.forEach(O);var H=function(G){!G||D.has(G)||Array.prototype.forEach.call(G.children,function(U){if(s.has(U))H(U);else try{var he=U.getAttribute(m),de=he!==null&&he!=="false",Y=(zf.get(U)||0)+1,le=(E.get(U)||0)+1;zf.set(U,Y),E.set(U,le),P.push(U),Y===1&&de&&iv.set(U,!0),le===1&&U.setAttribute(u,"true"),de||U.setAttribute(m,"true")}catch(re){console.error("aria-hidden: cannot operate on ",U,re)}})};return H(o),s.clear(),G2++,function(){P.forEach(function(G){var U=zf.get(G)-1,he=E.get(G)-1;zf.set(G,U),E.set(G,he),U||(iv.has(G)||G.removeAttribute(m),iv.delete(G)),he||G.removeAttribute(u)}),G2--,G2||(zf=new WeakMap,zf=new WeakMap,iv=new WeakMap,rv={})}},vz=function(i,o,u){u===void 0&&(u="data-aria-hidden");var m=Array.from(Array.isArray(i)?i:[i]),w=D9(i);return w?(m.push.apply(m,Array.from(w.querySelectorAll("[aria-live]"))),j9(m,w,u,"aria-hidden")):function(){return null}},BE="Dialog",[wz,qH]=Rm(BE),[z9,fl]=wz(BE),bz=i=>{const{__scopeDialog:o,children:u,open:m,defaultOpen:w,onOpenChange:E,modal:P=!0}=i,s=W.useRef(null),D=W.useRef(null),[O=!1,H]=tp({prop:m,defaultProp:w,onChange:E});return _.jsx(z9,{scope:o,triggerRef:s,contentRef:D,contentId:dh(),titleId:dh(),descriptionId:dh(),open:O,onOpenChange:H,onOpenToggle:W.useCallback(()=>H(G=>!G),[H]),modal:P,children:u})};bz.displayName=BE;var Sz="DialogTrigger",Tz=W.forwardRef((i,o)=>{const{__scopeDialog:u,...m}=i,w=fl(Sz,u),E=kn(o,w.triggerRef);return _.jsx(jr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":w.open,"aria-controls":w.contentId,"data-state":GE(w.open),...m,ref:E,onClick:ir(i.onClick,w.onOpenToggle)})});Tz.displayName=Sz;var VE="DialogPortal",[L9,Ez]=wz(VE,{forceMount:void 0}),Cz=i=>{const{__scopeDialog:o,forceMount:u,children:m,container:w}=i,E=fl(VE,o);return _.jsx(L9,{scope:o,forceMount:u,children:W.Children.map(m,P=>_.jsx(up,{present:u||E.open,children:_.jsx(F1,{asChild:!0,container:w,children:P})}))})};Cz.displayName=VE;var v1="DialogOverlay",Iz=W.forwardRef((i,o)=>{const u=Ez(v1,i.__scopeDialog),{forceMount:m=u.forceMount,...w}=i,E=fl(v1,i.__scopeDialog);return E.modal?_.jsx(up,{present:m||E.open,children:_.jsx(F9,{...w,ref:o})}):null});Iz.displayName=v1;var F9=W.forwardRef((i,o)=>{const{__scopeDialog:u,...m}=i,w=fl(v1,u);return _.jsx(OE,{as:ep,allowPinchZoom:!0,shards:[w.contentRef],children:_.jsx(jr.div,{"data-state":GE(w.open),...m,ref:o,style:{pointerEvents:"auto",...m.style}})})}),sp="DialogContent",Az=W.forwardRef((i,o)=>{const u=Ez(sp,i.__scopeDialog),{forceMount:m=u.forceMount,...w}=i,E=fl(sp,i.__scopeDialog);return _.jsx(up,{present:m||E.open,children:E.modal?_.jsx(O9,{...w,ref:o}):_.jsx(B9,{...w,ref:o})})});Az.displayName=sp;var O9=W.forwardRef((i,o)=>{const u=fl(sp,i.__scopeDialog),m=W.useRef(null),w=kn(o,u.contentRef,m);return W.useEffect(()=>{const E=m.current;if(E)return vz(E)},[]),_.jsx(Pz,{...i,ref:w,trapFocus:u.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ir(i.onCloseAutoFocus,E=>{var P;E.preventDefault(),(P=u.triggerRef.current)==null||P.focus()}),onPointerDownOutside:ir(i.onPointerDownOutside,E=>{const P=E.detail.originalEvent,s=P.button===0&&P.ctrlKey===!0;(P.button===2||s)&&E.preventDefault()}),onFocusOutside:ir(i.onFocusOutside,E=>E.preventDefault())})}),B9=W.forwardRef((i,o)=>{const u=fl(sp,i.__scopeDialog),m=W.useRef(!1),w=W.useRef(!1);return _.jsx(Pz,{...i,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:E=>{var P,s;(P=i.onCloseAutoFocus)==null||P.call(i,E),E.defaultPrevented||(m.current||(s=u.triggerRef.current)==null||s.focus(),E.preventDefault()),m.current=!1,w.current=!1},onInteractOutside:E=>{var D,O;(D=i.onInteractOutside)==null||D.call(i,E),E.defaultPrevented||(m.current=!0,E.detail.originalEvent.type==="pointerdown"&&(w.current=!0));const P=E.target;((O=u.triggerRef.current)==null?void 0:O.contains(P))&&E.preventDefault(),E.detail.originalEvent.type==="focusin"&&w.current&&E.preventDefault()}})}),Pz=W.forwardRef((i,o)=>{const{__scopeDialog:u,trapFocus:m,onOpenAutoFocus:w,onCloseAutoFocus:E,...P}=i,s=fl(sp,u),D=W.useRef(null),O=kn(o,D);return hz(),_.jsxs(_.Fragment,{children:[_.jsx(FE,{asChild:!0,loop:!0,trapped:m,onMountAutoFocus:w,onUnmountAutoFocus:E,children:_.jsx(Ay,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":GE(s.open),...P,ref:O,onDismiss:()=>s.onOpenChange(!1)})}),_.jsxs(_.Fragment,{children:[_.jsx(V9,{titleId:s.titleId}),_.jsx(G9,{contentRef:D,descriptionId:s.descriptionId})]})]})}),UE="DialogTitle",Mz=W.forwardRef((i,o)=>{const{__scopeDialog:u,...m}=i,w=fl(UE,u);return _.jsx(jr.h2,{id:w.titleId,...m,ref:o})});Mz.displayName=UE;var Rz="DialogDescription",kz=W.forwardRef((i,o)=>{const{__scopeDialog:u,...m}=i,w=fl(Rz,u);return _.jsx(jr.p,{id:w.descriptionId,...m,ref:o})});kz.displayName=Rz;var Dz="DialogClose",Nz=W.forwardRef((i,o)=>{const{__scopeDialog:u,...m}=i,w=fl(Dz,u);return _.jsx(jr.button,{type:"button",...m,ref:o,onClick:ir(i.onClick,()=>w.onOpenChange(!1))})});Nz.displayName=Dz;function GE(i){return i?"open":"closed"}var jz="DialogTitleWarning",[HH,zz]=i6(jz,{contentName:sp,titleName:UE,docsSlug:"dialog"}),V9=({titleId:i})=>{const o=zz(jz),u=`\`${o.contentName}\` requires a \`${o.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${o.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${o.docsSlug}`;return W.useEffect(()=>{i&&(document.getElementById(i)||console.error(u))},[u,i]),null},U9="DialogDescriptionWarning",G9=({contentRef:i,descriptionId:o})=>{const m=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${zz(U9).contentName}}.`;return W.useEffect(()=>{var E;const w=(E=i.current)==null?void 0:E.getAttribute("aria-describedby");o&&w&&(document.getElementById(o)||console.warn(m))},[m,i,o]),null},$9=bz,q9=Tz,H9=Cz,Lz=Iz,Fz=Az,Oz=Mz,Bz=kz,W9=Nz;const uo=$9,$E=q9,Z9=H9,Vz=W.forwardRef(({className:i,...o},u)=>_.jsx(Lz,{ref:u,className:Zr("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...o}));Vz.displayName=Lz.displayName;const Zs=W.forwardRef(({className:i,children:o,...u},m)=>_.jsxs(Z9,{children:[_.jsx(Vz,{}),_.jsxs(Fz,{ref:m,className:Zr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",i),...u,children:[o,_.jsxs(W9,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[_.jsx(U1,{className:"h-4 w-4"}),_.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Zs.displayName=Fz.displayName;const Xs=({className:i,...o})=>_.jsx("div",{className:Zr("flex flex-col space-y-1.5 text-center sm:text-left",i),...o});Xs.displayName="DialogHeader";const Ys=W.forwardRef(({className:i,...o},u)=>_.jsx(Oz,{ref:u,className:Zr("text-lg font-semibold leading-none tracking-tight",i),...o}));Ys.displayName=Oz.displayName;const qE=W.forwardRef(({className:i,...o},u)=>_.jsx(Bz,{ref:u,className:Zr("text-sm text-muted-foreground",i),...o}));qE.displayName=Bz.displayName;const X9=()=>{const[i,o]=W.useState(null),[u,m]=W.useState(!1),[w,E]=W.useState(!0);W.useEffect(()=>{(async()=>{try{const O=await ao.getPopup();if(O&&O.isActive){o(O);const H=localStorage.getItem("welcomePopupLastShown"),G=new Date().toDateString();H!==G&&m(!0)}}catch(O){console.error("Error fetching popup:",O)}finally{E(!1)}})()},[]);const P=()=>{m(!1),localStorage.setItem("welcomePopupLastShown",new Date().toDateString())},s=()=>{i!=null&&i.link&&window.open(i.link,"_blank"),P()};return w||!i?null:_.jsx(uo,{open:u,onOpenChange:P,children:_.jsx(Zs,{className:"max-w-md p-0 overflow-hidden ",children:_.jsxs("div",{className:"relative",children:[_.jsx(Yt,{variant:"ghost",size:"icon",className:"absolute right-4 top-4 z-10 bg-white/80 hover:bg-white/90",onClick:P,children:_.jsx(U1,{className:"h-4 w-4"})}),_.jsx("div",{className:"aspect-video w-full overflow-hidden",children:_.jsx("img",{src:i.image,alt:i.title,className:"w-full h-full object-cover"})}),_.jsxs("div",{className:"p-8",children:[_.jsxs(Xs,{className:"space-y-4 text-center",children:[_.jsx(Ys,{className:"text-3xl font-bold text-gray-900",children:i.title}),_.jsx(qE,{className:"text-xl font-semibold text-primary",children:i.subject}),_.jsx("p",{className:"text-gray-600 text-lg leading-relaxed max-w-xl mx-auto",children:i.description})]}),_.jsx("div",{className:"flex justify-center mt-8",children:_.jsx(Yt,{onClick:s,size:"lg",children:"Get Started"})})]})]})})})},Y9=()=>{const[i,o]=W.useState([]),[u,m]=W.useState([]),[w,E]=W.useState([]),[P,s]=W.useState([]),[D,O]=W.useState(!0),[H,G]=W.useState(!1),[U,he]=W.useState({heroType:"image",heroImage:"/lovable-uploads/1d16839f-1293-4868-96a6-d3a7e8489861.jpg",heroVideoUrl:"",runningTextCompanies:["TechStars","Y Combinator","Sequoia Capital","Andreessen Horowitz","Google Ventures","Microsoft Ventures","Amazon Web Services","Salesforce Ventures"],collaborators:[{id:"1",name:"Microsoft",logo:"https://logos-world.net/wp-content/uploads/2020/09/Microsoft-Logo.png",website:"https://microsoft.com"},{id:"2",name:"Google Cloud",logo:"https://logos-world.net/wp-content/uploads/2021/02/Google-Cloud-Logo.png",website:"https://cloud.google.com"}]});W.useEffect(()=>{const Y=localStorage.getItem("styleSettings");Y&&he(JSON.parse(Y)),(async()=>{try{const[re,oe,_e,Ne,Ge]=await Promise.all([ao.getServices(),ao.getCaseStudies(),ao.getProducts(),ao.getPopup(),ao.getConsulting()]);o(re.slice(0,3)),m(Ge.slice(0,3)),E(oe.slice(0,2)),s(_e.slice(0,3)),Ne!=null&&Ne.isActive&&G(!0)}catch(re){console.error("Error fetching data:",re)}finally{O(!1)}})()},[]);const de=Y=>({home:Wd,"arrow-up":t1,book:V1,users:Zd})[Y]||Wd;return D?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx(X9,{}),_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[_.jsxs("div",{children:[_.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-6 md:text-4xl",children:["Driving Innovation, Investment, and Ecosystem Growth",_.jsx("span",{className:"gradient-text block",children:"In Emerging Markets"})]}),_.jsx("p",{className:"text-xl  text-gray-600 mb-8 leading-relaxed",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and markets connect."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[_.jsx(Yt,{size:"lg",asChild:!0,children:_.jsx(Nr,{to:"/contact",children:"Start Your Journey"})}),_.jsx(Yt,{variant:"outline",size:"lg",asChild:!0,children:_.jsx("a",{href:"https://www.hubspot.fr/",target:"_blank",rel:"noopener noreferrer",children:"Download Our Brochure"})})]}),_.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-12 pt-8 border-t border-gray-200",children:[_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"text-3xl font-bold text-primary",children:"250+"}),_.jsx("div",{className:"text-sm text-gray-600",children:"Startups Supported"})]}),_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"text-3xl font-bold text-primary",children:"10+"}),_.jsx("div",{className:"text-sm text-gray-600",children:"Innovation Programs"})]}),_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"text-3xl font-bold text-primary",children:"12"}),_.jsx("div",{className:"text-sm text-gray-600",children:"Startups from scratch"})]})]})]}),_.jsxs("div",{className:"rounded-md shadow-xl overflow-hidden transform transition-all duration-500 group-hover:scale-[1.02] group-hover:shadow-2xl",children:[U.heroType==="video"?_.jsx("div",{className:"aspect-video w-full",children:_.jsx("iframe",{src:U.heroVideoUrl.replace("watch?v=","embed/"),title:"Hero Video",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):_.jsx("img",{src:U.heroImage,alt:"Hero",className:"w-full h-72 object-cover"}),_.jsxs("div",{className:"p-6 bg-white",children:[_.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Innovation in Action"}),_.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Where ideas meet execution"})]})]})]})})}),_.jsx(U$,{companies:U.runningTextCompanies}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Mission"}),_.jsx("p",{className:"text-xl text-gray-600 max-w-4xl mx-auto",children:"At Betawaves, we empower nations and industries to thrive by activating three core forces:"})]}),_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:_.jsx(Zd,{className:"h-8 w-8 text-primary"})}),_.jsx("h3",{className:"text-xl font-semibold mb-4",children:"People"}),_.jsx("p",{className:"text-gray-600",children:"We cultivate talent and strengthen human capital through tailored training, mentorship, and workforce development—building the next generation of tech leaders, innovators, and change-makers."})]}),_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:_.jsx(t1,{className:"h-8 w-8 text-primary"})}),_.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Technology"}),_.jsx("p",{className:"text-gray-600",children:"We harness the power of emerging technologies to help startups and enterprises build scalable, efficient, and future-proof solutions across key sectors."})]}),_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:_.jsx(Wd,{className:"h-8 w-8 text-primary"})}),_.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Innovation"}),_.jsx("p",{className:"text-gray-600",children:"We design and drive innovation ecosystems, launch ventures, and enable strategic transformation—working with governments, corporates, and startups to turn bold ideas into real impact."})]})]})]})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Innovation Consulting"}),_.jsx("p",{className:"text-xl text-gray-600",children:"Comprehensive Consultings designed to address every aspect of startup development"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:u.map(Y=>{const le=de(Y.icon);return _.jsxs(Wi,{className:"h-full hover:shadow-lg transition-shadow",children:[_.jsxs(cr,{children:[_.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:_.jsx(le,{className:"h-6 w-6 text-primary"})}),_.jsx(ur,{className:"text-xl",children:Y.title}),_.jsx(Rn,{className:"text-base",children:Y.description})]}),_.jsxs(hr,{children:[_.jsx("ul",{className:"space-y-2 mb-6",children:Y.features.slice(0,3).map((re,oe)=>_.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[_.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),re]},oe))}),_.jsx("div",{className:"space-y-2 text-sm",children:_.jsxs("div",{children:[_.jsx("strong",{children:"Duration : "})," ",Y.eligibility]})})]})]},Y.id)})}),_.jsx("div",{className:"text-center mt-12",children:_.jsx(Yt,{asChild:!0,children:_.jsx(Nr,{to:"/consultings",children:"View All Consultings"})})})]})}),_.jsx("section",{className:"py-20 bg-gray-900 text-white",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Products"}),_.jsx("p",{className:"text-xl text-gray-300",children:"Innovative tools and platforms designed to empower your startup journey"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:P.map(Y=>_.jsxs(Wi,{className:"h-full hover:shadow-lg transition-shadow bg-gray-800 border-gray-700 text-white",children:[_.jsxs(cr,{children:[_.jsxs("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center mb-4",children:[_.jsx(U6,{className:"h-6 w-6 text-primary"})," "]}),_.jsx(ur,{className:"text-xl text-white",children:Y.name}),_.jsx(Rn,{className:"text-base text-gray-300",children:Y.description})]}),_.jsxs(hr,{children:[_.jsxs("div",{className:"mb-6 text-sm text-gray-400",children:[_.jsx("strong",{children:"Price:"})," ",Y.price]}),_.jsx("ul",{className:"space-y-2 text-sm text-gray-300",children:Y.features.slice(0,3).map((le,re)=>_.jsxs("li",{className:"flex items-center",children:[_.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),le]},re))})]})]},Y.id))}),_.jsx("div",{className:"text-center mt-12",children:_.jsx(Yt,{asChild:!0,variant:"secondary",children:_.jsx(Nr,{to:"/products",children:"View All Products"})})})]})}),_.jsxs("section",{className:"py-20 bg-gradient-to-br from-blue-600 via-primary to-cyan-500 text-white relative overflow-hidden",children:[_.jsxs("div",{className:"absolute inset-0 opacity-20",children:[_.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-white/10 rounded-full -translate-x-48 -translate-y-48"}),_.jsx("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-white/5 rounded-full translate-x-40 translate-y-40"}),_.jsxs("svg",{className:"w-full h-full absolute inset-0",viewBox:"0 0 1200 600",preserveAspectRatio:"none",children:[_.jsx("defs",{children:_.jsx("pattern",{id:"wave-pattern",x:"0",y:"0",width:"100",height:"20",patternUnits:"userSpaceOnUse",children:_.jsx("path",{d:"M0,10 Q25,0 50,10 T100,10",stroke:"currentColor",strokeWidth:"0.5",fill:"none",opacity:"0.3"})})}),_.jsx("rect",{width:"100%",height:"100%",fill:"url(#wave-pattern)"})]})]}),_.jsx("div",{className:"container-width section-padding relative z-10",children:_.jsxs("div",{className:"max-w-5xl mx-auto",children:[_.jsxs(Wi,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-500 hover:scale-[1.02] hover:shadow-2xl",children:[_.jsxs(cr,{className:"text-center pb-8",children:[_.jsx("div",{className:"mb-6",children:_.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-white/20 rounded-full text-sm font-medium mb-4",children:[_.jsx(GS,{className:"h-4 w-4 mr-2"}),"Impact Investment Fund"]})}),_.jsxs(ur,{className:"text-3xl md:text-4xl font-bold text-white mb-6 leading-tight",children:["Powering the Future of Sustainability and Climate Tech",_.jsx("span",{className:"block bg-gradient-to-r from-cyan-200 to-white bg-clip-text text-transparent",children:"Across MENA+"})]}),_.jsx(Rn,{className:"text-2xl text-white/95 mb-6 font-medium",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges."}),_.jsx("p",{className:"text-lg text-white/85 max-w-4xl mx-auto leading-relaxed",children:"We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]}),_.jsxs(hr,{children:[_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[_.jsxs("div",{className:"text-center group",children:[_.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:_.jsx(YN,{className:"h-5 w-5 text-white"})}),_.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"$40M Fund Size"}),_.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Targeting sustainability and climate tech startups from ideation to series A"})]}),_.jsxs("div",{className:"text-center group",children:[_.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:_.jsx(Y6,{className:"h-5 w-5 text-white"})}),_.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Regional Focus"}),_.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan"})]}),_.jsxs("div",{className:"text-center group",children:[_.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:_.jsx(GS,{className:"h-5 w-5 text-white"})}),_.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Beyond Capital"}),_.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Venture building, expert guidance, and global network access"})]})]}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[_.jsxs("div",{className:"text-center",children:[_.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Startups"}),_.jsx(Yt,{size:"lg",variant:"secondary",className:"bg-white text-primary hover:bg-white/90 font-semibold px-8 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all",asChild:!0,children:_.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})]}),_.jsxs("div",{className:"text-center",children:[_.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Investors"}),_.jsx(Yt,{size:"lg",variant:"outline",className:"border-2 border-white text-primary hover:bg-white hover:text-primary font-semibold px-8 py-3 rounded-xl transition-all",asChild:!0,children:_.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})]})]})]})]}),_.jsx("div",{className:"text-center mt-12",children:_.jsx(Yt,{asChild:!0,variant:"secondary",size:"lg",className:"bg-white/20 backdrop-blur border-white/30 text-white hover:bg-white hover:text-primary font-semibold rounded-xl",children:_.jsx("a",{href:"https://betaventuresfund1.decilehub.com/",target:"_blank",rel:"noopener noreferrer",children:"Learn More About Betaventures"})})})]})})]}),_.jsx("section",{className:"py-20 ",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Portfolio"}),_.jsx("p",{className:"text-xl text-gray-600",children:"See how we've helped startups achieve remarkable growth and success"})]}),_.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:w.map(Y=>{var le,re;return _.jsxs(Wi,{className:"overflow-hidden",children:[_.jsx("div",{className:"aspect-video",children:_.jsx("img",{src:Y.image,alt:Y.companyName,className:"w-full h-full object-cover"})}),_.jsxs(cr,{children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx(ur,{className:"text-xl",children:Y.companyName}),_.jsx("span",{className:"text-sm text-gray-500",children:Y.industry})]}),_.jsx(Rn,{children:Y.description})]}),_.jsx(hr,{children:((re=(le=Y.testimonial)==null?void 0:le.quote)==null?void 0:re.trim())&&_.jsxs(_.Fragment,{children:[_.jsxs("blockquote",{className:"border-l-4 border-primary pl-4 italic text-gray-600 mb-4",children:['"',Y.testimonial.quote,'"']}),_.jsxs("div",{className:"text-sm",children:[_.jsx("strong",{children:Y.testimonial.author}),_.jsx("div",{className:"text-gray-500",children:Y.testimonial.position})]})]})})]},Y.id)})}),_.jsx("div",{className:"text-center mt-12",children:_.jsx(Yt,{asChild:!0,children:_.jsx(Nr,{to:"/case-studies",children:"View All Case Studies"})})})]})}),_.jsx(V$,{}),_.jsx(G$,{collaborators:U.collaborators}),_.jsx("section",{className:"py-20 bg-primary text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Transform Your Startup?"}),_.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Join hundreds of successful startups who have accelerated their growth with Betawaves. Your journey to success starts here."}),_.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:_.jsx(Yt,{size:"lg",variant:"secondary",asChild:!0,children:_.jsx(Nr,{to:"/contact",children:"Download Brochure"})})})]})})]})},K9=My("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ls({className:i,variant:o,...u}){return _.jsx("div",{className:Zr(K9({variant:o}),i),...u})}const Si=W.forwardRef(({className:i,type:o,...u},m)=>_.jsx("input",{type:o,className:Zr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:m,...u}));Si.displayName="Input";var Q9="Label",Uz=W.forwardRef((i,o)=>_.jsx(jr.label,{...i,ref:o,onMouseDown:u=>{var w;u.target.closest("button, input, select, textarea")||((w=i.onMouseDown)==null||w.call(i,u),!u.defaultPrevented&&u.detail>1&&u.preventDefault())}}));Uz.displayName=Q9;var Gz=Uz;const J9=My("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ft=W.forwardRef(({className:i,...o},u)=>_.jsx(Gz,{ref:u,className:Zr(J9(),i),...o}));Ft.displayName=Gz.displayName;const Xn=W.forwardRef(({className:i,...o},u)=>_.jsx("textarea",{className:Zr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:u,...o}));Xn.displayName="Textarea";function ZR(i,[o,u]){return Math.min(u,Math.max(o,i))}var eq=W.createContext(void 0);function HE(i){const o=W.useContext(eq);return i||o||"ltr"}function $z(i){const o=W.useRef({value:i,previous:i});return W.useMemo(()=>(o.current.value!==i&&(o.current.previous=o.current.value,o.current.value=i),o.current.previous),[i])}var tq=[" ","Enter","ArrowUp","ArrowDown"],iq=[" ","Enter"],Dy="Select",[Q1,J1,rq]=mE(Dy),[zm,WH]=Rm(Dy,[rq,H1]),ew=H1(),[nq,Th]=zm(Dy),[sq,oq]=zm(Dy),qz=i=>{const{__scopeSelect:o,children:u,open:m,defaultOpen:w,onOpenChange:E,value:P,defaultValue:s,onValueChange:D,dir:O,name:H,autoComplete:G,disabled:U,required:he,form:de}=i,Y=ew(o),[le,re]=W.useState(null),[oe,_e]=W.useState(null),[Ne,Ge]=W.useState(!1),pt=HE(O),[ot=!1,dt]=tp({prop:m,defaultProp:w,onChange:E}),[Bt,Wt]=tp({prop:P,defaultProp:s,onChange:D}),Ht=W.useRef(null),ei=le?de||!!le.closest("form"):!0,[xi,It]=W.useState(new Set),ui=Array.from(xi).map(Zt=>Zt.props.value).join(";");return _.jsx(M8,{...Y,children:_.jsxs(nq,{required:he,scope:o,trigger:le,onTriggerChange:re,valueNode:oe,onValueNodeChange:_e,valueNodeHasChildren:Ne,onValueNodeHasChildrenChange:Ge,contentId:dh(),value:Bt,onValueChange:Wt,open:ot,onOpenChange:dt,dir:pt,triggerPointerDownPosRef:Ht,disabled:U,children:[_.jsx(Q1.Provider,{scope:o,children:_.jsx(sq,{scope:i.__scopeSelect,onNativeOptionAdd:W.useCallback(Zt=>{It(Ni=>new Set(Ni).add(Zt))},[]),onNativeOptionRemove:W.useCallback(Zt=>{It(Ni=>{const ct=new Set(Ni);return ct.delete(Zt),ct})},[]),children:u})}),ei?_.jsxs(gL,{"aria-hidden":!0,required:he,tabIndex:-1,name:H,autoComplete:G,value:Bt,onChange:Zt=>Wt(Zt.target.value),disabled:U,form:de,children:[Bt===void 0?_.jsx("option",{value:""}):null,Array.from(xi)]},ui):null]})})};qz.displayName=Dy;var Hz="SelectTrigger",Wz=W.forwardRef((i,o)=>{const{__scopeSelect:u,disabled:m=!1,...w}=i,E=ew(u),P=Th(Hz,u),s=P.disabled||m,D=kn(o,P.onTriggerChange),O=J1(u),H=W.useRef("touch"),[G,U,he]=_L(Y=>{const le=O().filter(_e=>!_e.disabled),re=le.find(_e=>_e.value===P.value),oe=yL(le,Y,re);oe!==void 0&&P.onValueChange(oe.value)}),de=Y=>{s||(P.onOpenChange(!0),he()),Y&&(P.triggerPointerDownPosRef.current={x:Math.round(Y.pageX),y:Math.round(Y.pageY)})};return _.jsx(Aj,{asChild:!0,...E,children:_.jsx(jr.button,{type:"button",role:"combobox","aria-controls":P.contentId,"aria-expanded":P.open,"aria-required":P.required,"aria-autocomplete":"none",dir:P.dir,"data-state":P.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":mL(P.value)?"":void 0,...w,ref:D,onClick:ir(w.onClick,Y=>{Y.currentTarget.focus(),H.current!=="mouse"&&de(Y)}),onPointerDown:ir(w.onPointerDown,Y=>{H.current=Y.pointerType;const le=Y.target;le.hasPointerCapture(Y.pointerId)&&le.releasePointerCapture(Y.pointerId),Y.button===0&&Y.ctrlKey===!1&&Y.pointerType==="mouse"&&(de(Y),Y.preventDefault())}),onKeyDown:ir(w.onKeyDown,Y=>{const le=G.current!=="";!(Y.ctrlKey||Y.altKey||Y.metaKey)&&Y.key.length===1&&U(Y.key),!(le&&Y.key===" ")&&tq.includes(Y.key)&&(de(),Y.preventDefault())})})})});Wz.displayName=Hz;var Zz="SelectValue",Xz=W.forwardRef((i,o)=>{const{__scopeSelect:u,className:m,style:w,children:E,placeholder:P="",...s}=i,D=Th(Zz,u),{onValueNodeHasChildrenChange:O}=D,H=E!==void 0,G=kn(o,D.onValueNodeChange);return co(()=>{O(H)},[O,H]),_.jsx(jr.span,{...s,ref:G,style:{pointerEvents:"none"},children:mL(D.value)?_.jsx(_.Fragment,{children:P}):E})});Xz.displayName=Zz;var aq="SelectIcon",Yz=W.forwardRef((i,o)=>{const{__scopeSelect:u,children:m,...w}=i;return _.jsx(jr.span,{"aria-hidden":!0,...w,ref:o,children:m||"▼"})});Yz.displayName=aq;var lq="SelectPortal",Kz=i=>_.jsx(F1,{asChild:!0,...i});Kz.displayName=lq;var op="SelectContent",Qz=W.forwardRef((i,o)=>{const u=Th(op,i.__scopeSelect),[m,w]=W.useState();if(co(()=>{w(new DocumentFragment)},[]),!u.open){const E=m;return E?cp.createPortal(_.jsx(Jz,{scope:i.__scopeSelect,children:_.jsx(Q1.Slot,{scope:i.__scopeSelect,children:_.jsx("div",{children:i.children})})}),E):null}return _.jsx(eL,{...i,ref:o})});Qz.displayName=op;var rl=10,[Jz,Eh]=zm(op),cq="SelectContentImpl",eL=W.forwardRef((i,o)=>{const{__scopeSelect:u,position:m="item-aligned",onCloseAutoFocus:w,onEscapeKeyDown:E,onPointerDownOutside:P,side:s,sideOffset:D,align:O,alignOffset:H,arrowPadding:G,collisionBoundary:U,collisionPadding:he,sticky:de,hideWhenDetached:Y,avoidCollisions:le,...re}=i,oe=Th(op,u),[_e,Ne]=W.useState(null),[Ge,pt]=W.useState(null),ot=kn(o,hi=>Ne(hi)),[dt,Bt]=W.useState(null),[Wt,Ht]=W.useState(null),ei=J1(u),[xi,It]=W.useState(!1),ui=W.useRef(!1);W.useEffect(()=>{if(_e)return vz(_e)},[_e]),hz();const Zt=W.useCallback(hi=>{const[_i,...ji]=ei().map(nr=>nr.ref.current),[Er]=ji.slice(-1),wr=document.activeElement;for(const nr of hi)if(nr===wr||(nr==null||nr.scrollIntoView({block:"nearest"}),nr===_i&&Ge&&(Ge.scrollTop=0),nr===Er&&Ge&&(Ge.scrollTop=Ge.scrollHeight),nr==null||nr.focus(),document.activeElement!==wr))return},[ei,Ge]),Ni=W.useCallback(()=>Zt([dt,_e]),[Zt,dt,_e]);W.useEffect(()=>{xi&&Ni()},[xi,Ni]);const{onOpenChange:ct,triggerPointerDownPosRef:Vt}=oe;W.useEffect(()=>{if(_e){let hi={x:0,y:0};const _i=Er=>{var wr,nr;hi={x:Math.abs(Math.round(Er.pageX)-(((wr=Vt.current)==null?void 0:wr.x)??0)),y:Math.abs(Math.round(Er.pageY)-(((nr=Vt.current)==null?void 0:nr.y)??0))}},ji=Er=>{hi.x<=10&&hi.y<=10?Er.preventDefault():_e.contains(Er.target)||ct(!1),document.removeEventListener("pointermove",_i),Vt.current=null};return Vt.current!==null&&(document.addEventListener("pointermove",_i),document.addEventListener("pointerup",ji,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",_i),document.removeEventListener("pointerup",ji,{capture:!0})}}},[_e,ct,Vt]),W.useEffect(()=>{const hi=()=>ct(!1);return window.addEventListener("blur",hi),window.addEventListener("resize",hi),()=>{window.removeEventListener("blur",hi),window.removeEventListener("resize",hi)}},[ct]);const[Gt,ti]=_L(hi=>{const _i=ei().filter(wr=>!wr.disabled),ji=_i.find(wr=>wr.ref.current===document.activeElement),Er=yL(_i,hi,ji);Er&&setTimeout(()=>Er.ref.current.focus())}),vi=W.useCallback((hi,_i,ji)=>{const Er=!ui.current&&!ji;(oe.value!==void 0&&oe.value===_i||Er)&&(Bt(hi),Er&&(ui.current=!0))},[oe.value]),Ki=W.useCallback(()=>_e==null?void 0:_e.focus(),[_e]),Zi=W.useCallback((hi,_i,ji)=>{const Er=!ui.current&&!ji;(oe.value!==void 0&&oe.value===_i||Er)&&Ht(hi)},[oe.value]),Hi=m==="popper"?fT:tL,Ii=Hi===fT?{side:s,sideOffset:D,align:O,alignOffset:H,arrowPadding:G,collisionBoundary:U,collisionPadding:he,sticky:de,hideWhenDetached:Y,avoidCollisions:le}:{};return _.jsx(Jz,{scope:u,content:_e,viewport:Ge,onViewportChange:pt,itemRefCallback:vi,selectedItem:dt,onItemLeave:Ki,itemTextRefCallback:Zi,focusSelectedItem:Ni,selectedItemText:Wt,position:m,isPositioned:xi,searchRef:Gt,children:_.jsx(OE,{as:ep,allowPinchZoom:!0,children:_.jsx(FE,{asChild:!0,trapped:oe.open,onMountAutoFocus:hi=>{hi.preventDefault()},onUnmountAutoFocus:ir(w,hi=>{var _i;(_i=oe.trigger)==null||_i.focus({preventScroll:!0}),hi.preventDefault()}),children:_.jsx(Ay,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:E,onPointerDownOutside:P,onFocusOutside:hi=>hi.preventDefault(),onDismiss:()=>oe.onOpenChange(!1),children:_.jsx(Hi,{role:"listbox",id:oe.contentId,"data-state":oe.open?"open":"closed",dir:oe.dir,onContextMenu:hi=>hi.preventDefault(),...re,...Ii,onPlaced:()=>It(!0),ref:ot,style:{display:"flex",flexDirection:"column",outline:"none",...re.style},onKeyDown:ir(re.onKeyDown,hi=>{const _i=hi.ctrlKey||hi.altKey||hi.metaKey;if(hi.key==="Tab"&&hi.preventDefault(),!_i&&hi.key.length===1&&ti(hi.key),["ArrowUp","ArrowDown","Home","End"].includes(hi.key)){let Er=ei().filter(wr=>!wr.disabled).map(wr=>wr.ref.current);if(["ArrowUp","End"].includes(hi.key)&&(Er=Er.slice().reverse()),["ArrowUp","ArrowDown"].includes(hi.key)){const wr=hi.target,nr=Er.indexOf(wr);Er=Er.slice(nr+1)}setTimeout(()=>Zt(Er)),hi.preventDefault()}})})})})})})});eL.displayName=cq;var uq="SelectItemAlignedPosition",tL=W.forwardRef((i,o)=>{const{__scopeSelect:u,onPlaced:m,...w}=i,E=Th(op,u),P=Eh(op,u),[s,D]=W.useState(null),[O,H]=W.useState(null),G=kn(o,ot=>H(ot)),U=J1(u),he=W.useRef(!1),de=W.useRef(!0),{viewport:Y,selectedItem:le,selectedItemText:re,focusSelectedItem:oe}=P,_e=W.useCallback(()=>{if(E.trigger&&E.valueNode&&s&&O&&Y&&le&&re){const ot=E.trigger.getBoundingClientRect(),dt=O.getBoundingClientRect(),Bt=E.valueNode.getBoundingClientRect(),Wt=re.getBoundingClientRect();if(E.dir!=="rtl"){const wr=Wt.left-dt.left,nr=Bt.left-wr,dr=ot.left-nr,Ln=ot.width+dr,ns=Math.max(Ln,dt.width),pn=window.innerWidth-rl,ys=ZR(nr,[rl,Math.max(rl,pn-ns)]);s.style.minWidth=Ln+"px",s.style.left=ys+"px"}else{const wr=dt.right-Wt.right,nr=window.innerWidth-Bt.right-wr,dr=window.innerWidth-ot.right-nr,Ln=ot.width+dr,ns=Math.max(Ln,dt.width),pn=window.innerWidth-rl,ys=ZR(nr,[rl,Math.max(rl,pn-ns)]);s.style.minWidth=Ln+"px",s.style.right=ys+"px"}const Ht=U(),ei=window.innerHeight-rl*2,xi=Y.scrollHeight,It=window.getComputedStyle(O),ui=parseInt(It.borderTopWidth,10),Zt=parseInt(It.paddingTop,10),Ni=parseInt(It.borderBottomWidth,10),ct=parseInt(It.paddingBottom,10),Vt=ui+Zt+xi+ct+Ni,Gt=Math.min(le.offsetHeight*5,Vt),ti=window.getComputedStyle(Y),vi=parseInt(ti.paddingTop,10),Ki=parseInt(ti.paddingBottom,10),Zi=ot.top+ot.height/2-rl,Hi=ei-Zi,Ii=le.offsetHeight/2,hi=le.offsetTop+Ii,_i=ui+Zt+hi,ji=Vt-_i;if(_i<=Zi){const wr=Ht.length>0&&le===Ht[Ht.length-1].ref.current;s.style.bottom="0px";const nr=O.clientHeight-Y.offsetTop-Y.offsetHeight,dr=Math.max(Hi,Ii+(wr?Ki:0)+nr+Ni),Ln=_i+dr;s.style.height=Ln+"px"}else{const wr=Ht.length>0&&le===Ht[0].ref.current;s.style.top="0px";const dr=Math.max(Zi,ui+Y.offsetTop+(wr?vi:0)+Ii)+ji;s.style.height=dr+"px",Y.scrollTop=_i-Zi+Y.offsetTop}s.style.margin=`${rl}px 0`,s.style.minHeight=Gt+"px",s.style.maxHeight=ei+"px",m==null||m(),requestAnimationFrame(()=>he.current=!0)}},[U,E.trigger,E.valueNode,s,O,Y,le,re,E.dir,m]);co(()=>_e(),[_e]);const[Ne,Ge]=W.useState();co(()=>{O&&Ge(window.getComputedStyle(O).zIndex)},[O]);const pt=W.useCallback(ot=>{ot&&de.current===!0&&(_e(),oe==null||oe(),de.current=!1)},[_e,oe]);return _.jsx(dq,{scope:u,contentWrapper:s,shouldExpandOnScrollRef:he,onScrollButtonChange:pt,children:_.jsx("div",{ref:D,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Ne},children:_.jsx(jr.div,{...w,ref:G,style:{boxSizing:"border-box",maxHeight:"100%",...w.style}})})})});tL.displayName=uq;var hq="SelectPopperPosition",fT=W.forwardRef((i,o)=>{const{__scopeSelect:u,align:m="start",collisionPadding:w=rl,...E}=i,P=ew(u);return _.jsx(Pj,{...P,...E,ref:o,align:m,collisionPadding:w,style:{boxSizing:"border-box",...E.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});fT.displayName=hq;var[dq,WE]=zm(op,{}),mT="SelectViewport",iL=W.forwardRef((i,o)=>{const{__scopeSelect:u,nonce:m,...w}=i,E=Eh(mT,u),P=WE(mT,u),s=kn(o,E.onViewportChange),D=W.useRef(0);return _.jsxs(_.Fragment,{children:[_.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:m}),_.jsx(Q1.Slot,{scope:u,children:_.jsx(jr.div,{"data-radix-select-viewport":"",role:"presentation",...w,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...w.style},onScroll:ir(w.onScroll,O=>{const H=O.currentTarget,{contentWrapper:G,shouldExpandOnScrollRef:U}=P;if(U!=null&&U.current&&G){const he=Math.abs(D.current-H.scrollTop);if(he>0){const de=window.innerHeight-rl*2,Y=parseFloat(G.style.minHeight),le=parseFloat(G.style.height),re=Math.max(Y,le);if(re<de){const oe=re+he,_e=Math.min(de,oe),Ne=oe-_e;G.style.height=_e+"px",G.style.bottom==="0px"&&(H.scrollTop=Ne>0?Ne:0,G.style.justifyContent="flex-end")}}}D.current=H.scrollTop})})})]})});iL.displayName=mT;var rL="SelectGroup",[pq,fq]=zm(rL),mq=W.forwardRef((i,o)=>{const{__scopeSelect:u,...m}=i,w=dh();return _.jsx(pq,{scope:u,id:w,children:_.jsx(jr.div,{role:"group","aria-labelledby":w,...m,ref:o})})});mq.displayName=rL;var nL="SelectLabel",sL=W.forwardRef((i,o)=>{const{__scopeSelect:u,...m}=i,w=fq(nL,u);return _.jsx(jr.div,{id:w.id,...m,ref:o})});sL.displayName=nL;var w1="SelectItem",[gq,oL]=zm(w1),aL=W.forwardRef((i,o)=>{const{__scopeSelect:u,value:m,disabled:w=!1,textValue:E,...P}=i,s=Th(w1,u),D=Eh(w1,u),O=s.value===m,[H,G]=W.useState(E??""),[U,he]=W.useState(!1),de=kn(o,oe=>{var _e;return(_e=D.itemRefCallback)==null?void 0:_e.call(D,oe,m,w)}),Y=dh(),le=W.useRef("touch"),re=()=>{w||(s.onValueChange(m),s.onOpenChange(!1))};if(m==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return _.jsx(gq,{scope:u,value:m,disabled:w,textId:Y,isSelected:O,onItemTextChange:W.useCallback(oe=>{G(_e=>_e||((oe==null?void 0:oe.textContent)??"").trim())},[]),children:_.jsx(Q1.ItemSlot,{scope:u,value:m,disabled:w,textValue:H,children:_.jsx(jr.div,{role:"option","aria-labelledby":Y,"data-highlighted":U?"":void 0,"aria-selected":O&&U,"data-state":O?"checked":"unchecked","aria-disabled":w||void 0,"data-disabled":w?"":void 0,tabIndex:w?void 0:-1,...P,ref:de,onFocus:ir(P.onFocus,()=>he(!0)),onBlur:ir(P.onBlur,()=>he(!1)),onClick:ir(P.onClick,()=>{le.current!=="mouse"&&re()}),onPointerUp:ir(P.onPointerUp,()=>{le.current==="mouse"&&re()}),onPointerDown:ir(P.onPointerDown,oe=>{le.current=oe.pointerType}),onPointerMove:ir(P.onPointerMove,oe=>{var _e;le.current=oe.pointerType,w?(_e=D.onItemLeave)==null||_e.call(D):le.current==="mouse"&&oe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ir(P.onPointerLeave,oe=>{var _e;oe.currentTarget===document.activeElement&&((_e=D.onItemLeave)==null||_e.call(D))}),onKeyDown:ir(P.onKeyDown,oe=>{var Ne;((Ne=D.searchRef)==null?void 0:Ne.current)!==""&&oe.key===" "||(iq.includes(oe.key)&&re(),oe.key===" "&&oe.preventDefault())})})})})});aL.displayName=w1;var O_="SelectItemText",lL=W.forwardRef((i,o)=>{const{__scopeSelect:u,className:m,style:w,...E}=i,P=Th(O_,u),s=Eh(O_,u),D=oL(O_,u),O=oq(O_,u),[H,G]=W.useState(null),U=kn(o,re=>G(re),D.onItemTextChange,re=>{var oe;return(oe=s.itemTextRefCallback)==null?void 0:oe.call(s,re,D.value,D.disabled)}),he=H==null?void 0:H.textContent,de=W.useMemo(()=>_.jsx("option",{value:D.value,disabled:D.disabled,children:he},D.value),[D.disabled,D.value,he]),{onNativeOptionAdd:Y,onNativeOptionRemove:le}=O;return co(()=>(Y(de),()=>le(de)),[Y,le,de]),_.jsxs(_.Fragment,{children:[_.jsx(jr.span,{id:D.textId,...E,ref:U}),D.isSelected&&P.valueNode&&!P.valueNodeHasChildren?cp.createPortal(E.children,P.valueNode):null]})});lL.displayName=O_;var cL="SelectItemIndicator",uL=W.forwardRef((i,o)=>{const{__scopeSelect:u,...m}=i;return oL(cL,u).isSelected?_.jsx(jr.span,{"aria-hidden":!0,...m,ref:o}):null});uL.displayName=cL;var gT="SelectScrollUpButton",hL=W.forwardRef((i,o)=>{const u=Eh(gT,i.__scopeSelect),m=WE(gT,i.__scopeSelect),[w,E]=W.useState(!1),P=kn(o,m.onScrollButtonChange);return co(()=>{if(u.viewport&&u.isPositioned){let s=function(){const O=D.scrollTop>0;E(O)};const D=u.viewport;return s(),D.addEventListener("scroll",s),()=>D.removeEventListener("scroll",s)}},[u.viewport,u.isPositioned]),w?_.jsx(pL,{...i,ref:P,onAutoScroll:()=>{const{viewport:s,selectedItem:D}=u;s&&D&&(s.scrollTop=s.scrollTop-D.offsetHeight)}}):null});hL.displayName=gT;var _T="SelectScrollDownButton",dL=W.forwardRef((i,o)=>{const u=Eh(_T,i.__scopeSelect),m=WE(_T,i.__scopeSelect),[w,E]=W.useState(!1),P=kn(o,m.onScrollButtonChange);return co(()=>{if(u.viewport&&u.isPositioned){let s=function(){const O=D.scrollHeight-D.clientHeight,H=Math.ceil(D.scrollTop)<O;E(H)};const D=u.viewport;return s(),D.addEventListener("scroll",s),()=>D.removeEventListener("scroll",s)}},[u.viewport,u.isPositioned]),w?_.jsx(pL,{...i,ref:P,onAutoScroll:()=>{const{viewport:s,selectedItem:D}=u;s&&D&&(s.scrollTop=s.scrollTop+D.offsetHeight)}}):null});dL.displayName=_T;var pL=W.forwardRef((i,o)=>{const{__scopeSelect:u,onAutoScroll:m,...w}=i,E=Eh("SelectScrollButton",u),P=W.useRef(null),s=J1(u),D=W.useCallback(()=>{P.current!==null&&(window.clearInterval(P.current),P.current=null)},[]);return W.useEffect(()=>()=>D(),[D]),co(()=>{var H;const O=s().find(G=>G.ref.current===document.activeElement);(H=O==null?void 0:O.ref.current)==null||H.scrollIntoView({block:"nearest"})},[s]),_.jsx(jr.div,{"aria-hidden":!0,...w,ref:o,style:{flexShrink:0,...w.style},onPointerDown:ir(w.onPointerDown,()=>{P.current===null&&(P.current=window.setInterval(m,50))}),onPointerMove:ir(w.onPointerMove,()=>{var O;(O=E.onItemLeave)==null||O.call(E),P.current===null&&(P.current=window.setInterval(m,50))}),onPointerLeave:ir(w.onPointerLeave,()=>{D()})})}),_q="SelectSeparator",fL=W.forwardRef((i,o)=>{const{__scopeSelect:u,...m}=i;return _.jsx(jr.div,{"aria-hidden":!0,...m,ref:o})});fL.displayName=_q;var yT="SelectArrow",yq=W.forwardRef((i,o)=>{const{__scopeSelect:u,...m}=i,w=ew(u),E=Th(yT,u),P=Eh(yT,u);return E.open&&P.position==="popper"?_.jsx(Mj,{...w,...m,ref:o}):null});yq.displayName=yT;function mL(i){return i===""||i===void 0}var gL=W.forwardRef((i,o)=>{const{value:u,...m}=i,w=W.useRef(null),E=kn(o,w),P=$z(u);return W.useEffect(()=>{const s=w.current,D=window.HTMLSelectElement.prototype,H=Object.getOwnPropertyDescriptor(D,"value").set;if(P!==u&&H){const G=new Event("change",{bubbles:!0});H.call(s,u),s.dispatchEvent(G)}},[P,u]),_.jsx(Py,{asChild:!0,children:_.jsx("select",{...m,ref:E,defaultValue:u})})});gL.displayName="BubbleSelect";function _L(i){const o=Ho(i),u=W.useRef(""),m=W.useRef(0),w=W.useCallback(P=>{const s=u.current+P;o(s),function D(O){u.current=O,window.clearTimeout(m.current),O!==""&&(m.current=window.setTimeout(()=>D(""),1e3))}(s)},[o]),E=W.useCallback(()=>{u.current="",window.clearTimeout(m.current)},[]);return W.useEffect(()=>()=>window.clearTimeout(m.current),[]),[u,w,E]}function yL(i,o,u){const w=o.length>1&&Array.from(o).every(O=>O===o[0])?o[0]:o,E=u?i.indexOf(u):-1;let P=xq(i,Math.max(E,0));w.length===1&&(P=P.filter(O=>O!==u));const D=P.find(O=>O.textValue.toLowerCase().startsWith(w.toLowerCase()));return D!==u?D:void 0}function xq(i,o){return i.map((u,m)=>i[(o+m)%i.length])}var vq=qz,xL=Wz,wq=Xz,bq=Yz,Sq=Kz,vL=Qz,Tq=iL,wL=sL,bL=aL,Eq=lL,Cq=uL,SL=hL,TL=dL,EL=fL;const $c=vq,qc=wq,Ql=W.forwardRef(({className:i,children:o,...u},m)=>_.jsxs(xL,{ref:m,className:Zr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",i),...u,children:[o,_.jsx(bq,{asChild:!0,children:_.jsx(ZN,{className:"h-4 w-4 opacity-50"})})]}));Ql.displayName=xL.displayName;const CL=W.forwardRef(({className:i,...o},u)=>_.jsx(SL,{ref:u,className:Zr("flex cursor-default items-center justify-center py-1",i),...o,children:_.jsx(H6,{className:"h-4 w-4"})}));CL.displayName=SL.displayName;const IL=W.forwardRef(({className:i,...o},u)=>_.jsx(TL,{ref:u,className:Zr("flex cursor-default items-center justify-center py-1",i),...o,children:_.jsx(ZN,{className:"h-4 w-4"})}));IL.displayName=TL.displayName;const Jl=W.forwardRef(({className:i,children:o,position:u="popper",...m},w)=>_.jsx(Sq,{children:_.jsxs(vL,{ref:w,className:Zr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",u==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:u,...m,children:[_.jsx(CL,{}),_.jsx(Tq,{className:Zr("p-1",u==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),_.jsx(IL,{})]})}));Jl.displayName=vL.displayName;const Iq=W.forwardRef(({className:i,...o},u)=>_.jsx(wL,{ref:u,className:Zr("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...o}));Iq.displayName=wL.displayName;const Cn=W.forwardRef(({className:i,children:o,...u},m)=>_.jsxs(bL,{ref:m,className:Zr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",i),...u,children:[_.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:_.jsx(Cq,{children:_.jsx(q6,{className:"h-4 w-4"})})}),_.jsx(Eq,{children:o})]}));Cn.displayName=bL.displayName;const Aq=W.forwardRef(({className:i,...o},u)=>_.jsx(EL,{ref:u,className:Zr("-mx-1 my-1 h-px bg-muted",i),...o}));Aq.displayName=EL.displayName;const Pq=({serviceName:i})=>{const[o,u]=W.useState(!1),[m,w]=W.useState({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""}),{toast:E}=Iy(),P=D=>{D.preventDefault(),console.log("Service application submitted:",{serviceName:i,...m}),E({title:"Application Submitted",description:`Your application for ${i} has been submitted successfully. We'll contact you soon.`}),u(!1),w({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""})},s=(D,O)=>{w(H=>({...H,[D]:O}))};return _.jsxs(uo,{open:o,onOpenChange:u,children:[_.jsx($E,{asChild:!0,children:_.jsxs(Yt,{className:"w-full",children:["Apply for ",i]})}),_.jsxs(Zs,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[_.jsxs(Xs,{children:[_.jsxs(Ys,{children:["Apply for ",i]}),_.jsxs(qE,{children:["Fill out this form to apply for our ",i," program. We'll review your application and get back to you within 48 hours."]})]}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"email",children:"Professional Email *"}),_.jsx(Si,{id:"email",type:"email",value:m.email,onChange:D=>s("email",D.target.value),placeholder:"your@company.com",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"fullName",children:"Full Name *"}),_.jsx(Si,{id:"fullName",value:m.fullName,onChange:D=>s("fullName",D.target.value),placeholder:"John Doe",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"company",children:"Company/Startup Name"}),_.jsx(Si,{id:"company",value:m.company,onChange:D=>s("company",D.target.value),placeholder:"Your Company Name"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"position",children:"Position/Role *"}),_.jsxs($c,{onValueChange:D=>s("position",D),required:!0,children:[_.jsx(Ql,{children:_.jsx(qc,{placeholder:"Select your role"})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"founder",children:"Founder/Co-founder"}),_.jsx(Cn,{value:"ceo",children:"CEO"}),_.jsx(Cn,{value:"cto",children:"CTO"}),_.jsx(Cn,{value:"entrepreneur",children:"Entrepreneur"}),_.jsx(Cn,{value:"business-owner",children:"Business Owner"}),_.jsx(Cn,{value:"other",children:"Other"})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"phoneNumber",children:"Phone Number"}),_.jsx(Si,{id:"phoneNumber",type:"tel",value:m.phoneNumber,onChange:D=>s("phoneNumber",D.target.value),placeholder:"+1 (555) 123-4567"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"experience",children:"Years of Experience *"}),_.jsxs($c,{onValueChange:D=>s("experience",D),required:!0,children:[_.jsx(Ql,{children:_.jsx(qc,{placeholder:"Select experience level"})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"0-1",children:"0-1 years"}),_.jsx(Cn,{value:"2-5",children:"2-5 years"}),_.jsx(Cn,{value:"6-10",children:"6-10 years"}),_.jsx(Cn,{value:"10+",children:"10+ years"})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"motivation",children:"Why are you interested in this program? *"}),_.jsx(Xn,{id:"motivation",value:m.motivation,onChange:D=>s("motivation",D.target.value),placeholder:"Tell us about your goals and how this program fits into your plans...",className:"min-h-[80px]",required:!0})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"button",variant:"outline",onClick:()=>u(!1),className:"flex-1",children:"Cancel"}),_.jsx(Yt,{type:"submit",className:"flex-1",children:"Submit Application"})]})]})]})]})},Mq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState(!0);W.useEffect(()=>{(async()=>{try{const P=await ao.getServices();o(P)}catch(P){console.error("Error fetching services:",P)}finally{m(!1)}})()},[]);const w=E=>({home:Wd,"arrow-up":t1,book:V1,users:Zd})[E]||Wd;return u?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",_.jsx("span",{className:"gradient-text",children:"Programs"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Comprehensive support programs designed to accelerate your startup's growth at every stage. From ideation to scaling, we provide the resources, mentorship, and networks you need to succeed."})]})})}),_.jsx("section",{className:"py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"grid grid-cols-1 gap-12",children:i.map((E,P)=>{const s=w(E.icon);return _.jsx(Wi,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 ${P%2===1?"lg:flex-row-reverse":""}`,children:_.jsxs("div",{className:"lg:flex",children:[_.jsx("div",{className:"lg:w-1/3 bg-primary/5 flex items-center justify-center p-12",children:_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-2xl flex items-center justify-center mx-auto mb-6",children:_.jsx(s,{className:"h-12 w-12 text-primary"})}),_.jsx(Ls,{variant:"secondary",className:"text-sm",children:E.duration})]})}),_.jsxs("div",{className:"lg:w-2/3 p-8",children:[_.jsxs(cr,{className:"p-0 mb-6",children:[_.jsx(ur,{className:"text-2xl mb-2",children:E.title}),_.jsx(Rn,{className:"text-base text-gray-600",children:E.description})]}),_.jsxs(hr,{className:"p-0 space-y-6",children:[_.jsxs("div",{children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"What You'll Get:"}),_.jsx("ul",{className:"space-y-2",children:E.features.map((D,O)=>_.jsxs("li",{className:"flex items-start text-gray-600",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{className:"text-sm",children:D})]},O))})]}),_.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Ideal For:"}),_.jsx("p",{className:"text-sm text-gray-600",children:E.eligibility})]}),_.jsx("div",{className:"pt-4 border-t border-gray-100",children:_.jsx(Pq,{serviceName:E.title})})]})]})]})},E.id)})})})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Process"}),_.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"A proven methodology that takes your startup from concept to success"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[{step:"01",title:"Application",description:"Submit your application with your startup idea and current stage"},{step:"02",title:"Assessment",description:"Our experts evaluate your potential and fit for our programs"},{step:"03",title:"Matching",description:"We connect you with the right program, mentors, and resources"},{step:"04",title:"Growth",description:"Execute your growth plan with continuous support and guidance"}].map((E,P)=>_.jsxs("div",{className:"text-center relative",children:[_.jsx("div",{className:"w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold",children:E.step}),_.jsx("h3",{className:"text-lg font-semibold mb-2",children:E.title}),_.jsx("p",{className:"text-gray-600 text-sm",children:E.description}),P<3&&_.jsx("div",{className:"hidden md:block absolute top-8 left-full w-full h-0.5 bg-gray-300 transform -translate-x-1/2"})]},P))})]})}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsx("div",{className:"text-center mb-16",children:_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Frequently Asked Questions"})}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[{question:"What stage startups do you work with?",answer:"We support startups at all stages, from pre-seed ideas to Series A companies looking to scale."},{question:"Do you take equity in startups?",answer:"Our equity requirements vary by program. Some programs are equity-free, while others involve small equity stakes in exchange for funding."},{question:"How long are the programs?",answer:"Program duration varies from 2 weeks for intensive bootcamps to 12 months for comprehensive incubation programs."},{question:"What kind of support do you provide?",answer:"We provide mentorship, funding connections, technical resources, legal guidance, and access to our extensive network of partners and investors."}].map((E,P)=>_.jsxs(Wi,{className:"p-6",children:[_.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:E.question}),_.jsx("p",{className:"text-gray-600 text-sm",children:E.answer})]},P))})]})}),_.jsx("section",{className:"py-20 bg-primary text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Get Started?"}),_.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Take the first step towards transforming your startup. Apply to our programs today."}),_.jsx(Yt,{size:"lg",variant:"secondary",children:"Apply Now"})]})})]})},Rq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState([]),[w,E]=W.useState("all"),[P,s]=W.useState(!0);W.useEffect(()=>{(async()=>{try{const G=await ao.getConsulting();o(G),m(G)}catch(G){console.error("Error fetching consultings:",G)}finally{s(!1)}})()},[]),W.useEffect(()=>{m(w==="all"?i:i.filter(H=>H.category===w))},[w,i]);const D=H=>({home:Wd,"arrow-up":t1,book:V1,users:Zd})[H]||Wd,O=[{value:"all",label:"All Categories"},{value:"strategy",label:"Strategy"},{value:"product",label:"Product"},{value:"marketing",label:"Marketing"},{value:"funding",label:"Funding"}];return P?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen bg-gray-50",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",_.jsx("span",{className:"gradient-text",children:"Consulting Services"})]}),_.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8",children:"Tailored innovation consulting designed to help your startup tackle strategic, product, marketing, or funding challenges."})]})}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"flex justify-between items-center mb-8",children:[_.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Consultings"}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),_.jsxs($c,{value:w,onValueChange:E,children:[_.jsx(Ql,{className:"w-48",children:_.jsx(qc,{placeholder:"Select category"})}),_.jsx(Jl,{children:O.map(H=>_.jsx(Cn,{value:H.value,children:H.label},H.value))})]})]})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:u.map(H=>{const G=D(H.icon);return _.jsxs(Wi,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[_.jsxs(cr,{children:[_.jsxs("div",{className:"flex items-start justify-between mb-4",children:[_.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:_.jsx(G,{className:"h-6 w-6 text-primary"})}),_.jsx(Ls,{variant:"secondary",className:"capitalize",children:H.category})]}),_.jsx(ur,{className:"text-xl",children:H.title}),_.jsx(Rn,{className:"text-base",children:H.description})]}),_.jsxs(hr,{className:"flex flex-col flex-grow justify-between",children:[_.jsxs("div",{children:[_.jsx("ul",{className:"space-y-2 mb-6",children:H.features.map((U,he)=>_.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[_.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),U]},he))}),_.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:[_.jsx("strong",{children:"Eligibility:"})," ",H.eligibility]})]}),_.jsx(Nr,{to:"/contact",className:"w-full mt-auto",children:_.jsx(Yt,{className:"w-full",children:"Contact Us"})})]})]},H.id)})}),u.length===0&&_.jsx("div",{className:"text-center py-12",children:_.jsx("p",{className:"text-gray-500",children:"No consulting services found for the selected category."})})]})}),_.jsx("section",{className:"py-20 bg-primary text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Need Strategic Support?"}),_.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Book a consulting session with our experts and take the next step in your startup's innovation journey."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[_.jsx(Yt,{size:"lg",variant:"secondary",children:_.jsx(Nr,{to:"/contact",children:"Book a session"})}),_.jsx(Yt,{size:"lg",variant:"secondary",children:_.jsx(Nr,{to:"/case-studies",children:"Download our brochure"})})]})]})})]})},kq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState([]),[w,E]=W.useState("all"),[P,s]=W.useState(!0);W.useEffect(()=>{(async()=>{try{const G=await ao.getProducts();o(G),m(G)}catch(G){console.error("Error fetching products:",G)}finally{s(!1)}})()},[]),W.useEffect(()=>{m(w==="all"?i:i.filter(H=>H.category===w))},[w,i]);const D=[{value:"all",label:"All Categories"},{value:"Software",label:"Software"},{value:"Service",label:"Service"},{value:"Analytics",label:"Analytics"}],O=H=>{switch(H){case"active":return _.jsx(Ls,{className:"bg-green-100 text-green-800",children:"Available"});case"coming-soon":return _.jsx(Ls,{className:"bg-blue-100 text-blue-800",children:"Coming Soon"});case"inactive":return _.jsx(Ls,{className:"bg-gray-100 text-gray-800",children:"Inactive"});default:return null}};return P?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",_.jsx("span",{className:"gradient-text",children:"Products"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Innovative tools and platforms designed to empower startups, investors, and organizations with data-driven insights and comprehensive evaluation frameworks."})]})})}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"flex justify-between items-center mb-8",children:[_.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Products"}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),_.jsxs($c,{value:w,onValueChange:E,children:[_.jsx(Ql,{className:"w-48",children:_.jsx(qc,{placeholder:"Select category"})}),_.jsx(Jl,{children:D.map(H=>_.jsx(Cn,{value:H.value,children:H.label},H.value))})]})]})]}),_.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:u.map(H=>_.jsxs(Wi,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[_.jsxs(cr,{children:[_.jsxs("div",{className:"flex justify-between items-start mb-4",children:[_.jsx(Ls,{variant:"outline",children:H.category}),O(H.status)]}),_.jsx(ur,{className:"text-2xl",children:H.name}),_.jsx(Rn,{className:"text-base leading-relaxed",children:H.description}),_.jsx("div",{className:"text-xl font-bold text-primary mt-2",children:H.price})]}),_.jsxs(hr,{className:"flex flex-col flex-grow justify-between",children:[_.jsxs("div",{className:"mb-6",children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Features:"}),_.jsx("ul",{className:"space-y-2",children:H.features.map((G,U)=>_.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[_.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),G]},U))})]}),_.jsx(Yt,{className:"w-full mt-auto",disabled:H.status!=="active",onClick:()=>{H.status==="active"&&H.image&&window.open(H.image,"_blank")},children:H.status==="coming-soon"?"Coming Soon":"Get Started"})]})]},H.id))}),u.length===0&&_.jsx("div",{className:"text-center py-12",children:_.jsx("p",{className:"text-gray-500",children:"No products found for the selected category."})})]})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Ready to Explore Our Products?"}),_.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Get in touch with our team to learn more about how our products can support your startup journey or investment decisions."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[_.jsx(Yt,{size:"lg",asChild:!0,children:_.jsx(Nr,{to:"/contact",children:"Contact Us"})}),_.jsx(Yt,{size:"lg",variant:"outline",asChild:!0,children:_.jsx(Nr,{to:"/resources",children:"View Resources"})})]})]})})]})},Dq=({isOpen:i,onClose:o,resource:u})=>{const{toast:m}=Iy(),[w,E]=W.useState({name:"",email:"",company:"",phone:"",message:""}),[P,s]=W.useState(!1),D=G=>{G.preventDefault(),console.log("Download request submitted:",{...w,resourceId:u==null?void 0:u.id}),s(!0),m({title:"Information submitted",description:"Thank you for your information! You can now download the resource."})},O=()=>{const G=document.createElement("a");G.href=(u==null?void 0:u.downloadUrl)||"#",G.download=`${u==null?void 0:u.title}.pdf`,G.click(),m({title:"Download started",description:"The resource is being downloaded."})},H=()=>{E({name:"",email:"",company:"",phone:"",message:""}),s(!1),o()};return u?_.jsx(uo,{open:i,onOpenChange:H,children:_.jsxs(Zs,{className:"max-w-md",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:P?"Download Ready!":`Download ${u.title}`})}),P?_.jsxs("div",{className:"space-y-4 text-center",children:[_.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[_.jsx("p",{className:"text-green-800 mb-4",children:"Thank you for providing your information! Your download is ready."}),_.jsxs("p",{className:"text-sm text-green-600 mb-4",children:["Click the button below to download ",u.title,"."]})]}),_.jsxs(Yt,{onClick:O,className:"w-full flex items-center gap-2",children:[_.jsx(KN,{size:16}),"Download ",u.title]}),_.jsx(Yt,{variant:"outline",onClick:H,className:"w-full",children:"Close"})]}):_.jsxs("form",{onSubmit:D,className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"name",children:"Full Name *"}),_.jsx(Si,{id:"name",value:w.name,onChange:G=>E(U=>({...U,name:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"email",children:"Email Address *"}),_.jsx(Si,{id:"email",type:"email",value:w.email,onChange:G=>E(U=>({...U,email:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"company",children:"Company/Organization *"}),_.jsx(Si,{id:"company",value:w.company,onChange:G=>E(U=>({...U,company:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"phone",children:"Phone Number"}),_.jsx(Si,{id:"phone",type:"tel",value:w.phone,onChange:G=>E(U=>({...U,phone:G.target.value}))})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"message",children:"How will you use this resource? *"}),_.jsx(Xn,{id:"message",value:w.message,onChange:G=>E(U=>({...U,message:G.target.value})),placeholder:"Brief description of your intended use...",rows:3,required:!0})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:"Submit & Download"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:H,children:"Cancel"})]})]})]})}):null},Nq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState([]),[w,E]=W.useState("all"),[P,s]=W.useState(!0),[D,O]=W.useState(null),[H,G]=W.useState(!1);W.useEffect(()=>{(async()=>{try{const le=await ao.getResources();o(le),m(le)}catch(le){console.error("Error fetching resources:",le)}finally{s(!1)}})()},[]),W.useEffect(()=>{m(w==="all"?i:i.filter(Y=>Y.type===w))},[w,i]);const U=Y=>{Y.downloadUrl?window.open(Y.downloadUrl,"_blank"):console.warn("No download URL for this resource.")},he=Y=>({"pitch-deck":oR,"financial-model":G6,presentation:oR,guide:V1})[Y]||X6,de=[{value:"all",label:"All Types"},{value:"pitch-deck",label:"Pitch Decks"},{value:"financial-model",label:"Financial Models"},{value:"presentation",label:"Presentations"},{value:"guide",label:"Guides"}];return P?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",_.jsx("span",{className:"gradient-text",children:"Resources"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Access essential templates, guides, and tools to accelerate your startup journey. From pitch decks to financial models, everything you need to succeed."})]})})}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"flex justify-between items-center mb-8",children:[_.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Resources"}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("span",{className:"text-sm text-gray-600",children:"Filter by type:"}),_.jsxs($c,{value:w,onValueChange:E,children:[_.jsx(Ql,{className:"w-48",children:_.jsx(qc,{placeholder:"Select type"})}),_.jsx(Jl,{children:de.map(Y=>_.jsx(Cn,{value:Y.value,children:Y.label},Y.value))})]})]})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:u.map(Y=>{const le=he(Y.type);return _.jsxs(Wi,{className:"h-full hover:shadow-lg transition-shadow",children:[_.jsxs(cr,{children:[_.jsxs("div",{className:"flex items-start justify-between mb-4",children:[_.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:_.jsx(le,{className:"h-6 w-6 text-primary"})}),_.jsx(Ls,{variant:"secondary",className:"capitalize",children:Y.category})]}),_.jsx(ur,{className:"text-xl",children:Y.title}),_.jsx(Rn,{className:"text-base",children:Y.description})]}),_.jsxs(hr,{children:[_.jsx("div",{className:"flex flex-wrap gap-1 mb-6",children:Y.tags.map((re,oe)=>_.jsx(Ls,{variant:"outline",className:"text-xs",children:re},oe))}),_.jsxs(Yt,{className:"w-full",onClick:()=>U(Y),children:[_.jsx(KN,{size:16,className:"mr-2"}),"Get Resource"]})]})]},Y.id)})}),u.length===0&&_.jsx("div",{className:"text-center py-12",children:_.jsx("p",{className:"text-gray-500",children:"No resources found for the selected type."})})]})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Need More Support?"}),_.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Our resources are just the beginning. Join our programs for personalized guidance and expert mentorship to take your startup to the next level."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[_.jsx(Yt,{size:"lg",asChild:!0,children:_.jsx(Nr,{to:"/fund",children:"View Investment"})}),_.jsx(Yt,{size:"lg",variant:"outline",asChild:!0,children:_.jsx(Nr,{to:"/contact",children:"Contact Us"})})]})]})}),_.jsx(Dq,{isOpen:H,onClose:()=>G(!1),resource:D})]})};var AL={exports:{}};(function(i,o){(function(u,m){i.exports=m()})(v4,function(){var u,m,w;function E(s,D){if(!u)u=D;else if(!m)m=D;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",H={};u(H),w=D(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}E(["exports"],function(s){var D=1e-6,O=typeof Float32Array<"u"?Float32Array:Array;function H(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=r*p-c*l;return f?(n[0]=p*(f=1/f),n[1]=-l*f,n[2]=-c*f,n[3]=r*f,n):null}function G(){var n=new O(9);return O!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function U(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=e[4],x=e[5],b=e[6],S=e[7],I=e[8];return n[0]=f*I-x*S,n[1]=c*S-l*I,n[2]=l*x-c*f,n[3]=x*b-p*I,n[4]=r*I-c*b,n[5]=c*p-r*x,n[6]=p*S-f*b,n[7]=l*b-r*S,n[8]=r*f-l*p,n}function he(n,e,r){var l=e[0],c=e[1],p=e[2],f=e[3],x=e[4],b=e[5],S=e[6],I=e[7],A=e[8],M=r[0],N=r[1],z=r[2],B=r[3],q=r[4],K=r[5],ne=r[6],se=r[7],V=r[8];return n[0]=M*l+N*f+z*S,n[1]=M*c+N*x+z*I,n[2]=M*p+N*b+z*A,n[3]=B*l+q*f+K*S,n[4]=B*c+q*x+K*I,n[5]=B*p+q*b+K*A,n[6]=ne*l+se*f+V*S,n[7]=ne*c+se*x+V*I,n[8]=ne*p+se*b+V*A,n}function de(){var n=new O(16);return O!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Y(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function le(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=e[4],x=e[5],b=e[6],S=e[7],I=e[8],A=e[9],M=e[10],N=e[11],z=e[12],B=e[13],q=e[14],K=e[15],ne=r*x-l*f,se=r*b-c*f,V=r*S-p*f,ee=l*b-c*x,ae=l*S-p*x,fe=c*S-p*b,Ae=I*B-A*z,Ee=I*q-M*z,Pe=I*K-N*z,De=A*q-M*B,He=A*K-N*B,ut=M*K-N*q,it=ne*ut-se*He+V*De+ee*Pe-ae*Ee+fe*Ae;return it?(n[0]=(x*ut-b*He+S*De)*(it=1/it),n[1]=(c*He-l*ut-p*De)*it,n[2]=(B*fe-q*ae+K*ee)*it,n[3]=(M*ae-A*fe-N*ee)*it,n[4]=(b*Pe-f*ut-S*Ee)*it,n[5]=(r*ut-c*Pe+p*Ee)*it,n[6]=(q*V-z*fe-K*se)*it,n[7]=(I*fe-M*V+N*se)*it,n[8]=(f*He-x*Pe+S*Ae)*it,n[9]=(l*Pe-r*He-p*Ae)*it,n[10]=(z*ae-B*V+K*ne)*it,n[11]=(A*V-I*ae-N*ne)*it,n[12]=(x*Ee-f*De-b*Ae)*it,n[13]=(r*De-l*Ee+c*Ae)*it,n[14]=(B*se-z*ee-q*ne)*it,n[15]=(I*ee-A*se+M*ne)*it,n):null}function re(n,e,r){var l=e[0],c=e[1],p=e[2],f=e[3],x=e[4],b=e[5],S=e[6],I=e[7],A=e[8],M=e[9],N=e[10],z=e[11],B=e[12],q=e[13],K=e[14],ne=e[15],se=r[0],V=r[1],ee=r[2],ae=r[3];return n[0]=se*l+V*x+ee*A+ae*B,n[1]=se*c+V*b+ee*M+ae*q,n[2]=se*p+V*S+ee*N+ae*K,n[3]=se*f+V*I+ee*z+ae*ne,n[4]=(se=r[4])*l+(V=r[5])*x+(ee=r[6])*A+(ae=r[7])*B,n[5]=se*c+V*b+ee*M+ae*q,n[6]=se*p+V*S+ee*N+ae*K,n[7]=se*f+V*I+ee*z+ae*ne,n[8]=(se=r[8])*l+(V=r[9])*x+(ee=r[10])*A+(ae=r[11])*B,n[9]=se*c+V*b+ee*M+ae*q,n[10]=se*p+V*S+ee*N+ae*K,n[11]=se*f+V*I+ee*z+ae*ne,n[12]=(se=r[12])*l+(V=r[13])*x+(ee=r[14])*A+(ae=r[15])*B,n[13]=se*c+V*b+ee*M+ae*q,n[14]=se*p+V*S+ee*N+ae*K,n[15]=se*f+V*I+ee*z+ae*ne,n}function oe(n,e,r){var l,c,p,f,x,b,S,I,A,M,N,z,B=r[0],q=r[1],K=r[2];return e===n?(n[12]=e[0]*B+e[4]*q+e[8]*K+e[12],n[13]=e[1]*B+e[5]*q+e[9]*K+e[13],n[14]=e[2]*B+e[6]*q+e[10]*K+e[14],n[15]=e[3]*B+e[7]*q+e[11]*K+e[15]):(c=e[1],p=e[2],f=e[3],x=e[4],b=e[5],S=e[6],I=e[7],A=e[8],M=e[9],N=e[10],z=e[11],n[0]=l=e[0],n[1]=c,n[2]=p,n[3]=f,n[4]=x,n[5]=b,n[6]=S,n[7]=I,n[8]=A,n[9]=M,n[10]=N,n[11]=z,n[12]=l*B+x*q+A*K+e[12],n[13]=c*B+b*q+M*K+e[13],n[14]=p*B+S*q+N*K+e[14],n[15]=f*B+I*q+z*K+e[15]),n}function _e(n,e,r){var l=r[0],c=r[1],p=r[2];return n[0]=e[0]*l,n[1]=e[1]*l,n[2]=e[2]*l,n[3]=e[3]*l,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Ne(n,e,r){var l=Math.sin(r),c=Math.cos(r),p=e[4],f=e[5],x=e[6],b=e[7],S=e[8],I=e[9],A=e[10],M=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*c+S*l,n[5]=f*c+I*l,n[6]=x*c+A*l,n[7]=b*c+M*l,n[8]=S*c-p*l,n[9]=I*c-f*l,n[10]=A*c-x*l,n[11]=M*c-b*l,n}function Ge(n,e,r){var l=Math.sin(r),c=Math.cos(r),p=e[0],f=e[1],x=e[2],b=e[3],S=e[8],I=e[9],A=e[10],M=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c-S*l,n[1]=f*c-I*l,n[2]=x*c-A*l,n[3]=b*c-M*l,n[8]=p*l+S*c,n[9]=f*l+I*c,n[10]=x*l+A*c,n[11]=b*l+M*c,n}function pt(n,e,r){var l=Math.sin(r),c=Math.cos(r),p=e[0],f=e[1],x=e[2],b=e[3],S=e[4],I=e[5],A=e[6],M=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*c+S*l,n[1]=f*c+I*l,n[2]=x*c+A*l,n[3]=b*c+M*l,n[4]=S*c-p*l,n[5]=I*c-f*l,n[6]=A*c-x*l,n[7]=M*c-b*l,n}function ot(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function dt(n,e,r){var l,c,p,f=r[0],x=r[1],b=r[2],S=Math.hypot(f,x,b);return S<D?null:(f*=S=1/S,x*=S,b*=S,l=Math.sin(e),c=Math.cos(e),n[0]=f*f*(p=1-c)+c,n[1]=x*f*p+b*l,n[2]=b*f*p-x*l,n[3]=0,n[4]=f*x*p-b*l,n[5]=x*x*p+c,n[6]=b*x*p+f*l,n[7]=0,n[8]=f*b*p+x*l,n[9]=x*b*p-f*l,n[10]=b*b*p+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Bt(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=r+r,x=l+l,b=c+c,S=r*f,I=l*f,A=l*x,M=c*f,N=c*x,z=c*b,B=p*f,q=p*x,K=p*b;return n[0]=1-A-z,n[1]=I+K,n[2]=M-q,n[3]=0,n[4]=I-K,n[5]=1-S-z,n[6]=N+B,n[7]=0,n[8]=M+q,n[9]=N-B,n[10]=1-S-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Wt=re;function Ht(){var n=new O(3);return O!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ei(n){var e=new O(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function xi(n){return Math.hypot(n[0],n[1],n[2])}function It(n,e,r){var l=new O(3);return l[0]=n,l[1]=e,l[2]=r,l}function ui(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function Zt(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function Ni(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function ct(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function Vt(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function Gt(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function ti(n,e,r,l){return n[0]=e[0]+r[0]*l,n[1]=e[1]+r[1]*l,n[2]=e[2]+r[2]*l,n}function vi(n,e){var r=e[0]-n[0],l=e[1]-n[1],c=e[2]-n[2];return r*r+l*l+c*c}function Ki(n){var e=n[0],r=n[1],l=n[2];return e*e+r*r+l*l}function Zi(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Hi(n,e){var r=e[0],l=e[1],c=e[2],p=r*r+l*l+c*c;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function Ii(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function hi(n,e,r){var l=e[0],c=e[1],p=e[2],f=r[0],x=r[1],b=r[2];return n[0]=c*b-p*x,n[1]=p*f-l*b,n[2]=l*x-c*f,n}function _i(n,e,r,l){var c=e[0],p=e[1],f=e[2];return n[0]=c+l*(r[0]-c),n[1]=p+l*(r[1]-p),n[2]=f+l*(r[2]-f),n}function ji(n,e,r){var l=e[0],c=e[1],p=e[2],f=r[3]*l+r[7]*c+r[11]*p+r[15];return n[0]=(r[0]*l+r[4]*c+r[8]*p+r[12])/(f=f||1),n[1]=(r[1]*l+r[5]*c+r[9]*p+r[13])/f,n[2]=(r[2]*l+r[6]*c+r[10]*p+r[14])/f,n}function Er(n,e,r){var l=e[0],c=e[1],p=e[2];return n[0]=l*r[0]+c*r[3]+p*r[6],n[1]=l*r[1]+c*r[4]+p*r[7],n[2]=l*r[2]+c*r[5]+p*r[8],n}function wr(n,e,r){var l=r[0],c=r[1],p=r[2],f=e[0],x=e[1],b=e[2],S=c*b-p*x,I=p*f-l*b,A=l*x-c*f,M=c*A-p*I,N=p*S-l*A,z=l*I-c*S,B=2*r[3];return I*=B,A*=B,N*=2,z*=2,n[0]=f+(S*=B)+(M*=2),n[1]=x+I+N,n[2]=b+A+z,n}function nr(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var dr=Zt,Ln=Ni,ns=xi;function pn(){var n=new O(4);return O!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function ys(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function Eo(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=r*r+l*l+c*c+p*p;return f>0&&(f=1/Math.sqrt(f)),n[0]=r*f,n[1]=l*f,n[2]=c*f,n[3]=p*f,n}function Ur(n,e,r){var l=e[0],c=e[1],p=e[2],f=e[3];return n[0]=r[0]*l+r[4]*c+r[8]*p+r[12]*f,n[1]=r[1]*l+r[5]*c+r[9]*p+r[13]*f,n[2]=r[2]*l+r[6]*c+r[10]*p+r[14]*f,n[3]=r[3]*l+r[7]*c+r[11]*p+r[15]*f,n}function Fn(){var n=new O(4);return O!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Co(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Io(n,e,r){r*=.5;var l=e[0],c=e[1],p=e[2],f=e[3],x=Math.sin(r),b=Math.cos(r);return n[0]=l*b+f*x,n[1]=c*b+p*x,n[2]=p*b-c*x,n[3]=f*b-l*x,n}function Os(n,e,r){r*=.5;var l=e[0],c=e[1],p=e[2],f=e[3],x=Math.sin(r),b=Math.cos(r);return n[0]=l*b-p*x,n[1]=c*b+f*x,n[2]=p*b+l*x,n[3]=f*b-c*x,n}Ht(),pn();var Qn,Wo,Ao,On,_a,ds=Eo,Zo=(Qn=Ht(),Wo=It(1,0,0),Ao=It(0,1,0),function(n,e,r){var l=Ii(e,r);return l<-.999999?(hi(Qn,Wo,e),ns(Qn)<1e-6&&hi(Qn,Ao,e),Hi(Qn,Qn),function(c,p,f){f*=.5;var x=Math.sin(f);c[0]=x*p[0],c[1]=x*p[1],c[2]=x*p[2],c[3]=Math.cos(f)}(n,Qn,Math.PI),n):l>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(hi(Qn,e,r),n[0]=Qn[0],n[1]=Qn[1],n[2]=Qn[2],n[3]=1+l,ds(n,n))});function Hn(){var n=new O(2);return O!=Float32Array&&(n[0]=0,n[1]=0),n}function xs(n,e){var r=new O(2);return r[0]=n,r[1]=e,r}function Po(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n}function Mo(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n}function ho(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n}function ss(n){return Math.hypot(n[0],n[1])}function ya(n,e){var r=e[0],l=e[1],c=r*r+l*l;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function di(n,e){return n[0]*e[0]+n[1]*e[1]}function Yr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Fn(),Fn(),G(),Hn();var rn,bn,As=function(){if(_a)return On;function n(e,r,l,c){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=c}return _a=1,On=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,c=0;c<8;c++){var p=this.sampleCurveX(l)-e;if(Math.abs(p)<r)return l;var f=this.sampleCurveDerivativeX(l);if(Math.abs(f)<1e-6)break;l-=p/f}var x=0,b=1;for(l=e,c=0;c<20&&(p=this.sampleCurveX(l),!(Math.abs(p-e)<r));c++)e>p?x=l:b=l,l=.5*(b-x)+x;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},On}(),Xo=Yr(As);function Yo(){if(bn)return rn;function n(e,r){this.x=e,this.y=r}return bn=1,rn=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,l=e.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),l=Math.sin(e),c=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=c,this},_rotateAround:function(e,r){var l=Math.cos(e),c=Math.sin(e),p=r.y+c*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-c*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},rn}var wt=Yr(Yo());function Ko(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!Ko(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!Ko(n[r],e[r]))return!1;return!0}return n===e}const Ch=Math.PI/180,tc=180/Math.PI;function Qi(n){return n*Ch}function Ve(n){return n*tc}const Q=[[0,0],[1,0],[1,1],[0,1]];function ie(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function me(n,e,r,l){const c=new Xo(n,e,r,l);return function(p){return c.solve(p)}}const Ie=me(.25,.1,.25,1);function ve(n,e,r){return Math.min(r,Math.max(e,n))}function ke(n,e,r){return(r=ve((r-n)/(e-n),0,1))*r*(3-2*r)}function Oe(n,e,r){const l=r-e,c=((n-e)%l+l)%l+e;return c===e?r:c}function Me(n,e,r){if(!n.length)return r(null,[]);let l=n.length;const c=new Array(n.length);let p=null;n.forEach((f,x)=>{e(f,(b,S)=>{b&&(p=b),c[x]=S,--l==0&&r(p,c)})})}function Be(n,...e){for(const r of e)for(const l in r)n[l]=r[l];return n}let tt=1;function ce(){return tt++}function rt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ct(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Ot(n,e,r){const l={};for(const c in n)l[c]=e.call(this,n[c],c,n);return l}function li(n,e,r){const l={};for(const c in n)e.call(this,n[c],c,n)&&(l[c]=n[c]);return l}function ci(n){return Array.isArray(n)?n.map(ci):typeof n=="object"&&n?Ot(n,ci):n}function yi(n,e){for(let r=0;r<n.length;r++)if(e.indexOf(n[r])>=0)return!0;return!1}const Oi={};function Ei(n){Oi[n]||(typeof console<"u"&&console.warn(n),Oi[n]=!0)}function Pr(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function Kr(n){let e=0;for(let r,l,c=0,p=n.length,f=p-1;c<p;f=c++)r=n[c],l=n[f],e+=(l.x-r.x)*(r.y+l.y);return e}function Qr([n,e,r]){const l=Qi(e+90),c=Qi(r);return{x:n*Math.cos(l)*Math.sin(c),y:n*Math.sin(l)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:r}}function yr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function sr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,c,p)=>{const f=c||p;return e[l]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let yn=null;function un(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function sn(n,e,r,l){for(;e<r;){const c=e+r>>1;n[c]<l?e=c+1:r=c}return e}function Jn(n,e,r,l){for(;e<r;){const c=e+r>>1;n[c]<=l?e=c+1:r=c}return e}function Bs(n){return n>0?1/(1.001-n):1+n}function vs(n){return n>0?1-1/(1.001-n):-n}function Ih(n,e,r){return(n-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const os={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!os.API_URL)return null;try{const n=new URL(os.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ml(n){return os.API_URL_REGEX.test(n)}function fp(n){return os.API_SPRITE_REGEX.test(n)}let Ah,Ph,mp,gp,ic,Mh;function _p(){return Ah==null&&(Ah=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ah}const Qo={now:()=>gp!==void 0?gp:performance.now(),setNow(n){gp=n},restoreNow(){gp=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:l}=n;ic||(ic=document.createElement("canvas"));const c=ic.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(r>ic.width||l>ic.height)&&(ic.width=r,ic.height=l),c.clearRect(-e,-e,r+2*e,l+2*e),c.drawImage(n,0,0,r,l),c.getImageData(-e,-e,r+2*e,l+2*e)},resolveURL:n=>(Ph||(Ph=document.createElement("a")),Ph.href=n,Ph.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(mp==null&&(mp=window.matchMedia("(prefers-reduced-motion: reduce)")),mp.matches)},hasCanvasFingerprintNoise(){if(Mh!==void 0)return Mh;if(!_p())return Mh=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let r=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(c,0,1,1);const l=e.getImageData(0,0,n.width,n.height);r=0;for(let c=0;c<l.data.length;++c)if(c%4!=3&&r++!==l.data[c])return Mh=!0,!0;return Mh=!1,!1}};function po(n,e){const r=n.indexOf("?");if(r<0)return`${n}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(n.slice(r));for(const c in e)l.set(c,e[c]);return`${n.slice(0,r)}?${l.toString()}`}function Ro(n,e={persistentParams:[]}){const r=n.indexOf("?");if(r<0)return n;const l=new URLSearchParams,c=new URLSearchParams(n.slice(r));for(const f of e.persistentParams){const x=c.get(f);x&&l.set(f,x)}const p=l.toString();return`${n.slice(0,r)}${p.length>0?`?${p}`:""}`}const La="mapbox-tiles";let Jo=500,Fa=50;const Rh=["language","worldview","jobid"];let xa,kh;function rc(){try{return caches}catch{}}function Wc(){const n=rc();n&&xa==null&&(xa=n.open(La))}let Lm=1/0;const Fm={supported:!1,testSupport:function(n){!Dh&&nc&&(Zc?jy(n):Vs=n)}};let Vs,nc,Dh=!1,Zc=!1;const Ny=typeof self<"u"?self:{};function jy(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,nc),n.isContextLost())return;Fm.supported=!0}catch{}n.deleteTexture(e),Dh=!0}Ny.document&&(nc=Ny.document.createElement("img"),nc.onload=function(){Vs&&jy(Vs),Vs=null,Zc=!0},nc.onerror=function(){Dh=!0,Vs=null},nc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Nh);class Ji extends Error{constructor(e,r,l){r===401&&ml(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const yp=yr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Xc=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(yp())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,c){const p=new AbortController,f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:yp(),referrerPolicy:l.referrerPolicy,signal:p.signal});let x=!1,b=!1;const S=(I=f.url).indexOf("sku=")>0&&ml(I);var I;l.type==="json"&&f.headers.set("Accept","application/json");const A=(N,z,B)=>{if(b)return;if(N&&N.message!=="SecurityError"&&Ei(N.toString()),z&&B)return M(z);const q=Date.now();fetch(f).then(K=>{if(K.ok){const ne=S?K.clone():null;return M(K,ne,q)}return c(new Ji(K.statusText,K.status,l.url))}).catch(K=>{K.name!=="AbortError"&&c(new Error(`${K.message} ${l.url}`))})},M=(N,z,B)=>{(l.type==="arrayBuffer"?N.arrayBuffer():l.type==="json"?N.json():N.text()).then(q=>{b||(z&&B&&function(K,ne,se){if(Wc(),xa==null)return;const V=sr(ne.headers.get("Cache-Control")||"");if(V["no-store"])return;const ee={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((Ae,Ee)=>ee.headers.set(Ee,Ae)),V["max-age"]&&ee.headers.set("Expires",new Date(se+1e3*V["max-age"]).toUTCString());const ae=ee.headers.get("Expires");if(!ae||new Date(ae).getTime()-se<42e4)return;let fe=Ro(K.url,{persistentParams:Rh});if(ne.status===206){const Ae=K.headers.get("Range");if(!Ae)return;ee.status=200,fe=po(fe,{range:Ae})}(function(Ae,Ee){if(kh===void 0)try{new Response(new ReadableStream),kh=!0}catch{kh=!1}kh?Ee(Ae.body):Ae.blob().then(Ee).catch(Pe=>Ei(Pe.message))})(ne,Ae=>{const Ee=new Response((Pe=ne.status)!==200&&Pe!==404&&[101,103,204,205,304].includes(Pe)?null:Ae,ee);var Pe;Wc(),xa!=null&&xa.then(De=>De.put(fe,Ee)).catch(De=>Ei(De.message))})}(f,z,B),x=!0,c(null,q,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(q=>{b||c(new Error(q.message))})};return S?function(N,z){if(Wc(),xa==null)return z(null);xa.then(B=>{let q=Ro(N.url,{persistentParams:Rh});const K=N.headers.get("Range");K&&(q=po(q,{range:K})),B.match(q).then(ne=>{const se=function(V){if(!V)return!1;const ee=new Date(V.headers.get("Expires")||0),ae=sr(V.headers.get("Cache-Control")||"");return Number(ee)>Date.now()&&!ae["no-cache"]}(ne);B.delete(q).catch(z),se&&B.put(q,ne.clone()).catch(z),z(null,ne,se)}).catch(z)}).catch(z)}(f,A):A(null,null),{cancel:()=>{b=!0,x||p.abort()}}}(n,e);if(yr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(l,c){const p=new XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const f in l.headers)p.setRequestHeader(f,l.headers[f]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{c(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let f=p.response;if(l.type==="json")try{f=JSON.parse(p.response)}catch(x){return c(x)}c(null,f,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else c(new Ji(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(n,e)},jh=function(n,e){return Xc(Be(n,{type:"arrayBuffer"}),e)};function iw(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const zh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sc,gl;sc=[],gl=0;const Om=function(n,e){if(Fm.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),gl>=os.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return sc.push(p),p}gl++;let r=!1;const l=()=>{if(!r)for(r=!0,gl--;sc.length&&gl<os.MAX_PARALLEL_IMAGE_REQUESTS;){const p=sc.shift(),{requestParameters:f,callback:x,cancelled:b}=p;b||(p.cancel=Om(f,x).cancel)}},c=jh(n,(p,f,x,b)=>{l(),p?e(p):f&&(self.createImageBitmap?function(S,I){const A=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(A).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(S,I)=>e(S,I,x,b)):function(S,I){const A=new Image;A.onload=()=>{I(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=zh})},A.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(S)],{type:"image/png"});A.src=S.byteLength?URL.createObjectURL(M):zh}(f,(S,I)=>e(S,I,x,b)))});return{cancel:()=>{c.cancel(),l()}}};var Bm,oc,zy,Oa={exports:{}},xp={exports:{}},vp={exports:{}},ea=function(){if(zy)return Oa.exports;zy=1;var n=(Bm||(Bm=1,xp.exports=function(r,l){var c,p,f,x,b,S,I,A;for(p=r.length-(c=3&r.length),f=l,b=3432918353,S=461845907,A=0;A<p;)I=255&r.charCodeAt(A)|(255&r.charCodeAt(++A))<<8|(255&r.charCodeAt(++A))<<16|(255&r.charCodeAt(++A))<<24,++A,f=27492+(65535&(x=5*(65535&(f=(f^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&r.charCodeAt(A+2))<<16;case 2:I^=(255&r.charCodeAt(A+1))<<8;case 1:f^=I=(65535&(I=(I=(65535&(I^=255&r.charCodeAt(A)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),xp.exports),e=(oc||(oc=1,vp.exports=function(r,l){for(var c,p=r.length,f=l^p,x=0;p>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:f^=(255&r.charCodeAt(x+2))<<16;case 2:f^=(255&r.charCodeAt(x+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(x)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),vp.exports);return Oa.exports=n,Oa.exports.murmur3=n,Oa.exports.murmur2=e,Oa.exports}(),Lh=Yr(ea);class ac{constructor(e,...r){Be(this,r[0]||{}),this.type=e}}class wp extends ac{constructor(e,r={}){super("error",Be({error:e},r))}}function Vm(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function bp(n,e,r){if(r&&r[n]){const l=r[n].indexOf(e);l!==-1&&r[n].splice(l,1)}}class lc{on(e,r){return this._listeners=this._listeners||{},Vm(e,r,this._listeners),this}off(e,r){return bp(e,r,this._listeners),bp(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Vm(e,r,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,r){const l=typeof e=="string"?new ac(e,r):e,c=l.type;if(this.listens(c)){l.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of p)b.call(this,l);const f=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of f)bp(c,b,this._oneTimeListeners),b.call(this,l);const x=this._eventedParent;x&&(Be(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(l))}else l instanceof wp&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class Ks{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ks(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,l]=e.split("");return new Ks({name:r,iconsetId:l})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return Ks.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Um,Yc={},cc=function(){if(Um)return Yc;Um=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function r(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function l(p){return(f=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:f>1?1:f;var f}function c(p,f,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(f-p)*x*6:2*x<1?f:3*x<2?p+(f-p)*(2/3-x)*6:p}try{Yc.parseCSSColor=function(p){var f,x=p.replace(/ /g,"").toLowerCase();if(x in n)return n[x].slice();if(x[0]==="#")return x.length===4?(f=parseInt(x.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:x.length===7&&(f=parseInt(x.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var b=x.indexOf("("),S=x.indexOf(")");if(b!==-1&&S+1===x.length){var I=x.substr(0,b),A=x.substr(b+1,S-(b+1)).split(","),M=1;switch(I){case"rgba":if(A.length!==4)return null;M=l(A.pop());case"rgb":return A.length!==3?null:[r(A[0]),r(A[1]),r(A[2]),M];case"hsla":if(A.length!==4)return null;M=l(A.pop());case"hsl":if(A.length!==3)return null;var N=(parseFloat(A[0])%360+360)%360/360,z=l(A[1]),B=l(A[2]),q=B<=.5?B*(z+1):B+z-B*z,K=2*B-q;return[e(255*c(K,q,N+1/3)),e(255*c(K,q,N)),e(255*c(K,q,N-1/3)),M];default:return null}}return null}}catch{}return Yc}();class pr{constructor(e,r,l,c=1){this.r=e,this.g=r,this.b=l,this.a=c}static parse(e){if(!e)return;if(e instanceof pr)return e;if(typeof e!="string")return;const r=cc.parseCSSColor(e);return r?new pr(r[0]/255,r[1]/255,r[2]/255,r[3]):void 0}toString(){const[e,r,l,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*l)},${c})`}toNonPremultipliedRenderColor(e){const{r,g:l,b:c,a:p}=this;return new rw(e,r,l,c,p)}toPremultipliedRenderColor(e){const{r,g:l,b:c,a:p}=this;return new Gm(e,r*p,l*p,c*p,p)}clone(){return new pr(this.r,this.g,this.b,this.a)}}class ta{constructor(e,r,l,c,p,f=!1){if(this.premultiplied=!1,this.premultiplied=f,e){const x=e.image.height,b=x*x;this.premultiplied?(r=p===0?0:r/p*(x-1),l=p===0?0:l/p*(x-1),c=p===0?0:c/p*(x-1)):(r*=x-1,l*=x-1,c*=x-1);const S=Math.floor(r),I=Math.floor(l),A=Math.floor(c),M=Math.ceil(r),N=Math.ceil(l),z=Math.ceil(c),B=r-S,q=l-I,K=c-A,ne=e.image.data,se=4*(S+I*b+A*x),V=4*(S+I*b+z*x),ee=4*(S+N*b+A*x),ae=4*(S+N*b+z*x),fe=4*(M+I*b+A*x),Ae=4*(M+I*b+z*x),Ee=4*(M+N*b+A*x),Pe=4*(M+N*b+z*x);if(se<0||Pe>=ne.length)throw new Error("out of range");this.r=si(si(si(ne[se],ne[V],K),si(ne[ee],ne[ae],K),q),si(si(ne[fe],ne[Ae],K),si(ne[Ee],ne[Pe],K),q),B)/255*(this.premultiplied?p:1),this.g=si(si(si(ne[se+1],ne[V+1],K),si(ne[ee+1],ne[ae+1],K),q),si(si(ne[fe+1],ne[Ae+1],K),si(ne[Ee+1],ne[Pe+1],K),q),B)/255*(this.premultiplied?p:1),this.b=si(si(si(ne[se+2],ne[V+2],K),si(ne[ee+2],ne[ae+2],K),q),si(si(ne[fe+2],ne[Ae+2],K),si(ne[Ee+2],ne[Pe+2],K),q),B)/255*(this.premultiplied?p:1),this.a=p}else this.r=r,this.g=l,this.b=c,this.a=p}toArray(){const{r:e,g:r,b:l,a:c}=this;return[255*e,255*r,255*l,c]}toHslaArray(){let{r:e,g:r,b:l,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];e/=c,r/=c,l/=c}const p=Math.min(Math.max(e,0),1),f=Math.min(Math.max(r,0),1),x=Math.min(Math.max(l,0),1),b=Math.min(p,f,x),S=Math.max(p,f,x),I=(b+S)/2;if(b===S)return[0,0,100*I,c];const A=S-b,M=I>.5?A/(2-S-b):A/(S+b);let N=0;return S===p?N=(f-x)/A+(f<x?6:0):S===f?N=(x-p)/A+2:S===x&&(N=(p-f)/A+4),N*=60,[Math.min(Math.max(N,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*I,0),100),c]}toArray01(){const{r:e,g:r,b:l,a:c}=this;return[e,r,l,c]}toArray01Scaled(e){const{r,g:l,b:c}=this;return[r*e,l*e,c*e]}toArray01Linear(){const{r:e,g:r,b:l,a:c}=this;return[Math.pow(e,2.2),Math.pow(r,2.2),Math.pow(l,2.2),c]}}class rw extends ta{constructor(e,r,l,c,p){super(e,r,l,c,p,!1)}}class Gm extends ta{constructor(e,r,l,c,p){super(e,r,l,c,p,!0)}}function si(n,e,r){return n*(1-r)+e*r}function Sp(n,e,r){return n.map((l,c)=>si(l,e[c],r))}pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1),pr.blue=new pr(0,0,1,1);var Fh=Object.freeze({__proto__:null,array:Sp,color:function(n,e,r){return new pr(si(n.r,e.r,r),si(n.g,e.g,r),si(n.b,e.b,r),si(n.a,e.a,r))},number:si});function uc(n,...e){for(const r of e)for(const l in r)n[l]=r[l];return n}class fo extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class $m{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,c]of r)this.bindings[l]=c}concat(e){return new $m(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kc={kind:"null"},$t={kind:"number"},br={kind:"string"},ar={kind:"boolean"},Qs={kind:"color"},Ba={kind:"object"},fr={kind:"value"},Tp={kind:"collator"},Oh={kind:"formatted"},Bh={kind:"resolvedImage"};function Ps(n,e){return{kind:"array",itemType:n,N:e}}function Dn(n){if(n.kind==="array"){const e=Dn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const nw=[Kc,$t,br,ar,Qs,Oh,Ba,Ps(fr),Bh];function Qc(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qc(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of nw)if(!Qc(r,e))return null}}return`Expected ${Dn(n)} but found ${Dn(e)} instead.`}function _l(n,e){return e.some(r=>r.kind===n.kind)}function Vh(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Ep(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&Ep(n.itemType,e.itemType):n.kind===e.kind}class Uh{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Cp{constructor(e,r,l,c,p){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=l,this.fontStack=c,this.textColor=p}}class Ms{constructor(e){this.sections=e}static fromString(e){return new Ms([new Cp(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ms?e:Ms.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const c=r.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(r.text);const l={};r.fontStack&&(l["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(l["font-scale"]=r.scale),r.textColor&&(l["text-color"]=["rgba"].concat(r.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class Va{constructor(e,r={}){if(this.id=Ks.from(e),this.options=Object.assign({},r),r.transform){const{a:l,b:c,c:p,d:f,e:x,f:b}=r.transform;this.options.transform=new DOMMatrix([l,c,p,f,x,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:l,d:c,e:p,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:l,d:c,e:p,f}})}static parse(e){let r,l,c,p;try{({name:r,iconsetId:l,params:c,transform:p}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:f,b:x,c:b,d:S,e:I,f:A}=p||{};return new Va({name:r,iconsetId:l},{params:c,transform:new DOMMatrix([f,x,b,S,I,A])})}scaleSelf(e,r){return this.options.transform.scaleSelf(e,r),this}}class Us{constructor(e,r,l,c,p=!1){this.primaryId=Ks.from(e),this.primaryOptions=r,l&&(this.secondaryId=Ks.from(l)),this.secondaryOptions=c,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Va(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Va(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Us.build({name:e}):e}static build(e,r,l,c){return!e||typeof e=="object"&&!("name"in e)?null:new Us(e,l,r,c)}}function hc(n,e,r,l){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,e,r,l]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zi(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof pr||n instanceof Uh||n instanceof Ms||n instanceof Us)return!0;if(Array.isArray(n)){for(const e of n)if(!zi(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!zi(n[e]))return!1;return!0}return!1}function Mt(n){if(n===null)return Kc;if(typeof n=="string")return br;if(typeof n=="boolean")return ar;if(typeof n=="number")return $t;if(n instanceof pr)return Qs;if(n instanceof Uh)return Tp;if(n instanceof Ms)return Oh;if(n instanceof Us)return Bh;if(Array.isArray(n)){const e=n.length;let r;for(const l of n){const c=Mt(l);if(r){if(r===c)continue;r=fr;break}r=c}return Ps(r||fr,e)}return Ba}function ko(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ms||n instanceof Us||n instanceof pr?n.toString():JSON.stringify(n)}class mi{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zi(e[1]))return r.error("invalid value");const l=e[1];let c=Mt(l);const p=r.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new mi(c,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ms?this.value.serialize():this.value}}class In{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Gh={string:br,number:$t,boolean:ar,object:Ba};class ri{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,c=1;const p=e[0];if(p==="array"){let x,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Gh)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=Gh[S],c++}else x=fr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}l=Ps(x,b)}else l=Gh[p];const f=[];for(;c<e.length;c++){const x=r.parse(e[c],c,fr);if(!x)return null;f.push(x)}return new ri(l,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Qc(this.type,Mt(l)))return l;if(r===this.args.length-1)throw new In(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Dn(Mt(l))} but was expected to be of type ${Dn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){r.push(l.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(l=>l.serialize()))}}class Jc{constructor(e){this.type=Oh,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const c=[];let p=!1;for(let f=1;f<=e.length-1;++f){const x=e[f];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let b=null;if(x["font-scale"]&&(b=r.parseObjectValue(x["font-scale"],f,"font-scale",$t),!b))return null;let S=null;if(x["text-font"]&&(S=r.parseObjectValue(x["text-font"],f,"text-font",Ps(br)),!S))return null;let I=null;if(x["text-color"]&&(I=r.parseObjectValue(x["text-color"],f,"text-color",Qs),!I))return null;const A=c[c.length-1];A.scale=b,A.font=S,A.textColor=I}else{const b=r.parse(e[f],f,fr);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Jc(c)}evaluate(e){return new Ms(this.sections.map(r=>{const l=r.content.evaluate(e);return Ep(Mt(l),Bh)?new Cp("",l,null,null,null):new Cp(ko(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const l={};r.scale&&(l["font-scale"]=r.scale.serialize()),r.font&&(l["text-font"]=r.font.serialize()),r.textColor&&(l["text-color"]=r.textColor.serialize()),e.push(l)}return e}}class eu{constructor(e,r,l,c){this._imageWarnHistory={},this.type=Bh,this.namePrimary=e,this.nameSecondary=r,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let l=1;const c=[];function p(){if(l<e.length){const x=r.parse(e[l],l++,br);return x?(c.push({image:x,options:{}}),!0):(r.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(l<e.length){const b=e[l];if((x=b)===null||typeof x!="object"||Array.isArray(x))return!0;const S=b.params,I=b.iconset,A=r.concat(l);if(!S&&!I)return l++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const M={},N=A.concat(void 0,"params");for(const z in S){if(!z)return N.error("Image parameter name should be non-empty"),!1;const B=N.concat(void 0,z).parse(S[z],void 0,Qs,void 0,{typeAnnotation:"coerce"});if(!B)return!1;M[z]=B}c[c.length-1].options.params=M}if(I){if(typeof I!="object"||I.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!I.id)return A.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=I}return l++,!0}var x;return!0}for(let x=0;x<2;x++)if(!p()||!f())return;return new eu(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,r){const l={};if(r){for(const c in r)if(r[c])try{l[c]=r[c].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Us.build(r,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const p=c.getPrimary().id;if(c.available=e.availableImages.some(f=>Ks.isEqual(f,p)),c.available){const f=c.getSecondary()?c.getSecondary().id:null;f&&(c.available=e.availableImages.some(x=>Ks.isEqual(x,f)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const l={};if(r&&(l.iconset={id:r}),e){l.params={};for(const c in e)e[c]&&(l.params[c]=e[c].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function yl(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const Ly={"to-boolean":ar,"to-color":Qs,"to-number":$t,"to-string":br};class Do{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0],c=[];let p=Kc;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);p=Ps(r.expectedType.itemType,f)}else{if(!(f>0&&zi(e[1][0])))return null;p=Ps(Mt(e[1][0]),f)}for(let x=0;x<f;x++){const b=e[1][x];let S;if(yl(b)==="array")S=r.parse(b,void 0,p.itemType);else{const I=yl(b);if(I!==p.itemType.kind)return r.error(`Expected ${p.itemType.kind} but found ${I}.`);S=r.registry.literal.parse(["literal",b===void 0?null:b],r)}if(!S)return null;c.push(S)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");p=Ly[l];for(let f=1;f<e.length;f++){const x=r.parse(e[f],f,fr);if(!x)return null;c.push(x)}}return new Do(p,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,l;for(const c of this.args){if(r=c.evaluate(e),l=null,r instanceof pr)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:hc(r[0],r[1],r[2],r[3]),!l))return new pr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new In(l||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new In(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ms.fromString(ko(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Us.build(ko(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):ko(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Jc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new eu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Rs=["Unknown","Point","LineString","Polygon"];class $h{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-e[0])+this.featureDistanceData.bearing[1]*(c*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=pr.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class es{constructor(e,r,l,c,p){this.name=e,this.type=r,this._evaluate=l,this.args=c,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const r=es.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const l=e[0],c=es.definitions[l];if(!c)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=[];let b=null,S=-1;for(const[I,A]of f){if(Array.isArray(I)&&I.length!==e.length-1)continue;x.push(I),S++,b=new Fp(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const M=[];let N=!1;for(let z=1;z<e.length;z++){const B=e[z],q=Array.isArray(I)?I[z-1]:I.type,K=b.parse(B,1+M.length,q);if(!K){N=!0;break}M.push(K)}if(!N)if(Array.isArray(I)&&I.length!==M.length)b.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const B=Array.isArray(I)?I[z]:I.type,q=M[z];b.concat(z+1).checkSubtype(B,q.type)}if(b.errors.length===0)return new es(l,p,A,M,S)}}if(x.length===1)r.errors.push(...b.errors);else{const I=(x.length?x:f.map(([M])=>M)).map(qm).join(" | "),A=[];for(let M=1;M<e.length;M++){const N=r.parse(e[M],1+A.length);if(!N)return null;A.push(Dn(N.type))}r.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){es.definitions=r;for(const l in r)e[l]=es}}function qm(n){return Array.isArray(n)?`(${n.map(Dn).join(", ")})`:`(${Dn(n.type)}...)`}class va{constructor(e,r,l){this.type=Tp,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const c=l["case-sensitive"]===void 0?r.parse(!1,1,ar):r.parseObjectValue(l["case-sensitive"],1,"case-sensitive",ar);if(!c)return null;const p=l["diacritic-sensitive"]===void 0?r.parse(!1,1,ar):r.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",ar);if(!p)return null;let f=null;return l.locale&&(f=r.parseObjectValue(l.locale,1,"locale",br),!f)?null:new va(c,p,f)}evaluate(e){return new Uh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ws(n,e,r=0,l=n.length-1,c=sw){for(;l>r;){if(l-r>600){const b=l-r+1,S=e-r+1,I=Math.log(b),A=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*A*(b-A)/b)*(S-b/2<0?-1:1);ws(n,e,Math.max(r,Math.floor(e-S*A/b+M)),Math.min(l,Math.floor(e+(b-S)*A/b+M)),c)}const p=n[e];let f=r,x=l;for(qh(n,r,e),c(n[l],p)>0&&qh(n,r,l);f<x;){for(qh(n,f,x),f++,x--;c(n[f],p)<0;)f++;for(;c(n[x],p)>0;)x--}c(n[r],p)===0?qh(n,r,x):(x++,qh(n,x,l)),x<=e&&(r=x+1),e<=x&&(l=x-1)}}function qh(n,e,r){const l=n[e];n[e]=n[r],n[r]=l}function sw(n,e){return n<e?-1:n>e?1:0}function ow(n){let e=0;for(let r,l,c=0,p=n.length,f=p-1;c<p;f=c++)r=n[c],l=n[f],e+=(l.x-r.x)*(r.y+l.y);return e}function xl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function tu(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function dc(n,e,r){const l=n[0]-e[0],c=n[1]-e[1],p=n[0]-r[0],f=n[1]-r[1];return l*f-p*c==0&&l*p<=0&&c*f<=0}function iu(n,e,r=!1){let l=!1;for(let x=0,b=e.length;x<b;x++){const S=e[x];for(let I=0,A=S.length,M=A-1;I<A;M=I++){const N=S[M],z=S[I];if(dc(n,N,z))return r;(p=N)[1]>(c=n)[1]!=(f=z)[1]>c[1]&&c[0]<(f[0]-p[0])*(c[1]-p[1])/(f[1]-p[1])+p[0]&&(l=!l)}}var c,p,f;return l}function Fy(n,e,r,l){const c=l[0]-r[0],p=l[1]-r[1],f=(n[0]-r[0])*p-c*(n[1]-r[1]),x=(e[0]-r[0])*p-c*(e[1]-r[1]);return f>0&&x<0||f<0&&x>0}function Ip(n,e,r,l){return(c=[l[0]-r[0],l[1]-r[1]])[0]*(p=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*p[0]!=0&&!(!Fy(n,e,r,l)||!Fy(r,l,n,e));var c,p}function Hm(n){const e=new wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of n[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),r.x<l.x&&(r.x=l.x),r.y<l.y&&(r.y=l.y);return{min:e,max:r}}const Ua=8192;function aw(n,e){const r=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*Ua),Math.round(l*c*Ua)]}function lw(n,e){for(let r=0;r<e.length;r++)if(iu(n,e[r]))return!0;return!1}function Oy(n,e,r){for(const l of r)for(let c=0,p=l.length,f=p-1;c<p;f=c++)if(Ip(n,e,l[f],l[c]))return!0;return!1}function By(n,e){for(let r=0;r<n.length;++r)if(!iu(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(Oy(n[r],n[r+1],e))return!1;return!0}function pc(n,e){for(let r=0;r<e.length;r++)if(By(n,e[r]))return!0;return!1}function Wm(n,e,r){const l=[];for(let c=0;c<n.length;c++){const p=[];for(let f=0;f<n[c].length;f++){const x=aw(n[c][f],r);xl(e,x),p.push(x)}l.push(p)}return l}function Vy(n,e,r){const l=[];for(let c=0;c<n.length;c++){const p=Wm(n[c],e,r);l.push(p)}return l}function Ap(n,e,r,l){if(n[0]<r[0]||n[0]>r[2]){const c=.5*l;let p=n[0]-r[0]>c?-l:r[0]-n[0]>c?l:0;p===0&&(p=n[0]-r[2]>c?-l:r[2]-n[0]>c?l:0),n[0]+=p}xl(e,n)}function Zm(n,e,r,l){const c=Math.pow(2,l.z)*Ua,p=[l.x*Ua,l.y*Ua],f=[];if(!n)return f;for(const x of n)for(const b of x){const S=[b.x+p[0],b.y+p[1]];Ap(S,e,r,c),f.push(S)}return f}function Xm(n,e,r,l){const c=Math.pow(2,l.z)*Ua,p=[l.x*Ua,l.y*Ua],f=[];if(!n)return f;for(const b of n){const S=[];for(const I of b){const A=[I.x+p[0],I.y+p[1]];xl(e,A),S.push(A)}f.push(S)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const b of f)for(const S of b)Ap(S,e,r,c)}var x;return f}class bs{constructor(e,r){this.type=ar,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zi(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let c=0;c<l.features.length;++c){const p=l.features[c].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new bs(l,l.features[c].geometry)}else if(l.type==="Feature"){const c=l.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new bs(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new bs(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(l.type==="Polygon"){const x=Wm(l.coordinates,p,f),b=Zm(r.geometry(),c,p,f);if(!tu(c,p))return!1;for(const S of b)if(!iu(S,x))return!1}if(l.type==="MultiPolygon"){const x=Vy(l.coordinates,p,f),b=Zm(r.geometry(),c,p,f);if(!tu(c,p))return!1;for(const S of b)if(!lw(S,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(l.type==="Polygon"){const x=Wm(l.coordinates,p,f),b=Xm(r.geometry(),c,p,f);if(!tu(c,p))return!1;for(const S of b)if(!By(S,x))return!1}if(l.type==="MultiPolygon"){const x=Vy(l.coordinates,p,f),b=Xm(r.geometry(),c,p,f);if(!tu(c,p))return!1;for(const S of b)if(!pc(S,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Hh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ym=1/298.257223563,Km=Ym*(2-Ym),ru=Math.PI/180;class nu{static fromTile(e,r,l){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),p=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/ru;return new nu(p,l)}static get units(){return Hh}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!Hh[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(Hh).join(", ")}`);const l=6378.137*ru*(r?Hh[r]:1),c=Math.cos(e*ru),p=1/(1-Km*(1-c*c)),f=Math.sqrt(p);this.kx=l*f*c,this.ky=l*f*p*(1-Km)}distance(e,r){const l=mo(e[0]-r[0])*this.kx,c=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+c*c)}bearing(e,r){const l=mo(r[0]-e[0])*this.kx;return Math.atan2(l,(r[1]-e[1])*this.ky)/ru}destination(e,r,l){const c=l*ru;return this.offset(e,Math.sin(c)*r,Math.cos(c)*r)}offset(e,r,l){return[e[0]+r/this.kx,e[1]+l/this.ky]}lineDistance(e){let r=0;for(let l=0;l<e.length-1;l++)r+=this.distance(e[l],e[l+1]);return r}area(e){let r=0;for(let l=0;l<e.length;l++){const c=e[l];for(let p=0,f=c.length,x=f-1;p<f;x=p++)r+=mo(c[p][0]-c[x][0])*(c[p][1]+c[x][1])*(l?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let l=0;if(r<=0)return e[0];for(let c=0;c<e.length-1;c++){const p=e[c],f=e[c+1],x=this.distance(p,f);if(l+=x,l>r)return Pp(p,f,(r-(l-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,r,l){let[c,p]=r,f=mo(l[0]-c)*this.kx,x=(l[1]-p)*this.ky;if(f!==0||x!==0){const b=(mo(e[0]-c)*this.kx*f+(e[1]-p)*this.ky*x)/(f*f+x*x);b>1?(c=l[0],p=l[1]):b>0&&(c+=f/this.kx*b,p+=x/this.ky*b)}return f=mo(e[0]-c)*this.kx,x=(e[1]-p)*this.ky,Math.sqrt(f*f+x*x)}pointOnLine(e,r){let l=1/0,c=e[0][0],p=e[0][1],f=0,x=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],I=e[b][1],A=mo(e[b+1][0]-S)*this.kx,M=(e[b+1][1]-I)*this.ky,N=0;A===0&&M===0||(N=(mo(r[0]-S)*this.kx*A+(r[1]-I)*this.ky*M)/(A*A+M*M),N>1?(S=e[b+1][0],I=e[b+1][1]):N>0&&(S+=A/this.kx*N,I+=M/this.ky*N)),A=mo(r[0]-S)*this.kx,M=(r[1]-I)*this.ky;const z=A*A+M*M;z<l&&(l=z,c=S,p=I,f=b,x=N)}return{point:[c,p],index:f,t:Math.max(0,Math.min(1,x))}}lineSlice(e,r,l){let c=this.pointOnLine(l,e),p=this.pointOnLine(l,r);if(c.index>p.index||c.index===p.index&&c.t>p.t){const S=c;c=p,p=S}const f=[c.point],x=c.index+1,b=p.index;!Qm(l[x],f[0])&&x<=b&&f.push(l[x]);for(let S=x+1;S<=b;S++)f.push(l[S]);return Qm(l[b],p.point)||f.push(p.point),f}lineSliceAlong(e,r,l){let c=0;const p=[];for(let f=0;f<l.length-1;f++){const x=l[f],b=l[f+1],S=this.distance(x,b);if(c+=S,c>e&&p.length===0&&p.push(Pp(x,b,(e-(c-S))/S)),c>=r)return p.push(Pp(x,b,(r-(c-S))/S)),p;c>e&&p.push(b)}return p}bufferPoint(e,r){const l=r/this.ky,c=r/this.kx;return[e[0]-c,e[1]-l,e[0]+c,e[1]+l]}bufferBBox(e,r){const l=r/this.ky,c=r/this.kx;return[e[0]-c,e[1]-l,e[2]+c,e[3]+l]}insideBBox(e,r){return mo(e[0]-r[0])>=0&&mo(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function Qm(n,e){return n[0]===e[0]&&n[1]===e[1]}function Pp(n,e,r){const l=mo(e[0]-n[0]);return[n[0]+l*r,n[1]+(e[1]-n[1])*r]}function mo(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Mp{constructor(e=[],r=(l,c)=>l<c?-1:l>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,c=r[e];for(;e>0;){const p=e-1>>1,f=r[p];if(l(c,f)>=0)break;r[e]=f,e=p}r[e]=c}_down(e){const{data:r,compare:l}=this,c=this.length>>1,p=r[e];for(;e<c;){let f=1+(e<<1);const x=f+1;if(x<this.length&&l(r[x],r[f])<0&&(f=x),l(r[f],p)>=0)break;r[e]=r[f],e=f}r[e]=p}}var bt=8192;function Jm(n,e){return e.dist-n.dist}const su=100,ou=50;function Wh(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function Zh(n){return n[1]-n[0]+1}function wa(n,e){const r=n[1]>=n[0]&&n[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Rp(n,e){if(n[0]>n[1])return[null,null];const r=Zh(n);if(e){if(r===2)return[n,null];const l=Math.floor(r/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}{if(r===1)return[n,null];const l=Math.floor(r/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}}function No(n,e){const r=[1/0,1/0,-1/0,-1/0];if(!wa(e,n.length))return r;for(let l=e[0];l<=e[1];++l)xl(r,n[l]);return r}function $i(n){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<n.length;++r)for(let l=0;l<n[r].length;++l)xl(e,n[r][l]);return e}function au(n,e,r){if(Wh(n)||Wh(e))return NaN;let l=0,c=0;return n[2]<e[0]&&(l=e[0]-n[2]),n[0]>e[2]&&(l=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),r.distance([0,0],[l,c])}function cw(n){return 360*n-180}function uw(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function kp(n,e){const r=Math.pow(2,e.z),l=(n.y/bt+e.y)/r;return[cw((n.x/bt+e.x)/r),uw(l)]}function hw(n,e){const r=[];for(let l=0;l<n.length;++l)r.push(kp(n[l],e));return r}function on(n,e,r){const l=r.pointOnLine(e,n).point;return r.distance(n,l)}function Uy(n,e,r,l,c){const p=r.slice(l[0],l[1]+1);let f=1/0;for(let x=e[0];x<=e[1];++x)if((f=Math.min(f,on(n[x],p,c)))===0)return 0;return f}function eg(n,e,r,l,c){const p=Math.min(c.pointToSegmentDistance(n,r,l),c.pointToSegmentDistance(e,r,l)),f=Math.min(c.pointToSegmentDistance(r,n,e),c.pointToSegmentDistance(l,n,e));return Math.min(p,f)}function dw(n,e,r,l,c){if(!wa(e,n.length)||!wa(l,r.length))return NaN;let p=1/0;for(let f=e[0];f<e[1];++f)for(let x=l[0];x<l[1];++x){if(Ip(n[f],n[f+1],r[x],r[x+1]))return 0;p=Math.min(p,eg(n[f],n[f+1],r[x],r[x+1],c))}return p}function pw(n,e,r,l,c){if(!wa(e,n.length)||!wa(l,r.length))return NaN;let p=1/0;for(let f=e[0];f<=e[1];++f)for(let x=l[0];x<=l[1];++x)if((p=Math.min(p,c.distance(n[f],r[x])))===0)return p;return p}function fw(n,e,r){if(iu(n,e,!0))return 0;let l=1/0;for(const c of e){const p=c.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[p-1]&&(l=Math.min(l,r.pointToSegmentDistance(n,c[p-1],c[0])))===0||(l=Math.min(l,on(n,c,r)))===0)return l}return l}function mw(n,e,r,l){if(!wa(e,n.length))return NaN;for(let p=e[0];p<=e[1];++p)if(iu(n[p],r,!0))return 0;let c=1/0;for(let p=e[0];p<e[1];++p)for(const f of r)for(let x=0,b=f.length,S=b-1;x<b;S=x++){if(Ip(n[p],n[p+1],f[S],f[x]))return 0;c=Math.min(c,eg(n[p],n[p+1],f[S],f[x],l))}return c}function Gy(n,e){for(const r of n)for(let l=0;l<=r.length-1;++l)if(iu(r[l],e,!0))return!0;return!1}function gw(n,e,r,l=1/0){const c=$i(n),p=$i(e);if(l!==1/0&&au(c,p,r)>=l)return l;if(tu(c,p)){if(Gy(n,e))return 0}else if(Gy(e,n))return 0;let f=l;for(const x of n)for(let b=0,S=x.length,I=S-1;b<S;I=b++)for(const A of e)for(let M=0,N=A.length,z=N-1;M<N;z=M++){if(Ip(x[I],x[b],A[z],A[M]))return 0;f=Math.min(f,eg(x[I],x[b],A[z],A[M],r))}return f}function Dp(n,e,r,l,c,p,f){if(p===null||f===null)return;const x=au(No(l,p),No(c,f),r);x<e&&n.push({dist:x,range1:p,range2:f})}function _w(n,e,r,l,c=1/0){let p=Math.min(l.distance(n[0],r[0][0]),c);if(p===0)return p;const f=new Mp([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Jm),x=e?ou:su,b=$i(r);for(;f.length;){const S=f.pop();if(S.dist>=p)continue;const I=S.range1;if(Zh(I)<=x){if(!wa(I,n.length))return NaN;if(e){const A=mw(n,I,r,l);if((p=Math.min(p,A))===0)return p}else for(let A=I[0];A<=I[1];++A){const M=fw(n[A],r,l);if((p=Math.min(p,M))===0)return p}}else{const A=Rp(I,e);if(A[0]!==null){const M=au(No(n,A[0]),b,l);M<p&&f.push({dist:M,range1:A[0],range2:[0,0]})}if(A[1]!==null){const M=au(No(n,A[1]),b,l);M<p&&f.push({dist:M,range1:A[1],range2:[0,0]})}}}return p}function $y(n,e,r,l,c,p=1/0){let f=Math.min(p,c.distance(n[0],r[0]));if(f===0)return f;const x=new Mp([{dist:0,range1:[0,n.length-1],range2:[0,r.length-1]}],Jm),b=e?ou:su,S=l?ou:su;for(;x.length;){const I=x.pop();if(I.dist>=f)continue;const A=I.range1,M=I.range2;if(Zh(A)<=b&&Zh(M)<=S){if(!wa(A,n.length)||!wa(M,r.length))return NaN;if(e&&l?f=Math.min(f,dw(n,A,r,M,c)):e||l?e&&!l?f=Math.min(f,Uy(r,M,n,A,c)):!e&&l&&(f=Math.min(f,Uy(n,A,r,M,c))):f=Math.min(f,pw(n,A,r,M,c)),f===0)return f}else{const N=Rp(A,e),z=Rp(M,l);Dp(x,f,c,n,r,N[0],z[0]),Dp(x,f,c,n,r,N[0],z[1]),Dp(x,f,c,n,r,N[1],z[0]),Dp(x,f,c,n,r,N[1],z[1])}}return f}function tg(n,e,r,l,c=1/0){let p=c;const f=No(n,[0,n.length-1]);for(const x of r)if(!(p!==1/0&&au(f,No(x,[0,x.length-1]),l)>=p)&&(p=Math.min(p,$y(n,e,x,!0,l,p)),p===0))return p;return p}function Np(n,e,r,l,c=1/0){let p=c;const f=No(n,[0,n.length-1]);for(const x of r){if(p!==1/0&&au(f,$i(x),l)>=p)continue;const b=_w(n,e,x,l,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function ig(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class fc{constructor(e,r){this.type=$t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(zi(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let c=0;c<l.features.length;++c)if(ig(l.features[c].geometry.type))return new fc(l,l.features[c].geometry)}else if(l.type==="Feature"){if(ig(l.geometry.type))return new fc(l,l.geometry)}else if(ig(l.type))return new fc(l,l)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),l=e.canonicalID();if(r!=null&&l!=null){if(e.geometryType()==="Point")return function(c,p,f){const x=[];for(const S of c)for(const I of S)x.push(kp(I,p));const b=new nu(x[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?$y(x,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",b):f.type==="MultiLineString"?tg(x,!1,f.coordinates,b):f.type==="Polygon"||f.type==="MultiPolygon"?Np(x,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,b):null}(r,l,this.geometries);if(e.geometryType()==="LineString")return function(c,p,f){const x=[];for(const S of c){const I=[];for(const A of S)I.push(kp(A,p));x.push(I)}const b=new nu(x[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return tg(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,b);if(f.type==="MultiLineString"){let S=1/0;for(let I=0;I<f.coordinates.length;I++){const A=tg(f.coordinates[I],!0,x,b,S);if(isNaN(A))return A;if((S=Math.min(S,A))===0)return S}return S}if(f.type==="Polygon"||f.type==="MultiPolygon"){let S=1/0;for(let I=0;I<x.length;I++){const A=Np(x[I],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,b,S);if(isNaN(A))return A;if((S=Math.min(S,A))===0)return S}return S}return null}(r,l,this.geometries);if(e.geometryType()==="Polygon")return function(c,p,f){const x=[];for(const S of function(I,A){const M=I.length;if(M<=1)return[I];const N=[];let z,B;for(let q=0;q<M;q++){const K=ow(I[q]);K!==0&&(I[q].area=Math.abs(K),B===void 0&&(B=K<0),B===K<0?(z&&N.push(z),z=[I[q]]):z.push(I[q]))}return z&&N.push(z),N}(c)){const I=[];for(let A=0;A<S.length;++A)I.push(hw(S[A],p));x.push(I)}const b=new nu(x[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Np(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x,b);if(f.type==="MultiLineString"){let S=1/0;for(let I=0;I<f.coordinates.length;I++){const A=Np(f.coordinates[I],!0,x,b,S);if(isNaN(A))return A;if((S=Math.min(S,A))===0)return S}return S}return f.type==="Polygon"||f.type==="MultiPolygon"?function(S,I,A){let M=1/0;for(const N of S)for(const z of I){const B=gw(N,z,A,M);if(isNaN(B))return B;if((M=Math.min(M,B))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,x,b):null}(r,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function lu(n){if(n instanceof es&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof bs||n instanceof fc)return!1;if(n instanceof uu)return n.featureConstant;let e=!0;return n.eachChild(r=>{e&&!lu(r)&&(e=!1)}),e}function jp(n){if(n instanceof es&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!jp(r)&&(e=!1)}),e}function zp(n){if(n instanceof uu)return new Set([n.key]);let e=new Set;return n.eachChild(r=>{e=new Set([...e,...zp(r)])}),e}function cu(n,e){if(n instanceof es&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(l=>{r&&!cu(l,e)&&(r=!1)}),r}function qy(n,e,r){return[n,e,r].filter(Boolean).join("")}function rg(n,e){switch(n){case"string":return ko(e);case"number":return+e;case"boolean":return!!e;case"color":return pr.parse(e);case"formatted":return Ms.fromString(ko(e));case"resolvedImage":return Us.build(ko(e))}return e}function Hy(n,e,r,l){return l!==void 0&&(n=l*Math.round(n/l)),e!==void 0&&n<e&&(n=e),r!==void 0&&n>r&&(n=r),n}class uu{constructor(e,r,l,c=!1){this.type=e,this.key=r,this.scope=l,this.featureConstant=c}static parse(e,r){let l=r.expectedType;if(l==null&&(l=fr),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const c=r.parse(e[1],1);if(!(c instanceof mi))return r.error("Key name of 'config' expression must be a string literal.");let p,f=!0;const x=ko(c.value);if(e.length>=3){const b=r.parse(e[2],2);if(!(b instanceof mi))return r.error("Scope of 'config' expression must be a string literal.");p=ko(b.value)}if(r.options){const b=qy(x,p,r._scope),S=r.options.get(b);S&&(f=lu(S.value||S.default))}return new uu(l,x,p,f)}evaluate(e){const r=qy(this.key,this.scope,e.scope),l=e.getConfig(r);if(!l)return null;const{type:c,value:p,values:f,minValue:x,maxValue:b,stepValue:S}=l,I=l.default.evaluate(e);let A=I;if(p){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),A=p.evaluate(e),e.scope=M}return c&&(A=rg(c,A)),A===void 0||x===void 0&&b===void 0&&S===void 0||(typeof A=="number"?A=Hy(A,x,b,S):Array.isArray(A)&&(A=A.map(M=>typeof M=="number"?Hy(M,x,b,S):M))),p!==void 0&&A!==void 0&&f&&!f.includes(A)&&(A=I,c&&(A=rg(c,A))),(c&&c!==this.type||A!==void 0&&!Ep(Mt(A),this.type))&&(A=rg(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Lp{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new Lp(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Fp{constructor(e,r=[],l,c=new $m,p=[],f,x){this.registry=e,this.path=r,this.key=r.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=c,this.errors=p,this.expectedType=l,this._scope=f,this.options=x}parse(e,r,l,c,p={}){return r||l?this.concat(r,null,l,c)._parse(e,p):this._parse(e,p)}parseObjectValue(e,r,l,c,p,f={}){return this.concat(r,l,c,p)._parse(e,f)}_parse(e,r){function l(c,p,f){return f==="assert"?new ri(p,[c]):f==="coerce"?new Do(p,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let p=c.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,x=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else p=l(p,f,r.typeAnnotation||"coerce");else p=l(p,f,r.typeAnnotation||"assert")}if(!(p instanceof mi)&&p.type.kind!=="resolvedImage"&&ng(p)){const f=new $h(this._scope,this.options);try{p=new mi(p.type,p.evaluate(f))}catch(x){return this.error(x.message),null}}return p}return Do.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l,c){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof r=="string"?p.concat(r):p;const f=c?this.scope.concat(c):this.scope;return new Fp(this.registry,p,l||null,f,this.errors,this._scope,this.options)}error(e,...r){const l=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new fo(l,e))}checkSubtype(e,r){const l=Qc(e,r);return l&&this.error(l),l}}function ng(n){if(n instanceof Lp)return ng(n.boundExpression);if(n instanceof es&&n.name==="error"||n instanceof va||n instanceof bs||n instanceof fc||n instanceof uu)return!1;const e=n instanceof Do||n instanceof ri;let r=!0;return n.eachChild(l=>{r=e?r&&ng(l):r&&l instanceof mi}),!!r&&lu(n)&&cu(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Op(n,e){const r=n.length-1;let l,c,p=0,f=r,x=0;for(;p<=f;)if(x=Math.floor((p+f)/2),l=n[x],c=n[x+1],l<=e){if(x===r||e<c)return x;p=x+1}else{if(!(l>e))throw new In("Input is not a number.");f=x-1}return 0}class Xh{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,p]of l)this.labels.push(c),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,$t);if(!l)return null;const c=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let f=1;f<e.length;f+=2){const x=f===1?-1/0:e[f],b=e[f+1],S=f,I=f+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(c.length&&c[c.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const A=r.parse(b,I,p);if(!A)return null;p=p||A.type,c.push([x,A])}return new Xh(p,l,c)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return l[0].evaluate(e);const p=r.length;return c>=r[p-1]?l[p-1].evaluate(e):l[Op(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Wy=.95047,Zy=1.08883,Xy=4/29,vl=6/29,Yy=3*vl*vl,Ky=vl*vl*vl,yw=Math.PI/180,xw=180/Math.PI;function sg(n){return n>Ky?Math.pow(n,1/3):n/Yy+Xy}function Bp(n){return n>vl?n*n*n:Yy*(n-Xy)}function Vp(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function wl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function og(n){const e=wl(n.r),r=wl(n.g),l=wl(n.b),c=sg((.4124564*e+.3575761*r+.1804375*l)/Wy),p=sg((.2126729*e+.7151522*r+.072175*l)/1);return{l:116*p-16,a:500*(c-p),b:200*(p-sg((.0193339*e+.119192*r+.9503041*l)/Zy)),alpha:n.a}}function ag(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,l=isNaN(n.b)?e:e-n.b/200;return e=1*Bp(e),r=Wy*Bp(r),l=Zy*Bp(l),new pr(Vp(3.2404542*r-1.5371385*e-.4985314*l),Vp(-.969266*r+1.8760108*e+.041556*l),Vp(.0556434*r-.2040259*e+1.0572252*l),n.alpha)}function vw(n,e,r){const l=e-n;return n+r*(l>180||l<-180?l-360*Math.round(l/360):l)}const mc={forward:og,reverse:ag,interpolate:function(n,e,r){return{l:si(n.l,e.l,r),a:si(n.a,e.a,r),b:si(n.b,e.b,r),alpha:si(n.alpha,e.alpha,r)}}},gc={forward:function(n){const{l:e,a:r,b:l}=og(n),c=Math.atan2(l,r)*xw;return{h:c<0?c+360:c,c:Math.sqrt(r*r+l*l),l:e,alpha:n.a}},reverse:function(n){const e=n.h*yw,r=n.c;return ag({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:vw(n.h,e.h,r),c:si(n.c,e.c,r),l:si(n.l,e.l,r),alpha:si(n.alpha,e.alpha,r)}}};var Qy=Object.freeze({__proto__:null,hcl:gc,lab:mc});class go{constructor(e,r,l,c,p){this.type=e,this.operator=r,this.interpolation=l,this.input=c,this.labels=[],this.outputs=[];for(const[f,x]of p)this.labels.push(f),this.outputs.push(x)}static interpolationFactor(e,r,l,c){let p=0;if(e.name==="exponential")p=Up(r,e.base,l,c);else if(e.name==="linear")p=Up(r,1,l,c);else if(e.name==="cubic-bezier"){const f=e.controlPoints;p=new Xo(f[0],f[1],f[2],f[3]).solve(Up(r,1,l,c))}return p}static parse(e,r){let[l,c,p,...f]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const S=c[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:S}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const S=c.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,$t),!p)return null;const x=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=Qs:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<f.length;S+=2){const I=f[S],A=f[S+1],M=S+3,N=S+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(x.length&&x[x.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const z=r.parse(A,N,b);if(!z)return null;b=b||z.type,x.push([I,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new go(b,l,c,p,x):r.error(`Type ${Dn(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return l[0].evaluate(e);const p=r.length;if(c>=r[p-1])return l[p-1].evaluate(e);const f=Op(r,c),x=go.interpolationFactor(this.interpolation,c,r[f],r[f+1]),b=l[f].evaluate(e),S=l[f+1].evaluate(e);return this.operator==="interpolate"?Fh[this.type.kind.toLowerCase()](b,S,x):this.operator==="interpolate-hcl"?gc.reverse(gc.interpolate(gc.forward(b),gc.forward(S),x)):mc.reverse(mc.interpolate(mc.forward(b),mc.forward(S),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)r.push(this.labels[l],this.outputs[l].serialize());return r}}function Up(n,e,r,l){const c=l-r,p=n-r;return c===0?0:e===1?p/c:(Math.pow(e,p)-1)/(Math.pow(e,c)-1)}class Yh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const c=r.expectedType;c&&c.kind!=="value"&&(l=c);const p=[];for(const x of e.slice(1)){const b=r.parse(x,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,p.push(b)}const f=c&&p.some(x=>Qc(c,x.type));return new Yh(f?fr:l,p)}evaluate(e){let r,l=null,c=0;for(const p of this.args){if(c++,l=p.evaluate(e),l&&l instanceof Us&&!l.available&&(r||(r=l),l=null,c===this.args.length))return r;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Gp{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const f=e[p];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=r.parse(e[p+1],p+1);if(!x)return null;l.push([f,x])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return c?new Gp(l,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,l]of this.bindings)e.push(r,l.serialize());return e.push(this.result.serialize()),e}}class lg{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,$t),c=r.parse(e[2],2,Ps(r.expectedType||fr));return l&&c?new lg(c.type.itemType,l,c):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new In(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new In(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new In(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class cg{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,$t),c=r.parse(e[2],2,Ps(r.expectedType||fr));return l&&c?new cg(c.type.itemType,l,c):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new In(`Array index out of bounds: ${r} < 0.`);if(r>l.length-1)throw new In(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r===Math.floor(r))return l[r];const c=Math.floor(r),p=Math.ceil(r),f=l[c],x=l[p];if(typeof f!="number"||typeof x!="number")throw new In(`Cannot interpolate between non-number values at index ${r}.`);const b=r-c;return f*(1-b)+x*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class $p{constructor(e,r){this.type=ar,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,fr),c=r.parse(e[2],2,fr);return l&&c?_l(l.type,[ar,br,$t,Kc,fr])?new $p(l,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Vh(r,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Mt(r))} instead.`);if(!Vh(l,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Dn(Mt(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Kh{constructor(e,r,l){this.type=$t,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,fr),c=r.parse(e[2],2,fr);if(!l||!c)return null;if(!_l(l.type,[ar,br,$t,Kc,fr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(l.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,$t);return p?new Kh(l,c,p):null}return new Kh(l,c)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Vh(r,["boolean","string","number","null"]))throw new In(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(Mt(r))} instead.`);if(!Vh(l,["string","array"]))throw new In(`Expected second argument to be of type array or string, but found ${Dn(Mt(l))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return l.indexOf(r,c)}return l.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hu{constructor(e,r,l,c,p,f){this.inputType=e,this.type=r,this.input=l,this.cases=c,this.outputs=p,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const p={},f=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const A=e[S+1];Array.isArray(I)||(I=[I]);const M=r.concat(S);if(I.length===0)return M.error("Expected at least one branch label.");for(const z of I){if(typeof z!="number"&&typeof z!="string")return M.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return M.error("Numeric branch labels must be integer values.");if(l){if(M.checkSubtype(l,Mt(z)))return null}else l=Mt(z);if(p[String(z)]!==void 0)return M.error("Branch labels must be unique.");p[String(z)]=f.length}const N=r.parse(A,S,c);if(!N)return null;c=c||N.type,f.push(N)}const x=r.parse(e[1],1,fr);if(!x)return null;const b=r.parse(e[e.length-1],e.length-1,c);return b?x.type.kind!=="value"&&r.concat(1).checkSubtype(l,x.type)?null:new hu(l,c,x,p,f,b):null}evaluate(e){const r=this.input.evaluate(e);return(Ep(Mt(r),this.inputType)&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),l=[],c={};for(const f of r){const x=c[this.cases[f]];x===void 0?(c[this.cases[f]]=l.length,l.push([this.cases[f],[f]])):l[x][1].push(f)}const p=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,x]of l)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class ug{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const c=[];for(let f=1;f<e.length-1;f+=2){const x=r.parse(e[f],f,ar);if(!x)return null;const b=r.parse(e[f+1],f+1,l);if(!b)return null;c.push([x,b]),l=l||b.type}const p=r.parse(e[e.length-1],e.length-1,l);return p?new ug(l,c,p):null}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Qh{constructor(e,r,l,c){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,fr),c=r.parse(e[2],2,$t);if(!l||!c)return null;if(!_l(l.type,[Ps(fr),br,fr]))return r.error(`Expected first argument to be of type array or string, but found ${Dn(l.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,$t);return p?new Qh(l.type,l,c,p):null}return new Qh(l.type,l,c)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Vh(r,["string","array"]))throw new In(`Expected first argument to be of type array or string, but found ${Dn(Mt(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(l,c)}return r.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jy(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ex(n,e,r,l){return l.compare(e,r)===0}function _c(n,e,r){const l=n!=="=="&&n!=="!=";return class PL{constructor(p,f,x){this.type=ar,this.lhs=p,this.rhs=f,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const x=p[0];let b=f.parse(p[1],1,fr);if(!b)return null;if(!Jy(x,b.type))return f.concat(1).error(`"${x}" comparisons are not supported for type '${Dn(b.type)}'.`);let S=f.parse(p[2],2,fr);if(!S)return null;if(!Jy(x,S.type))return f.concat(2).error(`"${x}" comparisons are not supported for type '${Dn(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${Dn(b.type)}' and '${Dn(S.type)}'.`);l&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new ri(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new ri(b.type,[S])));let I=null;if(p.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(I=f.parse(p[3],3,Tp),!I)return null}return new PL(b,S,I)}evaluate(p){const f=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const b=Mt(f),S=Mt(x);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new In(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=Mt(f),S=Mt(x);if(b.kind!=="string"||S.kind!=="string")return e(p,f,x)}return this.collator?r(p,f,x,this.collator.evaluate(p)):e(p,f,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(f=>{p.push(f.serialize())}),p}}}const tx=_c("==",function(n,e,r){return e===r},ex),ww=_c("!=",function(n,e,r){return e!==r},function(n,e,r,l){return!ex(0,e,r,l)}),bw=_c("<",function(n,e,r){return e<r},function(n,e,r,l){return l.compare(e,r)<0}),Sw=_c(">",function(n,e,r){return e>r},function(n,e,r,l){return l.compare(e,r)>0}),qp=_c("<=",function(n,e,r){return e<=r},function(n,e,r,l){return l.compare(e,r)<=0}),Tw=_c(">=",function(n,e,r){return e>=r},function(n,e,r,l){return l.compare(e,r)>=0});class Hp{constructor(e,r,l,c,p,f){this.type=br,this.number=e,this.locale=r,this.currency=l,this.unit=c,this.minFractionDigits=p,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,$t);if(!l)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=r.parseObjectValue(c.locale,2,"locale",br),!p))return null;let f=null;if(c.currency&&(f=r.parseObjectValue(c.currency,2,"currency",br),!f))return null;let x=null;if(c.unit&&(x=r.parseObjectValue(c.unit,2,"unit",br),!x))return null;let b=null;if(c["min-fraction-digits"]&&(b=r.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",$t),!b))return null;let S=null;return c["max-fraction-digits"]&&(S=r.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",$t),!S)?null:new Hp(l,p,f,x,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hg{constructor(e){this.type=$t,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Dn(l.type)} instead.`):new hg(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new In(`Expected value to be of type string or array, but found ${Dn(Mt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function ix(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const yc={"==":tx,"!=":ww,">":Sw,"<":bw,">=":Tw,"<=":qp,array:ri,at:lg,"at-interpolated":cg,boolean:ri,case:ug,coalesce:Yh,collator:va,format:Jc,image:eu,in:$p,"index-of":Kh,interpolate:go,"interpolate-hcl":go,"interpolate-lab":go,length:hg,let:Gp,literal:mi,match:hu,number:ri,"number-format":Hp,object:ri,slice:Qh,step:Xh,string:ri,"to-boolean":Do,"to-color":Do,"to-number":Do,"to-string":Do,var:Lp,within:bs,distance:fc,config:uu};function dg(n,[e,r,l,c]){e=e.evaluate(n),r=r.evaluate(n),l=l.evaluate(n);const p=c?c.evaluate(n):1,f=hc(e,r,l,p);if(f)throw new In(f);return new pr(e/255,r/255,l/255,p)}function pg(n,[e,r,l,c]){e=e.evaluate(n),r=r.evaluate(n),l=l.evaluate(n);const p=c?c.evaluate(n):1,f=function(S,I,A,M){return typeof S=="number"&&S>=0&&S<=360?typeof I=="number"&&I>=0&&I<=100&&typeof A=="number"&&A>=0&&A<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[S,I,A,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[S,I,A,M]:[S,I,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[S,I,A,M]:[S,I,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,l,p);if(f)throw new In(f);const x=`hsla(${e}, ${r}%, ${l}%, ${p})`,b=pr.parse(x);if(!b)throw new In(`Failed to parse HSLA color: ${x}`);return b}function rx(n,e){return n in e}function bl(n,e){const r=e[n];return r===void 0?null:r}function xc(n){return{type:n}}function nx(n){return{result:"success",value:n}}function Sl(n){return{result:"error",value:n}}function Wp(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Jh(n){return n["property-type"]==="data-driven"}function fg(n){return Wp(n.expression,"measure-light")}function mg(n){return Wp(n.expression,"zoom")}function ed(n){return!!n.expression&&n.expression.interpolated}function td(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function sx(n){return n}function ox(n,e){const r=e.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",c=l||!(l||n.property!==void 0),p=n.type||(ed(e)?"exponential":"interval");if(r&&((n=uc({},n)).stops&&(n.stops=n.stops.map(S=>[S[0],pr.parse(S[1])])),n.default=pr.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Qy[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,x,b;if(p==="exponential")f=gg;else if(p==="interval")f=Cw;else if(p==="categorical"){f=Ew,x=Object.create(null);for(const S of n.stops)x[S[0]]=S[1];b=typeof n.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);f=Iw}if(l){const S={},I=[];for(let N=0;N<n.stops.length;N++){const z=n.stops[N],B=z[0].zoom;S[B]===void 0&&(S[B]={zoom:B,type:n.type,property:n.property,default:n.default,stops:[]},I.push(B)),S[B].stops.push([z[0].value,z[1]])}const A=[];for(const N of I)A.push([S[N].zoom,ox(S[N],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:go.interpolationFactor.bind(void 0,M),zoomStops:A.map(N=>N[0]),evaluate:({zoom:N},z)=>gg({stops:A,base:n.base},e,N).evaluate(N,z)}}if(c){const S=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:go.interpolationFactor.bind(void 0,S),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>f(n,e,I,x,b)}}return{kind:"source",evaluate(S,I){const A=I&&I.properties?I.properties[n.property]:void 0;return A===void 0?jo(n.default,e.default):f(n,e,A,x,b)}}}function jo(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function Ew(n,e,r,l,c){return jo(typeof r===c?l[r]:void 0,n.default,e.default)}function Cw(n,e,r){if(yl(r)!=="number")return jo(n.default,e.default);const l=n.stops.length;if(l===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const c=Op(n.stops.map(p=>p[0]),r);return n.stops[c][1]}function gg(n,e,r){const l=n.base!==void 0?n.base:1;if(yl(r)!=="number")return jo(n.default,e.default);const c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const p=Op(n.stops.map(I=>I[0]),r),f=function(I,A,M,N){const z=N-M,B=I-M;return z===0?0:A===1?B/z:(Math.pow(A,B)-1)/(Math.pow(A,z)-1)}(r,l,n.stops[p][0],n.stops[p+1][0]),x=n.stops[p][1],b=n.stops[p+1][1];let S=Fh[e.type]||sx;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=Qy[n.colorSpace];S=(A,M)=>I.reverse(I.interpolate(I.forward(A),I.forward(M),f))}return typeof x.evaluate=="function"?{evaluate(...I){const A=x.evaluate.apply(void 0,I),M=b.evaluate.apply(void 0,I);if(A!==void 0&&M!==void 0)return S(A,M,f)}}:S(x,b,f)}function Iw(n,e,r){return e.type==="color"?r=pr.parse(r):e.type==="formatted"?r=Ms.fromString(r.toString()):e.type==="resolvedImage"?r=Us.build(r.toString()):yl(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),jo(r,n.default,e.default)}es.register(yc,{error:[{kind:"error"},[br],(n,[e])=>{throw new In(e.evaluate(n))}],typeof:[br,[fr],(n,[e])=>Dn(Mt(e.evaluate(n)))],"to-rgba":[Ps($t,4),[Qs],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ps($t,4),[Qs],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Qs,[$t,$t,$t],dg],rgba:[Qs,[$t,$t,$t,$t],dg],hsl:[Qs,[$t,$t,$t],pg],hsla:[Qs,[$t,$t,$t,$t],pg],has:{type:ar,overloads:[[[br],(n,[e])=>rx(e.evaluate(n),n.properties())],[[br,Ba],(n,[e,r])=>rx(e.evaluate(n),r.evaluate(n))]]},get:{type:fr,overloads:[[[br],(n,[e])=>bl(e.evaluate(n),n.properties())],[[br,Ba],(n,[e,r])=>bl(e.evaluate(n),r.evaluate(n))]]},"feature-state":[fr,[br],(n,[e])=>bl(e.evaluate(n),n.featureState||{})],properties:[Ba,[],n=>n.properties()],"geometry-type":[br,[],n=>n.geometryType()],worldview:[br,[],n=>n.globals.worldview||""],id:[fr,[],n=>n.id()],zoom:[$t,[],n=>n.globals.zoom],pitch:[$t,[],n=>n.globals.pitch||0],"distance-from-center":[$t,[],n=>n.distanceFromCenter()],"measure-light":[$t,[br],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[$t,[],n=>n.globals.heatmapDensity||0],"line-progress":[$t,[],n=>n.globals.lineProgress||0],"raster-value":[$t,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[$t,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[$t,[],n=>n.globals.skyRadialProgress||0],accumulated:[fr,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[$t,xc($t),(n,e)=>{let r=0;for(const l of e)r+=l.evaluate(n);return r}],"*":[$t,xc($t),(n,e)=>{let r=1;for(const l of e)r*=l.evaluate(n);return r}],"-":{type:$t,overloads:[[[$t,$t],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[$t],(n,[e])=>-e.evaluate(n)]]},"/":[$t,[$t,$t],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[$t,[$t,$t],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[$t,[$t],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[$t,[$t],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[$t,[$t],(n,[e])=>Math.log(e.evaluate(n))],log2:[$t,[$t],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[$t,[$t],(n,[e])=>Math.sin(e.evaluate(n))],cos:[$t,[$t],(n,[e])=>Math.cos(e.evaluate(n))],tan:[$t,[$t],(n,[e])=>Math.tan(e.evaluate(n))],asin:[$t,[$t],(n,[e])=>Math.asin(e.evaluate(n))],acos:[$t,[$t],(n,[e])=>Math.acos(e.evaluate(n))],atan:[$t,[$t],(n,[e])=>Math.atan(e.evaluate(n))],min:[$t,xc($t),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[$t,xc($t),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[$t,[$t],(n,[e])=>Math.abs(e.evaluate(n))],round:[$t,[$t],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[$t,[$t],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ar,[br,fr],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[ar,[fr],(n,[e])=>n.id()===e.value],"filter-type-==":[ar,[br],(n,[e])=>n.geometryType()===e.value],"filter-<":[ar,[br,fr],(n,[e,r])=>{const l=n.properties()[e.value],c=r.value;return typeof l==typeof c&&l<c}],"filter-id-<":[ar,[fr],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[ar,[br,fr],(n,[e,r])=>{const l=n.properties()[e.value],c=r.value;return typeof l==typeof c&&l>c}],"filter-id->":[ar,[fr],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[ar,[br,fr],(n,[e,r])=>{const l=n.properties()[e.value],c=r.value;return typeof l==typeof c&&l<=c}],"filter-id-<=":[ar,[fr],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[ar,[br,fr],(n,[e,r])=>{const l=n.properties()[e.value],c=r.value;return typeof l==typeof c&&l>=c}],"filter-id->=":[ar,[fr],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[ar,[fr],(n,[e])=>e.value in n.properties()],"filter-has-id":[ar,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ar,[Ps(br)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ar,[Ps(fr)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ar,[br,Ps(fr)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ar,[br,Ps(fr)],(n,[e,r])=>function(l,c,p,f){for(;p<=f;){const x=p+f>>1;if(c[x]===l)return!0;c[x]>l?f=x-1:p=x+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ar,overloads:[[[ar,ar],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[xc(ar),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:ar,overloads:[[[ar,ar],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[xc(ar),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[ar,[ar],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ar,[br],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[br,[br],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[br,[br],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[br,xc(fr),(n,e)=>e.map(r=>ko(r.evaluate(n))).join("")],"resolved-locale":[br,[Tp],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[$t,[$t,$t,fr],(n,e)=>{const[r,l,c]=e.map(f=>f.evaluate(n));if(r>l||r===l)return r;let p;if(typeof c=="string")p=function(f){let x=0;if(f.length===0)return x;for(let b=0;b<f.length;b++)x=(x<<5)-x+f.charCodeAt(b),x|=0;return x}(c);else{if(typeof c!="number")throw new In(`Invalid seed input: ${c}`);p=c}return r+ix(p)()*(l-r)}]});class du{constructor(e,r,l,c){this.expression=e,this._warningHistory={},this._evaluator=new $h(l,c),this._defaultValue=r?function(p){return p.type==="color"&&(td(p.default)||Array.isArray(p.default))?new pr(0,0,0,0):p.type==="color"?pr.parse(p.default)||null:p.default===void 0?null:p.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=zp(e)}evaluateWithoutErrorHandling(e,r,l,c,p,f,x,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,c,p,f,x,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new In(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function Zp(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in yc}function Ga(n,e,r,l){const c=new Fp(yc,[],e?function(f){const x={color:Qs,string:br,number:$t,enum:br,boolean:ar,formatted:Oh,resolvedImage:Bh};return f.type==="array"?Ps(x[f.value]||fr,f.length):x[f.type]}(e):void 0,void 0,void 0,r,l),p=c.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?nx(new du(p,e,r,l)):Sl(c.errors)}class id{constructor(e,r,l,c){this.kind=e,this._styleExpression=r,this.isLightConstant=l,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!jp(r.expression),this.configDependencies=zp(r.expression)}evaluateWithoutErrorHandling(e,r,l,c,p,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,c,p,f)}evaluate(e,r,l,c,p,f){return this._styleExpression.evaluate(e,r,l,c,p,f)}}class rd{constructor(e,r,l,c,p,f){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!jp(r.expression),this.isLightConstant=p,this.isLineProgressConstant=f,this.configDependencies=zp(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,l,c,p,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,c,p,f)}evaluate(e,r,l,c,p,f){return this._styleExpression.evaluate(e,r,l,c,p,f)}interpolationFactor(e,r,l){return this.interpolationType?go.interpolationFactor(this.interpolationType,e,r,l):0}}function ax(n,e,r,l){if((n=Ga(n,e,r,l)).result==="error")return n;const c=n.value.expression,p=lu(c);if(!p&&!Jh(e))return Sl([new fo("","data expressions not supported")]);const f=cu(c,["zoom","pitch","distance-from-center"]);if(!f&&!mg(e))return Sl([new fo("","zoom expressions not supported")]);const x=cu(c,["measure-light"]);if(!x&&!fg(e))return Sl([new fo("","measure-light expression not supported")]);const b=cu(c,["line-progress"]);if(!b&&!function(A){return Wp(A.expression,"line-progress")}(e))return Sl([new fo("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,I=fu(c);return I||f||S?I instanceof fo?Sl([I]):I instanceof go&&!ed(e)?Sl([new fo("",'"interpolate" expressions cannot be used with this property')]):nx(I?new rd(p&&b?"camera":"composite",n.value,I.labels,I instanceof go?I.interpolation:void 0,x,b):new id(p&&b?"constant":"source",n.value,x,b)):Sl([new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pu{constructor(e,r){this._parameters=e,this._specification=r,uc(this,ox(this._parameters,this._specification))}static deserialize(e){return new pu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fu(n){let e=null;if(n instanceof Gp)e=fu(n.result);else if(n instanceof Yh){for(const r of n.args)if(e=fu(r),e)break}else(n instanceof Xh||n instanceof go)&&n.input instanceof es&&n.input.name==="zoom"&&(e=n);return e instanceof fo||n.eachChild(r=>{const l=fu(r);l instanceof fo?e=l:e&&l&&e!==l&&(e=new fo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Xp,_g,yg=function(){if(_g)return Xp;_g=1,Xp=e;var n=3;function e(r,l,c){var p=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(l=f[1])+2*(c=f[2]);for(var x=0;x<this.d*this.d;x++){var b=f[n+x],S=f[n+x+1];p.push(b===S?null:f.subarray(b,S))}var I=f[n+p.length+1];this.keys=f.subarray(f[n+p.length],I),this.bboxes=f.subarray(I),this.insert=this._insertReadonly}else{this.d=l+2*c;for(var A=0;A<this.d*this.d;A++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=c,this.scale=l/r,this.uid=0;var M=c/l*r;this.min=-M,this.max=r+M}return e.prototype.insert=function(r,l,c,p,f){this._forEachCell(l,c,p,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,l,c,p,f,x){this.cells[f].push(x)},e.prototype.query=function(r,l,c,p,f){var x=this.min,b=this.max;if(r<=x&&l<=x&&b<=c&&b<=p&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(r,l,c,p,this._queryCell,S,{},f),S},e.prototype._queryCell=function(r,l,c,p,f,x,b,S){var I=this.cells[f];if(I!==null)for(var A=this.keys,M=this.bboxes,N=0;N<I.length;N++){var z=I[N];if(b[z]===void 0){var B=4*z;(S?S(M[B+0],M[B+1],M[B+2],M[B+3]):r<=M[B+2]&&l<=M[B+3]&&c>=M[B+0]&&p>=M[B+1])?(b[z]=!0,x.push(A[z])):b[z]=!1}}},e.prototype._forEachCell=function(r,l,c,p,f,x,b,S){for(var I=this._convertToCellCoord(r),A=this._convertToCellCoord(l),M=this._convertToCellCoord(c),N=this._convertToCellCoord(p),z=I;z<=M;z++)for(var B=A;B<=N;B++){var q=this.d*B+z;if((!S||S(this._convertFromCellCoord(z),this._convertFromCellCoord(B),this._convertFromCellCoord(z+1),this._convertFromCellCoord(B+1)))&&f.call(this,r,l,c,p,q,x,b,S))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,l=n+this.cells.length+1+1,c=0,p=0;p<this.cells.length;p++)c+=this.cells[p].length;var f=new Int32Array(l+c+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var x=l,b=0;b<r.length;b++){var S=r[b];f[n+b]=x,f.set(S,x),x+=S.length}return f[n+r.length]=x,f.set(this.keys,x),f[n+r.length+1]=x+=this.keys.length,f.set(this.bboxes,x),x+=this.bboxes.length,f.buffer},Xp}(),$a=Yr(yg);const qa={};function Rt(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),qa[e]={klass:n,omit:r.omit||[]}}Rt(Object,"Object"),$a.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.add(r),{buffer:r}},$a.deserialize=function(n){return new $a(n.buffer)},Object.defineProperty($a,"name",{value:"Grid"}),Rt($a,"Grid"),typeof DOMMatrix<"u"&&Rt(DOMMatrix,"DOMMatrix"),Rt(pr,"Color"),Rt(Error,"Error"),Rt(Ms,"Formatted"),Rt(Cp,"FormattedSection"),Rt(Ji,"AJAXError"),Rt(Us,"ResolvedImage"),Rt(pu,"StylePropertyFunction"),Rt(du,"StyleExpression",{omit:["_evaluator"]}),Rt(Ks,"ImageId"),Rt(Va,"ImageVariant"),Rt(rd,"ZoomDependentExpression"),Rt(id,"ZoomConstantExpression"),Rt(es,"CompoundExpression",{omit:["_evaluate"]});for(const n in yc)qa[yc[n]._classRegistryKey]||Rt(yc[n],`Expression${n}`);function lx(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function cx(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Tl(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(lx(n)||cx(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const l of n)r.push(Tl(l,e));return r}if(n instanceof Map){const r={$name:"Map",entries:[]};for(const[l,c]of n.entries())r.entries.push(Tl(l),Tl(c,e));return r}if(n instanceof Set){const r={$name:"Set"};let l=0;for(const c of n.values())r[++l]=Tl(c);return r}if(n instanceof DOMMatrix){const r={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of l)r[c]=n[c];return r}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const r=n.constructor,l=r._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const c=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const p in n)n.hasOwnProperty(p)&&(qa[l].omit.indexOf(p)>=0||(c[p]=Tl(n[p],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(c.$name=l),c}throw new Error("can't serialize object of type "+typeof n)}function El(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||lx(n)||cx(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(El);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],p=new Map;for(let f=0;f<c.length;f+=2)p.set(El(c[f]),El(c[f+1]));return p}if(e==="Set"){const c=new Set;for(const p of Object.keys(n))p!=="$name"&&c.add(El(n[p]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:r}=qa[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(n);const l=Object.create(r.prototype);for(const c of Object.keys(n))c!=="$name"&&(l[c]=El(n[c]));return l}throw new Error("can't deserialize object of type "+typeof n)}const Jt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function nd(n){for(const e of n)if(xg(e.charCodeAt(0)))return!0;return!1}function Aw(n){for(const e of n)if(!Pw(e.charCodeAt(0)))return!1;return!0}function Pw(n){return!(Jt.Arabic(n)||Jt["Arabic Supplement"](n)||Jt["Arabic Extended-A"](n)||Jt["Arabic Presentation Forms-A"](n)||Jt["Arabic Presentation Forms-B"](n))}function xg(n){return!(n!==746&&n!==747&&(n<4352||!(Jt["Bopomofo Extended"](n)||Jt.Bopomofo(n)||Jt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Jt["CJK Compatibility Ideographs"](n)||Jt["CJK Compatibility"](n)||Jt["CJK Radicals Supplement"](n)||Jt["CJK Strokes"](n)||!(!Jt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Jt["CJK Unified Ideographs Extension A"](n)||Jt["CJK Unified Ideographs"](n)||Jt["Enclosed CJK Letters and Months"](n)||Jt["Hangul Compatibility Jamo"](n)||Jt["Hangul Jamo Extended-A"](n)||Jt["Hangul Jamo Extended-B"](n)||Jt["Hangul Jamo"](n)||Jt["Hangul Syllables"](n)||Jt.Hiragana(n)||Jt["Ideographic Description Characters"](n)||Jt.Kanbun(n)||Jt["Kangxi Radicals"](n)||Jt["Katakana Phonetic Extensions"](n)||Jt.Katakana(n)&&n!==12540||!(!Jt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Jt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](n)||Jt["Unified Canadian Aboriginal Syllabics Extended"](n)||Jt["Vertical Forms"](n)||Jt["Yijing Hexagram Symbols"](n)||Jt["Yi Syllables"](n)||Jt["Yi Radicals"](n))))}function ux(n){return!(xg(n)||function(e){return!!(Jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Jt["Letterlike Symbols"](e)||Jt["Number Forms"](e)||Jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Jt["Control Pictures"](e)&&e!==9251||Jt["Optical Character Recognition"](e)||Jt["Enclosed Alphanumerics"](e)||Jt["Geometric Shapes"](e)||Jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Jt["CJK Symbols and Punctuation"](e)||Jt.Katakana(e)||Jt["Private Use Area"](e)||Jt["CJK Compatibility Forms"](e)||Jt["Small Form Variants"](e)||Jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Mw(n){return Jt.Arabic(n)||Jt["Arabic Supplement"](n)||Jt["Arabic Extended-A"](n)||Jt["Arabic Presentation Forms-A"](n)||Jt["Arabic Presentation Forms-B"](n)}function hx(n){return n>=1424&&n<=2303||Jt["Arabic Presentation Forms-A"](n)||Jt["Arabic Presentation Forms-B"](n)}function Rw(n,e){return!(!e&&hx(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Jt.Khmer(n))}function kw(n){for(const e of n)if(hx(e.charCodeAt(0)))return!0;return!1}const Js={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let vg=null,ks=Js.unavailable,Ha=null;const vc=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(ks=Js.error),vg&&vg(n)};function Yp(){Kp.fire(new ac("pluginStateChange",{pluginStatus:ks,pluginURL:Ha}))}const Kp=new lc,mu=function(){return ks},dx=function(){if(ks!==Js.deferred||!Ha)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ks=Js.loading,Yp(),Ha&&jh({url:Ha},n=>{n?vc(n):(ks=Js.loaded,Yp())})},Wa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ks===Js.loaded||Wa.applyArabicShaping!=null,isLoading:()=>ks===Js.loading,setState(n){ks=n.pluginStatus,Ha=n.pluginURL},isParsing:()=>ks===Js.parsing,isParsed:()=>ks===Js.parsed,getPluginURL:()=>Ha};class Cr{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness,this.worldview=r.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,l){for(const c of r)if(!Rw(c.charCodeAt(0),l))return!1;return!0}(e,Wa.isLoaded())}}class sd{constructor(e,r,l,c){this.property=e,this.value=r,this.expression=function(p,f,x,b){if(td(p))return new pu(p,f);if(Zp(p)||Array.isArray(p)&&p.length>0){const S=ax(p,f,x,b);if(S.result==="error")throw new Error(S.value.map(I=>`${I.key}: ${I.message}`).join(", "));return S.value}{let S=p;return typeof p=="string"&&f.type==="color"&&(S=pr.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(r===void 0?e.specification.default:r,e.specification,l,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class Cl{constructor(e,r,l){this.property=e,this.value=new sd(e,void 0,r,l)}transitioned(e,r){return new fx(this.property,this.value,r,Be({},e.transition,this.transition),e.now)}untransitioned(){return new fx(this.property,this.value,null,{},0)}}class px{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return ci(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Cl(this._values[e].property,this._scope,this._options)),this._values[e].value=new sd(this._values[e].property,r===null?void 0:ci(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const l=this._properties.properties;if(e)for(const c in e){const p=e[c];if(c.endsWith("-transition")){const f=c.slice(0,-11);l[f]&&this.setTransition(f,p)}else l.hasOwnProperty(c)&&this.setValue(c,p)}}getTransition(e){return ci(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Cl(this._values[e].property)),this._values[e].transition=ci(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const l=new mx(this._properties);for(const c of Object.keys(this._values))l._values[c]=this._values[c].transitioned(e,r._values[c]);return l}untransitioned(){const e=new mx(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class fx{constructor(e,r,l,c,p){const f=c.delay||0,x=c.duration||0;p=p||0,this.property=e,this.value=r,this.begin=p+f,this.end=this.begin+x,e.specification.transition&&(c.delay||c.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const c=e.now||0,p=this.value.possiblyEvaluate(e,r,l),f=this.prior;if(f){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return f.possiblyEvaluate(e,r,l);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,l),p,ie(x))}}return p}}class mx{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const c=new wc(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,r,l);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Dw{constructor(e,r,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=l,this.configDependencies=new Set}getValue(e){return ci(this._values[e].value)}setValue(e,r){this._values[e]=new sd(this._values[e].property,r===null?void 0:ci(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const c=new wc(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(e,r,l);return c}}class gu{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,c){return this.property.evaluate(this.value,this.parameters,e,r,l,c)}}class wc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ft{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,l){const c=Fh[this.specification.type];return c?c(e,r,l):e}}class At{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,c){return new gu(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,c)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new gu(this,{kind:"constant",value:void 0},e.parameters);const c=Fh[this.specification.type];return c?new gu(this,{kind:"constant",value:c(e.value.value,r.value.value,l)},e.parameters):e}evaluate(e,r,l,c,p,f){return e.kind==="constant"?e.value:e.evaluate(r,l,c,p,f)}}class bc{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,c){return!!e.expression.evaluate(r,null,{},l,c)}interpolate(){return!1}}class hn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Cr(0,{});for(const l in e){const c=e[l];c.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new sd(c,void 0),f=this.defaultTransitionablePropertyValues[l]=new Cl(c);this.defaultTransitioningPropertyValues[l]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(r)}}}Rt(At,"DataDrivenProperty"),Rt(ft,"DataConstantProperty"),Rt(bc,"ColorRampProperty");var ze=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ia(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Qp(n){if(Array.isArray(n))return n.map(Qp);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=Qp(n[r]);return e}return ia(n)}function Jp(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Jp(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wg(n,e="",r=null,l="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jp(n)||(n=ef(n));const c=n;let p=!0;try{p=function(I){if(!_u(I))return I;let A=Qp(I);return _x(A),A=gx(A),A}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let f=null,x=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){x=ze[`filter_${l}`];const I=Ga(p,x,e,r);if(I.result==="error")throw new Error(I.value.map(A=>`${A.key}: ${A.message}`).join(", "));f=(A,M,N)=>I.value.evaluate(A,M,{},N)}let b=null,S=null;if(p!==c){const I=Ga(c,x,e,r);if(I.result==="error")throw new Error(I.value.map(A=>`${A.key}: ${A.message}`).join(", "));b=(A,M,N,z,B)=>I.value.evaluate(A,M,{},N,void 0,void 0,z,B),S=!lu(I.value.expression)}return{filter:f,dynamicFilter:b||void 0,needGeometry:yx(p),needFeature:!!S}}function gx(n){if(!Array.isArray(n))return n;const e=function(r){if(Nw.has(r[0])){for(let l=1;l<r.length;l++)if(_u(r[l]))return!0}return r}(n);return e===!0?e:e.map(r=>gx(r))}function _x(n){let e=!1;const r=[];if(n[0]==="case"){for(let l=1;l<n.length-1;l+=2)e=e||_u(n[l]),r.push(n[l+1]);r.push(n[n.length-1])}else if(n[0]==="match"){e=e||_u(n[1]);for(let l=2;l<n.length-1;l+=2)r.push(n[l+1]);r.push(n[n.length-1])}else if(n[0]==="step"){e=e||_u(n[1]);for(let l=1;l<n.length-1;l+=2)r.push(n[l+1])}e&&(n.length=0,n.push("any",...r));for(let l=1;l<n.length;l++)_x(n[l])}function _u(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<n.length;r++)if(_u(n[r]))return!0;return!1}const Nw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jw(n,e){return n<e?-1:n>e?1:0}function yx(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(yx(n[e]))return!0;return!1}function ef(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?bg(n[1],n[2],"=="):e==="!="?tf(bg(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?bg(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(ef))):e==="all"?["all"].concat(n.slice(1).map(ef)):e==="none"?["all"].concat(n.slice(1).map(ef).map(tf)):e==="in"?Sg(n[1],n.slice(2)):e==="!in"?tf(Sg(n[1],n.slice(2))):e==="has"?xx(n[1]):e!=="!has"||tf(xx(n[1]));var r}function bg(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Sg(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(jw)]]:["filter-in-small",n,["literal",e]]}}function xx(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function tf(n){return["!",n]}const od="";function Sc(n,e){return e?`${n}${od}${e}`:n}const Tg="-transition",Il=new Set(["fill","line","background","hillshade","raster"]);class Ss extends lc{constructor(e,r,l,c,p){if(super(),this.id=e.id,this.fqid=Sc(this.id,l),this.type=e.type,this.scope=l,this.lut=c,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Ga(this.filter,ze[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Dw(r.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new px(r.paint,this.scope,p);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wc(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Il.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Tg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const l=this._transitionablePaint,c=l._properties.properties;if(e.endsWith(Tg)){const A=e.slice(0,-11);return c[A]&&l.setTransition(A,r||void 0),!1}if(!c[e])return!1;const p=l._values[e],f=p.value.isDataDriven(),x=p.value;l.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=l._values[e].value,S=b.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return S||f||I||this._handleOverridablePaintPropertyUpdate(e,x,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,l){return null}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof gu&&Jh(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=wg(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,l,c,p,f,x,b,S){}}const zw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ad{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&r.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function er(n,e=1){let r=0,l=0;return{members:n.map(c=>{const p=zw[c.type].BYTES_PER_ELEMENT,f=r=Eg(r,Math.max(e,p)),x=c.components||1;return l=Math.max(l,p),r+=p*x,{name:c.name,type:c.type,components:x,offset:f}}),size:Eg(r,Math.max(l,e)),alignment:e}}function Eg(n,e){return Math.ceil(n/e)*e}class Za extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=l,e}}Za.prototype.bytesPerElement=4,Rt(Za,"StructArrayLayout2i4");class ld extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l)}emplace(e,r,l,c){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.int16[p+2]=c,e}}ld.prototype.bytesPerElement=6,Rt(ld,"StructArrayLayout3i6");class yu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,c)}emplace(e,r,l,c,p){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=l,this.int16[f+2]=c,this.int16[f+3]=p,e}}yu.prototype.bytesPerElement=8,Rt(yu,"StructArrayLayout4i8");class Al extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Al.prototype.bytesPerElement=4,Rt(Al,"StructArrayLayout1f4");class Cg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l)}emplace(e,r,l,c){const p=4*e,f=2*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.float32[f+1]=c,e}}Cg.prototype.bytesPerElement=8,Rt(Cg,"StructArrayLayout2i1f8");class rf extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l)}emplace(e,r,l,c){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=l,this.int16[p+2]=c,e}}rf.prototype.bytesPerElement=8,Rt(rf,"StructArrayLayout3i8");class xu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,c,p)}emplace(e,r,l,c,p,f){const x=5*e;return this.int16[x+0]=r,this.int16[x+1]=l,this.int16[x+2]=c,this.int16[x+3]=p,this.int16[x+4]=f,e}}xu.prototype.bytesPerElement=10,Rt(xu,"StructArrayLayout5i10");class Ig extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,c,p,f,x)}emplace(e,r,l,c,p,f,x,b){const S=6*e,I=12*e,A=3*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.uint8[I+4]=c,this.uint8[I+5]=p,this.uint8[I+6]=f,this.uint8[I+7]=x,this.float32[A+2]=b,e}}Ig.prototype.bytesPerElement=12,Rt(Ig,"StructArrayLayout2i4ub1f12");class ba extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l)}emplace(e,r,l,c){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=l,this.float32[p+2]=c,e}}ba.prototype.bytesPerElement=12,Rt(ba,"StructArrayLayout3f12");class Pl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,c,p)}emplace(e,r,l,c,p,f){const x=6*e,b=3*e;return this.uint16[x+0]=r,this.uint16[x+1]=l,this.uint16[x+2]=c,this.uint16[x+3]=p,this.float32[b+2]=f,e}}Pl.prototype.bytesPerElement=12,Rt(Pl,"StructArrayLayout4ui1f12");class cd extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,c)}emplace(e,r,l,c,p){const f=4*e;return this.uint16[f+0]=r,this.uint16[f+1]=l,this.uint16[f+2]=c,this.uint16[f+3]=p,e}}cd.prototype.bytesPerElement=8,Rt(cd,"StructArrayLayout4ui8");class nf extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,c,p,f)}emplace(e,r,l,c,p,f,x){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=c,this.int16[b+3]=p,this.int16[b+4]=f,this.int16[b+5]=x,e}}nf.prototype.bytesPerElement=12,Rt(nf,"StructArrayLayout6i12");class vu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A,M){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,l,c,p,f,x,b,S,I,A,M)}emplace(e,r,l,c,p,f,x,b,S,I,A,M,N){const z=12*e;return this.int16[z+0]=r,this.int16[z+1]=l,this.int16[z+2]=c,this.int16[z+3]=p,this.uint16[z+4]=f,this.uint16[z+5]=x,this.uint16[z+6]=b,this.uint16[z+7]=S,this.int16[z+8]=I,this.int16[z+9]=A,this.int16[z+10]=M,this.int16[z+11]=N,e}}vu.prototype.bytesPerElement=24,Rt(vu,"StructArrayLayout4i4ui4i24");class wu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,c,p,f)}emplace(e,r,l,c,p,f,x){const b=10*e,S=5*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=c,this.float32[S+2]=p,this.float32[S+3]=f,this.float32[S+4]=x,e}}wu.prototype.bytesPerElement=20,Rt(wu,"StructArrayLayout3i3f20");class as extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,c)}emplace(e,r,l,c,p){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=l,this.float32[f+2]=c,this.float32[f+3]=p,e}}as.prototype.bytesPerElement=16,Rt(as,"StructArrayLayout4f16");class bu extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}bu.prototype.bytesPerElement=4,Rt(bu,"StructArrayLayout1ul4");class Ml extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=l,e}}Ml.prototype.bytesPerElement=4,Rt(Ml,"StructArrayLayout2ui4");class Ag extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A,M,N){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,l,c,p,f,x,b,S,I,A,M,N)}emplace(e,r,l,c,p,f,x,b,S,I,A,M,N,z){const B=20*e,q=10*e;return this.int16[B+0]=r,this.int16[B+1]=l,this.int16[B+2]=c,this.int16[B+3]=p,this.int16[B+4]=f,this.float32[q+3]=x,this.float32[q+4]=b,this.float32[q+5]=S,this.float32[q+6]=I,this.int16[B+14]=A,this.uint32[q+8]=M,this.uint16[B+18]=N,this.uint16[B+19]=z,e}}Ag.prototype.bytesPerElement=40,Rt(Ag,"StructArrayLayout5i4f1i1ul2ui40");class sf extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,c,p,f,x)}emplace(e,r,l,c,p,f,x,b){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=l,this.int16[S+2]=c,this.int16[S+4]=p,this.int16[S+5]=f,this.int16[S+6]=x,this.int16[S+7]=b,e}}sf.prototype.bytesPerElement=16,Rt(sf,"StructArrayLayout3i2i2i16");class Pg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,c,p)}emplace(e,r,l,c,p,f){const x=4*e,b=8*e;return this.float32[x+0]=r,this.float32[x+1]=l,this.float32[x+2]=c,this.int16[b+6]=p,this.int16[b+7]=f,e}}Pg.prototype.bytesPerElement=16,Rt(Pg,"StructArrayLayout2f1f2i16");class ud extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,c,p,f)}emplace(e,r,l,c,p,f,x){const b=20*e,S=5*e;return this.uint8[b+0]=r,this.uint8[b+1]=l,this.float32[S+1]=c,this.float32[S+2]=p,this.float32[S+3]=f,this.float32[S+4]=x,e}}ud.prototype.bytesPerElement=20,Rt(ud,"StructArrayLayout2ub4f20");class ls extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,l)}emplace(e,r,l,c){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=l,this.uint16[p+2]=c,e}}ls.prototype.bytesPerElement=6,Rt(ls,"StructArrayLayout3ui6");class hd extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee)}emplace(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee,ae){const fe=30*e,Ae=15*e,Ee=60*e;return this.int16[fe+0]=r,this.int16[fe+1]=l,this.int16[fe+2]=c,this.float32[Ae+2]=p,this.float32[Ae+3]=f,this.uint16[fe+8]=x,this.uint16[fe+9]=b,this.uint32[Ae+5]=S,this.uint32[Ae+6]=I,this.uint32[Ae+7]=A,this.uint16[fe+16]=M,this.uint16[fe+17]=N,this.uint16[fe+18]=z,this.float32[Ae+10]=B,this.float32[Ae+11]=q,this.uint8[Ee+48]=K,this.uint8[Ee+49]=ne,this.uint8[Ee+50]=se,this.uint32[Ae+13]=V,this.int16[fe+28]=ee,this.uint8[Ee+58]=ae,e}}hd.prototype.bytesPerElement=60,Rt(hd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Mg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee,ae,fe,Ae,Ee,Pe,De,He,ut,it,lt,ht,Ze){const st=this.length;return this.resize(st+1),this.emplace(st,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee,ae,fe,Ae,Ee,Pe,De,He,ut,it,lt,ht,Ze)}emplace(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se,V,ee,ae,fe,Ae,Ee,Pe,De,He,ut,it,lt,ht,Ze,st){const $e=20*e,We=40*e,gt=80*e;return this.float32[$e+0]=r,this.float32[$e+1]=l,this.int16[We+4]=c,this.int16[We+5]=p,this.int16[We+6]=f,this.int16[We+7]=x,this.int16[We+8]=b,this.int16[We+9]=S,this.int16[We+10]=I,this.int16[We+11]=A,this.int16[We+12]=M,this.uint16[We+13]=N,this.uint16[We+14]=z,this.uint16[We+15]=B,this.uint16[We+16]=q,this.uint16[We+17]=K,this.uint16[We+18]=ne,this.uint16[We+19]=se,this.uint16[We+20]=V,this.uint16[We+21]=ee,this.uint16[We+22]=ae,this.uint16[We+23]=fe,this.uint16[We+24]=Ae,this.uint16[We+25]=Ee,this.uint16[We+26]=Pe,this.uint16[We+27]=De,this.uint32[$e+14]=He,this.float32[$e+15]=ut,this.float32[$e+16]=it,this.float32[$e+17]=lt,this.float32[$e+18]=ht,this.uint8[gt+76]=Ze,this.uint16[We+39]=st,e}}Mg.prototype.bytesPerElement=80,Rt(Mg,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Rg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,l,c,p,f)}emplace(e,r,l,c,p,f,x){const b=6*e;return this.float32[b+0]=r,this.float32[b+1]=l,this.float32[b+2]=c,this.float32[b+3]=p,this.float32[b+4]=f,this.float32[b+5]=x,e}}Rg.prototype.bytesPerElement=24,Rt(Rg,"StructArrayLayout6f24");class Rl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,c,p)}emplace(e,r,l,c,p,f){const x=5*e;return this.float32[x+0]=r,this.float32[x+1]=l,this.float32[x+2]=c,this.float32[x+3]=p,this.float32[x+4]=f,e}}Rl.prototype.bytesPerElement=20,Rt(Rl,"StructArrayLayout5f20");class dd extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,c,p,f,x)}emplace(e,r,l,c,p,f,x,b){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=l,this.float32[S+2]=c,this.float32[S+3]=p,this.float32[S+4]=f,this.float32[S+5]=x,this.float32[S+6]=b,e}}dd.prototype.bytesPerElement=28,Rt(dd,"StructArrayLayout7f28");class kg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,c,p,f,x,b,S,I,A)}emplace(e,r,l,c,p,f,x,b,S,I,A,M){const N=11*e;return this.float32[N+0]=r,this.float32[N+1]=l,this.float32[N+2]=c,this.float32[N+3]=p,this.float32[N+4]=f,this.float32[N+5]=x,this.float32[N+6]=b,this.float32[N+7]=S,this.float32[N+8]=I,this.float32[N+9]=A,this.float32[N+10]=M,e}}kg.prototype.bytesPerElement=44,Rt(kg,"StructArrayLayout11f44");class of extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,l,c,p,f,x,b,S)}emplace(e,r,l,c,p,f,x,b,S,I){const A=9*e;return this.float32[A+0]=r,this.float32[A+1]=l,this.float32[A+2]=c,this.float32[A+3]=p,this.float32[A+4]=f,this.float32[A+5]=x,this.float32[A+6]=b,this.float32[A+7]=S,this.float32[A+8]=I,e}}of.prototype.bytesPerElement=36,Rt(of,"StructArrayLayout9f36");class Tc extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=l,e}}Tc.prototype.bytesPerElement=8,Rt(Tc,"StructArrayLayout2f8");class Dg extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,l,c)}emplace(e,r,l,c,p){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=l,this.uint16[f+3]=c,this.uint16[f+4]=p,e}}Dg.prototype.bytesPerElement=12,Rt(Dg,"StructArrayLayout1ul3ui12");class pd extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}pd.prototype.bytesPerElement=2,Rt(pd,"StructArrayLayout1ui2");class Su extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q){const K=this.length;return this.resize(K+1),this.emplace(K,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q)}emplace(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K){const ne=16*e;return this.float32[ne+0]=r,this.float32[ne+1]=l,this.float32[ne+2]=c,this.float32[ne+3]=p,this.float32[ne+4]=f,this.float32[ne+5]=x,this.float32[ne+6]=b,this.float32[ne+7]=S,this.float32[ne+8]=I,this.float32[ne+9]=A,this.float32[ne+10]=M,this.float32[ne+11]=N,this.float32[ne+12]=z,this.float32[ne+13]=B,this.float32[ne+14]=q,this.float32[ne+15]=K,e}}Su.prototype.bytesPerElement=64,Rt(Su,"StructArrayLayout16f64");class fd extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,c,p,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,l,c,p,f,x)}emplace(e,r,l,c,p,f,x,b){const S=10*e,I=5*e;return this.uint16[S+0]=r,this.uint16[S+1]=l,this.uint16[S+2]=c,this.uint16[S+3]=p,this.float32[I+2]=f,this.float32[I+3]=x,this.float32[I+4]=b,e}}fd.prototype.bytesPerElement=20,Rt(fd,"StructArrayLayout4ui3f20");class Ng extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Ng.prototype.bytesPerElement=2,Rt(Ng,"StructArrayLayout1i2");class af extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}af.prototype.bytesPerElement=1,Rt(af,"StructArrayLayout1ub1");class vx extends ad{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}vx.prototype.size=40;class lf extends Ag{get(e){return new vx(this,e)}}Rt(lf,"CollisionBoxArray");class wx extends ad{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}wx.prototype.size=60;class bx extends hd{get(e){return new wx(this,e)}}Rt(bx,"PlacedSymbolArray");class Sx extends ad{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Sx.prototype.size=80;class Tx extends Mg{get(e){return new Sx(this,e)}}Rt(Tx,"SymbolInstanceArray");class jg extends Al{getoffsetX(e){return this.float32[1*e+0]}}Rt(jg,"GlyphOffsetArray");class Ex extends Za{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Rt(Ex,"SymbolLineVertexArray");class Cx extends ad{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Cx.prototype.size=12;class Ix extends Dg{get(e){return new Cx(this,e)}}Rt(Ix,"FeatureIndexArray");class Ax extends Ml{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Rt(Ax,"FillExtrusionCentroidArray");class Px extends ad{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Px.prototype.size=6;class Mx extends ld{get(e){return new Px(this,e)}}Rt(Mx,"FillExtrusionWallArray");const Lw=er([{name:"a_pos",components:2,type:"Int16"}],4),Fw=er([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),cf=er([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fn{constructor(e=[]){this.segments=e}_prepareSegment(e,r,l,c){let p=this.segments[this.segments.length-1];return e>fn.MAX_VERTEX_ARRAY_LENGTH&&Ei(`Max vertices per segment is ${fn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>fn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:r,primitiveOffset:l,vertexLength:0,primitiveLength:0},c!==void 0&&(p.sortKey=c),this.segments.push(p)),p}prepareSegment(e,r,l,c){return this._prepareSegment(e,r.length,l.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,c){return new fn([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:c,vaos:{},sortKey:0}])}}function Rx(n,e){return 256*(n=ve(Math.floor(n),0,255))+ve(Math.floor(e),0,255)}fn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(fn,"SegmentVector");const uf=er([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zg=er([{name:"a_pattern_b",components:4,type:"Uint16"}]),kx=er([{name:"a_dash",components:4,type:"Uint16"}]);class md{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,l,c){this.ids.push(Lg(e)),this.positions.push(r,l,c)}eachPosition(e,r){const l=Lg(e);let c=0,p=this.ids.length-1;for(;c<p;){const f=c+p>>1;this.ids[f]>=l?p=f:c=f+1}for(;this.ids[c]===l;)r(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,r){const l=new Float64Array(e.ids),c=new Uint32Array(e.positions);return hf(l,c,0,l.length-1),r&&(r.add(l.buffer),r.add(c.buffer)),{ids:l,positions:c}}static deserialize(e){const r=new md;let l;r.ids=e.ids,r.positions=e.positions;for(const c of r.ids)c!==l&&r.uniqueIds.push(c),l=c;return r.indexed=!0,r}}function Lg(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Lh(String(n))}function hf(n,e,r,l){for(;r<l;){const c=n[r+l>>1];let p=r-1,f=l+1;for(;;){do p++;while(n[p]<c);do f--;while(n[f]>c);if(p>=f)break;gd(n,p,f),gd(e,3*p,3*f),gd(e,3*p+1,3*f+1),gd(e,3*p+2,3*f+2)}f-r<l-f?(hf(n,e,r,f),r=f+1):(hf(n,e,f+1,l),l=f)}}function gd(n,e,r){const l=n[e];n[e]=n[r],n[r]=l}Rt(md,"FeaturePositionMap");class Xa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class df extends Xa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class Sn extends Xa{constructor(e){super(e),this.current=0}set(e,r,l){this.fetchUniformLocation(e,r)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Sa extends Xa{constructor(e){super(e),this.current=[0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class _d extends Xa{constructor(e){super(e),this.current=[0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class pf extends Xa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,l){this.fetchUniformLocation(e,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Dx extends Xa{constructor(e){super(e),this.current=pr.transparent.toPremultipliedRenderColor(null)}set(e,r,l){this.fetchUniformLocation(e,r)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Ow=new Float32Array(16);class Tu extends Xa{constructor(e){super(e),this.current=Ow}set(e,r,l){if(this.fetchUniformLocation(e,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let c=1;c<16;c++)if(l[c]!==this.current[c]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const Fg=new Float32Array(9),Ta=new Float32Array(4);class yd extends Xa{constructor(e){super(e),this.current=Ta}set(e,r,l){if(this.fetchUniformLocation(e,r)){for(let c=0;c<4;c++)if(l[c]!==this.current[c]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Og(n){return[Rx(255*n.r,255*n.g),Rx(255*n.b,255*n.a)]}class xd{constructor(e,r,l,c){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=l,this.context=c}setUniform(e,r,l,c,p){const f=c.constantOr(this.value);r.set(e,p,f instanceof pr?f.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,r){return this.type==="color"?new Dx(e):new Sn(e)}}class Eu{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,l,c,p){let f=null;p!=="u_pattern"&&p!=="u_dash"||(f=this.pattern),p==="u_pattern_b"&&(f=this.patternTransition),p==="u_pixel_ratio"&&(f=this.pixelRatio),f&&r.set(e,p,f)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new pf(e):new Sn(e)}}class Ya{constructor(e,r,l,c){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,l,c,p,f,x,b){const S=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Cr(0,{brightness:f,worldview:b}),r,{},p,c,x):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cr(0,{brightness:f,worldview:b}),r,{},p,c,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(S,e,I,A?null:this.context.lut)}updatePaintArray(e,r,l,c,p,f,x,b){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:b},l,c,void 0,p):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cr(0,{brightness:x,worldview:b}),l,c,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,I?null:this.context.lut)}_setPaintValue(e,r,l,c){if(this.type==="color"){const p=Og(l.toPremultipliedRenderColor(c));for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ra{constructor(e,r,l,c,p,f){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=c,this.context=p,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,l,c,p,f,x,b){const S=this.expression.evaluate(new Cr(this.context.zoom,{brightness:f,worldview:b}),r,{},p,c,x),I=this.expression.evaluate(new Cr(this.context.zoom+1,{brightness:f,worldview:b}),r,{},p,c,x),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cr(0,{brightness:f,worldview:b}),r,{},p,c,x):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,S,I,A?null:this.context.lut)}updatePaintArray(e,r,l,c,p,f,x,b){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:b},l,c,void 0,p),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:b},l,c,void 0,p),A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Cr(0,{brightness:x,worldview:b}),l,c,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,r,S,I,A?null:this.context.lut)}_setPaintValue(e,r,l,c,p){if(this.type==="color"){const f=Og(l.toPremultipliedRenderColor(p)),x=Og(l.toPremultipliedRenderColor(p));for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,f[0],f[1],x[0],x[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l,c);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,l,c,p){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=ve(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);r.set(e,p,x)}getBinding(e,r){return new Sn(e)}}class zo{constructor(e,r,l,c,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?kx:uf).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new c,this.paintTransitionVertexArray=new cd}populatePaintArray(e,r,l,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,c,p,f,x){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],f)}_setPaintValues(e,r,l,c){if(!c||!l)return;const p=c[l[0]],f=c[l[1]];if(p){if(p){const{tl:x,br:b,pixelRatio:S}=p;for(let I=e;I<r;I++)this.paintVertexArray.emplace(I,x[0],x[1],b[0],b[1],S)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:b}=f;for(let S=e;S<r;S++)this.paintTransitionVertexArray.emplace(S,x[0],x[1],b[0],b[1])}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,zg.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Cu{constructor(e,r,l=()=>!0){this.binders={},this._buffers=[],this.context=r;const c=[];for(const p in e.paint._values){const f=e.paint.get(p);if(p.endsWith("-use-theme")||!l(p)||!(f instanceof gu&&Jh(f.property.specification)))continue;const x=a(p,e.type),b=f.value,S=f.property.specification.type,I=!!f.property.useIntegerZoom,A=p==="line-dasharray"||p.endsWith("pattern"),M=e.paint.get(`${p}-use-theme`),N=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(b.kind!=="constant"||N)if(b.kind==="source"||N||A){const z=y(p,S,"source");this.binders[p]=A?new zo(b,x,S,z,e.id):new Ya(b,x,S,z),c.push(`/a_${p}`)}else{const z=y(p,S,"composite");this.binders[p]=new ra(b,x,S,I,r,z),c.push(`/z_${p}`)}else this.binders[p]=A?new Eu(b.value,x):new xd(b.value,x,S,r),c.push(`/u_${p}`);M&&(this.binders[p].lutExpression=M.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ya||r instanceof ra?r.maxValue:0}populatePaintArrays(e,r,l,c,p,f,x,b){for(const S in this.binders){const I=this.binders[S];I.context=this.context,(I instanceof Ya||I instanceof ra||I instanceof zo)&&I.populatePaintArray(e,r,l,c,p,f,x,b)}}setConstantPatternPositions(e,r){for(const l in this.binders){const c=this.binders[l];c instanceof Eu&&c.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof zo?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,l,c,p,f,x,b,S,I){let A=!1;const M=Object.keys(e),N=M.length!==0&&!b,z=N?M:r.uniqueIds;this.context.lut=p.lut;for(const B in this.binders){const q=this.binders[B];if(q.context=this.context,(q instanceof Ya||q instanceof ra||q instanceof zo)&&q.expression&&q.expression.kind&&q.expression.kind!=="constant"&&(q.expression.isStateDependent===!0||q.expression.isLightConstant===!1)){const K=p.paint.get(B);q.expression=K.value;for(const ne of z){const se=e[ne.toString()];r.eachPosition(ne,(V,ee,ae)=>{const fe=c.feature(V);q.updatePaintArray(ee,ae,fe,se,f,x,S,I)})}if(!N)for(const ne of l.uniqueIds){const se=e[ne.toString()];l.eachPosition(ne,(V,ee,ae)=>{const fe=c.feature(V);q.updatePaintArray(ee,ae,fe,se,f,x,S,I)})}A=!0}}return A}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof xd||l instanceof Eu)&&e.push(...l.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Ya||l instanceof ra||l instanceof zo)for(let c=0;c<l.paintVertexAttributes.length;c++)e.push(l.paintVertexAttributes[c].name);if(l instanceof zo)for(let c=0;c<zg.members.length;c++)e.push(zg.members[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof xd||l instanceof Eu||l instanceof ra)for(const c of l.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof xd||c instanceof Eu||c instanceof ra)for(const p of c.uniformNames)r.push({name:p,property:l,binding:c.getBinding(e,p)})}return r}setUniforms(e,r,l,c,p){for(const{name:f,property:x,binding:b}of l)this.binders[x].setUniform(e,b,p,c.get(x),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ya||r instanceof ra||r instanceof zo)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof zo&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof Ya||l instanceof ra||l instanceof zo)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ya||r instanceof ra||r instanceof zo)&&r.destroy()}}}class h{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Cu(c,r,l);this.needsUpload=!1,this._featureMap=new md,this._featureMapWithoutIds=new md,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,l,c,p,f,x,b,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,r,c,p,f,x,b,S);r.id!==void 0?this._featureMap.add(r.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,c,p,f,x,b){for(const S of l)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,S,c,p,f,x||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function a(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:Pl,composite:Pl},"fill-pattern":{source:Pl,composite:Pl},"fill-extrusion-pattern":{source:Pl,composite:Pl},"line-dasharray":{source:cd,composite:cd}},g={color:{source:Tc,composite:as},number:{source:Al,composite:Tc}};function y(n,e,r){const l=d[n];return l&&l[r]||g[e][r]}Rt(xd,"ConstantBinder"),Rt(Eu,"PatternConstantBinder"),Rt(Ya,"SourceExpressionBinder"),Rt(zo,"PatternCompositeBinder"),Rt(ra,"CompositeExpressionBinder"),Rt(Cu,"ProgramConfiguration",{omit:["_buffers"]}),Rt(h,"ProgramConfigurationSet");const v=bt/Math.PI/2,T=5,C=6,R=16383,k=64,L=[k,32,16],j=-v,F=v;function Z(n,e,r,l=v){return r=Qi(r),[n*Math.sin(r)*l,-e*l,n*Math.cos(r)*l]}function $(n,e,r){return Z(Math.cos(Qi(n)),Math.sin(Qi(n)),e,r)}const X=63710088e-1,J=2*Math.PI*X;class te{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new te(Oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,c=e.lat*r,p=Math.sin(l)*Math.sin(c)+Math.cos(l)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return X*Math.acos(Math.min(p,1))}toBounds(e=0){const r=360*e/40075017,l=r/Math.cos(Math.PI/180*this.lat);return new pe({lng:this.lng-l,lat:this.lat-r},{lng:this.lng+l,lat:this.lat+r})}toEcef(e){return $(this.lat,this.lng,v+e*v/X)}static convert(e){if(e instanceof te)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new te(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new te(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class pe{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{const l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof te?new te(e.lng,e.lat):te.convert(e),this}setSouthWest(e){return this._sw=e instanceof te?new te(e.lng,e.lat):te.convert(e),this}extend(e){const r=this._sw,l=this._ne;let c,p;if(e instanceof te)c=e,p=e;else{if(!(e instanceof pe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(pe.convert(e)):this.extend(te.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(te.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return r||l?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new te(c.lng,c.lat),this._ne=new te(p.lng,p.lat)),this}getCenter(){return new te((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new te(this.getWest(),this.getNorth())}getSouthEast(){return new te(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=te.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(e){if(e)return e instanceof pe?e:new pe(e)}}const ye=0,Se=25.5;function be(n){return J*Math.cos(n*Math.PI/180)}function we(n){return(180+n)/360}function xe(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Te(n,e){return n/be(e)}function Ce(n){return 360*n-180}function Le(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Fe(n,e){return n*be(Le(e))}const Ke=85.051129;function Qe(n){return Math.cos(Qi(ve(n,-85.051129,Ke)))}function at(n,e){const r=ve(e,ye,Se),l=Math.pow(2,r);return Qe(n)*J/(512*l)}function je(n){return 1/Math.cos(n*Math.PI/180)}function qe(n,e=0){const r=Math.exp(Math.PI*(1-(n.y+e/bt)/(1<<n.z)*2));return 80150034*r/(r*r+1)/bt/(1<<n.z)}class Re{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=te.convert(e);return new Re(we(l.lng),xe(l.lat),Te(r,l.lat))}toLngLat(){return new te(Ce(this.x),Le(this.y))}toAltitude(){return Fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/J*je(Le(this.y))}}function et(n,e,r,l,c,p,f,x,b){const S=(e+l)/2,I=(r+c)/2,A=new wt(S,I);x(A),function(M,N,z,B,q,K){const ne=z-q,se=B-K;return Math.abs((B-N)*ne-(z-M)*se)/Math.hypot(ne,se)}(A.x,A.y,p.x,p.y,f.x,f.y)>=b?(et(n,e,r,S,I,p,A,x,b),et(n,S,I,l,c,A,f,x,b)):n.push(f)}function Ue(n,e,r){let l=n[0],c=l.x,p=l.y;e(l);const f=[l];for(let x=1;x<n.length;x++){const b=n[x],{x:S,y:I}=b;e(b),et(f,c,p,S,I,l,b,e,r),c=S,p=I,l=b}return f}function nt(n,e,r,l){if(l(e,r)){const c=e.add(r)._mult(.5);nt(n,e,c,l),nt(n,c,r,l)}else n.push(r)}function xt(n,e){let r=n[0];const l=[r];for(let c=1;c<n.length;c++){const p=n[c];nt(l,r,p,e),r=p}return l}const Je=Math.pow(2,14)-1,_t=-Je-1;function kt(n,e){const r=Math.round(n.x*e),l=Math.round(n.y*e);return n.x=ve(r,_t,Je),n.y=ve(l,_t,Je),(r<n.x||r>n.x+1||l<n.y||l>n.y+1)&&Ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Dt(n,e,r){const l=n.loadGeometry(),c=n.extent,p=bt/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:x,x:b,y:S,projection:I}=r,A=M=>{const N=Ce((e.x+M.x/c)/f),z=Le((e.y+M.y/c)/f),B=I.project(N,z);M.x=(B.x*x-b)*c,M.y=(B.y*x-S)*c};for(let M=0;M<l.length;M++)if(n.type!==1)l[M]=Ue(l[M],A,1);else{const N=[];for(const z of l[M])z.x<0||z.x>=c||z.y<0||z.y>=c||(A(z),N.push(z));l[M]=N}}for(const f of l)for(const x of f)kt(x,p);return l}function Pt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Dt(n):[]}}var Ut,qt,Kt,pi,Ai,mr,zr,xr={};function Sr(){if(qt)return Ut;qt=1;var n=Yo();function e(c,p,f,x,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=x,this._values=b,c.readFields(r,this,p)}function r(c,p,f){c==1?p.id=f.readVarint():c==2?function(x,b){for(var S=x.readVarint()+x.pos;x.pos<S;){var I=b._keys[x.readVarint()],A=b._values[x.readVarint()];b.properties[I]=A}}(f,p):c==3?p.type=f.readVarint():c==4&&(p._geometry=f.pos)}function l(c){for(var p,f,x=0,b=0,S=c.length,I=S-1;b<S;I=b++)x+=((f=c[I]).x-(p=c[b]).x)*(p.y+f.y);return x}return Ut=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var p,f=c.readVarint()+c.pos,x=1,b=0,S=0,I=0,A=[];c.pos<f;){if(b<=0){var M=c.readVarint();x=7&M,b=M>>3}if(b--,x===1||x===2)S+=c.readSVarint(),I+=c.readSVarint(),x===1&&(p&&A.push(p),p=[]),p.push(new n(S,I));else{if(x!==7)throw new Error("unknown command "+x);p&&p.push(p[0].clone())}}return p&&A.push(p),A},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var p=c.readVarint()+c.pos,f=1,x=0,b=0,S=0,I=1/0,A=-1/0,M=1/0,N=-1/0;c.pos<p;){if(x<=0){var z=c.readVarint();f=7&z,x=z>>3}if(x--,f===1||f===2)(b+=c.readSVarint())<I&&(I=b),b>A&&(A=b),(S+=c.readSVarint())<M&&(M=S),S>N&&(N=S);else if(f!==7)throw new Error("unknown command "+f)}return[I,M,A,N]},e.prototype.toGeoJSON=function(c,p,f){var x,b,S=this.extent*Math.pow(2,f),I=this.extent*c,A=this.extent*p,M=this.loadGeometry(),N=e.types[this.type];function z(K){for(var ne=0;ne<K.length;ne++){var se=K[ne];K[ne]=[360*(se.x+I)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(se.y+A)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(x=0;x<M.length;x++)B[x]=M[x][0];z(M=B);break;case 2:for(x=0;x<M.length;x++)z(M[x]);break;case 3:for(M=function(K){var ne=K.length;if(ne<=1)return[K];for(var se,V,ee=[],ae=0;ae<ne;ae++){var fe=l(K[ae]);fe!==0&&(V===void 0&&(V=fe<0),V===fe<0?(se&&ee.push(se),se=[K[ae]]):se.push(K[ae]))}return se&&ee.push(se),ee}(M),x=0;x<M.length;x++)for(b=0;b<M[x].length;b++)z(M[x][b])}M.length===1?M=M[0]:N="Multi"+N;var q={type:"Feature",geometry:{type:N,coordinates:M},properties:this.properties};return"id"in this&&(q.id=this.id),q},Ut}function xn(){if(pi)return Kt;pi=1;var n=Sr();function e(l,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(r,this,c),this.length=this._features.length}function r(l,c,p){l===15?c.version=p.readVarint():l===1?c.name=p.readString():l===5?c.extent=p.readVarint():l===2?c._features.push(p.pos):l===3?c._keys.push(p.readString()):l===4&&c._values.push(function(f){for(var x=null,b=f.readVarint()+f.pos;f.pos<b;){var S=f.readVarint()>>3;x=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return x}(p))}return Kt=e,e.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)},Kt}function wi(){return zr||(zr=1,xr.VectorTile=function(){if(mr)return Ai;mr=1;var n=xn();function e(r,l,c){if(r===3){var p=new n(c,c.readVarint()+c.pos);p.length&&(l[p.name]=p)}}return Ai=function(r,l){this.layers=r.readFields(e,{},l)},Ai}(),xr.VectorTileFeature=Sr(),xr.VectorTileLayer=xn()),xr}var Ri=wi();const Bi="3d_elevation_id",Gr="level";class An{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,l){return this.get(e,!0,r,l)}optional(e,r,l){return this.get(e,!1,r,l)}success(){return this._valid}get(e,r,l,c){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?l(c?c(p):p):r&&(this._valid=!1),this}}class Lr{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,l){return this.featureFunc(e,r,l)}parseVertex(e,r,l){return this.vertexFunc(e,r,l)}}const or=new Lr((n,e,r)=>n.reset(e).require(Bi,l=>{r.id=l}).optional("fixed_height_relative",l=>{r.constantHeight=l},Xi.decodeRelativeHeight).geometry(l=>{r.bounds=l},Hm).success(),(n,e,r)=>n.reset(e).require(Bi,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height_relative",l=>{r.height=l},Xi.decodeRelativeHeight).geometry(l=>{r.position=l},Xi.getPoint).success()),dn=new Lr((n,e,r)=>n.reset(e).require(Bi,l=>{r.id=l}).optional("fixed_height",l=>{r.constantHeight=l},Xi.decodeMetricHeight).geometry(l=>{r.bounds=l},Hm).success(),(n,e,r)=>n.reset(e).require(Bi,l=>{r.id=l}).require("elevation_idx",l=>{r.idx=l}).require("extent",l=>{r.extent=l}).require("height",l=>{r.height=l},Xi.decodeMetricHeight).geometry(l=>{r.position=l},Xi.getPoint).success());class Xi{static getPoint(e){return xs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],l=[],c=e.length,p=new An;for(let x=0;x<c;x++){const b=e.feature(x),S=b.properties.hasOwnProperty("version")?String(b.properties.version):void 0,I=(f=S)?f==="1.0.1"?dn:void 0:or;if(I===void 0){Ei(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const A=b.properties.hasOwnProperty("type")?b.properties.type:void 0;if(A){if(Ri.VectorTileFeature.types[b.type]==="Point"&&A==="curve_point"){const M={};I.parseVertex(p,b,M)&&r.push(M)}else if(Ri.VectorTileFeature.types[b.type]==="Polygon"&&A==="curve_meta"){const M={};I.parseFeature(p,b,M)&&l.push(M)}}}var f;return{vertices:r,features:l}}}class Tn{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const c=di(r,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/c;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,!0}}class $r{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,l){const c=Ii(r,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/c;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,r,l){if(function(N,z){var B=N[0],q=N[1],K=N[2],ne=z[0],se=z[1],V=z[2];return Math.abs(B-ne)<=D*Math.max(1,Math.abs(B),Math.abs(ne))&&Math.abs(q-se)<=D*Math.max(1,Math.abs(q),Math.abs(se))&&Math.abs(K-V)<=D*Math.max(1,Math.abs(K),Math.abs(V))}(this.pos,e)||r===0)return l[0]=l[1]=l[2]=0,!1;const[c,p,f]=this.dir,x=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],I=c*c+p*p+f*f,A=2*(x*c+b*p+S*f),M=A*A-4*I*(x*x+b*b+S*S-r*r);if(M<0){const N=Math.max(-A/2,0),z=x+c*N,B=b+p*N,q=S+f*N,K=Math.hypot(z,B,q);return l[0]=z*r/K,l[1]=B*r/K,l[2]=q*r/K,!1}{const N=(-A-Math.sqrt(M))/(2*I);if(N<0){const z=Math.hypot(x,b,S);return l[0]=x*r/z,l[1]=b*r/z,l[2]=S*r/z,!1}return l[0]=x+c*N,l[1]=b+p*N,l[2]=S+f*N,!0}}}class Mr{constructor(e,r,l,c,p){this.TL=e,this.TR=r,this.BR=l,this.BL=c,this.horizon=p}static fromInvProjectionMatrix(e,r,l){const c=[-1,1,1],p=[1,1,1],f=[1,-1,1],x=[-1,-1,1],b=ji(c,c,e),S=ji(p,p,e),I=ji(f,f,e),A=ji(x,x,e);return new Mr(b,S,I,A,r/l)}}function qr(n,e,r){let l=1/0,c=-1/0;const p=[];for(const f of n){dr(p,f,e);const x=Ii(p,r);l=Math.min(l,x),c=Math.max(c,x)}return[l,c]}function lr(n,e){let r=!0;for(let l=0;l<n.planes.length;l++){const c=n.planes[l];let p=0;for(let f=0;f<e.length;f++)p+=Ii(c,e[f])+c[3]>=0;if(p===0)return 0;p!==e.length&&(r=!1)}return r?2:1}function mn(n,e){for(const r of n.projections){const l=qr(e,n.points[0],r.axis);if(r.projection[1]<l[0]||r.projection[0]>l[1])return 0}return 1}function cs(n,e){let r=0;const l=[0,0,0,0];for(let f=0;f<n.length;f++)l[0]=n[f][0],l[1]=n[f][1],l[2]=n[f][2],l[3]=1,(c=l)[0]*(p=e)[0]+c[1]*p[1]+c[2]*p[2]+c[3]*p[3]>=0&&r++;var c,p;return r}class en{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=rr.fromPoints(this.points),this.projections=[],this.frustumEdges=[dr([],this.points[2],this.points[3]),dr([],this.points[0],this.points[3]),dr([],this.points[4],this.points[0]),dr([],this.points[5],this.points[1]),dr([],this.points[6],this.points[2]),dr([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const c=[0,-l[2],l[1]],p=[l[2],0,-l[0]];this.projections.push({axis:c,projection:qr(this.points,this.points[0],c)}),this.projections.push({axis:p,projection:qr(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,r,l,c){const p=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const I=Ur([],S,e),A=1/I[3]/r*p;return(M=I)[0]=(N=I)[0]*(z=[A,A,c?1/I[3]:A,A])[0],M[1]=N[1]*z[1],M[2]=N[2]*z[2],M[3]=N[3]*z[3],M;var M,N,z}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const I=Hi([],hi([],dr([],f[S[0]],f[S[1]]),dr([],f[S[2]],f[S[1]]))),A=-Ii(I,f[S[1]]);return I.concat(A)}),b=[];for(let S=0;S<f.length;S++)b.push([f[S][0],f[S][1],f[S][2]]);return new en(b,x)}intersectsPrecise(e,r,l){for(let c=0;c<r.length;c++)if(!cs(e,r[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!cs(e,this.planes[c]))return 0;for(const c of l)for(const p of this.frustumEdges){const f=hi([],c,p),x=xi(f);if(x===0)continue;Gt(f,f,1/x);const b=qr(this.points,this.points[0],f),S=qr(e,this.points[0],f);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const l=r[3];if(Ii([r[0],r[1],r[2]],e)+l<0)return!1}return!0}}class rr{static fromPoints(e){const r=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const c of e)ct(r,r,c),Vt(l,l,c);return new rr(r,l)}static fromTileIdAndHeight(e,r,l){const c=1<<e.canonical.z,p=e.canonical.x,f=e.canonical.y;return new rr([p/c,f/c,r],[(p+1)/c,(f+1)/c,l])}static applyTransform(e,r){const l=e.getCorners();for(let c=0;c<l.length;++c)ji(l[c],l[c],r);return rr.fromPoints(l)}static applyTransformFast(e,r){const l=[r[12],r[13],r[14]],c=[...l];for(let p=0;p<3;p++)for(let f=0;f<3;f++){const x=r[4*f+p],b=x*e.min[f],S=x*e.max[f];l[p]+=Math.min(b,S),c[p]+=Math.max(b,S)}return new rr(l,c)}static projectAabbCorners(e,r){const l=e.getCorners();for(let c=0;c<l.length;++c)ji(l[c],l[c],r);return l}constructor(e,r){this.min=e,this.max=r,this.center=Gt([],ui([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=ei(this.min),c=ei(this.max);for(let p=0;p<r.length;p++)l[p]=r[p]?this.min[p]:this.center[p],c[p]=r[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new rr(l,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?lr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?lr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?mn(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?mn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Rt(rr,"Aabb");class eo{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,l=r[1],c=-r[0],p=(e.extent+1)*this.metersToTile;return[new wt(Math.trunc(e.position[0]+l*p),Math.trunc(e.position[1]+c*p)),new wt(Math.trunc(e.position[0]-l*p),Math.trunc(e.position[1]-c*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Gs{constructor(e,r,l,c,p,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:l,max:l},this.safeArea=r,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=p,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((b=this.vertices[x.a].position)[0]===(S=this.vertices[x.b].position)[0]&&b[1]===S[1]);var b,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:xs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const b=this.vertices[x.a].position,S=this.vertices[x.b].position,I=Mo(Hn(),S,b),A=ss(I),M=ho(Hn(),I,1/A);this.edgeProps.push({vec:I,dir:M,len:A});const N=this.vertexProps[x.a].dir,z=this.vertexProps[x.b].dir;Po(N,N,M),Po(z,z,M)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||ya(x.dir,x.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[l,c]=r;return si(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,c)}computeSlopeNormal(e,r){const l=this.getClosestEdge(e);if(!l)return It(0,0,1);const c=l[0],p=this.edges[c],f=this.edgeProps[c].vec,x=It(f[0],f[1],(this.vertices[p.b].height-this.vertices[p.a].height)*r),b=It(x[1],-x[0],0);hi(b,b,x);const S=xi(b);return S>0?Gt(b,b,1/S):It(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,l=Number.POSITIVE_INFINITY,c=0;const p=xs(e.x,e.y);for(let f=0;f<this.edges.length;f++){const x=this.edges[f],b=this.edgeProps[f].dir,S=new Tn(p,this.edgeProps[f].dir),I=this.vertices[x.a].position,A=this.vertices[x.b].position,M=Hn(),N=Hn(),z=S.intersectsPlane(I,this.vertexProps[x.a].dir,M),B=S.intersectsPlane(A,this.vertexProps[x.b].dir,N);if(!z||!B)continue;const q=Mo(Hn(),N,M),K=Mo(Hn(),p,M),ne=di(q,q),se=ne>0?di(K,q)/ne:0,V=ve(se,0,1),ee=Math.abs((se-V)*this.edgeProps[f].len),ae=Mo(Hn(),p,I),fe=ee+Math.abs(di(ae,xs(b[1],-b[0])));fe<l&&(r=f,l=fe,c=V)}return[r,c]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const l=this.edges[r].a,c=this.edges[r].b,{position:p,height:f,extent:x}=this.vertices[l],{position:b,height:S,extent:I}=this.vertices[c],A=this.vertexProps[l].dir,M=this.vertexProps[c].dir,N=It(p[0]/e,p[1]/e,f),z=It(b[0]/e,b[1]/e,S),B=It(A[1],-A[0],0);Gt(B,B,x);const q=It(M[1],-M[0],0);if(Gt(q,q,I),this.distSqLines(It(N[0]+.5*B[0],N[1]+.5*B[1],N[2]+.5*B[2]),It(z[0]-.5*q[0],z[1]-.5*q[1],z[2]-.5*q[2]),It(N[0]-.5*B[0],N[1]-.5*B[1],N[2]-.5*B[2]),It(z[0]+.5*q[0],z[1]+.5*q[1],z[2]+.5*q[2]))<=.0025000000000000005)continue;const K=this.vertices.length,ne=Po(Hn(),p,b);this.vertices.push({position:ho(ne,ne,.5),height:.5*(f+S),extent:.5*(x+I)});const se=Po(Hn(),A,M);this.vertexProps.push({dir:ya(se,se)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a:l,b:K}),this.edges.push({a:K,b:c});const V=Mo(Hn(),this.vertices[K].position,p),ee=ss(V),ae={vec:V,dir:ho(Hn(),V,1/ee),len:ee};this.edgeProps.push(ae),this.edgeProps.push(ae)}}distSqLines(e,r,l,c){const p=Zt(Ht(),r,e),f=Zt(Ht(),c,l),x=Zt(Ht(),e,l),b=Ii(p,p),S=Ii(p,f),I=Ii(p,x),A=Ii(f,f),M=Ii(f,x),N=b*A-S*S;if(N===0){const q=Ii(x,f)/Ii(f,f);return vi(_i(Ht(),l,c,q),e)}const z=(S*M-I*A)/N,B=(b*M-S*I)/N;return vi(_i(Ht(),e,r,z),_i(Ht(),l,c,B))}}class _o{static parseFrom(e,r){const l=Xi.parse(e);if(!l)return[];let{vertices:c,features:p}=l;const f=1/qe(r);p.sort((I,A)=>I.id-A.id),c.sort((I,A)=>I.id-A.id||I.idx-A.idx),c=c.filter((I,A,M)=>A===M.findIndex(N=>N.id===I.id&&N.idx===I.idx));const x=new Array;let b=0;const S=c.length;for(const I of p){if(I.constantHeight){x.push(new Gs(I.id,I.bounds,I.constantHeight));continue}for(;b!==S&&c[b].id<I.id;)b++;if(b===S||c[b].id!==I.id)continue;const A=new Array,M=new Array,N=b;for(;b!==S&&c[b].id===I.id;){const z=c[b];if(A.push({position:z.position,height:z.height,extent:z.extent}),b!==N&&c[b-1].idx===z.idx-1){const B=b-N;M.push({a:B-1,b:B})}b++}x.push(new Gs(I.id,I.bounds,void 0,A,M,f))}return x}static getElevationFeature(e,r){if(!r)return;const l=+e.properties[Bi];return Number.isNaN(l)?void 0:r.find(c=>c.id===l)}}class na{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*bt,this.yOffset=(e.y*this.zScale-r.y)*bt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,l){const c=this.constantElevation(r,l);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),l))}computeBiasedHeight(e,r){return r<=0?e:e+r*ke(0,r,e>=0?e:Math.abs(.5*e))}}Rt(Gs,"ElevationFeature");class Lo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Za,this.indexArray=new ls,this.segments=new fn,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Al),this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,c){const p=this.layers[0],f=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:S,id:I,index:A,sourceLayerIndex:M}of e){const N=this.layers[0]._featureFilter.needGeometry,z=Pt(S,N);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),z,l))continue;const B=x?x.evaluate(z,{},l):void 0,q={id:I,properties:S.properties,type:S.type,sourceLayerIndex:M,index:A,geometry:N?z.geometry:Dt(S,l,c),patterns:{},sortKey:B};f.push(q)}x&&f.sort((S,I)=>S.sortKey-I.sortKey);let b=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new nf,b=c.projection);for(const S of f){const{geometry:I,index:A,sourceLayerIndex:M}=S,N=e[A].feature;this.addFeature(S,I,A,r.availableImages,l,b,r.brightness,r.elevationFeatures),r.featureIndex.insert(N,I,A,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,r,l,c,p,f,x){this.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cf.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Fw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,r,l,c,p,f,x,b){let S;this.elevationMode!=="none"&&(S=_o.getElevationFeature(e,b));for(const I of r)for(const A of I){const M=A.x,N=A.y;if(M<0||M>=bt||N<0||N>=bt)continue;if(f){const q=f.projectTilePoint(M,N,p),K=f.upVector(p,M,N);this.addGlobeExtVertex(q,K),this.addGlobeExtVertex(q,K),this.addGlobeExtVertex(q,K),this.addGlobeExtVertex(q,K)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=z.vertexLength;if(this.addCircleVertex(M,N,-1,-1),this.addCircleVertex(M,N,1,-1),this.addCircleVertex(M,N,1,1),this.addCircleVertex(M,N,-1,1),this.elevationMode!=="none"){const q=S?S.pointElevation(new wt(M,N)):0;this.hasElevation=this.hasElevation||q!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(q)}this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},c,p,x,void 0,this.worldview)}addCircleVertex(e,r,l,c){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*r+(c+1)/2)}addGlobeExtVertex(e,r){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}}function $s(n,e){for(let r=0;r<n.length;r++)if(Ea(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Ea(n,e[r]))return!0;return!!vd(n,e)}function kl(n,e,r){return!!Ea(n,e)||!!wd(e,n,r)}function sa(n,e){if(n.length===1)return mf(e,n[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let c=0;c<l.length;c++)if(Ea(n,l[c]))return!0}for(let r=0;r<n.length;r++)if(mf(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(vd(n,e[r]))return!0;return!1}function Dl(n,e,r){if(n.length>1){if(vd(n,e))return!0;for(let l=0;l<e.length;l++)if(wd(e[l],n,r))return!0}for(let l=0;l<n.length;l++)if(wd(n[l],e,r))return!0;return!1}function vd(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const l=n[r],c=n[r+1];for(let p=0;p<e.length-1;p++)if(Bg(l,c,e[p],e[p+1]))return!0}return!1}function Bg(n,e,r,l){return Pr(n,r,l)!==Pr(e,r,l)&&Pr(n,e,r)!==Pr(n,e,l)}function Iu(n,e,r){return(n.x-r.x)*(e.y-r.y)-(n.y-r.y)*(e.x-r.x)}function Vg(n,e,r,l){const c=Iu(n,e,l),p=Iu(n,e,r);if(Math.sign(c)===Math.sign(p))return;const f=Iu(r,l,n),x=f+p-c;return Math.sign(f)!==Math.sign(x)?[f/(f-x),p/(p-c)]:void 0}function wd(n,e,r){const l=r*r;if(e.length===1)return n.distSqr(e[0])<l;for(let c=1;c<e.length;c++)if(ff(n,e[c-1],e[c])<l)return!0;return!1}function ff(n,e,r){const l=e.distSqr(r);if(l===0)return n.distSqr(e);const c=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/l;return n.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function mf(n,e){let r,l,c,p=!1;for(let f=0;f<n.length;f++){r=n[f];for(let x=0,b=r.length-1;x<r.length;b=x++)l=r[x],c=r[b],l.y>e.y!=c.y>e.y&&e.x<(c.x-l.x)*(e.y-l.y)/(c.y-l.y)+l.x&&(p=!p)}return p}function Ea(n,e){let r=!1;for(let l=0,c=n.length-1;l<n.length;c=l++){const p=n[l],f=n[c];p.y>e.y!=f.y>e.y&&e.x<(f.x-p.x)*(e.y-p.y)/(f.y-p.y)+p.x&&(r=!r)}return r}function Au(n,e,r,l,c){for(const f of n)if(e<=f.x&&r<=f.y&&l>=f.x&&c>=f.y)return!0;const p=[new wt(e,r),new wt(e,c),new wt(l,c),new wt(l,r)];if(n.length>2){for(const f of p)if(Ea(n,f))return!0}for(let f=0;f<n.length-1;f++)if(Ec(n[f],n[f+1],p))return!0;return!1}function Ec(n,e,r){const l=r[0],c=r[2];if(n.x<l.x&&e.x<l.x||n.x>c.x&&e.x>c.x||n.y<l.y&&e.y<l.y||n.y>c.y&&e.y>c.y)return!1;const p=Pr(n,e,r[0]);return p!==Pr(n,e,r[1])||p!==Pr(n,e,r[2])||p!==Pr(n,e,r[3])}function Nl(n,e,r,l,c,p){let f=e.y-n.y,x=n.x-e.x;if(p=p||0){const b=f*f+x*x;if(b===0)return!0;const S=Math.sqrt(b);f/=S,x/=S}return!((r.x-n.x)*f+(r.y-n.y)*x-p<0||(l.x-n.x)*f+(l.y-n.y)*x-p<0||(c.x-n.x)*f+(c.y-n.y)*x-p<0)}function Bw(n,e,r,l,c,p,f){return!(Nl(n,e,l,c,p,f)||Nl(e,r,l,c,p,f)||Nl(r,n,l,c,p,f)||Nl(l,c,n,e,r,f)||Nl(c,p,n,e,r,f)||Nl(p,l,n,e,r,f))}function gf(n,e,r){const l=e.paint.get(n).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Nx(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function KE(n,e,r,l,c){if(!e[0]&&!e[1])return n;const p=wt.convert(e)._mult(c);r==="viewport"&&p._rotate(-l);const f=[];for(let x=0;x<n.length;x++)f.push(n[x].sub(p));return f}function QE(n,e,r,l){const c=wt.convert(n)._mult(l);return e==="viewport"&&c._rotate(-r),c}let JE,eC;function tC(n,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[n*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Rt(Lo,"CircleBucket",{omit:["layers"]});class bd{constructor(e,r,l){this.z=e,this.x=r,this.y=l,this.key=_f(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const l=function(p,f,x){var b=tC(256*p,256*(f=Math.pow(2,x)-f-1),x),S=tC(256*(p+1),256*(f+1),x);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),c=function(p,f,x){let b,S="";for(let I=p;I>0;I--)b=1<<I-1,S+=(f&b?1:0)+(x&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iC{constructor(e,r){this.wrap=e,this.canonical=r,this.key=_f(e,r.z,r.z,r.x,r.y)}}class Ds{constructor(e,r,l,c,p){this.overscaledZ=e,this.wrap=r,this.canonical=new bd(l,+c,+p),this.key=r===0&&e===l?this.canonical.key:_f(r,e,l,c,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Ds(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ds(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return _f(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return _f(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ds(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,c=2*this.canonical.y;return[new Ds(r,this.wrap,r,l,c),new Ds(r,this.wrap,r,l+1,c),new Ds(r,this.wrap,r,l,c+1),new Ds(r,this.wrap,r,l+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ds(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ds(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _f(n,e,r,l,c){const p=1<<Math.min(r,22);let f=p*(c%p)+l%p;return n&&r<22&&(f+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}const r3=[n=>{let e=n.canonical.x-1,r=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,r--),new Ds(n.overscaledZ,r,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,r=n.wrap;return e===1<<n.canonical.z&&(e=0,r++),new Ds(n.overscaledZ,r,n.canonical.z,e,n.canonical.y)},n=>new Ds(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Ds(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Rt(bd,"CanonicalTileID"),Rt(Ds,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const n3=er([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:jx}=n3,s3=er([{name:"a_pos_3",components:3,type:"Int16"}]);var rC=er([{name:"a_pos",type:"Int16",components:2}]);function zx(n){return n*v/X}const o3=[new rr([j,j,j],[F,F,F]),new rr([j,j,j],[0,0,F]),new rr([0,j,j],[F,0,F]),new rr([j,0,j],[0,F,F]),new rr([0,0,j],[F,F,F])];function nC(n,e,r,l=!0){const c=Gt([],n._camera.position,n.worldSize),p=[e,r,1,1];Ur(p,p,n.pixelMatrixInverse),ys(p,p,1/p[3]);const f=Hi([],dr([],p,c)),x=n.globeMatrix,b=[x[12],x[13],x[14]],S=dr([],b,c),I=xi(S),A=Hi([],S),M=n.worldSize/(2*Math.PI),N=Ii(A,f),z=Math.asin(M/I);if(z<Math.acos(N)){if(!l)return null;const Pe=[],De=[];Gt(Pe,f,I/N),Hi(De,dr(De,Pe,S)),Hi(f,ui(f,S,Gt(f,De,Math.tan(z)*I)))}const B=[];new $r(c,f).closestPointOnSphere(b,M,B);const q=Hi([],un(x,0)),K=Hi([],un(x,1)),ne=Hi([],un(x,2)),se=Ii(q,B),V=Ii(K,B),ee=Ii(ne,B),ae=Ve(Math.asin(-V/M));let fe=Ve(Math.atan2(se,ee));fe=n.center.lng+function(Pe,De){const He=(De-Pe+180)%360-180;return He<-180?He+360:He}(n.center.lng,fe);const Ae=we(fe),Ee=ve(xe(ae),0,1);return new Re(Ae,Ee)}class a3{constructor(e,r,l){this.a=dr([],e,l),this.b=dr([],r,l),this.center=l;const c=Hi([],this.a),p=Hi([],this.b);this.angle=Math.acos(Ii(c,p))}}function Vw(n,e){if(n.angle===0)return null;let r;return r=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(l,c,p,f){const x=Math.sin(p);return l*(Math.sin((1-f)*p)/x)+c*(Math.sin(f*p)/x)}(n.a[e],n.b[e],n.angle,ve(r,0,1))+n.center[e]}function jl(n){if(n.z<=1)return o3[n.z+2*n.y+n.x];const e=Uw(Lx(n));return rr.fromPoints(e)}function Cc(n,e,r){return Gt(n,n,1-r),ti(n,n,e,r)}function sC(n,e,r){for(const l of n)ji(l,l,e),Gt(l,l,r)}function oC(n,e,r,l){const c=e/n.worldSize,p=n.globeMatrix;if(r.z<=1){const Ee=jl(r).getCorners();return sC(Ee,p,c),rr.fromPoints(Ee)}const f=Lx(r,l),x=Uw(f,v+zx(n._tileCoverLift));sC(x,p,c);const b=Number.MAX_VALUE,S=[-b,-b,-b],I=[b,b,b];if(f.contains(n.center)){for(const De of x)ct(I,I,De),Vt(S,S,De);S[2]=0;const Ee=n.point,Pe=[Ee.x*c,Ee.y*c,0];return ct(I,I,Pe),Vt(S,S,Pe),new rr(I,S)}if(n._tileCoverLift>0){for(const Ee of x)ct(I,I,Ee),Vt(S,S,Ee);return new rr(I,S)}const A=[p[12]*c,p[13]*c,p[14]*c],M=f.getCenter(),N=ve(n.center.lat,-85.051129,Ke),z=ve(M.lat,-85.051129,Ke),B=we(n.center.lng),q=xe(N);let K=B-we(M.lng);const ne=q-xe(z);K>.5?K-=1:K<-.5&&(K+=1);let se=0;Math.abs(K)>Math.abs(ne)?se=K>=0?1:3:(se=ne>=0?0:2,ti(A,A,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(Qi(ne>=0?f.getSouth():f.getNorth()))*v));const V=x[se],ee=x[(se+1)%4],ae=new a3(V,ee,A),fe=[Vw(ae,0)||V[0],Vw(ae,1)||V[1],Vw(ae,2)||V[2]],Ae=Pu(n.zoom);if(Ae>0){const Ee=function({x:De,y:He,z:ut},it,lt,ht,Ze){const st=1/(1<<ut);let $e=De*st,We=$e+st,gt=He*st,yt=gt+st,Xt=0;const zt=($e+We)/2-ht;return zt>.5?Xt=-1:zt<-.5&&(Xt=1),$e=(($e+Xt)*it-(ht*=it))*lt+ht,We=((We+Xt)*it-ht)*lt+ht,gt=(gt*it-(Ze*=it))*lt+Ze,yt=(yt*it-Ze)*lt+Ze,[[$e,yt,0],[We,yt,0],[We,gt,0],[$e,gt,0]]}(r,e,n._pixelsPerMercatorPixel,B,q);for(let De=0;De<x.length;De++)Cc(x[De],Ee[De],Ae);const Pe=ui([],Ee[se],Ee[(se+1)%4]);Gt(Pe,Pe,.5),Cc(fe,Pe,Ae)}for(const Ee of x)ct(I,I,Ee),Vt(S,S,Ee);return I[2]=Math.min(V[2],ee[2]),ct(I,I,fe),Vt(S,S,fe),new rr(I,S)}function Lx({x:n,y:e,z:r},l=!1){const c=1/(1<<r),p=new te(Ce(n*c),e===(1<<r)-1&&l?-90:Le((e+1)*c)),f=new te(Ce((n+1)*c),e===0&&l?90:Le(e*c));return new pe(p,f)}function Uw(n,e=v){const r=Qi(n.getNorth()),l=Qi(n.getSouth()),c=Math.cos(r),p=Math.cos(l),f=Math.sin(r),x=Math.sin(l),b=n.getWest(),S=n.getEast();return[Z(p,x,b,e),Z(p,x,S,e),Z(c,f,S,e),Z(c,f,b,e)]}function Ug(n,e,r,l){const c=1<<r.z,p=(n/bt+r.x)/c;return $(Le((e/bt+r.y)/c),Ce(p),l)}function Fx({min:n,max:e}){return R/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const aC=new Float64Array(16);function Ox(n){const e=Fx(n),r=ot(aC,[e,e,e]);return oe(r,r,Zi([],n.min))}function Gw(n){const e=(l=n.min,(r=aC)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=l[0],r[13]=l[1],r[14]=l[2],r[15]=1,r);var r,l;const c=1/Fx(n);return _e(e,e,[c,c,c])}function $w(n){const e=bt/(2*Math.PI);return n/(2*Math.PI)/e}function lC(n,e){return bt/(512*Math.pow(2,n))*Fx(jl(e))}function cC(n,e,r,l,c){const p=$w(r),f=[n,e,-r/(2*Math.PI)],x=Y(new Float64Array(16));return oe(x,x,f),_e(x,x,[p,p,p]),Ne(x,x,Qi(-c)),Ge(x,x,Qi(-l)),x}function Pu(n){return ke(T,C,n)}function uC(n,e){const r=$(e.lat,e.lng),l=function(z){const B=$(z._center.lat,z._center.lng);let q=hi([],It(0,1,0),B);const K=dt([],-z.angle,B);q=ji(q,q,K),dt(K,-z._pitch,q);const ne=Hi([],B);return Gt(ne,ne,zx(z.cameraToCenterDistance/z.pixelsPerMeter)),ji(ne,ne,K),ui([],B,ne)}(n);return f=(c=Zt([],l,r))[0],x=c[1],b=c[2],S=(p=r)[0],I=p[1],A=p[2],N=(M=Math.sqrt(f*f+x*x+b*b)*Math.sqrt(S*S+I*I+A*A))&&Ii(c,p)/M,Math.acos(Math.min(Math.max(N,-1),1));var c,p,f,x,b,S,I,A,M,N}function qw(n,e){return uC(n,e)>Math.PI/2*1.01}const hC=Qi(85),l3=Math.cos(hC),c3=Math.sin(hC),u3=de(),dC=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function pC(n,e,r,l,c,p,f,x,b){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(b*=n.pixelToTileUnitsFactor);const S=n.tileID.canonical,I=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const A of e)for(const M of A){const N=M.add(x),z=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(N.x,N.y,!0):0,B=r.projection.projectTilePoint(N.x,N.y,S);if(z>0){const se=r.projection.upVector(S,N.x,N.y);B.x+=se[0]*I*z,B.y+=se[1]*I*z,B.z+=se[2]*I*z}const q=p?N:h3(B.x,B.y,B.z,l),K=p?n.tilespaceRays.map(se=>p3(se,z)):n.queryGeometry.screenGeometry,ne=Ur([],[B.x,B.y,B.z,1],l);if(!f&&p?b*=ne[3]/r.cameraToCenterDistance:f&&!p&&(b*=r.cameraToCenterDistance/ne[3]),p){const se=Le((M.y/bt+S.y)/(1<<S.z));b/=r.projection.pixelsPerMeter(se,1)/Te(1,se)}if(kl(K,q,b))return!0}return!1}function h3(n,e,r,l){const c=Ur([],[n,e,r,1],l);return new wt(c[0]/c[3],c[1]/c[3])}const fC=It(0,0,0),d3=It(0,0,1);function p3(n,e){const r=Ht();return fC[2]=e,n.intersectsPlane(fC,d3,r),new wt(r[0],r[1])}class mC extends Lo{}let gC,_C,yC,xC;function vC(n,{width:e,height:r},l,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*l)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*l);return n.width=e,n.height=r,n.data=c,n}function wC(n,e,r){const{width:l,height:c}=e;l===n.width&&c===n.height||(Hw(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,l),height:Math.min(n.height,c)},r,null),n.width=l,n.height=c,n.data=e.data)}function Hw(n,e,r,l,c,p,f,x){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||l.x>e.width-c.width||l.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const b=n.data,S=e.data,I=p===4&&x;for(let A=0;A<c.height;A++){const M=((r.y+A)*n.width+r.x)*p,N=((l.y+A)*e.width+l.x)*p;if(I)for(let z=0;z<c.width;z++){const B=M+z*p+3,q=N+z*p;S[q+0]=255,S[q+1]=255,S[q+2]=255,S[q+3]=b[B]}else if(f)for(let z=0;z<c.width;z++){const B=M+z*p,q=N+z*p,K=new pr(b[B+0]/255,b[B+1]/255,b[B+2]/255,b[B+3]).toNonPremultipliedRenderColor(f).toArray();S[q+0]=K[0],S[q+1]=K[1],S[q+2]=K[2],S[q+3]=K[3]}else for(let z=0;z<c.width*p;z++)S[N+z]=b[M+z]}return e}Rt(mC,"HeatmapBucket",{omit:["layers"]});class Mu{constructor(e,r){vC(this,e,1,r)}resize(e){wC(this,new Mu(e),1)}clone(){return new Mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,c,p){Hw(e,r,l,c,p,1,null)}}class ps{constructor(e,r){vC(this,e,4,r)}resize(e){wC(this,new ps(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,c,p,f,x){Hw(e,r,l,c,p,4,f,x)}}class bC{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Gg(n){const e={},r=n.resolution||256,l=n.clips?n.clips.length:1,c=n.image||new ps({width:r,height:l}),p=(f,x,b)=>{e[n.evaluationKey]=b;const S=n.expression.evaluate(e),I=S?S.toNonPremultipliedRenderColor(null):null;I&&(c.data[f+x+0]=Math.floor(255*I.r),c.data[f+x+1]=Math.floor(255*I.g),c.data[f+x+2]=Math.floor(255*I.b),c.data[f+x+3]=Math.floor(255*I.a))};if(n.clips)for(let f=0,x=0;f<l;++f,x+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const I=b/(r-1),{start:A,end:M}=n.clips[f];p(x,S,A*(1-I)+M*I)}else for(let f=0,x=0;f<r;f++,x+=4)p(0,x,f/(r-1));return c}Rt(Mu,"AlphaImage"),Rt(ps,"RGBAImage");const f3=er([{name:"a_pos",components:2,type:"Int16"}],4),m3=er([{name:"a_road_z_offset",components:1,type:"Float32"}],4),g3=er([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),_3=er([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function $g(n,e,r=2){const l=e&&e.length,c=l?e[0]*r:n.length;let p=SC(n,0,c,r,!0);const f=[];if(!p||p.next===p.prev)return f;let x,b,S;if(l&&(p=function(I,A,M,N){const z=[];for(let B=0,q=A.length;B<q;B++){const K=SC(I,A[B]*N,B<q-1?A[B+1]*N:I.length,N,!1);K===K.next&&(K.steiner=!0),z.push(E3(K))}z.sort(b3);for(let B=0;B<z.length;B++)M=S3(z[B],M);return M}(n,e,p,r)),n.length>80*r){x=1/0,b=1/0;let I=-1/0,A=-1/0;for(let M=r;M<c;M+=r){const N=n[M],z=n[M+1];N<x&&(x=N),z<b&&(b=z),N>I&&(I=N),z>A&&(A=z)}S=Math.max(I-x,A-b),S=S!==0?32767/S:0}return qg(p,f,r,x,b,S,0),f}function SC(n,e,r,l,c){let p;if(c===function(f,x,b,S){let I=0;for(let A=x,M=b-S;A<b;A+=S)I+=(f[M]-f[A])*(f[A+1]+f[M+1]),M=A;return I}(n,e,r,l)>0)for(let f=e;f<r;f+=l)p=IC(f/l|0,n[f],n[f+1],p);else for(let f=r-l;f>=e;f-=l)p=IC(f/l|0,n[f],n[f+1],p);return p&&yf(p,p.next)&&(Zg(p),p=p.next),p}function Sd(n,e){if(!n)return n;e||(e=n);let r,l=n;do if(r=!1,l.steiner||!yf(l,l.next)&&Wn(l.prev,l,l.next)!==0)l=l.next;else{if(Zg(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function qg(n,e,r,l,c,p,f){if(!n)return;!f&&p&&function(b,S,I,A){let M=b;do M.z===0&&(M.z=Ww(M.x,M.y,S,I,A)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(N){let z,B=1;do{let q,K=N;N=null;let ne=null;for(z=0;K;){z++;let se=K,V=0;for(let ae=0;ae<B&&(V++,se=se.nextZ,se);ae++);let ee=B;for(;V>0||ee>0&&se;)V!==0&&(ee===0||!se||K.z<=se.z)?(q=K,K=K.nextZ,V--):(q=se,se=se.nextZ,ee--),ne?ne.nextZ=q:N=q,q.prevZ=ne,ne=q;K=se}ne.nextZ=null,B*=2}while(z>1)}(M)}(n,l,c,p);let x=n;for(;n.prev!==n.next;){const b=n.prev,S=n.next;if(p?x3(n,l,c,p):y3(n))e.push(b.i,n.i,S.i),Zg(n),n=S.next,x=S.next;else if((n=S)===x){f?f===1?qg(n=v3(Sd(n),e),e,r,l,c,p,2):f===2&&w3(n,e,r,l,c,p):qg(Sd(n),e,r,l,c,p,1);break}}}function y3(n){const e=n.prev,r=n,l=n.next;if(Wn(e,r,l)>=0)return!1;const c=e.x,p=r.x,f=l.x,x=e.y,b=r.y,S=l.y,I=Math.min(c,p,f),A=Math.min(x,b,S),M=Math.max(c,p,f),N=Math.max(x,b,S);let z=l.next;for(;z!==e;){if(z.x>=I&&z.x<=M&&z.y>=A&&z.y<=N&&Hg(c,x,p,b,f,S,z.x,z.y)&&Wn(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function x3(n,e,r,l){const c=n.prev,p=n,f=n.next;if(Wn(c,p,f)>=0)return!1;const x=c.x,b=p.x,S=f.x,I=c.y,A=p.y,M=f.y,N=Math.min(x,b,S),z=Math.min(I,A,M),B=Math.max(x,b,S),q=Math.max(I,A,M),K=Ww(N,z,e,r,l),ne=Ww(B,q,e,r,l);let se=n.prevZ,V=n.nextZ;for(;se&&se.z>=K&&V&&V.z<=ne;){if(se.x>=N&&se.x<=B&&se.y>=z&&se.y<=q&&se!==c&&se!==f&&Hg(x,I,b,A,S,M,se.x,se.y)&&Wn(se.prev,se,se.next)>=0||(se=se.prevZ,V.x>=N&&V.x<=B&&V.y>=z&&V.y<=q&&V!==c&&V!==f&&Hg(x,I,b,A,S,M,V.x,V.y)&&Wn(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;se&&se.z>=K;){if(se.x>=N&&se.x<=B&&se.y>=z&&se.y<=q&&se!==c&&se!==f&&Hg(x,I,b,A,S,M,se.x,se.y)&&Wn(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;V&&V.z<=ne;){if(V.x>=N&&V.x<=B&&V.y>=z&&V.y<=q&&V!==c&&V!==f&&Hg(x,I,b,A,S,M,V.x,V.y)&&Wn(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function v3(n,e){let r=n;do{const l=r.prev,c=r.next.next;!yf(l,c)&&EC(l,r,r.next,c)&&Wg(l,c)&&Wg(c,l)&&(e.push(l.i,r.i,c.i),Zg(r),Zg(r.next),r=n=c),r=r.next}while(r!==n);return Sd(r)}function w3(n,e,r,l,c,p){let f=n;do{let x=f.next.next;for(;x!==f.prev;){if(f.i!==x.i&&C3(f,x)){let b=CC(f,x);return f=Sd(f,f.next),b=Sd(b,b.next),qg(f,e,r,l,c,p,0),void qg(b,e,r,l,c,p,0)}x=x.next}f=f.next}while(f!==n)}function b3(n,e){let r=n.x-e.x;return r===0&&(r=n.y-e.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function S3(n,e){const r=function(c,p){let f=p;const x=c.x,b=c.y;let S,I=-1/0;if(yf(c,f))return f;do{if(yf(c,f.next))return f.next;if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const B=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(B<=x&&B>I&&(I=B,S=f.x<f.next.x?f:f.next,B===x))return S}f=f.next}while(f!==p);if(!S)return null;const A=S,M=S.x,N=S.y;let z=1/0;f=S;do{if(x>=f.x&&f.x>=M&&x!==f.x&&TC(b<N?x:I,b,M,N,b<N?I:x,b,f.x,f.y)){const B=Math.abs(b-f.y)/(x-f.x);Wg(f,c)&&(B<z||B===z&&(f.x>S.x||f.x===S.x&&T3(S,f)))&&(S=f,z=B)}f=f.next}while(f!==A);return S}(n,e);if(!r)return e;const l=CC(r,n);return Sd(l,l.next),Sd(r,r.next)}function T3(n,e){return Wn(n.prev,n,e.prev)<0&&Wn(e.next,n,n.next)<0}function Ww(n,e,r,l,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function E3(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function TC(n,e,r,l,c,p,f,x){return(c-f)*(e-x)>=(n-f)*(p-x)&&(n-f)*(l-x)>=(r-f)*(e-x)&&(r-f)*(p-x)>=(c-f)*(l-x)}function Hg(n,e,r,l,c,p,f,x){return!(n===f&&e===x)&&TC(n,e,r,l,c,p,f,x)}function C3(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,l){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==l.i&&c.next.i!==l.i&&EC(c,c.next,r,l))return!0;c=c.next}while(c!==r);return!1}(n,e)&&(Wg(n,e)&&Wg(e,n)&&function(r,l){let c=r,p=!1;const f=(r.x+l.x)/2,x=(r.y+l.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&f<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==r);return p}(n,e)&&(Wn(n.prev,n,e.prev)||Wn(n,e.prev,e))||yf(n,e)&&Wn(n.prev,n,n.next)>0&&Wn(e.prev,e,e.next)>0)}function Wn(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function yf(n,e){return n.x===e.x&&n.y===e.y}function EC(n,e,r,l){const c=Vx(Wn(n,e,r)),p=Vx(Wn(n,e,l)),f=Vx(Wn(r,l,n)),x=Vx(Wn(r,l,e));return c!==p&&f!==x||!(c!==0||!Bx(n,r,e))||!(p!==0||!Bx(n,l,e))||!(f!==0||!Bx(r,n,l))||!(x!==0||!Bx(r,e,l))}function Bx(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Vx(n){return n>0?1:n<0?-1:0}function Wg(n,e){return Wn(n.prev,n,n.next)<0?Wn(n,e,n.next)>=0&&Wn(n,n.prev,e)>=0:Wn(n,e,n.prev)<0||Wn(n,n.next,e)<0}function CC(n,e){const r=Zw(n.i,n.x,n.y),l=Zw(e.i,e.x,e.y),c=n.next,p=e.prev;return n.next=e,e.prev=n,r.next=c,c.prev=r,l.next=r,r.prev=l,p.next=l,l.prev=p,l}function IC(n,e,r,l){const c=Zw(n,e,r);return l?(c.next=l.next,c.prev=l,l.next.prev=c,l.next=c):(c.prev=c,c.next=c),c}function Zg(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zw(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ux(n,e){const r=n.length;if(r<=1)return[n];const l=[];let c,p;for(let f=0;f<r;f++){const x=Kr(n[f]);x!==0&&(n[f].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(c&&l.push(c),c=[n[f]]):c.push(n[f]))}if(c&&l.push(c),e>1)for(let f=0;f<l.length;f++)l[f].length<=e||(ws(l[f],e,1,l[f].length-1,I3),l[f]=l[f].slice(0,e));return l}function I3(n,e){return e.area-n.area}function AC(n,e,r=1){if(!n)return null;const l=typeof n=="string"?Us.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const p of[l,c]){if(!p)continue;const f=p.id.toString();e.has(f)||e.set(f,[]),p.scaleSelf(r),e.get(f).push(p)}return{primary:l.toString(),secondary:c?c.toString():null}}function Xw(n,e,r,l){const c=l.patternDependencies;let p=!1;for(const f of e){const x=f.paint.get(`${n}-pattern`);x.isConstant()||(p=!0),AC(x.constantOr(null),c,r)&&(p=!0)}return p}function Yw(n,e,r,l,c,p){const f=p.patternDependencies;for(const x of e){const b=x.paint.get(`${n}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:l},r,{},p.availableImages);S=S&&S.name?S.name:S;const I=AC(S,f,c);if(!I)continue;const{primary:A,secondary:M}=I;A&&(r.patterns[x.id]=[A,M].filter(Boolean))}}return r}class PC{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,l]of e.polygons)this.add(r,...l)}}class Td{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Td;let r=[];for(const S of e)r.push(...S.portals);if(r.length===0)return new Td;const l=(S,I)=>S<=0&&I<=0||S>=bt&&I>=bt;for(const S of r){const I=S.va,A=S.vb;(l(I.x,A.x)||l(I.y,A.y))&&(S.type="border")}const c=r.filter(S=>S.type!=="unevaluated"),p=r.filter(S=>S.type==="unevaluated");if(p.length===0)return new Td;p.sort((S,I)=>S.hash===I.hash?S.isTunnel===I.isTunnel?0:S.isTunnel?-1:1:S.hash<I.hash?1:-1),r=c.concat(p);let f=c.length,x=f,b=f;do if(x++,x===r.length||r[f].hash!==r[x].hash){if(x-f==2){b<f&&(r[b]=r[f],r[f]=null);const S=r[b],I=r[x-1];S.type=S.isTunnel!==I.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:I.connection.a},b++}f=x}while(f!==r.length);return r.splice(b),r.sort((S,I)=>S.hash<I.hash?1:-1),{portals:r}}}Rt(Td,"ElevationPortalGraph"),Rt(PC,"ElevationPolygons");class A3{constructor(e,r,l){this.outPositions=e,this.outNormals=r,this.outIndices=l,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,l){let c=e[2];l!=null&&(c*=l);const p=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),f=this.vertexLookup.get(p);if(f!=null)return f;const x=this.outPositions.length;this.vertexLookup.set(p,x);const b=Math.trunc(16384*r[0]),S=Math.trunc(16384*r[1]),I=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(b,S,I),x}addVertices(e,r,...l){const c=[];for(const p of l){const f=this.addVertex(p,e,r);c.push(f)}return c}addTriangles(e,r,l){if(r&&l){const c=l.length===1,p=It(0,0,0);for(let f=0;f<e.length;f+=3){const x=r[e[f+0]],b=r[e[f+1]],S=r[e[f+2]],I=c?l[0]:l[e[f+1]],A=c?l[0]:l[e[f+2]],M=this.addVertex(It(x.x,x.y,c?l[0]:l[e[f+0]]),p),N=this.addVertex(It(b.x,b.y,I),p),z=this.addVertex(It(S.x,S.y,A),p);this.outIndices.emplaceBack(M,N,z)}}else for(let c=0;c<e.length;c+=3)this.outIndices.emplaceBack(e[c+0],e[c+1],e[c+2])}addQuad(e,r){const l=this.addVertices(r,void 0,...e.map(b=>It(b.coord.x,b.coord.y,b.height))),[c,p,f,x]=l;this.addTriangles([c,p,f,f,x,c])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Fo{constructor(e,r,l,c){this.unevaluatedPortals=new Td,this.portalPolygons=new PC,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Cg,this.vertexNormals=new rf,this.indexArray=new ls,this.tileToMeters=qe(e),this.bridgeProgramConfigurations=new h(r,{zoom:l,lut:c},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new h(r,{zoom:l,lut:c},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,r){const l=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(r[c]);return l}addTriangles(e,r,l){const c=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)c.push(p+r)}addRenderableRing(e,r,l,c,p,f){const x=[new wt(p.min.x,p.min.y),new wt(p.max.x,p.min.y),new wt(p.max.x,p.max.y),new wt(p.min.x,p.max.y)];for(let b=0;b<l-1;b++){const S=r+b,I=S+1,A=this.unevalVertices[S],M=this.unevalVertices[I];if(!(A.x>=p.min.x&&A.x<=p.max.x&&A.y>=p.min.y&&A.y<=p.max.y||M.x>=p.min.x&&M.x<=p.max.x&&M.y>=p.min.y&&M.y<=p.max.y||Ec(A,M,x))||this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))continue;const N=Fo.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[I]);let z,B=this.vertexHashLookup.get(Fo.computePosHash(A));B!=null?z=B.next:(B=this.vertexHashLookup.get(Fo.computePosHash(M)),z=B!=null?B.prev:N),this.unevalEdges.push({polygonIdx:e,a:S,b:I,hash:N,portalHash:z,isTunnel:c,type:"unevaluated",featureInfo:f})}}addPortalCandidates(e,r,l,c,p){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:p});const f=r[0];this.vertexHashLookup.clear();let x=Fo.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let b=0;b<f.length-1;b++){const S=f[b+0],I=f[b+1],A=xs(I.x-S.x,I.y-S.y),M=ss(A);if(M===0)continue;let N="unevaluated";const z=c.pointElevation(S),B=c.pointElevation(I);Math.abs(z)<.01&&Math.abs(B)<.01?N="entrance":(this.isOnBorder(S.x,I.x)||this.isOnBorder(S.y,I.y))&&(N="border");const q=Fo.computeEdgeHash(S,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:I,vab:A,length:M,hash:q,isTunnel:l,type:N});const K=Fo.computePosHash(S);this.vertexHashLookup.set(K,{prev:x,next:q}),x=q}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},c=new A3(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=r(),f=r(),x=r(),b=(M,N)=>{M.sort((B,q)=>B.type===N&&q.type!==N?-1:B.type!==N&&q.type===N?1:0);const z=M.findIndex(B=>B.type!==N);return z>=0?z:M.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),l(x);const I=r(),A=r();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(S),N=b(M,"tunnel")+S;this.unevalEdges.push(...M),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:N})}l(I),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(A),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(f),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(p),this.maskSegments=fn.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=fn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableBridgeSegments=fn.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=fn.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=fn.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,r,l,c,p,f,x,b){this.bridgeProgramConfigurations.updatePaintArrays(e,r,p,l,c,f,x,b),this.tunnelProgramConfigurations.updatePaintArrays(e,r,p,l,c,f,x,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,g3.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,_3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,r,l,c,p){const f=(x,b)=>{for(let S=0;S<b.length-1;S++){const I=b[S].featureIndex,A=b[S+1].vertexStart,M=e.feature(I);x.populatePaintArrays(A,M,I,{},l,r,c,void 0,p)}};f(this.bridgeProgramConfigurations,this.bridgeFeatureSections),f(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,r,l,c,p){const f=new Map;for(let x=c;x<p;x++){const b=l[x],S=b.a,I=b.b,A=Fo.computePosHash(e[S]),M=Fo.computePosHash(e[I]);f.has(A)||f.set(A,{}),f.has(M)||f.set(M,{});const N=f.get(A),z=f.get(M);r[S]<=0&&r[I]<=0||(N.to=I,z.from=S)}return f}constructBridgeStructures(e,r,l,c,p,f){e.clearVertexLookup();const x=this.computeVertexConnections(r,l,c,p.min,p.max),b=1/f,S=.5*b,I=N=>It(r[N].x,r[N].y,l[N]*b),A=N=>{const z=x.get(Fo.computePosHash(r[N])),B=z.from,q=z.to;if(!B||!q)return;const K=I(B),ne=I(N),se=I(q),V=It(0,0,0);if(!nr(K,ne)){const ae=dr(Ht(),ne,K);ui(V,V,Hi(ae,ae))}if(!nr(se,ne)){const ae=dr(Ht(),se,ne);ui(V,V,Hi(ae,ae))}const ee=ns(V);return ee>0?Gt(V,V,1/ee):void 0};let M=Number.POSITIVE_INFINITY;this.sortSubarray(c,p.min,p.max,(N,z)=>N.featureInfo.featureIndex-z.featureInfo.featureIndex);for(let N=p.min;N<p.max;N++){const z=c[N];if(!z.featureInfo.guardRailEnabled)continue;const B=this.prepareEdgePoints(r,l,z,(gi,jt)=>gi>jt);if(B==null)continue;const q=B[0],K=B[1],ne=It(q.coord.x,q.coord.y,b*q.height),se=It(K.coord.x,K.coord.y,b*K.height);if(nr(ne,se))continue;const V=dr(Ht(),se,ne);Hi(V,V);const ee=gi=>Hi(gi,gi),ae=A(z.a)||V,fe=A(z.b)||V,Ae=ee(It(ae[1],-ae[0],0)),Ee=ee(It(fe[1],-fe[0],0)),Pe=ee(hi(Ht(),Ae,ae)),De=ee(hi(Ht(),Ee,fe)),He=Ht(),ut=[ui(Ht(),ne,Gt(He,dr(He,Ae,Pe),S)),ui(Ht(),ne,Gt(He,ui(He,Ae,Pe),S)),ui(Ht(),ne,Gt(He,Pe,S)),ne],it=[ui(Ht(),se,Gt(He,dr(He,Ee,De),S)),ui(Ht(),se,Gt(He,ui(He,Ee,De),S)),ui(Ht(),se,Gt(He,De,S)),se];M=this.addFeatureSection(z.featureInfo.featureIndex,M,this.bridgeFeatureSections,e);const[lt,ht]=e.addVertices(Ae,f,ut[0],ut[1]),[Ze,st]=e.addVertices(Ee,f,it[0],it[1]);e.addTriangles([lt,ht,Ze,ht,st,Ze]);const[$e,We]=e.addVertices(Pe,f,ut[1],ut[2]),[gt,yt]=e.addVertices(De,f,it[1],it[2]);e.addTriangles([$e,We,gt,We,yt,gt]);const[Xt,zt]=e.addVertices(Zi(Ae,Ae),f,ut[2],ut[3]),[Tt,mt]=e.addVertices(Zi(Ee,Ee),f,it[2],it[3]);e.addTriangles([Xt,zt,Tt,zt,mt,Tt])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,r,l,c,p,f){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const b=(I,A)=>I.featureInfo.featureIndex-A.featureInfo.featureIndex;this.sortSubarray(c,p.min,p.max,b),this.sortSubarray(c,f.min,f.max,b);const S=I=>Hi(I,I);for(let I=p.min;I<p.max;I++){const A=this.prepareEdgePoints(r,l,c[I],(B,q)=>B<q);if(A==null)continue;const[M,N]=A,z=S(It(-(N.coord.y-M.coord.y),N.coord.x-M.coord.x,0));x=this.addFeatureSection(c[I].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([M,N,{coord:N.coord,height:c[I].isTunnel?-.1:0},{coord:M.coord,height:c[I].isTunnel?-.1:0}],z)}for(let I=f.min;I<f.max;I++){const A=c[I];A.isTunnel&&([A.a,A.b]=[A.b,A.a]);const M=r[A.a],N=r[A.b],z=S(It(-(N.y-M.y),N.x-M.x,0));x=this.addFeatureSection(A.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([{coord:N,height:0},{coord:M,height:0},{coord:M,height:l[A.a]+4},{coord:N,height:l[A.b]+4}],z),e.addQuad([{coord:M,height:0},{coord:N,height:0},{coord:N,height:l[A.b]+4},{coord:M,height:l[A.a]+4}],z)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,r,l,c){let p=r[l.a],f=r[l.b];const x=c(p,0),b=c(f,0);if(x&&b)return[{coord:e[l.a],height:p},{coord:e[l.b],height:f}];if(!x&&!b)return;const S=e[l.a].clone(),I=e[l.b].clone();if(x){if(!b){const A=f/(f-p);I.x=si(I.x,S.x,A),I.y=si(I.y,S.y,A),f=si(f,p,A)}}else{const A=p/(p-f);S.x=si(S.x,I.x,A),S.y=si(S.y,I.y,A),p=si(p,f,A)}return[{coord:S,height:p},{coord:I,height:f}]}prepareEdges(e,r){if(r.length===0)return;r.sort((x,b)=>x.hash===b.hash?b.polygonIdx-x.polygonIdx:b.hash>x.hash?1:-1);let l=0,c=0,p=0,f=r[l].polygonIdx;do c++,(c===r.length||r[l].hash!==r[c].hash)&&((c-l==1||r[c-1].polygonIdx!==f)&&(p<l&&(r[p]=r[l],r[l]=null),r[p].type="none",p++),l=c,l!==r.length&&(f=r[l].polygonIdx));while(l!==r.length);if(r.splice(p),r.length!==0&&e.length!==0){r.sort((S,I)=>S.portalHash<I.portalHash?1:-1);let x=0,b=0;for(;x!==r.length&&b!==e.length;){const S=r[x],I=e[b];S.portalHash>I.hash?x++:I.hash>S.portalHash?b++:(S.type=I.type,x++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=bt&&r>=bt}addFeatureSection(e,r,l,c){return e!==r&&(r=e,l.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),r}sortSubarray(e,r,l,c){const p=e.slice(r,l);p.sort(c),e.splice(r,p.length,...p)}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Fo.computePosHash(e))<<32n|BigInt(Fo.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var MC,RC={exports:{}},kC=(MC||(MC=1,function(n,e){(function(r){function l(ue,ge){return ue>ge?1:ue<ge?-1:0}var c=function(ue,ge){ue===void 0&&(ue=l),ge===void 0&&(ge=!1),this._compare=ue,this._root=null,this._size=0,this._noDuplicates=!!ge},p={size:{configurable:!0}};function f(ue,ge,Ye,vt,Et){var St=Et-vt;if(St>0){var Nt=vt+Math.floor(St/2),ni={key:ge[Nt],data:Ye[Nt],parent:ue};return ni.left=f(ni,ge,Ye,vt,Nt),ni.right=f(ni,ge,Ye,Nt+1,Et),ni}return null}function x(ue,ge,Ye,vt,Et){if(!(Ye>=vt)){for(var St=ue[Ye+vt>>1],Nt=Ye-1,ni=vt+1;;){do Nt++;while(Et(ue[Nt],St)<0);do ni--;while(Et(ue[ni],St)>0);if(Nt>=ni)break;var Vi=ue[Nt];ue[Nt]=ue[ni],ue[ni]=Vi,Vi=ge[Nt],ge[Nt]=ge[ni],ge[ni]=Vi}x(ue,ge,Ye,ni,Et),x(ue,ge,ni+1,vt,Et)}}c.prototype.rotateLeft=function(ue){var ge=ue.right;ge&&(ue.right=ge.left,ge.left&&(ge.left.parent=ue),ge.parent=ue.parent),ue.parent?ue===ue.parent.left?ue.parent.left=ge:ue.parent.right=ge:this._root=ge,ge&&(ge.left=ue),ue.parent=ge},c.prototype.rotateRight=function(ue){var ge=ue.left;ge&&(ue.left=ge.right,ge.right&&(ge.right.parent=ue),ge.parent=ue.parent),ue.parent?ue===ue.parent.left?ue.parent.left=ge:ue.parent.right=ge:this._root=ge,ge&&(ge.right=ue),ue.parent=ge},c.prototype._splay=function(ue){for(;ue.parent;){var ge=ue.parent;ge.parent?ge.left===ue&&ge.parent.left===ge?(this.rotateRight(ge.parent),this.rotateRight(ge)):ge.right===ue&&ge.parent.right===ge?(this.rotateLeft(ge.parent),this.rotateLeft(ge)):ge.left===ue&&ge.parent.right===ge?(this.rotateRight(ge),this.rotateLeft(ge)):(this.rotateLeft(ge),this.rotateRight(ge)):ge.left===ue?this.rotateRight(ge):this.rotateLeft(ge)}},c.prototype.splay=function(ue){for(var ge,Ye,vt,Et,St;ue.parent;)(Ye=(ge=ue.parent).parent)&&Ye.parent?((vt=Ye.parent).left===Ye?vt.left=ue:vt.right=ue,ue.parent=vt):(ue.parent=null,this._root=ue),Et=ue.left,St=ue.right,ue===ge.left?(Ye&&(Ye.left===ge?(ge.right?(Ye.left=ge.right,Ye.left.parent=Ye):Ye.left=null,ge.right=Ye,Ye.parent=ge):(Et?(Ye.right=Et,Et.parent=Ye):Ye.right=null,ue.left=Ye,Ye.parent=ue)),St?(ge.left=St,St.parent=ge):ge.left=null,ue.right=ge,ge.parent=ue):(Ye&&(Ye.right===ge?(ge.left?(Ye.right=ge.left,Ye.right.parent=Ye):Ye.right=null,ge.left=Ye,Ye.parent=ge):(St?(Ye.left=St,St.parent=Ye):Ye.left=null,ue.right=Ye,Ye.parent=ue)),Et?(ge.right=Et,Et.parent=ge):ge.right=null,ue.left=ge,ge.parent=ue)},c.prototype.replace=function(ue,ge){ue.parent?ue===ue.parent.left?ue.parent.left=ge:ue.parent.right=ge:this._root=ge,ge&&(ge.parent=ue.parent)},c.prototype.minNode=function(ue){if(ue===void 0&&(ue=this._root),ue)for(;ue.left;)ue=ue.left;return ue},c.prototype.maxNode=function(ue){if(ue===void 0&&(ue=this._root),ue)for(;ue.right;)ue=ue.right;return ue},c.prototype.insert=function(ue,ge){var Ye=this._root,vt=null,Et=this._compare;if(this._noDuplicates)for(;Ye;){if(vt=Ye,Et(Ye.key,ue)===0)return;Ye=Et(Ye.key,ue)<0?Ye.right:Ye.left}else for(;Ye;)vt=Ye,Ye=Et(Ye.key,ue)<0?Ye.right:Ye.left;return Ye={key:ue,data:ge,left:null,right:null,parent:vt},vt?Et(vt.key,Ye.key)<0?vt.right=Ye:vt.left=Ye:this._root=Ye,this.splay(Ye),this._size++,Ye},c.prototype.find=function(ue){for(var ge=this._root,Ye=this._compare;ge;){var vt=Ye(ge.key,ue);if(vt<0)ge=ge.right;else{if(!(vt>0))return ge;ge=ge.left}}return null},c.prototype.contains=function(ue){for(var ge=this._root,Ye=this._compare;ge;){var vt=Ye(ue,ge.key);if(vt===0)return!0;ge=vt<0?ge.left:ge.right}return!1},c.prototype.remove=function(ue){var ge=this.find(ue);if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var Ye=this.minNode(ge.right);Ye.parent!==ge&&(this.replace(Ye,Ye.right),Ye.right=ge.right,Ye.right.parent=Ye),this.replace(ge,Ye),Ye.left=ge.left,Ye.left.parent=Ye}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},c.prototype.removeNode=function(ue){if(!ue)return!1;if(this.splay(ue),ue.left)if(ue.right){var ge=this.minNode(ue.right);ge.parent!==ue&&(this.replace(ge,ge.right),ge.right=ue.right,ge.right.parent=ge),this.replace(ue,ge),ge.left=ue.left,ge.left.parent=ge}else this.replace(ue,ue.left);else this.replace(ue,ue.right);return this._size--,!0},c.prototype.erase=function(ue){var ge=this.find(ue);if(ge){this.splay(ge);var Ye=ge.left,vt=ge.right,Et=null;Ye&&(Ye.parent=null,Et=this.maxNode(Ye),this.splay(Et),this._root=Et),vt&&(Ye?Et.right=vt:this._root=vt,vt.parent=Et),this._size--}},c.prototype.pop=function(){var ue=this._root,ge=null;if(ue){for(;ue.left;)ue=ue.left;ge={key:ue.key,data:ue.data},this.remove(ue.key)}return ge},c.prototype.next=function(ue){var ge=ue;if(ge)if(ge.right)for(ge=ge.right;ge&&ge.left;)ge=ge.left;else for(ge=ue.parent;ge&&ge.right===ue;)ue=ge,ge=ge.parent;return ge},c.prototype.prev=function(ue){var ge=ue;if(ge)if(ge.left)for(ge=ge.left;ge&&ge.right;)ge=ge.right;else for(ge=ue.parent;ge&&ge.left===ue;)ue=ge,ge=ge.parent;return ge},c.prototype.forEach=function(ue){for(var ge=this._root,Ye=[],vt=!1,Et=0;!vt;)ge?(Ye.push(ge),ge=ge.left):Ye.length>0?(ue(ge=Ye.pop(),Et++),ge=ge.right):vt=!0;return this},c.prototype.range=function(ue,ge,Ye,vt){for(var Et=[],St=this._compare,Nt=this._root;Et.length!==0||Nt;)if(Nt)Et.push(Nt),Nt=Nt.left;else{if(St((Nt=Et.pop()).key,ge)>0)break;if(St(Nt.key,ue)>=0&&Ye.call(vt,Nt))return this;Nt=Nt.right}return this},c.prototype.keys=function(){for(var ue=this._root,ge=[],Ye=[],vt=!1;!vt;)ue?(ge.push(ue),ue=ue.left):ge.length>0?(ue=ge.pop(),Ye.push(ue.key),ue=ue.right):vt=!0;return Ye},c.prototype.values=function(){for(var ue=this._root,ge=[],Ye=[],vt=!1;!vt;)ue?(ge.push(ue),ue=ue.left):ge.length>0?(ue=ge.pop(),Ye.push(ue.data),ue=ue.right):vt=!0;return Ye},c.prototype.at=function(ue){for(var ge=this._root,Ye=[],vt=!1,Et=0;!vt;)if(ge)Ye.push(ge),ge=ge.left;else if(Ye.length>0){if(ge=Ye.pop(),Et===ue)return ge;Et++,ge=ge.right}else vt=!0;return null},c.prototype.load=function(ue,ge,Ye){if(ue===void 0&&(ue=[]),ge===void 0&&(ge=[]),Ye===void 0&&(Ye=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var vt=ue.length;return Ye&&x(ue,ge,0,vt-1,this._compare),this._root=f(null,ue,ge,0,vt),this._size=vt,this},c.prototype.min=function(){var ue=this.minNode(this._root);return ue?ue.key:null},c.prototype.max=function(){var ue=this.maxNode(this._root);return ue?ue.key:null},c.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},c.createTree=function(ue,ge,Ye,vt,Et){return new c(Ye,Et).load(ue,ge,vt)},Object.defineProperties(c.prototype,p);var b=0,S=1,I=2,A=3,M=0,N=1,z=2,B=3;function q(ue,ge,Ye){ge===null?(ue.inOut=!1,ue.otherInOut=!0):(ue.isSubject===ge.isSubject?(ue.inOut=!ge.inOut,ue.otherInOut=ge.otherInOut):(ue.inOut=!ge.otherInOut,ue.otherInOut=ge.isVertical()?!ge.inOut:ge.inOut),ge&&(ue.prevInResult=!K(ge,Ye)||ge.isVertical()?ge.prevInResult:ge));var vt=K(ue,Ye);ue.resultTransition=vt?function(Et,St){var Nt,ni=!Et.inOut,Vi=!Et.otherInOut;switch(St){case M:Nt=ni&&Vi;break;case N:Nt=ni||Vi;break;case B:Nt=ni^Vi;break;case z:Nt=Et.isSubject?ni&&!Vi:Vi&&!ni}return Nt?1:-1}(ue,Ye):0}function K(ue,ge){switch(ue.type){case b:switch(ge){case M:return!ue.otherInOut;case N:return ue.otherInOut;case z:return ue.isSubject&&ue.otherInOut||!ue.isSubject&&!ue.otherInOut;case B:return!0}break;case I:return ge===M||ge===N;case A:return ge===z;case S:return!1}return!1}var ne=function(ue,ge,Ye,vt,Et){this.left=ge,this.point=ue,this.otherEvent=Ye,this.isSubject=vt,this.type=Et||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},se={inResult:{configurable:!0}};function V(ue,ge){return ue[0]===ge[0]&&ue[1]===ge[1]}ne.prototype.isBelow=function(ue){var ge=this.point,Ye=this.otherEvent.point;return this.left?(ge[0]-ue[0])*(Ye[1]-ue[1])-(Ye[0]-ue[0])*(ge[1]-ue[1])>0:(Ye[0]-ue[0])*(ge[1]-ue[1])-(ge[0]-ue[0])*(Ye[1]-ue[1])>0},ne.prototype.isAbove=function(ue){return!this.isBelow(ue)},ne.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},se.inResult.get=function(){return this.resultTransition!==0},ne.prototype.clone=function(){var ue=new ne(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ue.contourId=this.contourId,ue.resultTransition=this.resultTransition,ue.prevInResult=this.prevInResult,ue.isExteriorRing=this.isExteriorRing,ue.inOut=this.inOut,ue.otherInOut=this.otherInOut,ue},Object.defineProperties(ne.prototype,se);var ee=11102230246251565e-32,ae=134217729,fe=(3+8*ee)*ee;function Ae(ue,ge,Ye,vt,Et){var St,Nt,ni,Vi,Ui=ge[0],Mi=vt[0],vr=0,Rr=0;Mi>Ui==Mi>-Ui?(St=Ui,Ui=ge[++vr]):(St=Mi,Mi=vt[++Rr]);var Gi=0;if(vr<ue&&Rr<Ye)for(Mi>Ui==Mi>-Ui?(ni=St-((Nt=Ui+St)-Ui),Ui=ge[++vr]):(ni=St-((Nt=Mi+St)-Mi),Mi=vt[++Rr]),St=Nt,ni!==0&&(Et[Gi++]=ni);vr<ue&&Rr<Ye;)Mi>Ui==Mi>-Ui?(ni=St-((Nt=St+Ui)-(Vi=Nt-St))+(Ui-Vi),Ui=ge[++vr]):(ni=St-((Nt=St+Mi)-(Vi=Nt-St))+(Mi-Vi),Mi=vt[++Rr]),St=Nt,ni!==0&&(Et[Gi++]=ni);for(;vr<ue;)ni=St-((Nt=St+Ui)-(Vi=Nt-St))+(Ui-Vi),Ui=ge[++vr],St=Nt,ni!==0&&(Et[Gi++]=ni);for(;Rr<Ye;)ni=St-((Nt=St+Mi)-(Vi=Nt-St))+(Mi-Vi),Mi=vt[++Rr],St=Nt,ni!==0&&(Et[Gi++]=ni);return St===0&&Gi!==0||(Et[Gi++]=St),Gi}function Ee(ue){return new Float64Array(ue)}var Pe=33306690738754716e-32,De=22204460492503146e-32,He=11093356479670487e-47,ut=Ee(4),it=Ee(8),lt=Ee(12),ht=Ee(16),Ze=Ee(4);function st(ue,ge,Ye){var vt=function(Et,St,Nt,ni,Vi,Ui){var Mi=(St-Ui)*(Nt-Vi),vr=(Et-Vi)*(ni-Ui),Rr=Mi-vr;if(Mi===0||vr===0||Mi>0!=vr>0)return Rr;var Gi=Math.abs(Mi+vr);return Math.abs(Rr)>=Pe*Gi?Rr:-function(an,Or,_r,vn,Hr,kr,Br){var Tr,ki,Ir,ln,ii,Yi,Wr,gn,tn,Nn,Ar,Pn,to,fs,us,io,Fl,jn,$n=an-Hr,ms=_r-Hr,Ns=Or-kr,Ts=vn-kr;ut[0]=(us=(gn=$n-(Wr=(Yi=ae*$n)-(Yi-$n)))*(Nn=Ts-(tn=(Yi=ae*Ts)-(Yi-Ts)))-((fs=$n*Ts)-Wr*tn-gn*tn-Wr*Nn))-((Ar=us-(Fl=(gn=Ns-(Wr=(Yi=ae*Ns)-(Yi-Ns)))*(Nn=ms-(tn=(Yi=ae*ms)-(Yi-ms)))-((io=Ns*ms)-Wr*tn-gn*tn-Wr*Nn)))+(ii=us-Ar))+(ii-Fl),ut[1]=(to=fs-((Pn=fs+Ar)-(ii=Pn-fs))+(Ar-ii))-((Ar=to-io)+(ii=to-Ar))+(ii-io),ut[2]=Pn-((jn=Pn+Ar)-(ii=jn-Pn))+(Ar-ii),ut[3]=jn;var zu=function(FH,VP){for(var UP=VP[0],t2=1;t2<4;t2++)UP+=VP[t2];return UP}(0,ut),b_=De*Br;if(zu>=b_||-zu>=b_||(Tr=an-($n+(ii=an-$n))+(ii-Hr),Ir=_r-(ms+(ii=_r-ms))+(ii-Hr),ki=Or-(Ns+(ii=Or-Ns))+(ii-kr),ln=vn-(Ts+(ii=vn-Ts))+(ii-kr),Tr===0&&ki===0&&Ir===0&&ln===0)||(b_=He*Br+fe*Math.abs(zu),(zu+=$n*ln+Ts*Tr-(Ns*Ir+ms*ki))>=b_||-zu>=b_))return zu;Ze[0]=(us=(gn=Tr-(Wr=(Yi=ae*Tr)-(Yi-Tr)))*(Nn=Ts-(tn=(Yi=ae*Ts)-(Yi-Ts)))-((fs=Tr*Ts)-Wr*tn-gn*tn-Wr*Nn))-((Ar=us-(Fl=(gn=ki-(Wr=(Yi=ae*ki)-(Yi-ki)))*(Nn=ms-(tn=(Yi=ae*ms)-(Yi-ms)))-((io=ki*ms)-Wr*tn-gn*tn-Wr*Nn)))+(ii=us-Ar))+(ii-Fl),Ze[1]=(to=fs-((Pn=fs+Ar)-(ii=Pn-fs))+(Ar-ii))-((Ar=to-io)+(ii=to-Ar))+(ii-io),Ze[2]=Pn-((jn=Pn+Ar)-(ii=jn-Pn))+(Ar-ii),Ze[3]=jn;var g4=Ae(4,ut,4,Ze,it);Ze[0]=(us=(gn=$n-(Wr=(Yi=ae*$n)-(Yi-$n)))*(Nn=ln-(tn=(Yi=ae*ln)-(Yi-ln)))-((fs=$n*ln)-Wr*tn-gn*tn-Wr*Nn))-((Ar=us-(Fl=(gn=Ns-(Wr=(Yi=ae*Ns)-(Yi-Ns)))*(Nn=Ir-(tn=(Yi=ae*Ir)-(Yi-Ir)))-((io=Ns*Ir)-Wr*tn-gn*tn-Wr*Nn)))+(ii=us-Ar))+(ii-Fl),Ze[1]=(to=fs-((Pn=fs+Ar)-(ii=Pn-fs))+(Ar-ii))-((Ar=to-io)+(ii=to-Ar))+(ii-io),Ze[2]=Pn-((jn=Pn+Ar)-(ii=jn-Pn))+(Ar-ii),Ze[3]=jn;var _4=Ae(g4,it,4,Ze,lt);Ze[0]=(us=(gn=Tr-(Wr=(Yi=ae*Tr)-(Yi-Tr)))*(Nn=ln-(tn=(Yi=ae*ln)-(Yi-ln)))-((fs=Tr*ln)-Wr*tn-gn*tn-Wr*Nn))-((Ar=us-(Fl=(gn=ki-(Wr=(Yi=ae*ki)-(Yi-ki)))*(Nn=Ir-(tn=(Yi=ae*Ir)-(Yi-Ir)))-((io=ki*Ir)-Wr*tn-gn*tn-Wr*Nn)))+(ii=us-Ar))+(ii-Fl),Ze[1]=(to=fs-((Pn=fs+Ar)-(ii=Pn-fs))+(Ar-ii))-((Ar=to-io)+(ii=to-Ar))+(ii-io),Ze[2]=Pn-((jn=Pn+Ar)-(ii=jn-Pn))+(Ar-ii),Ze[3]=jn;var y4=Ae(_4,lt,4,Ze,ht);return ht[y4-1]}(Et,St,Nt,ni,Vi,Ui,Gi)}(ue[0],ue[1],ge[0],ge[1],Ye[0],Ye[1]);return vt>0?-1:vt<0?1:0}function $e(ue,ge){var Ye=ue.point,vt=ge.point;return Ye[0]>vt[0]?1:Ye[0]<vt[0]?-1:Ye[1]!==vt[1]?Ye[1]>vt[1]?1:-1:function(Et,St,Nt,ni){return Et.left!==St.left?Et.left?1:-1:st(Nt,Et.otherEvent.point,St.otherEvent.point)!==0?Et.isBelow(St.otherEvent.point)?-1:1:!Et.isSubject&&St.isSubject?1:-1}(ue,ge,Ye)}function We(ue,ge,Ye){var vt=new ne(ge,!1,ue,ue.isSubject),Et=new ne(ge,!0,ue.otherEvent,ue.isSubject);return V(ue.point,ue.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ue),vt.contourId=Et.contourId=ue.contourId,$e(Et,ue.otherEvent)>0&&(ue.otherEvent.left=!0,Et.left=!1),ue.otherEvent.otherEvent=Et,ue.otherEvent=vt,Ye.push(Et),Ye.push(vt),Ye}function gt(ue,ge){return ue[0]*ge[1]-ue[1]*ge[0]}function yt(ue,ge){return ue[0]*ge[0]+ue[1]*ge[1]}function Xt(ue,ge,Ye){var vt=function(Vi,Ui,Mi,vr,Rr){var Gi=[Ui[0]-Vi[0],Ui[1]-Vi[1]],an=[vr[0]-Mi[0],vr[1]-Mi[1]];function Or(Yi,Wr,gn){return[Yi[0]+Wr*gn[0],Yi[1]+Wr*gn[1]]}var _r=[Mi[0]-Vi[0],Mi[1]-Vi[1]],vn=gt(Gi,an),Hr=vn*vn,kr=yt(Gi,Gi);if(Hr>0){var Br=gt(_r,an)/vn;if(Br<0||Br>1)return null;var Tr=gt(_r,Gi)/vn;return Tr<0||Tr>1?null:Br===0||Br===1?[Or(Vi,Br,Gi)]:Tr===0||Tr===1?[Or(Mi,Tr,an)]:[Or(Vi,Br,Gi)]}if((Hr=(vn=gt(_r,Gi))*vn)>0)return null;var ki=yt(Gi,_r)/kr,Ir=ki+yt(Gi,an)/kr,ln=Math.min(ki,Ir),ii=Math.max(ki,Ir);return ln<=1&&ii>=0?ln===1?[Or(Vi,ln>0?ln:0,Gi)]:ii===0?[Or(Vi,ii<1?ii:1,Gi)]:[Or(Vi,ln>0?ln:0,Gi),Or(Vi,ii<1?ii:1,Gi)]:null}(ue.point,ue.otherEvent.point,ge.point,ge.otherEvent.point),Et=vt?vt.length:0;if(Et===0||Et===1&&(V(ue.point,ge.point)||V(ue.otherEvent.point,ge.otherEvent.point))||Et===2&&ue.isSubject===ge.isSubject)return 0;if(Et===1)return V(ue.point,vt[0])||V(ue.otherEvent.point,vt[0])||We(ue,vt[0],Ye),V(ge.point,vt[0])||V(ge.otherEvent.point,vt[0])||We(ge,vt[0],Ye),1;var St=[],Nt=!1,ni=!1;return V(ue.point,ge.point)?Nt=!0:$e(ue,ge)===1?St.push(ge,ue):St.push(ue,ge),V(ue.otherEvent.point,ge.otherEvent.point)?ni=!0:$e(ue.otherEvent,ge.otherEvent)===1?St.push(ge.otherEvent,ue.otherEvent):St.push(ue.otherEvent,ge.otherEvent),Nt&&ni||Nt?(ge.type=S,ue.type=ge.inOut===ue.inOut?I:A,Nt&&!ni&&We(St[1].otherEvent,St[0].point,Ye),2):ni?(We(St[0],St[1].point,Ye),3):St[0]!==St[3].otherEvent?(We(St[0],St[1].point,Ye),We(St[1],St[2].point,Ye),3):(We(St[0],St[1].point,Ye),We(St[3].otherEvent,St[2].point,Ye),3)}function zt(ue,ge){if(ue===ge)return 0;if(st(ue.point,ue.otherEvent.point,ge.point)!==0||st(ue.point,ue.otherEvent.point,ge.otherEvent.point)!==0)return V(ue.point,ge.point)?ue.isBelow(ge.otherEvent.point)?-1:1:ue.point[0]===ge.point[0]?ue.point[1]<ge.point[1]?-1:1:$e(ue,ge)===1?ge.isAbove(ue.point)?-1:1:ue.isBelow(ge.point)?-1:1;if(ue.isSubject!==ge.isSubject)return ue.isSubject?-1:1;var Ye=ue.point,vt=ge.point;return Ye[0]===vt[0]&&Ye[1]===vt[1]?(Ye=ue.otherEvent.point)[0]===(vt=ge.otherEvent.point)[0]&&Ye[1]===vt[1]?0:ue.contourId>ge.contourId?1:-1:$e(ue,ge)===1?1:-1}var Tt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function mt(ue,ge,Ye,vt){var Et,St=ue+1,Nt=ge[ue].point,ni=ge.length;for(St<ni&&(Et=ge[St].point);St<ni&&Et[0]===Nt[0]&&Et[1]===Nt[1];){if(!Ye[St])return St;++St<ni&&(Et=ge[St].point)}for(St=ue-1;Ye[St]&&St>vt;)St--;return St}Tt.prototype.isExterior=function(){return this.holeOf==null};var gi=Lt,jt=Lt;function Lt(ue,ge){if(!(this instanceof Lt))return new Lt(ue,ge);if(this.data=ue||[],this.length=this.data.length,this.compare=ge||oi,this.length>0)for(var Ye=(this.length>>1)-1;Ye>=0;Ye--)this._down(Ye)}function oi(ue,ge){return ue<ge?-1:ue>ge?1:0}Lt.prototype={push:function(ue){this.data.push(ue),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ue=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ue}},peek:function(){return this.data[0]},_up:function(ue){for(var ge=this.data,Ye=this.compare,vt=ge[ue];ue>0;){var Et=ue-1>>1,St=ge[Et];if(Ye(vt,St)>=0)break;ge[ue]=St,ue=Et}ge[ue]=vt},_down:function(ue){for(var ge=this.data,Ye=this.compare,vt=this.length>>1,Et=ge[ue];ue<vt;){var St=1+(ue<<1),Nt=St+1,ni=ge[St];if(Nt<this.length&&Ye(ge[Nt],ni)<0&&(St=Nt,ni=ge[Nt]),Ye(ni,Et)>=0)break;ge[ue]=ni,ue=St}ge[ue]=Et}},gi.default=jt;var Ti=Math.max,bi=Math.min,Li=0;function Pi(ue,ge,Ye,vt,Et,St){var Nt,ni,Vi,Ui,Mi,vr;for(Nt=0,ni=ue.length-1;Nt<ni;Nt++)if(Ui=ue[Nt+1],Mi=new ne(Vi=ue[Nt],!1,void 0,ge),vr=new ne(Ui,!1,Mi,ge),Mi.otherEvent=vr,Vi[0]!==Ui[0]||Vi[1]!==Ui[1]){Mi.contourId=vr.contourId=Ye,St||(Mi.isExteriorRing=!1,vr.isExteriorRing=!1),$e(Mi,vr)>0?vr.left=!0:Mi.left=!0;var Rr=Vi[0],Gi=Vi[1];Et[0]=bi(Et[0],Rr),Et[1]=bi(Et[1],Gi),Et[2]=Ti(Et[2],Rr),Et[3]=Ti(Et[3],Gi),vt.push(Mi),vt.push(vr)}}var Fi=[];function gr(ue,ge,Ye){typeof ue[0][0][0]=="number"&&(ue=[ue]),typeof ge[0][0][0]=="number"&&(ge=[ge]);var vt=function(Gi,an,Or){var _r=null;return Gi.length*an.length==0&&(Or===M?_r=Fi:Or===z?_r=Gi:Or!==N&&Or!==B||(_r=Gi.length===0?an:Gi)),_r}(ue,ge,Ye);if(vt)return vt===Fi?null:vt;var Et=[1/0,1/0,-1/0,-1/0],St=[1/0,1/0,-1/0,-1/0],Nt=function(Gi,an,Or,_r,vn){var Hr,kr,Br,Tr,ki,Ir,ln=new gi(null,$e);for(Br=0,Tr=Gi.length;Br<Tr;Br++)for(ki=0,Ir=(Hr=Gi[Br]).length;ki<Ir;ki++)(kr=ki===0)&&Li++,Pi(Hr[ki],!0,Li,ln,Or,kr);for(Br=0,Tr=an.length;Br<Tr;Br++)for(ki=0,Ir=(Hr=an[Br]).length;ki<Ir;ki++)kr=ki===0,vn===z&&(kr=!1),kr&&Li++,Pi(Hr[ki],!1,Li,ln,_r,kr);return ln}(ue,ge,Et,St,Ye);if(vt=function(Gi,an,Or,_r,vn){var Hr=null;return(Or[0]>_r[2]||_r[0]>Or[2]||Or[1]>_r[3]||_r[1]>Or[3])&&(vn===M?Hr=Fi:vn===z?Hr=Gi:vn!==N&&vn!==B||(Hr=Gi.concat(an))),Hr}(ue,ge,Et,St,Ye))return vt===Fi?null:vt;for(var ni=function(Gi){var an,Or,_r=function(Br){var Tr,ki,Ir,ln,ii=[];for(ki=0,Ir=Br.length;ki<Ir;ki++)((Tr=Br[ki]).left&&Tr.inResult||!Tr.left&&Tr.otherEvent.inResult)&&ii.push(Tr);for(var Yi=!1;!Yi;)for(Yi=!0,ki=0,Ir=ii.length;ki<Ir;ki++)ki+1<Ir&&$e(ii[ki],ii[ki+1])===1&&(ln=ii[ki],ii[ki]=ii[ki+1],ii[ki+1]=ln,Yi=!1);for(ki=0,Ir=ii.length;ki<Ir;ki++)(Tr=ii[ki]).otherPos=ki;for(ki=0,Ir=ii.length;ki<Ir;ki++)(Tr=ii[ki]).left||(ln=Tr.otherPos,Tr.otherPos=Tr.otherEvent.otherPos,Tr.otherEvent.otherPos=ln);return ii}(Gi),vn={},Hr=[],kr=function(){if(!vn[an]){var Br=Hr.length,Tr=function(ii,Yi,Wr){var gn=new Tt;if(ii.prevInResult!=null){var tn=ii.prevInResult,Nn=tn.outputContourId;if(tn.resultTransition>0){var Ar=Yi[Nn];if(Ar.holeOf!=null){var Pn=Ar.holeOf;Yi[Pn].holeIds.push(Wr),gn.holeOf=Pn,gn.depth=Yi[Nn].depth}else Yi[Nn].holeIds.push(Wr),gn.holeOf=Nn,gn.depth=Yi[Nn].depth+1}else gn.holeOf=null,gn.depth=Yi[Nn].depth}else gn.holeOf=null,gn.depth=0;return gn}(_r[an],Hr,Br),ki=function(ii){vn[ii]=!0,ii<_r.length&&_r[ii]&&(_r[ii].outputContourId=Br)},Ir=an,ln=an;for(Tr.points.push(_r[an].point);ki(Ir),ki(Ir=_r[Ir].otherPos),Tr.points.push(_r[Ir].point),!((Ir=mt(Ir,_r,vn,ln))==ln||Ir>=_r.length)&&_r[Ir];);Hr.push(Tr)}};for(an=0,Or=_r.length;an<Or;an++)kr();return Hr}(function(Gi,an,Or,_r,vn,Hr){for(var kr,Br,Tr,ki=new c(zt),Ir=[],ln=Math.min(_r[2],vn[2]);Gi.length!==0;){var ii=Gi.pop();if(Ir.push(ii),Hr===M&&ii.point[0]>ln||Hr===z&&ii.point[0]>_r[2])break;if(ii.left){Br=kr=ki.insert(ii),kr=kr!==(Tr=ki.minNode())?ki.prev(kr):null,Br=ki.next(Br);var Yi=kr?kr.key:null;if(q(ii,Yi,Hr),Br&&Xt(ii,Br.key,Gi)===2&&(q(ii,Yi,Hr),q(Br.key,ii,Hr)),kr&&Xt(kr.key,ii,Gi)===2){var Wr=kr;q(Yi,(Wr=Wr!==Tr?ki.prev(Wr):null)?Wr.key:null,Hr),q(ii,Yi,Hr)}}else Br=kr=ki.find(ii=ii.otherEvent),kr&&Br&&(kr=kr!==Tr?ki.prev(kr):null,Br=ki.next(Br),ki.remove(ii),Br&&kr&&Xt(kr.key,Br.key,Gi))}return Ir}(Nt,0,0,Et,St,Ye)),Vi=[],Ui=0;Ui<ni.length;Ui++){var Mi=ni[Ui];if(Mi.isExterior()){for(var vr=[Mi.points],Rr=0;Rr<Mi.holeIds.length;Rr++)vr.push(ni[Mi.holeIds[Rr]].points);Vi.push(vr)}}return Vi}var Fr={UNION:N,DIFFERENCE:z,INTERSECTION:M,XOR:B};r.diff=function(ue,ge){return gr(ue,ge,z)},r.intersection=function(ue,ge){return gr(ue,ge,M)},r.operations=Fr,r.union=function(ue,ge){return gr(ue,ge,N)},r.xor=function(ue,ge){return gr(ue,ge,B)},Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,RC.exports)),RC.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Gx(n,e,r,l){const c=[],p=l===0?(f,x,b,S,I,A)=>{f.push(new wt(A,b+(A-x)/(S-x)*(I-b)))}:(f,x,b,S,I,A)=>{f.push(new wt(x+(A-b)/(I-b)*(S-x),A))};for(const f of n){const x=[];for(const b of f){if(b.length<=2)continue;const S=[];for(let M=0;M<b.length-1;M++){const N=b[M].x,z=b[M].y,B=b[M+1].x,q=b[M+1].y,K=l===0?N:z,ne=l===0?B:q;K<e?ne>e&&p(S,N,z,B,q,e):K>r?ne<r&&p(S,N,z,B,q,r):S.push(b[M]),ne<e&&K>=e&&p(S,N,z,B,q,e),ne>r&&K<=r&&p(S,N,z,B,q,r)}let I=b[b.length-1];const A=l===0?I.x:I.y;A>=e&&A<=r&&S.push(I),S.length&&(I=S[S.length-1],S[0].x===I.x&&S[0].y===I.y||S.push(S[0]),x.push(S))}x.length&&c.push(x)}return c}function P3(n,e){const r=Kw(n),l=Kw([e]),c=kC.intersection(r,l);return c==null?[]:DC(c)}function M3(n,e){let l=Kw(n,65536);for(;e.valid();e.next()){const[c,p]=e.get(),f=c.x*65536,x=c.y*65536,b=p.x*65536,S=p.y*65536,I=b-f,A=S-x,M=Math.hypot(I,A),N=Math.trunc(A/M*3),z=-Math.trunc(I/M*3);l=kC.diff(l,[[[f,x],[b,S],[b+N,S+z],[f+N,x+z],[f,x]]])}return DC(l,1/65536)}function Kw(n,e=1){return[n.map(r=>r.map(l=>[l.x*e,l.y*e]))]}function DC(n,e=1){return n.map(r=>r.map((l,c)=>{const p=l.map(f=>new wt(f[0]*e,f[1]*e).round());return c>0&&p.reverse(),p}))}class Qw{constructor(e,r){this.layoutVertexArray=new Za,this.indexArray=new ls,this.lineIndexArray=new Ml,this.triangleSegments=new fn,this.lineSegments=new fn,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Al)}update(e,r,l,c,p,f,x,b){this.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,m3.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,l,c,p,f,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,l,c,p,f,void 0,x)}}class Jw{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Qw(e,!1),this.elevationBufferData=new Qw(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,c){this.hasPattern=Xw("fill",this.layers,this.pixelRatio,r);const p=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:x,id:b,index:S,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Pt(x,A);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),M,l))continue;const N=p?p.evaluate(M,{},l,r.availableImages):void 0,z={id:b,properties:x.properties,type:x.type,sourceLayerIndex:I,index:S,geometry:A?M.geometry:Dt(x,l,c),patterns:{},sortKey:N};f.push(z)}p&&f.sort((x,b)=>x.sortKey-b.sortKey);for(const x of f){const{geometry:b,index:S,sourceLayerIndex:I}=x;if(this.hasPattern){const A=Yw("fill",this.layers,x,this.zoom,this.pixelRatio,r);this.patternFeatures.push(A)}else this.addFeature(x,b,S,l,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[S].feature,b,S,I,this.index)}}update(e,r,l,c,p,f,x){this.bufferData.update(e,r,l,c,p,f,x,this.worldview),this.elevationBufferData.update(e,r,l,c,p,f,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,r,l,c,p,f,x,this.worldview)}addFeatures(e,r,l,c,p,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,l,c,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,l,c,p,f=[],x,b){const S=Ux(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,c,l,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,l,p,f,c,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,p,f,c,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,r,l,c,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(r,l,c,p,this.worldview))}addElevatedRoadFeature(e,r,l,c,p){const f=new Array,x=_o.getElevationFeature(e,p);if(!x)return void this.addGeometry(r,this.bufferData);{const S=this.clipPolygonsToTile(r,1);S.length>0&&f.push({polygons:S,elevationFeature:x,elevationTileID:l})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:c};for(const S of f)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Fo(S.elevationTileID,this.layers,this.zoom,this.lut));const A=S.elevationFeature.isTunnel();let M=0;e.properties.hasOwnProperty(Gr)&&(M=+e.properties[Gr]);for(const N of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,N,A,S.elevationFeature,M)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const I=new na(l,S.elevationTileID);this.addElevatedGeometry(S.polygons,I,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,b)}}addElevatedGeometry(e,r,l,c,p,f){const x={elevation:l,elevationSampler:r,bias:c,index:p,featureInfo:f},[b,S]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,r,l){let c=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,f=null;l&&(f=l.elevationSampler.constantElevation(l.elevation,l.bias),f!=null&&(c=f,p=f));const x=(b,S,I)=>{if(l!=null)if(S.push(b),f!=null)r.elevatedLayoutVertexArray.emplaceBack(f),I.push(f);else{const A=l.elevationSampler.pointElevation(b,l.elevation,l.bias);r.elevatedLayoutVertexArray.emplaceBack(A),I.push(A),c=Math.min(c,A),p=Math.max(p,A)}};for(const b of e){let S=0;for(const se of b)S+=se.length;const I=r.triangleSegments.prepareSegment(S,r.layoutVertexArray,r.indexArray),A=I.vertexLength,M=[],N=[],z=[],B=[],q=[],K=r.layoutVertexArray.length;for(const se of b){if(se.length===0)continue;se!==b[0]&&N.push(M.length/2);const V=r.lineSegments.prepareSegment(se.length,r.layoutVertexArray,r.lineIndexArray),ee=V.vertexLength;l&&q.push(r.layoutVertexArray.length-K),x(se[0],z,B),r.layoutVertexArray.emplaceBack(se[0].x,se[0].y),r.lineIndexArray.emplaceBack(ee+se.length-1,ee),M.push(se[0].x),M.push(se[0].y);for(let ae=1;ae<se.length;ae++)x(se[ae],z,B),r.layoutVertexArray.emplaceBack(se[ae].x,se[ae].y),r.lineIndexArray.emplaceBack(ee+ae-1,ee+ae),M.push(se[ae].x),M.push(se[ae].y);V.vertexLength+=se.length,V.primitiveLength+=se.length}const ne=$g(M,N);for(let se=0;se<ne.length;se+=3)r.indexArray.emplaceBack(A+ne[se],A+ne[se+1],A+ne[se+2]);if(ne.length>0&&l&&this.elevationMode==="hd-road-base"){const se=l.elevation.isTunnel(),V=l.elevation.safeArea,ee=this.elevatedStructures.addVertices(z,B);this.elevatedStructures.addTriangles(ne,ee,se);const ae=q.length;if(ae>0){for(let fe=0;fe<ae-1;fe++)this.elevatedStructures.addRenderableRing(l.index,q[fe]+ee,q[fe+1]-q[fe],se,V,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,q[ae-1]+ee,z.length-q[ae-1],se,V,l.featureInfo)}}I.vertexLength+=S,I.primitiveLength+=ne.length/3}return[c,p]}prepareElevatedPolygons(e,r,l){const c=1/qe(l),p=[];for(const f of e){const x=M3(f,new eo(r,c));p.push(...x)}return p}clipPolygonsToTile(e,r){const l=-r,c=-r,p=bt+r,f=bt+r;let x=0;const b=[],S=[];for(;x<e.length;x++){const M=e[x],N=Hm(M);(N.min.x>=l&&N.max.x<=p&&N.min.y>=c&&N.max.y<=f?b:S).push(M)}if(b.length===e.length)return e;const I=[new wt(l,c),new wt(p,c),new wt(p,f),new wt(l,f),new wt(l,c)],A=b;for(const M of S)A.push(...P3(M,I));return A}}let NC,jC,zC,LC;Rt(Jw,"FillBucket",{omit:["layers","patternFeatures"]}),Rt(Qw,"FillBufferData"),Rt(Fo,"ElevatedStructures");class eb{constructor(e,r,l,c){if(this.triangleCount=r.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,f]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const M=e[A];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),f.x=Math.max(f.x,M.x),f.y=Math.max(f.y,M.y)}if(c){const A=Math.ceil(Math.max(f.x-p.x,f.y-p.y)/c);l=Math.max(l,A)}if(l===0)return;this.min=p,this.max=f;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const b=Math.max(x.x,x.y)/l;this.cellsX=Math.max(1,Math.ceil(x.x/b)),this.cellsY=Math.max(1,Math.ceil(x.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let A=0;A<this.triangleCount;A++){const M=e[r[3*A+0]].sub(this.min),N=e[r[3*A+1]].sub(this.min),z=e[r[3*A+2]].sub(this.min),B=zl(Math.floor(Math.min(M.x,N.x,z.x)),this.xScale,this.cellsX),q=zl(Math.floor(Math.max(M.x,N.x,z.x)),this.xScale,this.cellsX),K=zl(Math.floor(Math.min(M.y,N.y,z.y)),this.yScale,this.cellsY),ne=zl(Math.floor(Math.max(M.y,N.y,z.y)),this.yScale,this.cellsY),se=new wt(0,0),V=new wt(0,0),ee=new wt(0,0),ae=new wt(0,0);for(let fe=K;fe<=ne;++fe){se.y=V.y=fe*b,ee.y=ae.y=(fe+1)*b;for(let Ae=B;Ae<=q;++Ae)se.x=ee.x=Ae*b,V.x=ae.x=(Ae+1)*b,(Bw(M,N,z,se,V,ae)||Bw(M,N,z,se,ae,ee))&&S.push({cellIdx:fe*this.cellsX+Ae,triIdx:A})}}if(S.length===0)return;S.sort((A,M)=>A.cellIdx-M.cellIdx||A.triIdx-M.triIdx);let I=0;for(;I<S.length;){const A=S[I].cellIdx,M={start:this.payload.length,len:0};for(;I<S.length&&S[I].cellIdx===A;)++M.len,this.payload.push(S[I++].triIdx);this.cells[A]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=zl(e.x-this.min.x,this.xScale,this.cellsX),c=zl(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[c*this.cellsX+l];if(p){this._lazyInitLookup();for(let f=0;f<p.len;f++){const x=this.payload[p.start+f],b=Math.floor(x/8),S=1<<x%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,r.push(x),r.length===this.triangleCount))return}}}query(e,r,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const c=zl(e.x-this.min.x,this.xScale,this.cellsX),p=zl(r.x-this.min.x,this.xScale,this.cellsX),f=zl(e.y-this.min.y,this.yScale,this.cellsY),x=zl(r.y-this.min.y,this.yScale,this.cellsY);for(let b=f;b<=x;b++)for(let S=c;S<=p;S++){const I=this.cells[b*this.cellsX+S];if(I)for(let A=0;A<I.len;A++){const M=this.payload[I.start+A],N=Math.floor(M/8),z=1<<M%8;if(!(this.lookup[N]&z)&&(this.lookup[N]|=z,l.push(M),l.length===this.triangleCount))return}}}}function zl(n,e,r){return Math.max(0,Math.min(r-1,Math.floor(n*e)))}Rt(eb,"TriangleGridIndex");class FC{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,r){for(const l of this.footprints)r.push({footprint:l,id:e})}populate(e,r,l,c){const p=[];for(const{feature:f,id:x,index:b,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,A=Pt(f,I);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),A,l))continue;const M={id:x,properties:f.properties,type:f.type,sourceLayerIndex:S,index:b,geometry:I?A.geometry:Dt(f,l,c),patterns:{}};p.push(M)}for(const f of p){const{geometry:x,index:b,sourceLayerIndex:S}=f;this.addFeature(f,x,b,l,{},r.availableImages,r.brightness),r.featureIndex.insert(e[b].feature,x,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,l,c,p,f,x){}destroy(){}addFeature(e,r,l,c,p,f=[],x){for(const b of Ux(r,2)){const S=[],I=[],A=[],M=new wt(1/0,1/0),N=new wt(-1/0,-1/0);for(const q of b)if(q.length!==0){q!==b[0]&&A.push(I.length/2);for(let K=0;K<q.length;K++)I.push(q[K].x),I.push(q[K].y),S.push(q[K]),M.x=Math.min(M.x,q[K].x),M.y=Math.min(M.y,q[K].y),N.x=Math.max(N.x,q[K].x),N.y=Math.max(N.y,q[K].y)}const z=$g(I,A),B=new eb(S,z,8,256);this.footprints.push({vertices:S,indices:z,grid:B,min:M,max:N})}}}Rt(FC,"ClipBucket",{omit:["layers"]});const R3=er([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),k3=er([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),D3=er([{name:"a_centroid_pos",components:2,type:"Uint16"}]),N3=er([{name:"a_join_normal_inside",components:3,type:"Int16"}]),j3=er([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),z3=er([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:L3}=R3,$x=Number.MAX_SAFE_INTEGER;function OC(n,e,r,l){return n.order<e||n.order===$x||!(n.clipMask&r)||function(c,p){return p.length!==0&&p.find(f=>f===c)===void 0}(l,n.clipScope)}function qx(n,e){return n.x-e.x||n.y-e.y}function BC(n,e){return qx(n.min,e.min)===0&&qx(n.max,e.max)===0}function tb(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function ib(n,e){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(n[r].sourceId!==e[r].sourceId||!BC(n[r],e[r])||n[r].order!==e[r].order||n[r].clipMask!==e[r].clipMask||!Ko(n[r].clipScope,e[r].clipScope))return!1;return!0}function VC(n,e,r){const l=1/bt,c=1/(1<<r.canonical.z),p=(e.x*l+r.canonical.x)*c+r.wrap,f=(e.y*l+r.canonical.y)*c;return{min:new wt((n.x*l+r.canonical.x)*c+r.wrap,(n.y*l+r.canonical.y)*c),max:new wt(p,f)}}function F3(n,e,r){const l=1<<r.canonical.z,c=((e.x-r.wrap)*l-r.canonical.x)*bt,p=(e.y*l-r.canonical.y)*bt;return{min:new wt(((n.x-r.wrap)*l-r.canonical.x)*bt,(n.y*l-r.canonical.y)*bt),max:new wt(c,p)}}function UC(n,e,r,l,c,p,f){const x=n.indices,b=n.vertices,S=[];for(let I=l;I<l+c;I+=3){const A=e[r[I+0]+p],M=e[r[I+1]+p],N=e[r[I+2]+p],z=Math.min(A.x,M.x,N.x),B=Math.max(A.x,M.x,N.x),q=Math.min(A.y,M.y,N.y),K=Math.max(A.y,M.y,N.y);S.length=0,n.grid.query(new wt(z,q),new wt(B,K),S);for(let ne=0;ne<S.length;ne++){const se=S[ne];if(Bw(b[x[3*se+0]],b[x[3*se+1]],b[x[3*se+2]],A,M,N,f))return!0}}return!1}function GC(n,e,r,l){if(!n||!r)return!1;let c=n.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(r.vertices.length<n.vertices.length)return GC(r,l,n,e);const p=e.canonical,f=l.canonical,x=Math.pow(2,f.z-p.z);c=n.vertices.map(b=>new wt((b.x+p.x*bt)*x-f.x*bt,(b.y+p.y*bt)*x-f.y*bt))}return UC(r,c,n.indices,0,n.indices.length,0,0)}function $C(n,e,r,l){const c=Math.pow(2,l.z-r.z);return new wt((n+r.x*bt)*c-l.x*bt,(e+r.y*bt)*c-l.y*bt)}function qC(n,e){const r=[];e.grid.queryPoint(n,r);const l=e.indices,c=e.vertices;for(let p=0;p<r.length;p++){const f=r[p];if(Ea([c[l[3*f+0]],c[l[3*f+1]],c[l[3*f+2]]],n))return!0}return!1}const rb=[new wt(0,0),new wt(bt,0),new wt(bt,bt),new wt(0,bt)];function HC(n,e){const r=[];let l=[];if(!e||n.length<2)return[n];if(n.length===2)return Ec(n[0],n[1],rb)?[n]:[];for(let c=0;c<n.length+2;c++){const p=n[c%n.length],f=n[(c+1)%n.length],x=Ec(c===0?n[n.length-1]:n[(c-1)%n.length],p,rb),b=Ec(p,f,rb),S=x||b;S&&l.push(p),S&&b||l.length>0&&(l.length>1&&r.push(l),l=[])}return l.length>1&&r.push(l),r}const nb=Ri.VectorTileFeature.types,O3=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],B3=["fill-extrusion-flood-light-ground-radius"],V3=Math.pow(2,13),U3=Math.pow(2,15)-1,WC=new wt(0,1),Ru=2147483648;function Xg(n,e,r,l,c,p,f,x){n.emplaceBack((e<<1)+f,(r<<1)+p,(Math.floor(l*V3)<<1)+c,Math.round(x))}function Yg(n,e,r){n.emplaceBack(e.x*bt,e.y*bt,r?1:0)}function Hx(n,e,r,l,c,p){n.emplaceBack(e.x,e.y,(r.x<<1)+l,(r.y<<1)+c,p)}function Kg(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ZC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class XC{constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class YC{constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,l){this.accCount++,this.acc._add(r);let c=!!this.borders;r.x<e.min.x?(e.min.x=r.x,c=!0):r.x>e.max.x&&(e.max.x=r.x,c=!0),r.y<e.min.y?(e.min.y=r.y,c=!0):r.y>e.max.y&&(e.max.y=r.y,c=!0),((r.x===0||r.x===bt)&&r.x===l.x)!=((r.y===0||r.y===bt)&&r.y===l.y)&&this.processBorderOverlap(r,l),c&&this.checkBorderIntersection(r,l)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,si(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>bt!=e.x>bt&&this.addBorderIntersection(1,si(r.y,e.y,(bt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,si(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>bt!=e.y>bt&&this.addBorderIntersection(3,si(r.x,e.x,(bt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];r<l[0]&&(l[0]=r),r>l[1]&&(l[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,r.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,r.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function KC(n,e){const r=n.add(e)._unit(),l=ve(n.x*r.x+n.y*r.y,-1,1);var c,p,f;return c=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(c)))/4*U3*((p=n).x*(f=e).y-p.y*f.x<0?-1:1)}const G3=[n=>n.x<0,n=>n.x>bt,n=>n.y<0,n=>n.y>bt];function $3(n,e,r,l){const c=[4];if(l===0)return c;r._mult(l);const p=n.sub(r),f=e.sub(r),x=[n,e,p,f];for(let b=0;b<4;b++)for(const S of x)if(G3[b](S)){c.push(b);break}return c}class QC{constructor(e){this.vertexArray=new xu,this.indexArray=new ls,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut},r=>B3.includes(r)),this._segments=new fn,this.hiddenByLandmarkVertexArray=new af,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new fn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,l,c=!1){const p=e.length;if(p>2){let f=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let b;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const S=e[0],I=e[1];b=KC(S.sub(e[p-1])._perp()._unit(),I.sub(S)._perp()._unit())}for(let S=0;S<p;S++){const I=S===p-1?0:S+1,A=e[S],M=e[I],N=e[I===p-1?0:I+1],z=M.sub(A)._perp()._unit(),B=KC(z,N.sub(M)._perp()._unit()),q=b,K=B;if(sb(A,M,r)||c&&tI(A,r)&&tI(M,r)){b=B;continue}const ne=x.vertexLength;Hx(this.vertexArray,A,M,1,1,q),Hx(this.vertexArray,A,M,1,0,q),Hx(this.vertexArray,A,M,0,1,K),Hx(this.vertexArray,A,M,0,0,K),x.vertexLength+=4;const se=$3(A,M,z,l);for(const V of se)this._segmentToGroundQuads[f].push({id:ne,region:V}),this._segmentToRegionTriCounts[f][V]+=2,x.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let l=0;l<r;l++)this._segmentToGroundQuads[l].sort((c,p)=>c.region-p.region);for(let l=0;l<r;l++){const c=this._segmentToGroundQuads[l],p=e[l],f=this._segmentToRegionTriCounts[l];f.reduce((b,S)=>b+S,0);let x=0;for(let b=0;b<=4;b++){const S=f[b];if(S!==0){let I=this.regionSegments[b];I||(I=this.regionSegments[b]=new fn);const A={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+x,vertexLength:p.vertexLength,primitiveLength:S};I.get().push(A)}x+=S}for(let b=0;b<c.length;b++){const S=c[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,l,c,p,f,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,l,c,p,f,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,k3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,l,c,p,f,x,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,l,c,p,f,x,b)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const l=e.flags&Ru?1:0;for(let c=e.groundVertexArrayOffset;c<r;++c)this.hiddenByLandmarkVertexArray.emplace(c,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,j3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class Wx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ls,this.footprintVertices=new Za,this.footprintSegments=[],this.layoutVertexArray=new yu,this.centroidVertexArray=new Ax,this.wallVertexArray=new Mx,this.indexArray=new ls,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut},r=>O3.includes(r)),this.segments=new fn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new QC(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,c){this.features=[],this.hasPattern=Xw("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=qe(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:f,index:x,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Pt(p,S);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),I,l))continue;const A={id:f,sourceLayerIndex:b,index:x,geometry:S?I.geometry:Dt(p,l,c),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length,N=nb[A.type]==="Polygon";if(this.hasPattern)this.features.push(Yw("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const z of A.geometry)for(const B of HC(z,N))this.addFeature(A,[B],x,l,{},r.availableImages,c,r.brightness);else this.addFeature(A,A.geometry,x,l,{},r.availableImages,c,r.brightness);r.featureIndex.insert(p,A.geometry,x,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,l,c,p,f){for(const x of this.features){const b=nb[x.type]==="Polygon",{geometry:S}=x;if(this.wallMode)for(const I of S)for(const A of HC(I,b))this.addFeature(x,[A],x.index,r,l,c,p,f);else this.addFeature(x,S,x.index,r,l,c,p,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,l,c,p,f,x){this.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,this.worldview),this.groundEffect.update(e,r,p,l,c,f,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,L3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,N3.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,z3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,D3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,c,p,f,x,b){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,I=[new wt(0,0),new wt(bt,bt)],A=x.projection,M=A.name==="globe",N=this.wallMode||nb[e.type]==="Polygon",z=new YC;z.centroidDataIndex=this.centroidData.length;const B=new XC,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,K=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);let ne;if(B.height=K,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nf),this.wallMode){if(M)return void Ei("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;ne=function(Pe){const De=Pe[0].x===Pe[Pe.length-1].x&&Pe[0].y===Pe[Pe.length-1].y;(function(Tt){let mt=0;const gi=Tt.length;for(let jt=0;jt<gi;jt++)mt+=(Tt[(jt+1)%gi].x-Tt[jt].x)*(Tt[(jt+1)%gi].y+Tt[jt].y);return mt>=0})(Pe)||(Pe=Pe.reverse());const ut={geometry:[],joinNormals:[],indices:[]},it=[],lt=[],ht=[];let Ze=Pe.length;for(;Ze>=2&&Pe[Ze-1].equals(Pe[Ze-2]);)Ze--;if(Ze<(De?3:2))return ut;let st,$e,We,gt,yt,Xt=0;for(;Xt<Ze-1&&Pe[Xt].equals(Pe[Xt+1]);)Xt++;De&&(st=Pe[Ze-2],yt=Pe[Xt].sub(st)._unit()._perp());for(let Tt=Xt;Tt<Ze;Tt++){if(We=Tt===Ze-1?De?Pe[Xt+1]:void 0:Pe[Tt+1],We&&Pe[Tt].equals(We))continue;yt&&(gt=yt),st&&($e=st),st=Pe[Tt],yt=We?We.sub(st)._unit()._perp():gt,gt=gt||yt;let mt=gt.add(yt);mt.x===0&&mt.y===0||mt._unit();const gi=mt.x*yt.x+mt.y*yt.y,jt=gi!==0?1/gi:1/0,Lt=gt.x*yt.y-gt.y*yt.x>0;let oi="miter";const Ti=2;oi==="miter"&&jt>Ti&&(oi="bevel"),oi==="bevel"&&(jt>100&&(oi="flipbevel"),jt<Ti&&(oi="miter"));const bi=(Li,Pi,Fi,gr)=>{const Fr=new wt(Li.x,Li.y),ue=new wt(Li.x,Li.y);Fr.x+=Pi.x*gr,Fr.y+=Pi.y*gr,ue.x-=Pi.x*Math.max(Fi,1),ue.y-=Pi.y*Math.max(Fi,1),ht.push(Pi),it.push(Fr),lt.push(ue)};if(oi==="miter")mt._mult(jt),bi(st,mt,0,0);else if(oi==="flipbevel")mt=yt.mult(-1),bi(st,mt,0,0),bi(st,mt.mult(-1),0,0);else{const Li=-Math.sqrt(jt*jt-1),Pi=Lt?Li:0,Fi=Lt?0:Li;$e&&bi(st,gt,Pi,Fi),We&&bi(st,yt,Pi,Fi)}}ut.geometry=[...it,...lt.reverse(),it[0]],ut.joinNormals=[...ht,...ht.reverse(),ht[ht.length-1]];const zt=ut.geometry.length-1;for(let Tt=0;Tt<zt/2;Tt++)if(Tt+1<zt/2){let mt=Tt,gi=Tt+1,jt=zt-1-Tt,Lt=zt-2-Tt;mt=mt===0?zt-1:mt-1,gi=gi===0?zt-1:gi-1,jt=jt===0?zt-1:jt-1,Lt=Lt===0?zt-1:Lt-1,ut.indices.push(jt),ut.indices.push(gi),ut.indices.push(mt),ut.indices.push(jt),ut.indices.push(Lt),ut.indices.push(gi)}return ut}(r[0]),r=[ne.geometry]}const se=(Pe,De)=>Pe<(De.length-1)/2||Pe===De.length-1,V=this.wallMode?[r]:Ux(r,500);for(let Pe=V.length-1;Pe>=0;Pe--){const De=V[Pe];(De.length===0||(ee=De[0]).every(He=>He.x<=0)||ee.every(He=>He.x>=bt)||ee.every(He=>He.y<=0)||ee.every(He=>He.y>=bt))&&V.splice(Pe,1)}var ee;let ae;if(M)ae=sI(V,I,c);else{ae=[];for(const Pe of V)ae.push({polygon:Pe,bounds:I})}const fe=N?this.edgeRadius:0,Ae=fe>0&&this.zoom<17,Ee=(Pe,De)=>{if(Pe.length===0)return!1;const He=Pe[Pe.length-1];return De.x===He.x&&De.y===He.y};for(const{polygon:Pe,bounds:De}of ae){let He=0,ut=0;for(const Ze of Pe)N&&!Ze[0].equals(Ze[Ze.length-1])&&Ze.push(Ze[0]),ut+=N?Ze.length-1:Ze.length;const it=this.segments.prepareSegment((N?5:4)*ut,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const lt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ht=new ZC;if(ht.vertexOffset=this.footprintVertices.length,ht.indexOffset=3*this.footprintIndices.length,ht.ringIndices=[],N){const Ze=[],st=[];He=it.vertexLength;for(let We=0;We<Pe.length;We++){const gt=Pe[We];gt.length&&We!==0&&st.push(Ze.length/2);const yt=[];let Xt,zt;Xt=gt[1].sub(gt[0])._perp()._unit(),ht.ringIndices.push(gt.length-1);for(let Tt=1;Tt<gt.length;Tt++){const mt=gt[Tt],gi=gt[Tt===gt.length-1?1:Tt+1],jt=mt.clone();if(fe){zt=gi.sub(mt)._perp()._unit();const Lt=Xt.add(zt)._unit(),oi=fe*Math.min(4,1/(Xt.x*Lt.x+Xt.y*Lt.y));jt.x+=oi*Lt.x,jt.y+=oi*Lt.y,jt.x=Math.round(jt.x),jt.y=Math.round(jt.y),Xt=zt}if(!q||fe!==0&&!Ae||Ee(yt,jt)||yt.push(jt),Xg(this.layoutVertexArray,jt.x,jt.y,0,0,1,1,0),this.wallMode){const Lt=se(Tt,gt);Yg(this.wallVertexArray,ne.joinNormals[Tt],!Lt)}it.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),Ze.push(mt.x,mt.y),M&&Kg(this.layoutVertexExtArray,A.projectTilePoint(jt.x,jt.y,c),A.upVector(c,jt.x,jt.y))}q&&(fe===0||Ae)&&(yt.length!==0&&Ee(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,De,S))}const $e=this.wallMode?ne.indices:$g(Ze,st);for(let We=0;We<$e.length;We+=3)this.footprintIndices.emplaceBack(ht.vertexOffset+$e[We+0],ht.vertexOffset+$e[We+1],ht.vertexOffset+$e[We+2]),this.indexArray.emplaceBack(He+$e[We],He+$e[We+2],He+$e[We+1]),it.primitiveLength++;ht.indexCount+=$e.length,ht.vertexCount+=this.footprintVertices.length-ht.vertexOffset}for(let Ze=0;Ze<Pe.length;Ze++){const st=Pe[Ze];z.startRing(B,st[0]);let $e=st.length>4&&iI(st[st.length-2],st[0],st[1]),We=fe?q3(st[st.length-2],st[0],st[1],fe):0;const gt=[];let yt,Xt,zt;Xt=st[1].sub(st[0])._perp()._unit();let Tt=!0;for(let mt=1,gi=0;mt<st.length;mt++){let jt=st[mt-1],Lt=st[mt];const oi=st[mt===st.length-1?1:mt+1];if(z.appendEdge(B,Lt,jt),sb(Lt,jt,De)){fe&&(Xt=oi.sub(Lt)._perp()._unit(),Tt=!Tt);continue}const Ti=Lt.sub(jt)._perp(),bi=Ti.x/(Math.abs(Ti.x)+Math.abs(Ti.y)),Li=Ti.y>0?1:0,Pi=jt.dist(Lt);if(gi+Pi>32768&&(gi=0),fe){zt=oi.sub(Lt)._perp()._unit();let ue=eI(jt,Lt,oi,JC(Xt,zt),fe);isNaN(ue)&&(ue=0);const ge=Lt.sub(jt)._unit();jt=jt.add(ge.mult(We))._round(),Lt=Lt.add(ge.mult(-ue))._round(),We=ue,Xt=zt,q&&this.zoom>=17&&(Ee(gt,jt)||gt.push(jt),Ee(gt,Lt)||gt.push(Lt))}const Fi=it.vertexLength,gr=st.length>4&&iI(jt,Lt,oi);let Fr=rI(gi,$e,Tt);if(Xg(this.layoutVertexArray,jt.x,jt.y,bi,Li,0,0,Fr),Xg(this.layoutVertexArray,jt.x,jt.y,bi,Li,0,1,Fr),this.wallMode){const ue=se(mt-1,st),ge=ne.joinNormals[mt-1];Yg(this.wallVertexArray,ge,ue),Yg(this.wallVertexArray,ge,ue)}if(gi+=Pi,Fr=rI(gi,gr,!Tt),$e=gr,Xg(this.layoutVertexArray,Lt.x,Lt.y,bi,Li,0,0,Fr),Xg(this.layoutVertexArray,Lt.x,Lt.y,bi,Li,0,1,Fr),this.wallMode){const ue=se(mt,st),ge=ne.joinNormals[mt];Yg(this.wallVertexArray,ge,ue),Yg(this.wallVertexArray,ge,ue)}if(it.vertexLength+=4,this.indexArray.emplaceBack(Fi+0,Fi+1,Fi+2),this.indexArray.emplaceBack(Fi+1,Fi+3,Fi+2),it.primitiveLength+=2,fe){const ue=He+(mt===1?st.length-2:mt-2),ge=mt===1?He:ue+1;if(this.indexArray.emplaceBack(Fi+1,ue,Fi+3),this.indexArray.emplaceBack(ue,ge,Fi+3),it.primitiveLength+=2,yt===void 0&&(yt=Fi),!sb(oi,st[mt],De)){const Ye=mt===st.length-1?yt:it.vertexLength;this.indexArray.emplaceBack(Fi+2,Fi+3,Ye),this.indexArray.emplaceBack(Fi+3,Ye+1,Ye),this.indexArray.emplaceBack(Fi+3,ge,Ye+1),it.primitiveLength+=3}Tt=!Tt}if(M){const ue=this.layoutVertexExtArray,ge=A.projectTilePoint(jt.x,jt.y,c),Ye=A.projectTilePoint(Lt.x,Lt.y,c),vt=A.upVector(c,jt.x,jt.y),Et=A.upVector(c,Lt.x,Lt.y);Kg(ue,ge,vt),Kg(ue,ge,vt),Kg(ue,Ye,Et),Kg(ue,Ye,Et)}}N&&(He+=st.length-1),q&&fe&&this.zoom>=17&&(gt.length!==0&&Ee(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,De,S,fe>0))}this.footprintSegments.push(ht),lt.triangleCount=this.indexArray.length-lt.triangleArrayOffset,this.polygonSegments.push(lt),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=z.borders?WC:this.encodeCentroid(z,B),this.centroidData.push(B),z.borders){this.featuresOnBorder.push(z);const Pe=this.featuresOnBorder.length-1;for(let De=0;De<z.borders.length;De++)z.borders[De][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[De].push(Pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,f,c,b,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,l,p,f,c,b,this.worldview),this.maxHeight=Math.max(this.maxHeight,K)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,l)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const b=this.centroidData[x],S=+(b.min.y+b.max.y>bt),I=2*S+(+(b.min.x+b.max.x>bt)^S);for(let A=0;A<b.polygonSegLen;A++){const M=b.polygonSegIdx+A;e.push({centroidIdx:x,subtile:I,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const r=new ls;e.sort((x,b)=>x.triangleSegmentIdx===b.triangleSegmentIdx?x.subtile-b.subtile:x.triangleSegmentIdx-b.triangleSegmentIdx);let l=0,c=0,p=0;for(const x of e){if(x.triangleSegmentIdx!==l)break;p++}const f=e.length;for(;c!==e.length;){l=e[c].triangleSegmentIdx;let x=0,b=c,S=c;for(let I=b;I<p&&e[I].subtile===x;I++)S++;for(;b!==p;){const I=e[b];x=I.subtile;const A=this.centroidData[I.centroidIdx].min.clone(),M=this.centroidData[I.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=b;z<S;z++){const B=e[z],q=this.polygonSegments[B.polygonSegmentIdx],K=this.centroidData[B.centroidIdx].min,ne=this.centroidData[B.centroidIdx].max,se=this.indexArray.uint16;for(let V=q.triangleArrayOffset;V<q.triangleArrayOffset+q.triangleCount;V++)r.emplaceBack(se[3*V],se[3*V+1],se[3*V+2]);N.primitiveLength+=q.triangleCount,A.x=Math.min(A.x,K.x),A.y=Math.min(A.y,K.y),M.x=Math.max(M.x,ne.x),M.y=Math.max(M.y,ne.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:A,max:M}),b=S;for(let z=b;z<p&&e[z].subtile===e[b].subtile;z++)S++}c=p;for(let I=c;I<f&&e[I].triangleSegmentIdx===e[c].triangleSegmentIdx;I++)p++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,l){const c=new fn;if(this.wallMode){for(const B of this.triangleSubSegments)c.segments.push(B.segment);return c}let p=0,f=0;const x=1<<e.canonical.z;if(r){const B=r.getMinMaxForTile(e);B&&(p=B.min,f=B.max)}f+=this.maxHeight;const b=e.toUnwrapped();let S;const I=[b.canonical.x/x+b.wrap,b.canonical.y/x],A=[(b.canonical.x+1)/x+b.wrap,(b.canonical.y+1)/x],M=(B,q,K)=>[B[0]*(1-K[0])+q[0]*K[0],B[1]*(1-K[1])+q[1]*K[1]],N=[],z=[];for(const B of this.triangleSubSegments){N[0]=B.min.x/bt,N[1]=B.min.y/bt,z[0]=B.max.x/bt,z[1]=B.max.y/bt;const q=M(I,A,N),K=M(I,A,z);if(new rr([q[0],q[1],p],[K[0],K[1],f]).intersectsPrecise(l)===0){S&&(c.segments.push(S),S=void 0);continue}const ne=B.segment;S&&S.vertexOffset!==ne.vertexOffset&&(c.segments.push(S),S=void 0),S?(S.vertexLength+=ne.vertexLength,S.primitiveLength+=ne.primitiveLength):S={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&c.segments.push(S),c}encodeCentroid(e,r){const l=e.centroid(),c=r.span(),p=Math.min(7,Math.round(c.x*this.tileToMeter/10)),f=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new wt(ve(l.x,1,bt-1)<<3|p,ve(l.y,1,bt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new wt(0,0);const r=e.borders,l=Number.MAX_VALUE;if(r[0][0]!==l||r[1][0]!==l){const c=r[0][0]!==l?0:1;return new wt(6|(r[0][0]!==l?0:65528),(r[c][0]+r[c][1])/2<<3|6)}{const c=r[2][0]!==l?2:3;return new wt((r[c][0]+r[c][1])/2<<3|6,6|(r[2][0]!==l?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=Ru,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,c=e.flags&Ru?WC:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==c.y||p!==c.x){for(let f=r;f<l;++f)this.centroidVertexArray.emplace(f,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,l){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(e.toUnwrapped());if(ib(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const p=[];for(const f of this.activeReplacements){if(f.order<l)continue;const x=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const b of this.centroidData)if(!(b.flags&Ru||f.min.x>b.max.x||b.min.x>f.max.x||f.min.y>b.max.y||b.min.y>f.max.y))for(let S=0;S<b.footprintSegLen;S++){const I=this.footprintSegments[b.footprintSegIdx+S];if(p.length=0,H3(this.footprintVertices,I.vertexOffset,I.vertexCount,f.footprintTileId.canonical,e.canonical,p),UC(f.footprint,p,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){b.flags|=Ru;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,l){let c=!1;for(let p=0;p<l.footprintSegLen;p++){const f=this.footprintSegments[l.footprintSegIdx+p];let x=0;for(const b of f.ringIndices){for(let S=x,I=b+x-1;S<b+x;I=S++){const A=this.footprintVertices.int16[2*(S+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(S+f.vertexOffset)+1],N=this.footprintVertices.int16[2*(I+f.vertexOffset)+1];M>r!=N>r&&e<(this.footprintVertices.int16[2*(I+f.vertexOffset)+0]-A)*(r-M)/(N-M)+A&&(c=!c)}x=b}}return c}getHeightAtTileCoord(e,r){let l=Number.NEGATIVE_INFINITY,c=!0;const p=4*(e+bt)*bt+(r+bt);if(this.partLookup.hasOwnProperty(p)){const f=this.partLookup[p];return f?{height:f.height,hidden:!!(f.flags&Ru)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||r>f.max.y||f.min.y>r||this.footprintContainsPoint(e,r,f)&&f&&f.height>l&&(l=f.height,this.partLookup[p]=f,c=!!(f.flags&Ru));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:c};this.partLookup[p]=void 0}}function JC(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function q3(n,e,r,l){const c=e.sub(n)._perp()._unit(),p=r.sub(e)._perp()._unit();return eI(n,e,r,JC(c,p),l)}function eI(n,e,r,l,c){const p=Math.sqrt(1-l*l);return Math.min(n.dist(e)/3,e.dist(r)/3,c*p/l)}function sb(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function tI(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function iI(n,e,r){if(n.x<0||n.x>=bt||e.x<0||e.x>=bt||r.x<0||r.x>=bt)return!1;const l=r.sub(e),c=l.perp(),p=n.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&c.x*p.x+c.y*p.y<0}function rI(n,e,r){const l=e?2|n:-3&n;return r?1|l:-2&l}function nI(){const n=Math.PI/32,e=Math.tan(n),r=X;return r*Math.sqrt(1+2*e*e)-r}function sI(n,e,r){const l=1<<r.z,c=Ce(r.x/l),p=Ce((r.x+1)/l),f=Le(r.y/l),x=Le((r.y+1)/l);return function(b,S,I,A,M=0,N){const z=[];if(!b.length||!I||!A)return z;const B=(ae,fe)=>{for(const Ae of ae)z.push({polygon:Ae,bounds:fe})},q=Math.ceil(Math.log2(I)),K=Math.ceil(Math.log2(A)),ne=q-K,se=[];for(let ae=0;ae<Math.abs(ne);ae++)se.push(ne>0?0:1);for(let ae=0;ae<Math.min(q,K);ae++)se.push(0),se.push(1);let V=b;if(V=Gx(V,S[0].y-M,S[1].y+M,1),V=Gx(V,S[0].x-M,S[1].x+M,0),!V.length)return z;const ee=[];for(se.length?ee.push({polygons:V,bounds:S,depth:0}):B(V,S);ee.length;){const ae=ee.pop(),fe=ae.depth,Ae=se[fe],Ee=ae.bounds[0],Pe=ae.bounds[1],De=Ae===0?Ee.x:Ee.y,He=Ae===0?Pe.x:Pe.y,ut=N?N(Ae,De,He):.5*(De+He),it=Gx(ae.polygons,De-M,ut+M,Ae),lt=Gx(ae.polygons,ut-M,He+M,Ae);if(it.length){const ht=[Ee,new wt(Ae===0?ut:Pe.x,Ae===1?ut:Pe.y)];se.length>fe+1?ee.push({polygons:it,bounds:ht,depth:fe+1}):B(it,ht)}if(lt.length){const ht=[new wt(Ae===0?ut:Ee.x,Ae===1?ut:Ee.y),Pe];se.length>fe+1?ee.push({polygons:lt,bounds:ht,depth:fe+1}):B(lt,ht)}}return z}(n,e,Math.ceil((p-c)/11.25),Math.ceil((f-x)/11.25),1,(b,S,I)=>{if(b===0)return .5*(S+I);{const A=Le((r.y+S/bt)/l);return(xe(.5*(Le((r.y+I/bt)/l)+A))*l-r.y)*bt}})}function H3(n,e,r,l,c,p){const f=Math.pow(2,l.z-c.z);for(let x=0;x<r;x++){let b=n.int16[2*(x+e)+0],S=n.int16[2*(x+e)+1];b=(b+c.x*bt)*f-l.x*bt,S=(S+c.y*bt)*f-l.y*bt,p.push(new wt(b,S))}}let oI,aI;Rt(Wx,"FillExtrusionBucket",{omit:["layers","features"]}),Rt(XC,"PartData"),Rt(ZC,"FootprintSegment"),Rt(YC,"BorderCentroidData"),Rt(QC,"GroundEffect");class Ed extends wt{constructor(e,r,l){super(e,r),this.z=l}}class lI extends Ed{constructor(e,r,l,c){super(e,r,l),this.w=c}}function cI(n,e,r,l){const c=r==="x"?"y":"x",p=(l-n[r])/(e[r]-n[r]);n[c]=Math.round(n[c]+(e[c]-n[c])*p),n[r]=l,n.hasOwnProperty("z")&&(n.z=si(n.z,e.z,p)),n.hasOwnProperty("w")&&(n.w=si(n.w,e.w,p))}function uI(n,e,r,l){const c=r,p=l;for(const f of["x","y"]){let x=n,b=e;x[f]>=b[f]&&(x=e,b=n),x[f]<c&&b[f]>c&&cI(x,b,f,c),x[f]<p&&b[f]>p&&cI(b,x,f,p)}}function Zx(n,e,r,l,c,p){const f=[];for(let x=0;x<n.length;x++){const b=n[x];let S;const I=f.length;let A=0;for(let M=0;M<b.length-1;M++){let N=b[M],z=b[M+1],B=0;const q=A;let K,ne;p&&(B=Math.hypot(z.x-N.x,z.y-N.y),A+=B,K=N,ne=z),N.x<e&&z.x<e||(N.x<e?N=new wt(e,N.y+(e-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x<e&&(z=new wt(e,N.y+(e-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y<r&&z.y<r||(N.y<r?N=new wt(N.x+(r-N.y)/(z.y-N.y)*(z.x-N.x),r)._round():z.y<r&&(z=new wt(N.x+(r-N.y)/(z.y-N.y)*(z.x-N.x),r)._round()),N.x>=l&&z.x>=l||(N.x>=l?N=new wt(l,N.y+(l-N.x)/(z.x-N.x)*(z.y-N.y))._round():z.x>=l&&(z=new wt(l,N.y+(l-N.x)/(z.x-N.x)*(z.y-N.y))._round()),N.y>=c&&z.y>=c||(N.y>=c?N=new wt(N.x+(c-N.y)/(z.y-N.y)*(z.x-N.x),c)._round():z.y>=c&&(z=new wt(N.x+(c-N.y)/(z.y-N.y)*(z.x-N.x),c)._round()),S&&N.equals(S[S.length-1])||(S=[N],f.push(S),p&&p.push({progress:{min:q+hI(K,ne,N)*B,max:1},parentIndex:x,prevPoint:K,nextPoint:ne})),S.push(z),p&&(p[p.length-1].progress.max=q+hI(K,ne,z)*B,p[p.length-1].nextPoint=ne)))))}if(p&&A>0)for(let M=I;M<f.length;M++)p[M].progress.min/=A,p[M].progress.max/=A}return f}function W3(n,e,r,l,c){if(n.length<2)return void l.push(n);const p=[];for(;e.valid();){const[S,I]=e.get();for(let A=0;A<n.length-1;A++){const M=n[A],N=n[A+1],z=Vg(M,N,S,I);if(z){const[B]=z,q=new wt(si(M.x,N.x,B),si(M.y,N.y,B));p.push({t:A+B,distance:0,point:q})}}e.next()}if(p.length===0)return void l.push(n);p.sort((S,I)=>S.t-I.t);let f=0,x=0,b=[];for(l.push(b);f!==n.length;){if(x===p.length){for(;f!==n.length;)b.length!==0&&b[b.length-1].equals(n[f])||b.push(n[f]),f++;break}p[x].t<=f?(b.length!==0&&b[b.length-1].equals(p[x].point)||b.push(p[x].point),Math.trunc(p[x].t),x++):(b.length!==0&&b[b.length-1].equals(n[f])||b.push(n[f]),f++)}}function hI(n,e,r){return n.x!==e.x?(r.x-n.x)/(e.x-n.x):n.y!==e.y?(r.y-n.y)/(e.y-n.y):0}function Qg(n,e){return n.x*e.x+n.y*e.y}function dI(n,e){if(n.length===1){let r=0;const l=e[r++];let c;for(;!c||l.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const p=e[r],f=n[0],x=c.sub(l),b=p.sub(l),S=f.sub(l),I=Qg(x,x),A=Qg(x,b),M=Qg(b,b),N=Qg(S,x),z=Qg(S,b),B=I*M-A*A,q=(M*N-A*z)/B,K=(I*z-A*N)/B,ne=l.z*(1-q-K)+c.z*q+p.z*K;if(isFinite(ne))return ne}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}function pI(n,e,r,l,c,p,f,x){const b=f*c.getElevationAt(n,e,!0,!0),S=p[0]!==0,I=S?p[1]===0?f*(p[0]/7-450):f*function(A,M,N){const z=Math.floor(M[0]/8),B=Math.floor(M[1]/8),q=10*(M[0]-8*z),K=10*(M[1]-8*B),ne=A.getElevationAt(z,B,!0,!0),se=A.getMeterToDEM(N),V=Math.floor(.5*(q*se-1)),ee=Math.floor(.5*(K*se-1)),ae=A.tileCoordToPixel(z,B),fe=2*V+1,Ae=2*ee+1,Ee=function(lt,ht,Ze,st,$e){return[lt.getElevationAtPixel(ht,Ze,!0),lt.getElevationAtPixel(ht+$e,Ze,!0),lt.getElevationAtPixel(ht,Ze+$e,!0),lt.getElevationAtPixel(ht+st,Ze+$e,!0)]}(A,ae.x-V,ae.y-ee,fe,Ae),Pe=Math.abs(Ee[0]-Ee[1]),De=Math.abs(Ee[2]-Ee[3]),He=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),ut=Math.min(.25,.5*se*(Pe+De)/fe),it=Math.min(.25,.5*se*He/Ae);return ne+Math.max(ut*q,it*K)}(c,p,x):b;return{base:b+(r===0?-1:r),top:S?Math.max(I+l,b+r+2):b+l}}class Z3{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class X3{constructor(){this.tasks={},this.taskQueue=[],Ct(["process"],this),this.invoker=new Z3(this.process),this.nextId=0}add(e,r){const l=this.nextId++,c=function({type:p,isSymbolTile:f,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||f?p!=="parseTile"||f?p==="parseTile"&&f?300-x:p==="maybePrepare"&&f?400-x:500:200-x:100-x}(r);if(c===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:r,priority:c,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const p=this.tasks[this.taskQueue[c]];p.priority<r&&(r=p.priority,e=c)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class fI{constructor(e,r,l){this.target=e,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new X3}send(e,r,l,c,p=!1,f){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=f,this.callbacks[x]=l);const b=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!l,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:Tl(r,b)},b),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const c=this.cancelCallbacks[l];delete this.cancelCallbacks[l],c&&c.cancel()}else if(r.mustQueue||yr(self)){const c=this.callbacks[l],p=this.scheduler.add(()=>this.processTask(l,r),c&&c.metadata||{type:"message"});p&&(this.cancelCallbacks[l]=p)}else this.processTask(l,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(r.error?l(El(r.error)):l(null,El(r.data)))}else{const l=new Set,c=r.hasCallback?(f,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Tl(f):null,data:Tl(x,l)},l)}:()=>{},p=El(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,c);else if(this.parent.getWorkerSource){const f=r.type.split("."),{source:x,scope:b}=p;this.parent.getWorkerSource(r.sourceMapId,f[0],x,b)[f[1]](p,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Jg={workerUrl:"",workerClass:null,workerParams:void 0};const ob="mapboxgl_preloaded_worker_pool";class Cd{constructor(){this.active={}}acquire(e,r=Cd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(Jg.workerClass!=null?new Jg.workerClass:new self.Worker(Jg.workerUrl,Jg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ob]}numActive(){return Object.keys(this.active).length}}Cd.workerCount=2;class xf{constructor(e,r,l="Worker",c=Cd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ce();const p=this.workerPool.acquire(this.id,c);for(let f=0;f<p.length;f++){const x=new xf.Actor(p[f],r,this.id);x.name=`${l} ${f}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,l){Me(this.actors,(c,p)=>{c.send(e,r,p)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let e_,ab;function Xx(){return e_||(e_=new Cd),e_}xf.Actor=fI;class Y3{constructor(e){this.module=e}createIntArray(e){const r=new Int32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heap32.set(r,l/r.BYTES_PER_ELEMENT),l}createFloatArray(e){const r=new Float32Array(e),l=this.module.malloc(r.length*r.BYTES_PER_ELEMENT);return this.module.heapF32.set(r,l/r.BYTES_PER_ELEMENT),l}createStringBuffer(e){const r=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[r+l]=e.charCodeAt(l);return this.module.heapU8[r+e.length]=0,r}readStringBuffer(e){let r="";for(;this.module.heapU8[e]!==0;)r+=String.fromCharCode(this.module.heapU8[e]),++e;return r}setStyle(e){const r=e.entranceColorRgb,l=e.facadeGlazingColorRgb,c=e.roofColorRgb,p=e.wallColorRgb,f=e.normalScale;this.module.setStyle(r[0],r[1],r[2],l[0],l[1],l[2],c[0],c[1],c[2],p[0],p[1],p[2],f[0],f[1],f[2],e.tileToMeters)}setAOOptions(e,r){this.module.setAOOptions(e?1:0,r)}setMetricOptions(e,r){this.module.setMetricOptions(e?1:0,r)}setFacadeOptions(e,r,l){this.module.setFacadeOptions(e,r,l)}generateMesh(e,r){for(const x of e){const b=this.createStringBuffer(x.roofType),S=[0],I=[];for(const N of x.coordinates)if(Array.isArray(N)){for(const z of N)I.push(z.x),I.push(z.y);S.push(I.length)}const A=this.createIntArray(S),M=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,b,x.roofType.length,M,A,S.length-1),this.module.free(b),this.module.free(A),this.module.free(M)}for(const x of r){let b;b=x.entrances?JSON.parse(x.entrances):[];const S=this.createFloatArray(b),I=[];for(const M of x.coordinates)I.push(M.x),I.push(M.y);const A=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,S,b.length,A,I.length),this.module.free(S),this.module.free(A)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const l=this.module.getMeshCount(),c=new Array(l);for(let x=0;x<l;x++){const b=this.module.getPositionsPtr(x),S=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,b,S),A=this.module.getNormalsPtr(x),M=this.module.getNormalsLength(x),N=new Float32Array(this.module.heapF32.buffer,A,M),z=this.module.getColorsPtr(x),B=this.module.getColorsLength(x),q=new Uint8Array(this.module.heapU8.buffer,z,B),K=this.module.getAOPtr(x),ne=this.module.getAOLength(x),se=new Float32Array(this.module.heapF32.buffer,K,ne),V=this.module.getIndicesPtr(x),ee=this.module.getIndicesLength(x),ae=new Int32Array(this.module.heap32.buffer,V,ee),fe=this.module.getBuildingPart(x),Ae=this.readStringBuffer(fe);c[x]={positions:I,normals:N,colors:q,ao:se,indices:ae,buildingPart:Ae}}const p=this.module.getRingCount(),f=[];for(let x=0;x<p;x++){const b=this.module.getRingPtr(x),S=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,b,S);f.push(I)}return{meshes:c,modifiedPolygonRings:f}}}let t_,lb,Ka,vf,cb,wf=null,bf=null,mI=null,ub=null;function gI(){return yr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:lb||os.DRACO_URL}function _I(){if(yr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(vf)return vf;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return vf=WebAssembly.validate(n)?os.MESHOPT_SIMD_URL:os.MESHOPT_URL,vf}const Yx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K3={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},i_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function yI(n,e,r){const l=r.json.bufferViews.length,c=r.buffers.length;e.bufferView=l,r.json.bufferViews[l]={buffer:c,byteLength:n.byteLength},r.buffers[c]=n}const hb="KHR_draco_mesh_compression";function Q3(n,e){const r=n.extensions&&n.extensions[hb];if(!r)return;const l=new Ka.Decoder,c=bI(e,r.bufferView),p=new Ka.Mesh;if(!l.DecodeArrayToMesh(c,c.byteLength,p))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],x=Yx[f.componentType],b=f.count*x.BYTES_PER_ELEMENT,S=Ka._malloc(b);x===Uint16Array?l.GetTrianglesUInt16Array(p,b,S):l.GetTrianglesUInt32Array(p,b,S),yI(Ka.memory.buffer.slice(S,S+b),f,e),Ka._free(S);for(const I of Object.keys(r.attributes)){const A=l.GetAttributeByUniqueId(p,r.attributes[I]),M=e.json.accessors[n.attributes[I]],N=K3[M.componentType],z=M.count*i_[M.type]*Yx[M.componentType].BYTES_PER_ELEMENT,B=Ka._malloc(z);l.GetAttributeDataArrayForAllPoints(p,A,Ka[N],z,B),yI(Ka.memory.buffer.slice(B,B+z),M,e),Ka._free(B)}l.destroy(),p.destroy(),delete n.extensions[hb]}const Kx="EXT_meshopt_compression";function J3(n,e){if(!n.extensions||!n.extensions[Kx])return;const r=n.extensions[Kx],l=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),c=new Uint8Array(r.count*r.byteStride);cb.decodeGltfBuffer(c,r.count,r.byteStride,l,r.mode,r.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[Kx]}const xI=1179937895,vI=new TextDecoder("utf8");function wI(n,e){return new URL(n,e).href}function eF(n,e,r,l){return fetch(wI(n.uri,l)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[r]=c})}function bI(n,e){const r=n.json.bufferViews[e];return new Uint8Array(n.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function tF(n,e,r,l){if(n.uri){const c=wI(n.uri,l);return fetch(c).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[r]=p})}if(n.bufferView!==void 0){const c=bI(e,n.bufferView),p=new Blob([c],{type:n.mimeType});return createImageBitmap(p).then(f=>{e.images[r]=f})}}function SI(n,e=0,r){const l={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===xI){const I=new Uint32Array(n,e);let A=2;const M=(I[A++]>>2)-3,N=I[A++]>>2;if(A++,l.json=JSON.parse(vI.decode(I.subarray(A,A+N))),A+=N,A<M){const z=I[A++];A++;const B=e+(A<<2);l.buffers[0]=n.slice(B,B+z)}}else l.json=JSON.parse(vI.decode(new Uint8Array(n,e)));const{buffers:c,images:p,meshes:f,extensionsUsed:x,bufferViews:b}=l.json;let S=Promise.resolve();if(c){const I=[];for(let A=0;A<c.length;A++){const M=c[A];M.uri?I.push(eF(M,l,A,r)):l.buffers[A]||(l.buffers[A]=null)}S=Promise.all(I)}return S.then(()=>{const I=[],A=x&&x.includes(hb),M=x&&x.includes(Kx);if(A&&I.push(function(){if(!Ka)return t_??(t_=function(N){let z,B=null;function q(){z=new Uint8Array(B.buffer)}function K(){throw new Error("Unexpected Draco error.")}const ne={a:{a:K,d:function(se,V,ee){return z.copyWithin(se,V,V+ee)},c:function(se){const V=z.length,ee=Math.max(se>>>0,Math.ceil(1.2*V)),ae=Math.ceil((ee-V)/65536);try{return B.grow(ae),q(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,ne):N.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,ne))).then(se=>{const{Rb:V,Qb:ee,P:ae,T:fe,X:Ae,Ja:Ee,La:Pe,Qa:De,Va:He,Wa:ut,eb:it,jb:lt,f:ht,e:Ze,yb:st,zb:$e,Ab:We,Bb:gt,Db:yt,Gb:Xt}=se.instance.exports;B=Ze;const zt=(()=>{let Tt=0,mt=0,gi=0,jt=0;return Lt=>{gi&&(V(jt),V(Tt),mt+=gi,gi=Tt=0),Tt||(mt+=128,Tt=ee(mt));const oi=Lt.length+7&-8;let Ti=Tt;oi>=mt&&(gi=oi,Ti=jt=ee(oi));for(let bi=0;bi<Lt.length;bi++)z[Ti+bi]=Lt[bi];return Ti}})();return q(),ht(),{memory:Ze,_free:V,_malloc:ee,Mesh:class{constructor(){this.ptr=ae()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){lt(this.ptr)}DecodeArrayToMesh(Tt,mt,gi){const jt=zt(Tt),Lt=Pe(this.ptr,jt,mt,gi.ptr);return!!Ae(Lt)}GetAttributeByUniqueId(Tt,mt){return{ptr:De(this.ptr,Tt.ptr,mt)}}GetTrianglesUInt16Array(Tt,mt,gi){He(this.ptr,Tt.ptr,mt,gi)}GetTrianglesUInt32Array(Tt,mt,gi){ut(this.ptr,Tt.ptr,mt,gi)}GetAttributeDataArrayForAllPoints(Tt,mt,gi,jt,Lt){it(this.ptr,Tt.ptr,mt.ptr,gi,jt,Lt)}},DT_INT8:st(),DT_UINT8:$e(),DT_INT16:We(),DT_UINT16:gt(),DT_UINT32:yt(),DT_FLOAT32:Xt()}})}(fetch(gI())),t_.then(N=>{Ka=N,t_=void 0}))}()),M&&I.push(function(){if(cb)return;const N=function(z){let B;const q=WebAssembly.instantiateStreaming(z,{}).then(se=>{B=se.instance,B.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(se,V,ee,ae,fe,Ae){(function(Ee,Pe,De,He,ut,it,lt){const ht=Ee.exports.sbrk,Ze=He+3&-4,st=ht(Ze*ut),$e=ht(it.length),We=new Uint8Array(Ee.exports.memory.buffer);We.set(it,$e);const gt=Pe(st,He,ut,$e,it.length);if(gt===0&&lt&&lt(st,Ze,ut),De.set(We.subarray(st,st+He*ut)),ht(st-ht(0)),gt!==0)throw new Error(`Malformed buffer data: ${gt}`)})(B,B.exports[ne[fe]],se,V,ee,ae,B.exports[K[Ae]])}}}(fetch(_I()));return N.ready.then(()=>{cb=N})}()),p)for(let N=0;N<p.length;N++)I.push(tF(p[N],l,N,r));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(A&&f)for(const{primitives:N}of f)for(const z of N)Q3(z,l);if(M&&f&&b)for(const N of b)J3(N,l);return l})})}class TI{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,r){}prepare(){return function(){if(ub!=null||mI!=null)return null;if(bf!=null)return bf;const e=fetch(os.BUILDING_GEN_URL);return bf=function(r){let l,c,p,f;function x(){l=new Uint8Array(f.buffer),c=new Int32Array(f.buffer),p=new Float32Array(f.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},I={a:{a:b,f:function(A){const M=l.length,N=Math.max(A>>>0,Math.ceil(1.2*M)),z=Math.ceil((N-M)/65536);try{return f.grow(z),x(),!0}catch{return!1}},g:b,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r,I):r.then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,I))).then(A=>{const M=A.instance.exports;return(0,M.g)(),f=M.f,x(),new Y3({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setFacadeOptions:M.k,addFeature:M.l,addFacade:M.m,generateMesh:M.n,getLastError:M.o,getMeshCount:M.p,getPositionsPtr:M.q,getPositionsLength:M.r,getNormalsPtr:M.s,getNormalsLength:M.t,getColorsPtr:M.u,getColorsLength:M.v,getAOPtr:M.w,getAOLength:M.x,getIndicesPtr:M.y,getIndicesLength:M.z,getBuildingPart:M.A,getRingCount:M.B,getRingPtr:M.C,getRingLength:M.D,free:M.E,malloc:M.F,heapU8:l,heap32:c,heapF32:p})})}(e).then(r=>(bf=null,ub=r,ub)).catch(r=>{Ei("Could not load building-gen"),bf=null,mI=r}),bf}()}populate(e,r,l,c){}update(e,r,l,c,p,f,x){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,r){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let EI,CI;Rt(TI,"BuildingBucket",{omit:["layers"]});const iF=er([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),rF=er([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:nF}=iF,sF=er([{name:"a_packed",components:3,type:"Float32"}]),{members:oF}=sF,aF=er([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:lF}=aF;class II{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Mu({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const l=this.getKey(e,r);return this.positions[l]}trim(){const e=this.width,r=this.height=rt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,l){const c=[];let p=e.length%2==1?-e[e.length-1]*l:0,f=e[0]*l,x=!0;c.push({left:p,right:f,isDash:x,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){x=!x;const I=e[S];p=b*l,b+=I,f=b*l,c.push({left:p,right:f,isDash:x,zeroLength:I===0})}return c}addRoundDash(e,r,l){const c=r/2;for(let p=-l;p<=l;p++){const f=this.width*(this.nextRow+l+p);let x=0,b=e[x];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++x]);const I=Math.abs(S-b.left),A=Math.abs(S-b.right),M=Math.min(I,A);let N;const z=p/l*(c+1);if(b.isDash){const B=c-Math.abs(z);N=Math.sqrt(M*M+B*B)}else N=c-Math.sqrt(M*M+z*z);this.image.data[f+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const S=e[b],I=e[b+1];S.zeroLength?e.splice(b,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(b,1))}const l=e[0],c=e[e.length-1];l.isDash===c.isDash&&(l.left=c.left-this.width,c.right=l.right+this.width);const p=this.width*this.nextRow;let f=0,x=e[f];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++f]);const S=Math.abs(b-x.left),I=Math.abs(b-x.right),A=Math.min(S,I);this.image.data[p+b]=Math.max(0,Math.min(255,(x.isDash?A:-A)+r+128))}}addDash(e,r){const l=this.getKey(e,r);if(this.positions[l])return this.positions[l];const c=r==="round",p=c?7:0,f=2*p+1;if(this.nextRow+f>this.height)return Ei("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(Ei("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,A=this.getDashRanges(e,this.width,I);c?this.addRoundDash(A,I,p):this.addRegularDash(A,r==="square"?.5*I:0)}const b=this.nextRow+p;this.nextRow+=f;const S={tl:[b,p],br:[x,0]};return this.positions[l]=S,S}}Rt(II,"LineAtlas");const cF=Ri.VectorTileFeature.types,uF=Math.cos(Math.PI/180*37.5),hF=Math.cos(Math.PI/180*5);class db{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ig,this.layoutVertexArray2=new ba,this.patternVertexArray=new ba,this.indexArray=new ls,this.programConfigurations=new h(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new fn,this.maxLineLength=0,this.zOffsetVertexArray=new ba,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:bt/64,this.worldview=e.worldview}updateFootprints(e,r){}populate(e,r,l,c){this.hasPattern=Xw("line",this.layers,this.pixelRatio,r);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=qe(l);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),N=M.isConstant()&&!M.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&f==="none"&&Ei(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const b=[];for(const{feature:M,id:N,index:z,sourceLayerIndex:B}of e){const q=this.layers[0]._featureFilter.needGeometry,K=Pt(M,q);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),K,l))continue;const ne=p?p.evaluate(K,{},l):void 0,se={id:N,properties:M.properties,type:M.type,sourceLayerIndex:B,index:z,geometry:q?K.geometry:Dt(M,l,c),patterns:{},sortKey:ne};b.push(se)}p&&b.sort((M,N)=>M.sortKey-N.sortKey);const{lineAtlas:S,featureIndex:I}=r,A=this.addConstantDashes(S);for(const M of b){const{geometry:N,index:z,sourceLayerIndex:B}=M;if(A&&this.addFeatureDashes(M,S),this.hasPattern){const q=Yw("line",this.layers,M,this.zoom,this.pixelRatio,r);this.patternFeatures.push(q)}else this.addFeature(M,N,z,l,S.positions,r.availableImages,r.brightness,r.elevationFeatures);I.insert(e[z].feature,N,z,B,this.index)}}addConstantDashes(e){let r=!1;for(const l of this.layers){const c=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(c.kind!=="constant"||p.kind!=="constant")r=!0;else{const f=p.value,x=c.value;if(!x)continue;e.addDash(x,f)}}return r}addFeatureDashes(e,r){const l=this.zoom;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if(p.kind==="constant"&&f.kind==="constant")continue;let x,b;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:l},e);b=f.kind==="constant"?f.value:f.evaluate({zoom:l},e),r.addDash(x,b),e.patterns[c.id]=[r.getKey(x,b)]}}update(e,r,l,c,p,f,x,b){this.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,b)}addFeatures(e,r,l,c,p,f){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,r,l,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,oF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,lF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,rF.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nF),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,c,p,f,x,b){const S=this.layers[0].layout,I=S.get("line-join").evaluate(e,{}),A=S.get("line-cap").evaluate(e,{}),M=S.get("line-miter-limit"),N=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=S.get("line-z-offset").value;const z=this.layers[0].paint.get("line-width").value;if(z.kind!=="constant"&&z.isLineProgressConstant===!1&&(this.variableWidthValue=z),this.elevationType==="road"){const B=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,c,b,I,A,M,N)){const[q,K]=this.clipRuntimeLinesToTile(r,1);for(let ne=0;ne<q.length;ne++){const se=q[ne],V=K[ne],ee={progress:{min:V.progress.min,max:V.progress.max},nextDir:this.computeSegNextDir(V,se),prevDir:this.computeSegPrevDir(V,se)};this.addLine(se,e,c,I,A,M,N,ee)}this.fillNonElevatedRoadSegment(B)}}else for(const B of r)this.addLine(B,e,c,I,A,M,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,f,c,x,void 0,this.worldview)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return Zx(e,-r,-r,bt+r,bt+r)}clipRuntimeLinesToTile(e,r){const l=[];return[Zx(e,-r,-r,bt+r,bt+r,l),l]}addElevatedRoadFeature(e,r,l,c,p,f,x,b){const S=[],I=_o.getElevationFeature(e,c);if(I){const A=this.clipLinesToTile(r,1),M=this.prepareElevatedLines(A,I,l);for(const N of M)S.push({geometry:N,elevation:I,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const A of S){const M=this.layoutVertexArray.length;this.addLine(A.geometry,e,l,p,f,x,b);const N=new na(l,A.elevationTileID);if(A.elevation)for(let z=M;z<this.layoutVertexArray.length;z++){const B=new wt(this.layoutVertexArray.int16[6*z]>>1,this.layoutVertexArray.int16[6*z+1]>>1),q=N.pointElevation(B,A.elevation,.05);this.updateHeightRange(q),this.zOffsetVertexArray.emplaceBack(q,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,r,l){if(r.constantHeight!=null)return e;const c=[],p=1/qe(l);for(const f of e)W3(f,new eo(r,p),0,c);return c}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,l,c,p,f,x,b){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const S=c==="none";this.patternJoinNone=this.hasPattern&&S,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const I=b&&b.progress.min>0,A=b&&b.progress.max<1;if(this.lineClips){let Ae={min:this.lineClips.start,max:this.lineClips.end},Ee=1;if(b){const He=this.lineClips.end-this.lineClips.start;Ae=function(ut,it,lt){return{min:Ih(ut.min,it,lt),max:Ih(ut.max,it,lt)}}(b.progress,{min:0,max:1},Ae),He>0&&(Ee=(Ae.max-Ae.min)/He)}const Pe=+r.properties.mapbox_clip_feature_len,De=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Pe)||Number.isNaN(De)){for(let ut=0;ut<e.length-1;ut++)this.totalDistance+=e[ut].dist(e[ut+1]);const He=this.totalDistance/(Ae.max-Ae.min);this.totalFeatureLength=Number.isFinite(He)?He:0,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Pe,this.distance=De*Ee,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=cF[r.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let z=0;for(;z<N-1&&e[z].equals(e[z+1]);)z++;if(N<(M?3:2))return;c==="bevel"&&(f=1.05);const B=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let q,K,ne,se,V,ee,ae,fe;b&&b.prevDir&&(ee=b.prevDir.perp()),b&&b.nextDir&&(ae=b.nextDir.perp()),this.e1=this.e2=-1,M&&(q=e[N-2],V=e[z].sub(q)._unit()._perp());for(let Ae=z;Ae<N;Ae++){if(ne=Ae===N-1?M?e[z+1]:void 0:e[Ae+1],ne&&e[Ae].equals(ne))continue;V&&(se=V),q&&(K=q),q=e[Ae],fe=this.evaluateLineProgressFeatures(K?K.dist(q):0),V=ne?ne.sub(q)._unit()._perp():se,se=se||V;const Ee=K&&ne;let Pe=Ee?c:M||S?"butt":p;const De=se.x*V.x+se.y*V.y;if(S){const $e=function(We){if(We.patternJoinNone){const gt=We.segmentPoints.length/2,yt=We.lineSoFar-We.segmentStart;for(let Xt=0;Xt<gt;++Xt){const zt=We.segmentPoints[2*Xt+1],Tt=Math.round(We.segmentPoints[2*Xt])+.5+.25*zt;We.patternVertexArray.emplaceBack(Tt,yt,We.segmentStart),We.patternVertexArray.emplaceBack(Tt,yt,We.segmentStart)}We.segmentPoints.length=0}We.e1=We.e2=-1};if(Ee&&De<hF){this.updateDistance(K,q),this.addCurrentVertex(q,se,1,1,B,fe),$e(this),this.addCurrentVertex(q,V,-1,-1,B,fe);continue}if(K){if(!ne){this.updateDistance(K,q),this.addCurrentVertex(q,se,1,1,B,fe),$e(this);continue}Pe="miter"}}let He=se.add(V);He.x===0&&He.y===0||He._unit();const ut=He.x*V.x+He.y*V.y,it=ut!==0?1/ut:1/0,lt=2*Math.sqrt(2-2*ut),ht=ut<uF&&K&&ne,Ze=se.x*V.y-se.y*V.x>0,st=this.overscaling<=16?15*bt/(512*this.overscaling):0;if(Ee&&Pe==="round"){if(it<x)Pe="miter";else if(it<=2){const $e=pb(q,-10,bt+10);Pe=this.elevationType==="offset"&&($e||this.hasCrossSlope)?"miter":"fakeround"}}if(Pe==="miter"&&it>f&&(Pe="bevel"),Pe==="bevel"&&(it>2&&(Pe="flipbevel"),it<f&&(Pe="miter")),K&&!(Pe==="miter"&&ht)&&this.updateDistance(K,q),Pe==="miter")if(ht){const $e=q.dist(K);if($e>2*st){const gt=q.sub(q.sub(K)._mult(st/$e)._round());this.updateDistance(K,gt),this.addCurrentVertex(gt,se,0,0,B,fe),K=gt}this.updateDistance(K,q),He._mult(it),this.addCurrentVertex(q,He,0,0,B,fe);const We=q.dist(ne);if(We>2*st){const gt=q.add(ne.sub(q)._mult(st/We)._round());this.updateDistance(q,gt),this.addCurrentVertex(gt,V,0,0,B,fe),q=gt}}else He._mult(it),this.addCurrentVertex(q,He,0,0,B,fe);else if(Pe==="flipbevel"){if(it>100)He=V.mult(-1);else{const $e=it*se.add(V).mag()/se.sub(V).mag();He._perp()._mult($e*(Ze?-1:1))}this.addCurrentVertex(q,He,0,0,B,fe),this.addCurrentVertex(q,He.mult(-1),0,0,B,fe)}else if(Pe==="bevel"||Pe==="fakeround"){fe!=null&&K&&this.addCurrentVertex(q,ae||se,-1,-1,B,fe);const $e=q.dist(K)<=2*st&&Pe!=="bevel",We=He.mult(Ze?1:-1);We._mult(it);const gt=V.mult(Ze?-1:1),yt=se.mult(Ze?-1:1),Xt=this.evaluateLineProgressFeatures(this.distance);if(fe==null&&(this.addHalfVertex(q,We.x,We.y,!1,!Ze,0,B,Xt),$e||this.addHalfVertex(q,We.x+2*yt.x,We.y+2*yt.y,!1,Ze,0,B,Xt)),Pe==="fakeround"){const zt=Math.round(180*lt/Math.PI/20);this.addHalfVertex(q,yt.x,yt.y,!1,Ze,0,B,Xt);for(let Tt=0;Tt<zt;Tt++){let mt=Tt/zt;if(mt!==.5){const jt=mt-.5;mt+=mt*jt*(mt-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*jt*jt+(.848013+De*(.215638*De-1.06021)))}const gi=gt.sub(yt)._mult(mt)._add(yt)._unit();this.addHalfVertex(q,gi.x,gi.y,!1,Ze,0,B,Xt)}this.addHalfVertex(q,gt.x,gt.y,!1,Ze,0,B,Xt)}$e||fe!=null||this.addHalfVertex(q,We.x+2*gt.x,We.y+2*gt.y,!1,Ze,0,B,Xt),fe!=null&&ne&&this.addCurrentVertex(q,ee||V,1,1,B,fe)}else if(Pe==="butt")this.addCurrentVertex(q,He,0,0,B,fe);else if(Pe==="square"){if(!K){const $e=I?0:-1;this.addCurrentVertex(q,He,$e,$e,B,fe)}if(this.addCurrentVertex(q,He,0,0,B,fe),K){const $e=A?0:1;this.addCurrentVertex(q,He,$e,$e,B,fe)}}else if(Pe==="round"){if(K){const $e=!Ee&&ae?ae:se;this.addCurrentVertex(q,$e,0,0,B,fe),!Ee&&A||this.addCurrentVertex(q,$e,1,1,B,fe,!0)}if(ne){const $e=!Ee&&ee?ee:V;!Ee&&I||this.addCurrentVertex(q,$e,-1,-1,B,fe,!0),this.addCurrentVertex(q,$e,0,0,B,fe)}}}}addVerticesTo(e,r,l,c,p,f,x,b,S,I){const A=(r.w-e.w)/this.tessellationStep|0;let M=0;const N=this.scaledDistance;if(A>1){this.lineSoFar=e.w;const B=(r.x-e.x)/A,q=(r.y-e.y)/A,K=(r.z-e.z)/A,ne=(r.w-e.w)/A;for(let se=1;se<A;++se){e.x+=B,e.y+=q,e.z+=K,this.lineSoFar+=ne,M+=ne;const V=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,l,c,I,!1,x,S,V),this.addHalfVertex(e,p,f,I,!0,-b,S,V)}}this.lineSoFar=r.w,this.scaledDistance=N;const z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,l,c,I,!1,x,S,z),this.addHalfVertex(r,p,f,I,!0,-b,S,z)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ei(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,l,c,p,f,x=!1){const b=r.x+r.y*l,S=r.y-r.x*l,I=r.y*c-r.x,A=-r.y-r.x*c;if(f!=null){const M=this.elevationType==="offset",N=-10,z=bt+10,B=f.zOffset,q=new lI(e.x,e.y,B,this.lineSoFar),K=!!M&&pb(e,N,z),ne=this.lineSoFar,se=this.distance;if(this.currentVertex)if(K){const V=this.currentVertexIsOutside,ee=this.currentVertex,ae=new lI(e.x,e.y,B,this.lineSoFar);if(uI(ee,ae,N,z),!pb(ae,N,z)){if(V){this.e1=this.e2=-1,this.distance-=ee.dist(q),this.lineSoFar=ee.w;const fe=this.evaluateLineProgressFeatures(ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ee,b,S,x,!1,l,p,fe),this.addHalfVertex(ee,I,A,x,!0,-c,p,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+ee.dist(ae),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ee,ae,b,S,I,A,l,c,p,x),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const V=this.currentVertex;if(this.currentVertexIsOutside){uI(V,q,N,z),this.e1=this.e2=-1,this.distance-=V.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=V.w;const ee=this.evaluateLineProgressFeatures(V.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(V,b,S,x,!1,l,p,ee),this.addHalfVertex(V,I,A,x,!0,-c,p,ee),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(V,q,b,S,I,A,l,c,p,x)}else K||(this.addHalfVertex(e,b,S,x,!1,l,p,f),this.addHalfVertex(e,I,A,x,!0,-c,p,f));this.currentVertex=q,this.currentVertexIsOutside=K,this.lineSoFar=ne}else this.addHalfVertex(e,b,S,x,!1,l,p,f),this.addHalfVertex(e,I,A,x,!0,-c,p,f)}addHalfVertex({x:e,y:r},l,c,p,f,x,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(f?1:0),Math.round(63*l)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=si(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),f?this.e2=I:this.e1=I,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function pb(n,e,r){return n.x<e||n.x>r||n.y<e||n.y>r}let AI,PI;function MI(n,e,r){return e*(bt/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}Rt(db,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const RI=(n,e,r)=>(1-r)*n+r*e;function kI(n,e){return 1/MI(n,1,e.tileZoom)}function DI(n,e,r,l){return n.translatePosMatrix(l||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const NI=n=>{const e=[];jI(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=n.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return l&&c&&e.push("LINE_JOIN_NONE"),e};function jI(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let fb;const zI=()=>fb||(fb={layout:AI||(AI=new hn({"line-cap":new At(ze.layout_line["line-cap"]),"line-join":new At(ze.layout_line["line-join"]),"line-miter-limit":new ft(ze.layout_line["line-miter-limit"]),"line-round-limit":new ft(ze.layout_line["line-round-limit"]),"line-sort-key":new At(ze.layout_line["line-sort-key"]),"line-z-offset":new At(ze.layout_line["line-z-offset"]),"line-elevation-reference":new ft(ze.layout_line["line-elevation-reference"]),"line-cross-slope":new ft(ze.layout_line["line-cross-slope"]),visibility:new ft(ze.layout_line.visibility),"line-width-unit":new ft(ze.layout_line["line-width-unit"])})),paint:PI||(PI=new hn({"line-opacity":new At(ze.paint_line["line-opacity"]),"line-color":new At(ze.paint_line["line-color"]),"line-translate":new ft(ze.paint_line["line-translate"]),"line-translate-anchor":new ft(ze.paint_line["line-translate-anchor"]),"line-width":new At(ze.paint_line["line-width"]),"line-gap-width":new At(ze.paint_line["line-gap-width"]),"line-offset":new At(ze.paint_line["line-offset"]),"line-blur":new At(ze.paint_line["line-blur"]),"line-dasharray":new At(ze.paint_line["line-dasharray"]),"line-pattern":new At(ze.paint_line["line-pattern"]),"line-pattern-cross-fade":new ft(ze.paint_line["line-pattern-cross-fade"]),"line-gradient":new bc(ze.paint_line["line-gradient"]),"line-trim-offset":new ft(ze.paint_line["line-trim-offset"]),"line-trim-fade-range":new ft(ze.paint_line["line-trim-fade-range"]),"line-trim-color":new ft(ze.paint_line["line-trim-color"]),"line-emissive-strength":new ft(ze.paint_line["line-emissive-strength"]),"line-border-width":new At(ze.paint_line["line-border-width"]),"line-border-color":new At(ze.paint_line["line-border-color"]),"line-occlusion-opacity":new ft(ze.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},fb);class dF extends At{possiblyEvaluate(e,r){return r=new Cr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition,worldview:r.worldview}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,c){return r=Be({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,c)}}let r_;function LI(n,e){return e>0?e+2*n:n}const pF=er([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fF=er([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),mF=er([{name:"a_projected_pos",components:4,type:"Float32"}],4);er([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gF=er([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),_F=er([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),yF=er([{name:"a_texb",components:2,type:"Uint16"}]),xF=er([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),vF=er([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);er([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const FI=er([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wF=er([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);er([{name:"triangle",components:3,type:"Uint16"}]),er([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),er([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),er([{type:"Float32",name:"offsetX"}]),er([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ts=24;function bF(n,e,r){return n.sections.forEach(l=>{l.text=function(c,p,f){const x=p.layout.get("text-transform").evaluate(f,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),Wa.applyArabicShaping&&(c=Wa.applyArabicShaping(c)),c}(l.text,e,r)}),n}const n_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function SF(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function TF(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var OI,mb,BI,gb={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function EF(){return OI||(OI=1,gb.read=function(n,e,r,l,c){var p,f,x=8*c-l-1,b=(1<<x)-1,S=b>>1,I=-7,A=r?c-1:0,M=r?-1:1,N=n[e+A];for(A+=M,p=N&(1<<-I)-1,N>>=-I,I+=x;I>0;p=256*p+n[e+A],A+=M,I-=8);for(f=p&(1<<-I)-1,p>>=-I,I+=l;I>0;f=256*f+n[e+A],A+=M,I-=8);if(p===0)p=1-S;else{if(p===b)return f?NaN:1/0*(N?-1:1);f+=Math.pow(2,l),p-=S}return(N?-1:1)*f*Math.pow(2,p-l)},gb.write=function(n,e,r,l,c,p){var f,x,b,S=8*p-c-1,I=(1<<S)-1,A=I>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=l?0:p-1,z=l?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,f=I):(f=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-f))<1&&(f--,b*=2),(e+=f+A>=1?M/b:M*Math.pow(2,1-A))*b>=2&&(f++,b/=2),f+A>=I?(x=0,f=I):f+A>=1?(x=(e*b-1)*Math.pow(2,c),f+=A):(x=e*Math.pow(2,A-1)*Math.pow(2,c),f=0));c>=8;n[r+N]=255&x,N+=z,x/=256,c-=8);for(f=f<<c|x,S+=c;S>0;n[r+N]=255&f,N+=z,f/=256,S-=8);n[r+N-z]|=128*B}),gb}function VI(){if(BI)return mb;BI=1,mb=e;var n=EF();function e(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,l=1/r,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function p(V){return V.type===e.Bytes?V.readVarint()+V.pos:V.pos+1}function f(V,ee,ae){return ae?4294967296*ee+(V>>>0):4294967296*(ee>>>0)+(V>>>0)}function x(V,ee,ae){var fe=ee<=16383?1:ee<=2097151?2:ee<=268435455?3:Math.floor(Math.log(ee)/(7*Math.LN2));ae.realloc(fe);for(var Ae=ae.pos-1;Ae>=V;Ae--)ae.buf[Ae+fe]=ae.buf[Ae]}function b(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeVarint(V[ae])}function S(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeSVarint(V[ae])}function I(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeFloat(V[ae])}function A(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeDouble(V[ae])}function M(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeBoolean(V[ae])}function N(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeFixed32(V[ae])}function z(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeSFixed32(V[ae])}function B(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeFixed64(V[ae])}function q(V,ee){for(var ae=0;ae<V.length;ae++)ee.writeSFixed64(V[ae])}function K(V,ee){return(V[ee]|V[ee+1]<<8|V[ee+2]<<16)+16777216*V[ee+3]}function ne(V,ee,ae){V[ae]=ee,V[ae+1]=ee>>>8,V[ae+2]=ee>>>16,V[ae+3]=ee>>>24}function se(V,ee){return(V[ee]|V[ee+1]<<8|V[ee+2]<<16)+(V[ee+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(V,ee,ae){for(ae=ae||this.length;this.pos<ae;){var fe=this.readVarint(),Ae=fe>>3,Ee=this.pos;this.type=7&fe,V(Ae,ee,this),this.pos===Ee&&this.skip(fe)}return ee},readMessage:function(V,ee){return this.readFields(V,ee,this.readVarint()+this.pos)},readFixed32:function(){var V=K(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=se(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=K(this.buf,this.pos)+K(this.buf,this.pos+4)*r;return this.pos+=8,V},readSFixed64:function(){var V=K(this.buf,this.pos)+se(this.buf,this.pos+4)*r;return this.pos+=8,V},readFloat:function(){var V=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var ee,ae,fe=this.buf;return ee=127&(ae=fe[this.pos++]),ae<128?ee:(ee|=(127&(ae=fe[this.pos++]))<<7,ae<128?ee:(ee|=(127&(ae=fe[this.pos++]))<<14,ae<128?ee:(ee|=(127&(ae=fe[this.pos++]))<<21,ae<128?ee:function(Ae,Ee,Pe){var De,He,ut=Pe.buf;if(De=(112&(He=ut[Pe.pos++]))>>4,He<128||(De|=(127&(He=ut[Pe.pos++]))<<3,He<128)||(De|=(127&(He=ut[Pe.pos++]))<<10,He<128)||(De|=(127&(He=ut[Pe.pos++]))<<17,He<128)||(De|=(127&(He=ut[Pe.pos++]))<<24,He<128)||(De|=(1&(He=ut[Pe.pos++]))<<31,He<128))return f(Ae,De,Ee);throw new Error("Expected varint not more than 10 bytes")}(ee|=(15&(ae=fe[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?(V+1)/-2:V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V=this.readVarint()+this.pos,ee=this.pos;return this.pos=V,V-ee>=12&&c?function(ae,fe,Ae){return c.decode(ae.subarray(fe,Ae))}(this.buf,ee,V):function(ae,fe,Ae){for(var Ee="",Pe=fe;Pe<Ae;){var De,He,ut,it=ae[Pe],lt=null,ht=it>239?4:it>223?3:it>191?2:1;if(Pe+ht>Ae)break;ht===1?it<128&&(lt=it):ht===2?(192&(De=ae[Pe+1]))==128&&(lt=(31&it)<<6|63&De)<=127&&(lt=null):ht===3?(He=ae[Pe+2],(192&(De=ae[Pe+1]))==128&&(192&He)==128&&((lt=(15&it)<<12|(63&De)<<6|63&He)<=2047||lt>=55296&&lt<=57343)&&(lt=null)):ht===4&&(He=ae[Pe+2],ut=ae[Pe+3],(192&(De=ae[Pe+1]))==128&&(192&He)==128&&(192&ut)==128&&((lt=(15&it)<<18|(63&De)<<12|(63&He)<<6|63&ut)<=65535||lt>=1114112)&&(lt=null)),lt===null?(lt=65533,ht=1):lt>65535&&(lt-=65536,Ee+=String.fromCharCode(lt>>>10&1023|55296),lt=56320|1023&lt),Ee+=String.fromCharCode(lt),Pe+=ht}return Ee}(this.buf,ee,V)},readBytes:function(){var V=this.readVarint()+this.pos,ee=this.buf.subarray(this.pos,V);return this.pos=V,ee},readPackedVarint:function(V,ee){if(this.type!==e.Bytes)return V.push(this.readVarint(ee));var ae=p(this);for(V=V||[];this.pos<ae;)V.push(this.readVarint(ee));return V},readPackedSVarint:function(V){if(this.type!==e.Bytes)return V.push(this.readSVarint());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==e.Bytes)return V.push(this.readBoolean());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==e.Bytes)return V.push(this.readFloat());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==e.Bytes)return V.push(this.readDouble());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==e.Bytes)return V.push(this.readFixed32());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==e.Bytes)return V.push(this.readSFixed32());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==e.Bytes)return V.push(this.readFixed64());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==e.Bytes)return V.push(this.readSFixed64());var ee=p(this);for(V=V||[];this.pos<ee;)V.push(this.readSFixed64());return V},skip:function(V){var ee=7&V;if(ee===e.Varint)for(;this.buf[this.pos++]>127;);else if(ee===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ee===e.Fixed32)this.pos+=4;else{if(ee!==e.Fixed64)throw new Error("Unimplemented type: "+ee);this.pos+=8}},writeTag:function(V,ee){this.writeVarint(V<<3|ee)},realloc:function(V){for(var ee=this.length||16;ee<this.pos+V;)ee*=2;if(ee!==this.length){var ae=new Uint8Array(ee);ae.set(this.buf),this.buf=ae,this.length=ee}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),ne(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),ne(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),ne(this.buf,-1&V,this.pos),ne(this.buf,Math.floor(V*l),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),ne(this.buf,-1&V,this.pos),ne(this.buf,Math.floor(V*l),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(ee,ae){var fe,Ae;if(ee>=0?(fe=ee%4294967296|0,Ae=ee/4294967296|0):(Ae=~(-ee/4294967296),4294967295^(fe=~(-ee%4294967296))?fe=fe+1|0:(fe=0,Ae=Ae+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ae.realloc(10),function(Ee,Pe,De){De.buf[De.pos++]=127&Ee|128,Ee>>>=7,De.buf[De.pos++]=127&Ee|128,Ee>>>=7,De.buf[De.pos++]=127&Ee|128,Ee>>>=7,De.buf[De.pos++]=127&Ee|128,De.buf[De.pos]=127&(Ee>>>=7)}(fe,0,ae),function(Ee,Pe){var De=(7&Ee)<<4;Pe.buf[Pe.pos++]|=De|((Ee>>>=3)?128:0),Ee&&(Pe.buf[Pe.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Pe.buf[Pe.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Pe.buf[Pe.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Pe.buf[Pe.pos++]=127&Ee|((Ee>>>=7)?128:0),Ee&&(Pe.buf[Pe.pos++]=127&Ee)))))}(Ae,ae)}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?2*-V-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var ee=this.pos;this.pos=function(fe,Ae,Ee){for(var Pe,De,He=0;He<Ae.length;He++){if((Pe=Ae.charCodeAt(He))>55295&&Pe<57344){if(!De){Pe>56319||He+1===Ae.length?(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189):De=Pe;continue}if(Pe<56320){fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,De=Pe;continue}Pe=De-55296<<10|Pe-56320|65536,De=null}else De&&(fe[Ee++]=239,fe[Ee++]=191,fe[Ee++]=189,De=null);Pe<128?fe[Ee++]=Pe:(Pe<2048?fe[Ee++]=Pe>>6|192:(Pe<65536?fe[Ee++]=Pe>>12|224:(fe[Ee++]=Pe>>18|240,fe[Ee++]=Pe>>12&63|128),fe[Ee++]=Pe>>6&63|128),fe[Ee++]=63&Pe|128)}return Ee}(this.buf,V,this.pos);var ae=this.pos-ee;ae>=128&&x(ee,ae,this),this.pos=ee-1,this.writeVarint(ae),this.pos+=ae},writeFloat:function(V){this.realloc(4),n.write(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),n.write(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var ee=V.length;this.writeVarint(ee),this.realloc(ee);for(var ae=0;ae<ee;ae++)this.buf[this.pos++]=V[ae]},writeRawMessage:function(V,ee){this.pos++;var ae=this.pos;V(ee,this);var fe=this.pos-ae;fe>=128&&x(ae,fe,this),this.pos=ae-1,this.writeVarint(fe),this.pos+=fe},writeMessage:function(V,ee,ae){this.writeTag(V,e.Bytes),this.writeRawMessage(ee,ae)},writePackedVarint:function(V,ee){ee.length&&this.writeMessage(V,b,ee)},writePackedSVarint:function(V,ee){ee.length&&this.writeMessage(V,S,ee)},writePackedBoolean:function(V,ee){ee.length&&this.writeMessage(V,M,ee)},writePackedFloat:function(V,ee){ee.length&&this.writeMessage(V,I,ee)},writePackedDouble:function(V,ee){ee.length&&this.writeMessage(V,A,ee)},writePackedFixed32:function(V,ee){ee.length&&this.writeMessage(V,N,ee)},writePackedSFixed32:function(V,ee){ee.length&&this.writeMessage(V,z,ee)},writePackedFixed64:function(V,ee){ee.length&&this.writeMessage(V,B,ee)},writePackedSFixed64:function(V,ee){ee.length&&this.writeMessage(V,q,ee)},writeBytesField:function(V,ee){this.writeTag(V,e.Bytes),this.writeBytes(ee)},writeFixed32Field:function(V,ee){this.writeTag(V,e.Fixed32),this.writeFixed32(ee)},writeSFixed32Field:function(V,ee){this.writeTag(V,e.Fixed32),this.writeSFixed32(ee)},writeFixed64Field:function(V,ee){this.writeTag(V,e.Fixed64),this.writeFixed64(ee)},writeSFixed64Field:function(V,ee){this.writeTag(V,e.Fixed64),this.writeSFixed64(ee)},writeVarintField:function(V,ee){this.writeTag(V,e.Varint),this.writeVarint(ee)},writeSVarintField:function(V,ee){this.writeTag(V,e.Varint),this.writeSVarint(ee)},writeStringField:function(V,ee){this.writeTag(V,e.Bytes),this.writeString(ee)},writeFloatField:function(V,ee){this.writeTag(V,e.Fixed32),this.writeFloat(ee)},writeDoubleField:function(V,ee){this.writeTag(V,e.Fixed64),this.writeDouble(ee)},writeBooleanField:function(V,ee){this.writeVarintField(V,!!ee)}},mb}var Qx=Yr(VI());const _b=3;function CF(n,e,r){e.glyphs=[],n===1&&r.readMessage(IF,e)}function IF(n,e,r){if(n===3){const{id:l,bitmap:c,width:p,height:f,left:x,top:b,advance:S}=r.readMessage(AF,{});e.glyphs.push({id:l,bitmap:new Mu({width:p+2*_b,height:f+2*_b},c),metrics:{width:p,height:f,left:x,top:b,advance:S}})}else n===4?e.ascender=r.readSVarint():n===5&&(e.descender=r.readSVarint())}function AF(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const PF=_b,yo={horizontal:1,vertical:2,horizontalOnly:3};class s_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const l=new s_;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new s_;return r.image=e,r}}class Sf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,l){const c=new Sf;for(let p=0;p<e.sections.length;p++){const f=e.sections[p];f.image?c.addImageSection(f,l):c.addTextSection(f,r)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,l){let c="";for(let p=0;p<r.length;p++){const f=r.charCodeAt(p+1)||null,x=r.charCodeAt(p-1)||null;c+=!l&&(f&&ux(f)&&!n_[r[p+1]]||x&&ux(x)&&!n_[r[p-1]])||!n_[r[p]]?r[p]:n_[r[p]]}return c}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Jx[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Jx[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new Sf;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(s_.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(l)}addImageSection(e,r){const l=e.image?e.image.getPrimary():null;if(!l)return void Ei("Can't add FormattedSection with an empty image.");l.scaleSelf(r);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(s_.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yb(n,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B=1){const q=Sf.fromFeature(n,c,B);A===yo.vertical&&q.verticalizePunctuation(M);let K=[];const ne=function(fe,Ae,Ee,Pe,De,He){if(!fe)return[];const ut=[],it=function(st,$e,We,gt,yt,Xt){let zt=0;for(let Tt=0;Tt<st.length();Tt++){const mt=st.getSection(Tt);zt+=UI(st.getCodePoint(Tt),mt,gt,yt,$e,Xt)}return zt/Math.max(1,Math.ceil(zt/We))}(fe,Ae,Ee,Pe,De,He),lt=fe.text.indexOf("​")>=0;let ht=0;for(let st=0;st<fe.length();st++){const $e=fe.getSection(st),We=fe.getCodePoint(st);if(Jx[We]||(ht+=UI(We,$e,Pe,De,Ae,He)),st<fe.length()-1){const gt=!((Ze=We)<11904||!(Jt["Bopomofo Extended"](Ze)||Jt.Bopomofo(Ze)||Jt["CJK Compatibility Forms"](Ze)||Jt["CJK Compatibility Ideographs"](Ze)||Jt["CJK Compatibility"](Ze)||Jt["CJK Radicals Supplement"](Ze)||Jt["CJK Strokes"](Ze)||Jt["CJK Symbols and Punctuation"](Ze)||Jt["CJK Unified Ideographs Extension A"](Ze)||Jt["CJK Unified Ideographs"](Ze)||Jt["Enclosed CJK Letters and Months"](Ze)||Jt["Halfwidth and Fullwidth Forms"](Ze)||Jt.Hiragana(Ze)||Jt["Ideographic Description Characters"](Ze)||Jt["Kangxi Radicals"](Ze)||Jt["Katakana Phonetic Extensions"](Ze)||Jt.Katakana(Ze)||Jt["Vertical Forms"](Ze)||Jt["Yi Radicals"](Ze)||Jt["Yi Syllables"](Ze)));(MF[We]||gt||$e.image)&&ut.push($I(st+1,ht,it,ut,RF(We,fe.getCodePoint(st+1),gt&&lt),!1))}}var Ze;return qI($I(fe.length(),ht,it,ut,0,!0))}(q,S,p,e,l,N),{processBidirectionalText:se,processStyledBidirectionalText:V}=Wa;if(se&&q.sections.length===1){const fe=se(q.toString(),ne);for(const Ae of fe){const Ee=new Sf;Ee.text=Ae,Ee.sections=q.sections;for(let Pe=0;Pe<Ae.length;Pe++)Ee.sectionIndex.push(0);K.push(Ee)}}else if(V){const fe=V(q.text,q.sectionIndex,ne);for(const Ae of fe){const Ee=new Sf;Ee.text=Ae[0],Ee.sectionIndex=Ae[1],Ee.sections=q.sections,K.push(Ee)}}else K=function(fe,Ae){const Ee=[],Pe=fe.text;let De=0;for(const He of Ae)Ee.push(fe.substring(De,He)),De=He;return De<Pe.length&&Ee.push(fe.substring(De,Pe.length)),Ee}(q,ne);const ee=[],ae={positionedLines:ee,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(fe,Ae,Ee,Pe,De,He,ut,it,lt,ht,Ze,st){let $e=0,We=0,gt=0;const yt=it==="right"?1:it==="left"?0:.5;let Xt=!1;for(const Lt of De){const oi=Lt.getSections();for(const Ti of oi){if(Ti.image)continue;const bi=Ae[Ti.fontStack];if(bi&&(Xt=bi.ascender!==void 0&&bi.descender!==void 0,!Xt))break}if(!Xt)break}let zt=0;for(const Lt of De){Lt.trim();const oi=Lt.getMaxScale(),Ti=(oi-1)*ts,bi={positionedGlyphs:[],lineOffset:0};fe.positionedLines[zt]=bi;const Li=bi.positionedGlyphs;let Pi=0;if(!Lt.length()){We+=He,++zt;continue}let Fi=0,gr=0;for(let ue=0;ue<Lt.length();ue++){const ge=Lt.getSection(ue),Ye=Lt.getSectionIndex(ue),vt=Lt.getCodePoint(ue);let Et=ge.scale,St=null,Nt=null,ni=null,Vi=ts,Ui=0;lt===yo.vertical&&((Tt=vt)===12312||Tt===12313||Tt===12316||Tt===12540||Tt===12448)&&(lt=yo.horizontal);const Mi=!(lt===yo.horizontal||!Ze&&!xg(vt)||Ze&&(Jx[vt]||Mw(vt)));if(ge.image){const vr=Pe.get(ge.image.toString());if(!vr)continue;ni=ge.image,fe.iconsInText=fe.iconsInText||!0,Nt=vr.paddedRect;const Rr=vr.displaySize;Et=Et*ts/st,St={width:Rr[0],height:Rr[1],left:0,top:-3,advance:Mi?Rr[1]:Rr[0],localGlyph:!1},Ui=Xt?-St.height*Et:oi*ts-17-Rr[1]*Et,Vi=St.advance;const Gi=(Mi?Rr[0]:Rr[1])*Et-ts*oi;Gi>0&&Gi>Pi&&(Pi=Gi)}else{const vr=Ee[ge.fontStack];if(!vr)continue;vr[vt]&&(Nt=vr[vt]);const Rr=Ae[ge.fontStack];if(!Rr)continue;const Gi=Rr.glyphs[vt];if(!Gi)continue;if(St=Gi.metrics,Vi=vt!==8203?ts:0,Xt){const an=Rr.ascender!==void 0?Math.abs(Rr.ascender):0,Or=Rr.descender!==void 0?Math.abs(Rr.descender):0,_r=(an+Or)*Et;Fi<_r&&(Fi=_r,gr=(an-Or)/2*Et),Ui=-an*Et}else Ui=(oi-Et)*ts-17}Mi?(fe.verticalizable=!0,Li.push({glyph:vt,image:ni,x:$e,y:We+Ui,vertical:Mi,scale:Et,localGlyph:St.localGlyph,fontStack:ge.fontStack,sectionIndex:Ye,metrics:St,rect:Nt}),$e+=Vi*Et+ht):(Li.push({glyph:vt,image:ni,x:$e,y:We+Ui,vertical:Mi,scale:Et,localGlyph:St.localGlyph,fontStack:ge.fontStack,sectionIndex:Ye,metrics:St,rect:Nt}),$e+=St.advance*Et+ht)}Li.length!==0&&(gt=Math.max($e-ht,gt),Xt?HI(Li,yt,Pi,gr,He*oi/2):HI(Li,yt,Pi,0,He/2)),$e=0;const Fr=He*oi+Pi;bi.lineOffset=Math.max(Pi,Ti),We+=Fr,++zt}var Tt;const mt=We,{horizontalAlign:gi,verticalAlign:jt}=xb(ut);(function(Lt,oi,Ti,bi,Li,Pi){const Fi=(oi-Ti)*Li,gr=-Pi*bi;for(const Fr of Lt)for(const ue of Fr.positionedGlyphs)ue.x+=Fi,ue.y+=gr})(fe.positionedLines,yt,gi,jt,gt,mt),fe.top+=-jt*mt,fe.bottom=fe.top+mt,fe.left+=-gi*gt,fe.right=fe.left+gt,fe.hasBaseline=Xt}(ae,e,r,l,K,f,x,b,A,S,M,z),!function(fe){for(const Ae of fe)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ee))return ae}const Jx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function UI(n,e,r,l,c,p){if(e.image){const f=l.get(e.image.toString());return f?f.displaySize[0]*e.scale*ts/p+c:0}{const f=r[e.fontStack],x=f&&f.glyphs[n];return x?x.metrics.advance*e.scale+c:0}}function GI(n,e,r,l){const c=Math.pow(n-e,2);return l?n<e?c/2:2*c:c+Math.abs(r)*r}function RF(n,e,r){let l=0;return n===10&&(l-=1e4),r&&(l+=150),n!==40&&n!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function $I(n,e,r,l,c,p){let f=null,x=GI(e,r,c,p);for(const b of l){const S=GI(e-b.x,r,c,p)+b.badness;S<=x&&(f=b,x=S)}return{index:n,x:e,priorBreak:f,badness:x}}function qI(n){return n?qI(n.priorBreak).concat(n.index):[]}function xb(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function HI(n,e,r,l,c){if(!(e||r||l||c))return;const p=n.length-1,f=n[p],x=(f.x+f.metrics.advance*f.scale)*e;for(let b=0;b<=p;b++)n[b].x-=x,n[b].y+=r+l+c}function WI(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function kF(n,e,r,l){const{horizontalAlign:c,verticalAlign:p}=xb(l),f=r[0]-n.displaySize[0]*c,x=r[1]-n.displaySize[1]*p;return{imagePrimary:n,imageSecondary:e,top:x,bottom:x+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function ZI(n,e,r,l,c,p){const f=n.imagePrimary;let x;if(f.content){const q=f.content,K=f.pixelRatio||1;x=[q[0]/K,q[1]/K,f.displaySize[0]-q[2]/K,f.displaySize[1]-q[3]/K]}const b=e.left*p,S=e.right*p;let I,A,M,N;r==="width"||r==="both"?(N=c[0]+b-l[3],A=c[0]+S+l[1]):(N=c[0]+(b+S-f.displaySize[0])/2,A=N+f.displaySize[0]);const z=e.top*p,B=e.bottom*p;return r==="height"||r==="both"?(I=c[1]+z-l[0],M=c[1]+B+l[2]):(I=c[1]+(z+B-f.displaySize[1])/2,M=I+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:I,right:A,bottom:M,left:N,collisionPadding:x}}function XI(n){return!n.imagePrimary.stretchX}function YI(n){return!n.imagePrimary.stretchY}function KI(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Ll=128;function QI(n,e,r){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Cr(n+1,{worldview:r}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=l;let f=0;for(;f<c.length&&c[f]<=n;)f++;f=Math.max(0,f-1);let x=f;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const b=c[f],S=c[x];return l.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:S,minSize:l.evaluate(new Cr(b,{worldview:r})),maxSize:l.evaluate(new Cr(S,{worldview:r})),interpolationType:p}}}function vb(n,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:c}){return n.kind==="source"?l/Ll:n.kind==="composite"?si(l/Ll,c/Ll,r):e}function o_(n,e,r=1){let l=0,c=0;if(n.kind==="constant")c=n.layoutSize*r;else if(n.kind!=="source"){const{interpolationType:p,minZoom:f,maxZoom:x}=n,b=p?ve(go.interpolationFactor(p,e,f,x),0,1):0;n.kind==="camera"?c=si(n.minSize,n.maxSize,b)*r:l=b*r}return{uSizeT:l,uSize:c}}class Ic extends wt{constructor(e,r,l,c,p){super(e,r),this.angle=c,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new Ic(this.x,this.y,this.z,this.angle,this.segment)}}function JI(n,e,r,l,c){if(e.segment===void 0)return!0;let p=e,f=e.segment+1,x=0;for(;x>-r/2;){if(f--,f<0)return!1;x-=n[f].dist(p),p=n[f]}x+=n[f].dist(n[f+1]),f++;const b=[];let S=0;for(;x<r/2;){const I=n[f],A=n[f+1];if(!A)return!1;let M=n[f-1].angleTo(I)-I.angleTo(A);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:x,angleDelta:M}),S+=M;x-b[0].distance>l;)S-=b.shift().angleDelta;if(S>c)return!1;f++,x+=I.dist(A)}return!0}function eA(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function tA(n,e,r){return n?.6*e*r:0}function iA(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function DF(n,e,r,l,c,p){const f=tA(r,c,p),x=iA(r,l)*p;let b=0;const S=eA(n)/2;for(let I=0;I<n.length-1;I++){const A=n[I],M=n[I+1],N=A.dist(M);if(b+N>S){const z=(S-b)/N,B=si(A.x,M.x,z),q=si(A.y,M.y,z),K=new Ic(B,q,0,M.angleTo(A),I);return!f||JI(n,K,x,f,e)?K:void 0}b+=N}}function NF(n,e,r,l,c,p,f,x,b){const S=tA(l,p,f),I=iA(l,c),A=I*f,M=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return e-A<e/4&&(e=A+e/4),rA(n,M?e/2*x%e:(I/2+2*p)*f*x%e,e,S,r,A,M,!1,b)}function rA(n,e,r,l,c,p,f,x,b){const S=p/2,I=eA(n);let A=0,M=e-r,N=[];for(let z=0;z<n.length-1;z++){const B=n[z],q=n[z+1],K=B.dist(q),ne=q.angleTo(B);for(;M+r<A+K;){M+=r;const se=(M-A)/K,V=si(B.x,q.x,se),ee=si(B.y,q.y,se);if(V>=0&&V<b&&ee>=0&&ee<b&&M-S>=0&&M+S<=I){const ae=new Ic(V,ee,0,ne,z);l&&!JI(n,ae,p,l,c)||N.push(ae)}}A+=K}return x||N.length||f||(N=rA(n,A/2,r,l,c,p,f,!0,b)),N}function nA(n){let e=0,r=0;for(const f of n)e+=f.w*f.h,r=Math.max(r,f.w);n.sort((f,x)=>x.h-f.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,p=0;for(const f of n)for(let x=l.length-1;x>=0;x--){const b=l[x];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,p=Math.max(p,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===b.w&&f.h===b.h){const S=l.pop();x<l.length&&(l[x]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(l.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:c,h:p,fill:e/(c*p)||0}}Rt(Ic,"Anchor");const Id=1;class a_{static getImagePositionScale(e,r,l){if(r&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:l,y:l}}constructor(e,r,l,c){this.paddedRect=e;const{pixelRatio:p,version:f,stretchX:x,stretchY:b,content:S,sdf:I,usvg:A}=r;this.pixelRatio=p,this.stretchX=x,this.stretchY=b,this.content=S,this.version=f,this.padding=l,this.sdf=I,this.usvg=A,this.scale=a_.getImagePositionScale(c,A,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function wb(n,e,r){const l=Va.parse(n),c=function(p,f,x=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*x[0])+2*f,h:(p.data?p.data.height:p.height*x[1])+2*f}}(e,r,[l.options.transform.a,l.options.transform.d]);return{bin:c,imagePosition:new a_(c,e,r,l),imageVariant:l}}class sA{constructor(e,r,l){const c=new Map,p=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,c,Id,f),this.addImages(r,p,2,f);const{w:x,h:b}=nA(f),S=new ps({width:x||1,height:b||1});for(const[I,A]of e.entries()){const M=c.get(I).paddedRect;ps.copy(A.data,S,{x:0,y:0},{x:M.x+Id,y:M.y+Id},A.data,l,A.sdf)}for(const[I,A]of r.entries()){const M=p.get(I),N=M.paddedRect;let z=M.padding;const B=N.x+z,q=N.y+z,K=A.data.width,ne=A.data.height;z=z>1?z-1:z,ps.copy(A.data,S,{x:0,y:0},{x:B,y:q},A.data,l),ps.copy(A.data,S,{x:0,y:ne-z},{x:B,y:q-z},{width:K,height:z},l),ps.copy(A.data,S,{x:0,y:0},{x:B,y:q+ne},{width:K,height:z},l),ps.copy(A.data,S,{x:K-z,y:0},{x:B-z,y:q},{width:z,height:ne},l),ps.copy(A.data,S,{x:0,y:0},{x:B+K,y:q},{width:z,height:ne},l),ps.copy(A.data,S,{x:K-z,y:ne-z},{x:B-z,y:q-z},{width:z,height:z},l),ps.copy(A.data,S,{x:0,y:ne-z},{x:B+K,y:q-z},{width:z,height:z},l),ps.copy(A.data,S,{x:0,y:0},{x:B+K,y:q+ne},{width:z,height:z},l),ps.copy(A.data,S,{x:K-z,y:0},{x:B-z,y:q+ne},{width:z,height:z},l)}this.lut=l,this.image=S,this.iconPositions=c,this.patternPositions=p}addImages(e,r,l,c){for(const[p,f]of e.entries()){const{bin:x,imagePosition:b,imageVariant:S}=wb(p,f,l);r.set(p,b),c.push(x),f.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const c of e.getUpdatedImages(l)){for(const p of this.iconPositions.keys()){const f=Va.parse(p);if(Ks.isEqual(f.id,c)){const x=e.getImage(c,l);this.patchUpdatedImage(this.iconPositions.get(p),x,r)}}for(const p of this.patternPositions.keys()){const f=Va.parse(p);if(Ks.isEqual(f.id,c)){const x=e.getImage(c,l);this.patchUpdatedImage(this.patternPositions.get(p),x,r)}}}}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,p]=e.tl,f=e.sdf;if(this.lut||f){const x={width:r.data.width,height:r.data.height},b=new ps(x);ps.copy(r.data,b,{x:0,y:0},{x:0,y:0},x,this.lut,f),l.update(b,{position:{x:c,y:p}})}else l.update(r.data,{position:{x:c,y:p}})}}Rt(a_,"ImagePosition"),Rt(sA,"ImageAtlas");const e0=1e20;function oA(n,e,r,l,c,p,f,x,b){for(let S=e;S<e+l;S++)aA(n,r*p+S,p,c,f,x,b);for(let S=r;S<r+c;S++)aA(n,S*p+e,1,l,f,x,b)}function aA(n,e,r,l,c,p,f){p[0]=0,f[0]=-1e20,f[1]=e0,c[0]=n[e];for(let x=1,b=0,S=0;x<l;x++){c[x]=n[e+x*r];const I=x*x;do{const A=p[b];S=(c[x]-c[A]+I-A*A)/(x-A)/2}while(S<=f[b]&&--b>-1);b++,p[b]=x,f[b]=S,f[b+1]=e0}for(let x=0,b=0;x<l;x++){for(;f[b+1]<x;)b++;const S=p[b],I=x-S;n[e+x*r]=c[S]+I*I}}const Qa=2,bb={none:0,ideographs:1,all:2};class Tf{constructor(e,r,l){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,l){const c=[],p=this.urls[r]||os.GLYPHS_URL;for(const f in e)for(const x of e[f])c.push({stack:f,id:x});Me(c,({stack:f,id:x},b)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=S.glyphs[x];if(I!==void 0)return void b(null,{stack:f,id:x,glyph:I});if(I=this._tinySDF(S,f,x),I)return S.glyphs[x]=I,void b(null,{stack:f,id:x,glyph:I});const A=Math.floor(x/256);if(256*A>65535)return Ei("glyphs > 65535 not supported"),void b(null,{stack:f,id:x,glyph:I});if(S.ranges[A])return void b(null,{stack:f,id:x,glyph:I});let M=S.requests[A];M||(M=S.requests[A]=[],Tf.loadGlyphRange(f,A,p,this.requestManager,(N,z)=>{if(z){S.ascender=z.ascender,S.descender=z.descender;for(const B in z.glyphs)this._doesCharSupportLocalGlyph(+B)||(S.glyphs[+B]=z.glyphs[+B]);S.ranges[A]=!0}for(const B of M)B(N,z);delete S.requests[A]})),M.push((N,z)=>{N?b(N):z&&b(null,{stack:f,id:x,glyph:z.glyphs[x]||null})})},(f,x)=>{if(f)l(f);else if(x){const b={};for(const{stack:S,id:I,glyph:A}of x)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[I]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;l(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==bb.none&&(this.localGlyphMode===bb.all?!!this.localFontFamily:!!this.localFontFamily&&(Jt["CJK Unified Ideographs"](e)||Jt["Hangul Syllables"](e)||Jt.Hiragana(e)||Jt.Katakana(e)||Jt["CJK Symbols and Punctuation"](e)||Jt["CJK Unified Ideographs Extension A"](e)||Jt["CJK Unified Ideographs Extension B"](e)||Jt.Osage(e)))}_tinySDF(e,r,l){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),p=e.tinySDF=new Tf.TinySDF({fontFamily:c,fontWeight:B,fontSize:24*Qa,buffer:3*Qa,radius:8*Qa}),p.fontWeight=B}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const f=String.fromCodePoint(l),{data:x,width:b,height:S,glyphWidth:I,glyphHeight:A,glyphLeft:M,glyphTop:N,glyphAdvance:z}=p.draw(f);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Mu({width:b,height:S},x),metrics:{width:I/Qa,height:A/Qa,left:M/Qa,top:N/Qa-27,advance:z/Qa,localGlyph:!0}}}}Tf.loadGlyphRange=function(n,e,r,l,c){const p=256*e,f=p+255,x=l.transformRequest(l.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${p}-${f}`),Nh.Glyphs);jh(x,(b,S)=>{if(b)c(b);else if(S){const I={},A=function(M){return new Qx(M).readFields(CF,{})}(S);for(const M of A.glyphs)I[M.id]=M;c(null,{glyphs:I,ascender:A.ascender,descender:A.descender})}})},Tf.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=r;const x=this.size=n+4*e,b=this._createCanvas(x),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${p} ${n}px ${c}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(n),f=Math.ceil(r),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),b=Math.min(this.size-this.buffer,f+Math.ceil(l)),S=x+2*this.buffer,I=b+2*this.buffer,A=Math.max(S*I,0),M=new Uint8ClampedArray(A),N={data:M,width:S,height:I,glyphWidth:x,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(x===0||b===0)return N;const{ctx:z,buffer:B,gridInner:q,gridOuter:K}=this;z.clearRect(B,B,x,b),z.fillText(n,B,B+f);const ne=z.getImageData(B,B,x,b);K.fill(e0,0,A),q.fill(0,0,A);for(let se=0;se<b;se++)for(let V=0;V<x;V++){const ee=ne.data[4*(se*x+V)+3]/255;if(ee===0)continue;const ae=(se+B)*S+V+B;if(ee===1)K[ae]=0,q[ae]=e0;else{const fe=.5-ee;K[ae]=fe>0?fe*fe:0,q[ae]=fe<0?fe*fe:0}}oA(K,0,0,S,I,S,this.f,this.v,this.z),oA(q,B,B,x,b,S,this.f,this.v,this.z);for(let se=0;se<A;se++){const V=Math.sqrt(K[se])-Math.sqrt(q[se]);M[se]=Math.round(255-255*(V/this.radius+this.cutoff))}return N}};const Ad=Id;function lA(n,e){return n+e[1]-e[0]}function cA(n,e,r,l,c=1){const p=[],f=n.imagePrimary,x=f.pixelRatio,b=f.paddedRect.w-2*Ad,S=f.paddedRect.h-2*Ad,I=(n.right-n.left)*c,A=(n.bottom-n.top)*c,M=f.stretchX||[[0,b]],N=f.stretchY||[[0,S]],z=M.reduce(lA,0),B=N.reduce(lA,0),q=b-z,K=S-B;let ne=0,se=z,V=0,ee=B,ae=0,fe=q,Ae=0,Ee=K;if(f.content&&l){const De=f.content;ne=t0(M,0,De[0]),V=t0(N,0,De[1]),se=t0(M,De[0],De[2]),ee=t0(N,De[1],De[3]),ae=De[0]-ne,Ae=De[1]-V,fe=De[2]-De[0]-se,Ee=De[3]-De[1]-ee}const Pe=(De,He,ut,it)=>{const lt=i0(De.stretch-ne,se,I,n.left*c),ht=r0(De.fixed-ae,fe,De.stretch,z),Ze=i0(He.stretch-V,ee,A,n.top*c),st=r0(He.fixed-Ae,Ee,He.stretch,B),$e=i0(ut.stretch-ne,se,I,n.left*c),We=r0(ut.fixed-ae,fe,ut.stretch,z),gt=i0(it.stretch-V,ee,A,n.top*c),yt=r0(it.fixed-Ae,Ee,it.stretch,B),Xt=new wt(lt,Ze),zt=new wt($e,Ze),Tt=new wt($e,gt),mt=new wt(lt,gt),gi=new wt(ht/x,st/x),jt=new wt(We/x,yt/x),Lt=e*Math.PI/180;if(Lt){const Fi=Math.sin(Lt),gr=Math.cos(Lt),Fr=[gr,-Fi,Fi,gr];Xt._matMult(Fr),zt._matMult(Fr),mt._matMult(Fr),Tt._matMult(Fr)}const oi=De.stretch+De.fixed,Ti=ut.stretch+ut.fixed,bi=He.stretch+He.fixed,Li=it.stretch+it.fixed,Pi=n.imageSecondary;return{tl:Xt,tr:zt,bl:mt,br:Tt,texPrimary:{x:f.paddedRect.x+Ad+oi,y:f.paddedRect.y+Ad+bi,w:Ti-oi,h:Li-bi},texSecondary:Pi?{x:Pi.paddedRect.x+Ad+oi,y:Pi.paddedRect.y+Ad+bi,w:Ti-oi,h:Li-bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gi,pixelOffsetBR:jt,minFontScaleX:fe/x/I,minFontScaleY:Ee/x/A,isSDF:r}};if(l&&(f.stretchX||f.stretchY)){const De=uA(M,q,z),He=uA(N,K,B);for(let ut=0;ut<De.length-1;ut++){const it=De[ut],lt=De[ut+1];for(let ht=0;ht<He.length-1;ht++)p.push(Pe(it,He[ht],lt,He[ht+1]))}}else p.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return p}function t0(n,e,r){let l=0;for(const c of n)l+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return l}function uA(n,e,r){const l=[{fixed:-1,stretch:0}];for(const[c,p]of n){const f=l[l.length-1];l.push({fixed:c-f.stretch,stretch:f.stretch}),l.push({fixed:c-f.stretch,stretch:f.stretch+(p-c)})}return l.push({fixed:e+Ad,stretch:r}),l}function i0(n,e,r,l){return n/e*r+l}function r0(n,e,r,l){return n-e*r/l}function jF(n,e,r,l){const c=e+n.positionedLines[l].lineOffset;return l===0?r+c/2:r+(c+(e+n.positionedLines[l-1].lineOffset))/2}function zF(n,e=1,r=!1){let l=1/0,c=1/0,p=-1/0,f=-1/0;const x=n[0];for(let N=0;N<x.length;N++){const z=x[N];(!N||z.x<l)&&(l=z.x),(!N||z.y<c)&&(c=z.y),(!N||z.x>p)&&(p=z.x),(!N||z.y>f)&&(f=z.y)}const b=Math.min(p-l,f-c);let S=b/2;const I=new Mp([],LF);if(b===0)return new wt(l,c);for(let N=l;N<p;N+=b)for(let z=c;z<f;z+=b)I.push(new Ef(N+S,z+S,S,n));let A=function(N){let z=0,B=0,q=0;const K=N[0];for(let ne=0,se=K.length,V=se-1;ne<se;V=ne++){const ee=K[ne],ae=K[V],fe=ee.x*ae.y-ae.x*ee.y;B+=(ee.x+ae.x)*fe,q+=(ee.y+ae.y)*fe,z+=3*fe}return new Ef(B/z,q/z,0,N)}(n),M=I.length;for(;I.length;){const N=I.pop();(N.d>A.d||!A.d)&&(A=N,r&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,M)),N.max-A.d<=e||(S=N.h/2,I.push(new Ef(N.p.x-S,N.p.y-S,S,n)),I.push(new Ef(N.p.x+S,N.p.y-S,S,n)),I.push(new Ef(N.p.x-S,N.p.y+S,S,n)),I.push(new Ef(N.p.x+S,N.p.y+S,S,n)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${A.d}`)),A.p}function LF(n,e){return e.max-n.max}class Ef{constructor(e,r,l,c){this.p=new wt(e,r),this.h=l,this.d=function(p,f){let x=!1,b=1/0;for(let S=0;S<f.length;S++){const I=f[S];for(let A=0,M=I.length,N=M-1;A<M;N=A++){const z=I[A],B=I[N];z.y>p.y!=B.y>p.y&&p.x<(B.x-z.x)*(p.y-z.y)/(B.y-z.y)+z.x&&(x=!x),b=Math.min(b,ff(p,z,B))}}return(x?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const FF=Object.keys,Sb=Number.POSITIVE_INFINITY,OF=Math.sqrt(2);function hA(n,[e,r]){let l=0,c=0;if(r===Sb){e<0&&(e=0);const p=e/OF;switch(n){case"top-right":case"top-left":c=p-7;break;case"bottom-right":case"bottom-left":c=7-p;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),n){case"top-right":case"top-left":case"top":c=r-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-r}switch(n){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,c]}function n0(n,e,r,l,c,p,f,x,b){if(!e||!e.usvg)return;const S=KI(l),I=KI(c),A=p!=="both"&&p!=="width"||!XI(l)?1:I.width/S.width,M=p!=="both"&&p!=="height"||!YI(l)?1:I.height/S.height;r.scaleSelf(A,M);const N=r.toString();f.set(N,r),x.set(N,e);const{imagePosition:z}=wb(N,e,Id);b.set(N,z)}function dA(n,e,r,l,c,p,f,x,b){if(!n)return;const S=function(I,A,M,N,z,B){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const q=A.possiblyEvaluate(new Cr(I.maxZoom,{worldview:B}),M).evaluate(z,{},M),K=A.possiblyEvaluate(new Cr(I.minZoom,{worldview:B}),M).evaluate(z,{},M);return Math.max(q,K)}return A.possiblyEvaluate(new Cr(N,{worldview:B})).evaluate(z,{},M)}(e,r,l,c,p,b);return n.scaleSelf(S*x*f)}function pA(n,e,r,l,c,p,f,x,b){return{iconPrimary:dA(n.getPrimary(),e,r,l,c,p,f,x,b),iconSecondary:dA(n.getSecondary(),e,r,l,c,p,f,x,b)}}function BF(n,e,r){if(!e)return;const l=r.get(n.toString()),c=r.get(e.toString());c&&(l.paddedRect.w===c.paddedRect.w&&l.paddedRect.h===c.paddedRect.h||Ei(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),l.usvg!==c.usvg&&Ei(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function fA(n,e,r,l){if(!n)return;const c=e.get(r.toString());if(n.imagePrimary=c,l){const p=e.get(l.toString());n.imageSecondary=p}}function VF(n,e){for(const r in n.horizontal)mA(n.horizontal[r],e);mA(n.vertical,e)}function mA(n,e){if(n){for(const r of n.positionedLines)for(const l of r.positionedGlyphs)if(l.image!==null){const c=l.image.toString();l.rect=e.get(c).paddedRect}}}function Tb(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UF(n,e,r,l,c,p,f,x,b){const S=Eb(p.horizontal)||p.vertical,I=r.get("icon-text-fit-padding").evaluate(l,{},c);let A,M=e;return e&&b!=="none"&&(n.allowVerticalPlacement&&p.vertical&&(A=ZI(e,p.vertical,b,I,x,f)),S&&(M=ZI(e,S,b,I,x,f))),{defaultShapedIcon:M,verticallyShapedIcon:A}}function GF(n,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K,ne,se){let V=f.textMaxSize.evaluate(e,{},M);V===void 0?V=x*f.textScaleFactor:V*=f.textScaleFactor;const ee=n.layers[0].layout,ae=Eb(r.horizontal)||r.vertical,fe=N.name==="globe",Ae=ts,Ee=n.tilePixelRatio*V/Ae,Pe=(ht=n.overscaling,n.zoom>18&&ht>2&&(ht>>=1),Math.max(bt/(512*ht),1)*ee.get("symbol-spacing")),De=ee.get("text-padding")*n.tilePixelRatio,He=ee.get("icon-padding")*n.tilePixelRatio,ut=Qi(ee.get("text-max-angle")),it=ee.get("icon-rotation-alignment")==="map"&&se!=="point",lt=Pe/2;var ht;n.hasAnyIconTextFit===!1&&q!=="none"&&(n.hasAnyIconTextFit=!0);const Ze=e.properties?+e.properties[Bi]:null,st=Ze&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Ze):65535,$e=(We,gt,yt)=>{if(gt.x<0||gt.x>=bt||gt.y<0||gt.y>=bt)return;let Xt=null;if(fe){const{x:zt,y:Tt,z:mt}=N.projectTilePoint(gt.x,gt.y,yt);Xt={anchor:new Ic(zt,Tt,mt,0,void 0),up:N.upVector(yt,gt.x,gt.y)}}(function(zt,Tt,mt,gi,jt,Lt,oi,Ti,bi,Li,Pi,Fi,gr,Fr,ue,ge,Ye,vt,Et,St,Nt,ni,Vi,Ui,Mi,vr,Rr,Gi,an){const Or=zt.addToLineVertexArray(Tt,gi);let _r,vn,Hr,kr,Br,Tr,ki,Ir=0,ln=0,ii=0,Yi=0,Wr=-1,gn=-1;const tn={};let Nn=Lh("");const Ar=mt?mt.anchor:Tt,Pn=Gi!=="none";let to=0,fs=0;if(bi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const jn=bi.layout.get("text-offset").evaluate(Nt,{},Mi);to=jn[0]*ts,fs=jn[1]*ts}else to=bi.layout.get("text-radial-offset").evaluate(Nt,{},Mi)*ts,fs=Sb;if(zt.allowVerticalPlacement&&jt.vertical){const jn=jt.vertical;if(ue)Tr=Cb(jn),Ti&&(ki=Cb(Ti));else{const $n=bi.layout.get("text-rotate").evaluate(Nt,{},Mi)+90;Hr=s0(Li,Ar,Tt,Pi,Fi,gr,jn,Fr,$n,ge),Ti&&(kr=s0(Li,Ar,Tt,Pi,Fi,gr,Ti,vt,$n))}}if(Lt){const jn=zt.iconSizeData,$n=bi.layout.get("icon-rotate").evaluate(Nt,{},Mi),ms=cA(Lt,$n,Vi,Pn,ni.iconScaleFactor),Ns=Ti?cA(Ti,$n,Vi,Pn,ni.iconScaleFactor):void 0;vn=s0(Li,Ar,Tt,Pi,Fi,gr,Lt,vt,$n,null),Ir=4*ms.length;let Ts=null;jn.kind==="source"?(Ts=[Ll*bi.layout.get("icon-size").evaluate(Nt,{},Mi)*ni.iconScaleFactor],Ts[0]>ku&&Ei(`${zt.layerIds[0]}: Value for "icon-size" is >= ${l_}. Reduce your "icon-size".`)):jn.kind==="composite"&&(Ts=[Ll*ni.compositeIconSizes[0].evaluate(Nt,{},Mi)*ni.iconScaleFactor,Ll*ni.compositeIconSizes[1].evaluate(Nt,{},Mi)*ni.iconScaleFactor],(Ts[0]>ku||Ts[1]>ku)&&Ei(`${zt.layerIds[0]}: Value for "icon-size" is >= ${l_}. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,ms,Ts,St,Et,Nt,void 0,mt,Tt,Or.lineStartIndex,Or.lineLength,-1,Ui,Mi,vr,Rr),Wr=zt.icon.placedSymbolArray.length-1,Ns&&(ln=4*Ns.length,zt.addSymbols(zt.icon,Ns,Ts,St,Et,Nt,yo.vertical,mt,Tt,Or.lineStartIndex,Or.lineLength,-1,Ui,Mi,vr,Rr),gn=zt.icon.placedSymbolArray.length-1)}for(const jn in jt.horizontal){const $n=jn,ms=jt.horizontal[$n];_r||(Nn=Lh(ms.text),ue?Br=Cb(ms):_r=s0(Li,Ar,Tt,Pi,Fi,gr,ms,Fr,bi.layout.get("text-rotate").evaluate(Nt,{},Mi),ge));const Ns=ms.positionedLines.length===1;if(ii+=gA(zt,mt,Tt,ms,oi,bi,ue,Nt,ge,Or,jt.vertical?yo.horizontal:yo.horizontalOnly,Ns?FF(jt.horizontal):[$n],tn,Wr,ni,Ui,Mi,vr),Ns)break}jt.vertical&&(Yi+=gA(zt,mt,Tt,jt.vertical,oi,bi,ue,Nt,ge,Or,yo.vertical,["vertical"],tn,gn,ni,Ui,Mi,vr));let us=-1;const io=(jn,$n)=>jn?Math.max(jn,$n):$n;us=io(Br,us),us=io(Tr,us),us=io(ki,us);const Fl=us>-1?1:0;zt.glyphOffsetArray.length>=65535&&Ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Nt.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,Nt.sortKey),zt.symbolInstances.emplaceBack(Tt.x,Tt.y,Ar.x,Ar.y,Ar.z,tn.right>=0?tn.right:-1,tn.center>=0?tn.center:-1,tn.left>=0?tn.left:-1,tn.vertical>=0?tn.vertical:-1,Wr,gn,Nn,_r!==void 0?_r:zt.collisionBoxArray.length,_r!==void 0?_r+1:zt.collisionBoxArray.length,Hr!==void 0?Hr:zt.collisionBoxArray.length,Hr!==void 0?Hr+1:zt.collisionBoxArray.length,vn!==void 0?vn:zt.collisionBoxArray.length,vn!==void 0?vn+1:zt.collisionBoxArray.length,kr||zt.collisionBoxArray.length,kr?kr+1:zt.collisionBoxArray.length,Pi,ii,Yi,Ir,ln,Fl,0,to,fs,us,0,Pn?1:0,an)})(n,gt,Xt,We,r,l,p,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,De,ne,S,0,He,it,K,e,f,I,A,M,z,B,q,st)};if(se==="line")for(const We of Zx(e.geometry,0,0,bt,bt)){const gt=NF(We,Pe,ut,r.vertical||ae,l,Ae,Ee,n.overscaling,bt);for(const yt of gt)ae&&$F(n,ae.text,lt,yt)||$e(We,yt,M)}else if(se==="line-center"){for(const We of e.geometry)if(We.length>1){const gt=DF(We,ut,r.vertical||ae,l,Ae,Ee);gt&&$e(We,gt,M)}}else if(e.type==="Polygon")for(const We of Ux(e.geometry,0)){const gt=zF(We,16);$e(We[0],new Ic(gt.x,gt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const We of e.geometry)$e(We,new Ic(We[0].x,We[0].y,0,0,void 0),M);else if(e.type==="Point")for(const We of e.geometry)for(const gt of We)$e([gt],new Ic(gt.x,gt.y,0,0,void 0),M)}const l_=255,ku=l_*Ll;function gA(n,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q,K){const ne=function(ee,ae,fe,Ae,Ee,Pe,De,He){const ut=[];if(ae.positionedLines.length===0)return ut;const it=Ae.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,lt=function(We){const gt=We[0],yt=We[1],Xt=gt*yt;return Xt>0?[gt,-yt]:Xt<0?[-gt,yt]:gt===0?[yt,gt]:[yt,-gt]}(fe);let ht=Math.abs(ae.top-ae.bottom);for(const We of ae.positionedLines)ht-=We.lineOffset;const Ze=ae.positionedLines.length,st=ht/Ze;let $e=ae.top-fe[1];for(let We=0;We<Ze;++We){const gt=ae.positionedLines[We];$e=jF(ae,st,$e,We);for(const yt of gt.positionedGlyphs){if(!yt.rect)continue;const Xt=yt.rect||{};let zt=PF+1,Tt=!0,mt=1,gi=0;if(yt.image){const Nt=De.get(yt.image.toString());if(!Nt)continue;if(Nt.sdf){Ei("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,mt=Nt.pixelRatio,zt=Id/mt}const jt=(Ee||He)&&yt.vertical,Lt=yt.metrics.advance*yt.scale/2,oi=yt.metrics,Ti=yt.rect;if(Ti===null)continue;He&&ae.verticalizable&&(gi=yt.image?Lt-yt.metrics.width*yt.scale/2:0);const bi=Ee?[yt.x+Lt,yt.y]:[0,0];let Li=[0,0],Pi=[0,0],Fi=!1;Ee||(jt?(Pi=[yt.x+Lt+lt[0],yt.y+lt[1]-gi],Fi=!0):Li=[yt.x+Lt+fe[0],yt.y+fe[1]-gi]);const gr=Ti.w*yt.scale/(mt*(yt.localGlyph?Qa:1)),Fr=Ti.h*yt.scale/(mt*(yt.localGlyph?Qa:1));let ue,ge,Ye,vt;if(jt){const Nt=yt.y-$e,ni=new wt(-Lt,Lt-Nt),Vi=-Math.PI/2,Ui=new wt(...Pi);ue=new wt(-Lt+Li[0],Li[1]),ue._rotateAround(Vi,ni)._add(Ui),ue.x+=-Nt+Lt,ue.y-=(oi.left-zt)*yt.scale;const Mi=yt.image?oi.advance*yt.scale:ts*yt.scale,vr=String.fromCodePoint(yt.glyph);SF(vr)?ue.x+=(1-zt)*yt.scale:TF(vr)?ue.x+=Mi-oi.height*yt.scale+(-zt-1)*yt.scale:ue.x+=yt.image||oi.width+2*zt===Ti.w&&oi.height+2*zt===Ti.h?(Mi-Fr)/2:(Mi-(oi.height+2*zt)*yt.scale)/2,ge=new wt(ue.x,ue.y-gr),Ye=new wt(ue.x+Fr,ue.y),vt=new wt(ue.x+Fr,ue.y-gr)}else{const Nt=(oi.left-zt)*yt.scale-Lt+Li[0],ni=(-oi.top-zt)*yt.scale+Li[1],Vi=Nt+gr,Ui=ni+Fr;ue=new wt(Nt,ni),ge=new wt(Vi,ni),Ye=new wt(Nt,Ui),vt=new wt(Vi,Ui)}if(it){let Nt;Nt=Ee?new wt(0,0):Fi?new wt(lt[0],lt[1]):new wt(fe[0],fe[1]),ue._rotateAround(it,Nt),ge._rotateAround(it,Nt),Ye._rotateAround(it,Nt),vt._rotateAround(it,Nt)}const Et=new wt(0,0),St=new wt(0,0);ut.push({tl:ue,tr:ge,bl:Ye,br:vt,texPrimary:Xt,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:bi,sectionIndex:yt.sectionIndex,isSDF:Tt,pixelOffsetTL:Et,pixelOffsetBR:St,minFontScaleX:0,minFontScaleY:0})}}return ut}(0,l,b,p,f,x,c,n.allowVerticalPlacement),se=n.textSizeData;let V=null;se.kind==="source"?(V=[Ll*p.layout.get("text-size").evaluate(x,{},q)*z.textScaleFactor],V[0]>ku&&Ei(`${n.layerIds[0]}: Value for "text-size" is >= ${l_}. Reduce your "text-size".`)):se.kind==="composite"&&(V=[Ll*z.compositeTextSizes[0].evaluate(x,{},q)*z.textScaleFactor,Ll*z.compositeTextSizes[1].evaluate(x,{},q)*z.textScaleFactor],(V[0]>ku||V[1]>ku)&&Ei(`${n.layerIds[0]}: Value for "text-size" is >= ${l_}. Reduce your "text-size".`)),n.addSymbols(n.text,ne,V,b,f,x,I,e,r,S.lineStartIndex,S.lineLength,N,B,q,K,!1);for(const ee of A)M[ee]=n.text.placedSymbolArray.length-1;return 4*ne.length}function Eb(n){for(const e in n)return n[e];return null}function s0(n,e,r,l,c,p,f,x,b,S){let I=f.top,A=f.bottom,M=f.left,N=f.right;if(WI(f)&&f.collisionPadding){const z=f.collisionPadding;M-=z[0],I-=z[1],N+=z[2],A+=z[3]}if(b){const z=new wt(M,I),B=new wt(N,I),q=new wt(M,A),K=new wt(N,A),ne=Qi(b);let se=new wt(0,0);S&&(se=new wt(S[0],S[1])),z._rotateAround(ne,se),B._rotateAround(ne,se),q._rotateAround(ne,se),K._rotateAround(ne,se),M=Math.min(z.x,B.x,q.x,K.x),N=Math.max(z.x,B.x,q.x,K.x),I=Math.min(z.y,B.y,q.y,K.y),A=Math.max(z.y,B.y,q.y,K.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,I,N,A,x,l,c,p),n.length-1}function Cb(n){WI(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function $F(n,e,r,l){const c=n.compareText;if(e in c){const p=c[e];for(let f=p.length-1;f>=0;f--)if(l.dist(p[f])<r)return!0}else c[e]=[];return c[e].push(l),!1}function _A(n,e){const r=n.fovAboveCenter,l=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-l)/Math.cos(n._pitch),p=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01));let f=Math.sin(n._pitch)*p+c;const x=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let b=Math.max(n.zoom-17,0);n.isOrthographic&&(b/=10),f*=1+b}return Math.min(1.01*f,x)}function c_(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),l=n.x*r,c=(n.x+1)*r,p=n.y*r,f=(n.y+1)*r,x=Ce(l),b=Ce(c),S=Le(p),I=Le(f),A=e.project(x,S),M=e.project(b,S),N=e.project(b,I),z=e.project(x,I);let B=Math.min(A.x,M.x,N.x,z.x),q=Math.min(A.y,M.y,N.y,z.y),K=Math.max(A.x,M.x,N.x,z.x),ne=Math.max(A.y,M.y,N.y,z.y);const se=r/16;function V(ae,fe,Ae,Ee,Pe,De){const He=(Ae+Pe)/2,ut=(Ee+De)/2,it=e.project(Ce(He),Le(ut)),lt=Math.max(0,B-it.x,q-it.y,it.x-K,it.y-ne);B=Math.min(B,it.x),K=Math.max(K,it.x),q=Math.min(q,it.y),ne=Math.max(ne,it.y),lt>se&&(V(ae,it,Ae,Ee,He,ut),V(it,fe,He,ut,Pe,De))}V(A,M,l,p,c,p),V(M,N,c,p,c,f),V(N,z,c,f,l,f),V(z,A,l,f,l,p),B-=se,q-=se,K+=se,ne+=se;const ee=1/Math.max(K-B,ne-q);return{scale:ee,x:B*ee,y:q*ee,x2:K*ee,y2:ne*ee,projection:e}}function yA(n,{x:e,y:r},l=0){return new wt(((e-l)*n.scale-n.x)*bt,(r*n.scale-n.y)*bt)}const qF=Y(new Float32Array(16));class Du{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new te(0,0)}projectTilePoint(e,r,l){return{x:e,y:r,z:0}}locationPoint(e,r,l,c=!0){return e._coordinatePoint(e.locationCoordinate(r,l),c)}pixelsPerMeter(e,r){return Te(1,e)*r}pixelSpaceConversion(e,r,l){return 1}farthestPixelDistance(e){return _A(e,e.pixelsPerMeter)}pointCoordinate(e,r,l,c){const p=e.horizonLineFromTop(!1),f=new wt(r,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,c))}pointCoordinate3D(e,r,l){const c=new wt(r,l);if(e.elevation)return e.elevation.pointCoordinate(c);{const p=this.pointCoordinate(e,c.x,c.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const l=e.horizonLineFromTop();return r.y<l}createInversionMatrix(e,r){return qF}createTileMatrix(e,r,l){let c,p,f;const x=l.canonical,b=Y(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=c_(x,this);c=1,p=S.x+l.wrap*S.scale,f=S.y,_e(b,b,[c/S.scale,c/S.scale,e.pixelsPerMeter/r])}else c=r/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*l.wrap)*c,f=x.y*c;return oe(b,b,[p,f,0]),_e(b,b,[c/bt,c/bt,1]),b}upVector(e,r,l){return[0,0,1]}upVectorScale(e,r,l){return{metersToTile:1}}}class HF extends Du{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,l]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Qi(r));this.n=(c+Math.sin(Qi(l)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:l,c,r0:p}=this,f=Qi(e-this.center[0]),x=Qi(r),b=Math.sqrt(c-2*l*Math.sin(x))/l;return{x:b*Math.sin(f*l),y:b*Math.cos(f*l)-p,z:0}}unproject(e,r){const{n:l,c,r0:p}=this,f=p+r;let x=Math.atan2(e,Math.abs(f))*Math.sign(f);f*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(f));const b=Qi(this.center[0])*l;x=Oe(x,-Math.PI-b,Math.PI-b);const S=ve(Ve(x/l)+this.center[0],-180,180),I=Math.asin(ve((c-(e*e+f*f)*l*l)/(2*l),-1,1)),A=ve(Ve(I),-85.051129,Ke);return new te(S,A)}}const u_=1.340264,h_=-.081106,d_=893e-6,p_=.003796,o0=Math.sqrt(3)/2;class WF extends Du{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(o0*Math.sin(r)),c=l*l,p=c*c*c;return{x:.5*(e*Math.cos(l)/(o0*(u_+3*h_*c+p*(7*d_+9*p_*c)))/Math.PI+.5),y:1-.5*(l*(u_+h_*c+p*(d_+p_*c))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,c=l*l,p=c*c*c;for(let I,A,M,N=0;N<12&&(A=l*(u_+h_*c+p*(d_+p_*c))-r,M=u_+3*h_*c+p*(7*d_+9*p_*c),I=A/M,l=ve(l-I,-Math.PI/3,Math.PI/3),c=l*l,p=c*c*c,!(Math.abs(I)<1e-12));++N);const f=o0*e*(u_+3*h_*c+p*(7*d_+9*p_*c))/Math.cos(l),x=Math.asin(Math.sin(l)/o0),b=ve(180*f/Math.PI,-180,180),S=ve(180*x/Math.PI,-85.051129,Ke);return new te(b,S)}}class ZF extends Du{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const l=360*(e-.5),c=ve(360*(.5-r),-85.051129,Ke);return new te(l,c)}}const Cf=Math.PI/2;function a0(n){return Math.tan((Cf+n)/2)}class XF extends Du{constructor(e){super(e),this.center=e.center||[0,30];const[r,l]=this.parallels=e.parallels||[30,30];let c=Qi(r),p=Qi(l);this.southernCenter=c+p<0,this.southernCenter&&(c=-c,p=-p);const f=Math.cos(c),x=a0(c);this.n=c===p?Math.sin(c):Math.log(f/Math.cos(p))/Math.log(a0(p)/x),this.f=f*Math.pow(a0(c),this.n)/this.n}project(e,r){r=Qi(r),this.southernCenter&&(r=-r),e=Qi(e-this.center[0]);const l=1e-6,{n:c,f:p}=this;p>0?r<-Cf+l&&(r=-Cf+l):r>Cf-l&&(r=Cf-l);const f=p/Math.pow(a0(r),c);let x=f*Math.sin(c*e),b=p-f*Math.cos(c*e);return x=.5*(x/Math.PI+.5),b=.5*(b/Math.PI+.5),{x,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:l,f:c}=this,p=c-r,f=Math.sign(p),x=Math.sign(l)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*f;p*l<0&&(b-=Math.PI*Math.sign(e)*f);const S=ve(Ve(b/l)+this.center[0],-180,180),I=ve(Ve(2*Math.atan(Math.pow(c/x,1/l))-Cf),-85.051129,Ke);return new te(S,this.southernCenter?-I:I)}}class xA extends Du{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:we(e),y:xe(r),z:0}}unproject(e,r){const l=Ce(e),c=Le(r);return new te(l,c)}}const vA=Qi(Ke);class YF extends Du{project(e,r){const l=(r=Qi(r))*r,c=l*l;return{x:.5*((e=Qi(e))*(.8707-.131979*l+c*(c*(.003971*l-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+l*(.015085+c*(.028874*l-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let l=r=(2*(1-r)-1)*Math.PI,c=25,p=0,f=l*l;do{f=l*l;const S=f*f;p=(l*(1.007226+f*(.015085+S*(.028874*f-.044475-.005916*S)))-r)/(1.007226+f*(.045255+S*(.259866*f-.311325-.005916*11*S))),l=ve(l-p,-vA,vA)}while(Math.abs(p)>1e-6&&--c>0);f=l*l;const x=ve(Ve(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=Ve(l);return new te(x,b)}}const wA=Qi(Ke);class KF extends Du{project(e,r){r=Qi(r),e=Qi(e);const l=Math.cos(r),c=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),f=Math.sin(p)/p,x=.5*(e*c+2*l*Math.sin(e/2)/f)||0,b=.5*(r+Math.sin(r)/f)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let l=e=(2*e-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,p=25;const f=1e-6;let x=0,b=0;do{const S=Math.cos(c),I=Math.sin(c),A=2*I*S,M=I*I,N=S*S,z=Math.cos(l/2),B=Math.sin(l/2),q=2*z*B,K=B*B,ne=1-N*z*z,se=ne?1/ne:0,V=ne?Math.acos(S*z)*Math.sqrt(1/ne):0,ee=.5*(2*V*S*B+2*l/Math.PI)-e,ae=.5*(V*I+c)-r,fe=.5*se*(N*K+V*S*z*M)+1/Math.PI,Ae=se*(q*A/4-V*I*B),Ee=.125*se*(A*B-V*I*N*q),Pe=.5*se*(M*z+V*K*S)+.5,De=Ae*Ee-Pe*fe;x=(ae*Ae-ee*Pe)/De,b=(ee*Ee-ae*fe)/De,l=ve(l-x,-Math.PI,Math.PI),c=ve(c-b,-wA,wA)}while((Math.abs(x)>f||Math.abs(b)>f)&&--p>0);return new te(Ve(l),Ve(c))}}class bA extends Du{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Qi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:l,cosPhi:c}=this;return{x:Qi(e)*c*l+.5,y:-Math.sin(Qi(r))/c*l+.5,z:0}}unproject(e,r){const{scale:l,cosPhi:c}=this,p=-(r-.5)/l,f=ve(Ve((e-.5)/l)/c,-180,180),x=Math.asin(ve(p*c,-1,1)),b=ve(Ve(x),-85.051129,Ke);return new te(f,b)}}class QF extends xA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,l){const c=Ug(e,r,l);return ji(c,c,Ox(jl(l))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,r,l){const c=$(r.lat,r.lng),p=Hi([],c),f=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;ti(c,c,p,Te(1,0)*bt*f);const x=Y(new Float64Array(16));return re(x,e.pixelMatrix,e.globeMatrix),ji(c,c,x),new wt(c[0],c[1])}pixelsPerMeter(e,r){return Te(1,0)*r}pixelSpaceConversion(e,r,l){const c=Te(1,e)*r,p=si(Te(1,45)*r,c,l);return this.pixelsPerMeter(e,r)/p}createTileMatrix(e,r,l){const c=Gw(jl(l.canonical));return re(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,r){const{center:l}=e,c=Ox(jl(r));return Ge(c,c,Qi(l.lng)),Ne(c,c,Qi(l.lat)),_e(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,r,l,c){return nC(e,r,l,!0)||new Re(0,0)}pointCoordinate3D(e,r,l){const c=this.pointCoordinate(e,r,l,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,r){return!nC(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(c,p){const f=c.cameraToCenterDistance,x=c._centerAltitude*p,b=c._camera,S=c._camera.forward(),I=ui([],Gt([],S,-f),[0,0,x]),A=c.worldSize/(2*Math.PI),M=[0,0,-A],N=c.width/c.height,z=Math.tan(c.fovAboveCenter),B=Gt([],b.up(),z),q=Gt([],b.right(),z*N),K=Hi([],ui([],ui([],S,B),q)),ne=[];let se;if(new $r(I,K).closestPointOnSphere(M,A,ne)){const V=ui([],ne,M),ee=dr([],V,I);se=Math.cos(c.fovAboveCenter)*xi(ee)}else{const V=dr([],I,M),ee=dr([],M,I);Hi(ee,ee);const ae=xi(V)-A;se=Math.sqrt(ae*(ae+2*A));const fe=Math.acos(se/(A+ae))-Math.acos(Ii(S,ee));se*=Math.cos(fe)}return 1.01*se}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Pu(e.zoom);if(l>0){const c=_A(e,Te(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return si(r,c+p*(1-Math.cos(f)),Math.pow(l,10))}return r}upVector(e,r,l){return Ug(r,l,e,1)}upVectorScale(e){return{metersToTile:zx(Fx(jl(e)))}}}function SA(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new xA(n);case"equirectangular":return new ZF(n);case"naturalEarth":return new YF(n);case"equalEarth":return new WF(n);case"winkelTripel":return new KF(n);case"albers":return r?new bA(n):new HF(n);case"lambertConformalConic":return r?new bA(n):new XF(n);case"globe":return new QF(n)}throw new Error(`Invalid projection name: ${n.name}`)}const JF=Ri.VectorTileFeature.types,eO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function l0(n,e,r,l,c,p,f,x,b,S,I,A,M){const N=x?Math.min(ku,Math.round(x[0])):0,z=x?Math.min(ku,Math.round(x[1])):0;n.emplaceBack(e,r,Math.round(32*l),Math.round(32*c),p,f,(N<<1)+(b?1:0),z,16*S,16*I,256*A,256*M)}function c0(n,e,r){n.emplaceBack(e,r)}function u0(n,e,r,l,c,p,f){n.emplaceBack(e,r,l,c,p,f)}const h0=(n,e,r,l)=>{for(let c=0;c<e;c++)n.emplaceBack(r[0],r[1],r[2],l[0],l[1],l[2])};function d0(n,e,r,l,c){n.emplaceBack(e,r,l,c),n.emplaceBack(e,r,l,c),n.emplaceBack(e,r,l,c),n.emplaceBack(e,r,l,c)}function tO(n){for(const e of n.sections)if(kw(e.text))return!0;return!1}class Ib{constructor(e){this.layoutVertexArray=new vu,this.indexArray=new ls,this.programConfigurations=e,this.segments=new fn,this.dynamicLayoutVertexArray=new as,this.opacityVertexArray=new bu,this.placedSymbolArray=new bx,this.iconTransitioningVertexArray=new Ml,this.globeExtVertexArray=new wu,this.zOffsetVertexArray=new Al,this.orientationVertexArray=new Rg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,l,c,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,mF.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,eO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,yF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,gF.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,_F.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Rt(Ib,"SymbolBuffers");class Ab{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new fn,this.collisionVertexArray=new ud,this.collisionVertexArrayExt=new as}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,xF.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,vF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(Ab,"CollisionBuffers");class p0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Y([]),this.placementViewportMatrix=Y([]);const r=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=QI(this.zoom,r["text-size"],this.worldview),this.iconSizeData=QI(this.zoom,r["icon-size"],this.worldview);const l=this.layers[0].layout,c=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(f=>yo[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ib(new h(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Ib(new h(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new jg,this.lineVertexArray=new Ex,this.symbolInstances=new Tx}calculateGlyphDependencies(e,r,l,c,p){for(const f of e){const x=f.codePointAt(0);if(x===void 0)break;if(r[x]=!0,c&&p&&x<=65535){const b=n_[f];b&&(r[b.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!ib(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,r,l,c){const p=this.layers[0],f=p.layout,x=this.projection.name==="globe",b=f.get("text-font"),S=f.get("text-field"),I=f.get("icon-image"),[A,M]=f.get("icon-size-scale-range"),N=ve(r.scaleFactor||1,A,M),z=(S.value.kind!=="constant"||S.value.value instanceof Ms&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,q=f.get("symbol-sort-key");if(this.features=[],!z&&!B)return;const K=r.iconDependencies,ne=r.glyphDependencies,se=r.availableImages,V=new Cr(this.zoom,{worldview:this.worldview});for(const{feature:ee,id:ae,index:fe,sourceLayerIndex:Ae}of e){const Ee=p._featureFilter.needGeometry,Pe=Pt(ee,Ee);if(!p._featureFilter.filter(V,Pe,l))continue;if(Ee||(Pe.geometry=Dt(ee,l,c)),x&&ee.type!==1&&l.z<=5){const lt=Pe.geometry,ht=.98078528056,Ze=(st,$e)=>Ii(Ug(st.x,st.y,l,1),Ug($e.x,$e.y,l,1))<ht;for(let st=0;st<lt.length;st++)lt[st]=xt(lt[st],Ze)}let De,He;if(z){const lt=p.getValueAndResolveTokens("text-field",Pe,l,se),ht=Ms.factory(lt);tO(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||mu()==="unavailable"||this.hasRTLText&&Wa.isParsed())&&(De=bF(ht,p,Pe))}if(B){const lt=p.getValueAndResolveTokens("icon-image",Pe,l,se);He=typeof lt=="string"?Us.build(lt):lt}if(!De&&!He)continue;const ut=this.sortFeaturesByKey?q.evaluate(Pe,{},l):void 0,it={id:ae,text:De,icon:He,index:fe,sourceLayerIndex:Ae,geometry:Pe.geometry,properties:ee.properties,type:JF[ee.type],sortKey:ut};if(this.features.push(it),He){const lt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:ht,iconSecondary:Ze}=pA(He,this.iconSizeData,lt["icon-size"],l,this.zoom,it,this.pixelRatio,N,this.worldview),st=ht.id.toString();if(K.has(st)?K.get(st).push(ht):K.set(st,[ht]),Ze){const $e=Ze.id.toString();K.has($e)?K.get($e).push(Ze):K.set($e,[Ze])}}if(De){const lt=b.evaluate(Pe,{},l).join(","),ht=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yo.vertical)>=0;for(const Ze of De.sections)if(Ze.image){const st=Ze.image.getPrimary().scaleSelf(this.pixelRatio),$e=st.id.toString(),We=K.get($e)||[];We.push(st),K.set($e,We)}else{const st=nd(De.toString()),$e=Ze.fontStack||lt,We=ne[$e]=ne[$e]||{};this.calculateGlyphDependencies(Ze.text,We,ht,this.allowVerticalPlacement,st)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(ee){const ae={},fe={},Ae=[];let Ee=0;function Pe(it){Ae.push(ee[it]),Ee++}function De(it,lt,ht){const Ze=fe[it];return delete fe[it],fe[lt]=Ze,Ae[Ze].geometry[0].pop(),Ae[Ze].geometry[0]=Ae[Ze].geometry[0].concat(ht[0]),Ze}function He(it,lt,ht){const Ze=ae[lt];return delete ae[lt],ae[it]=Ze,Ae[Ze].geometry[0].shift(),Ae[Ze].geometry[0]=ht[0].concat(Ae[Ze].geometry[0]),Ze}function ut(it,lt,ht){const Ze=ht?lt[0][lt[0].length-1]:lt[0][0];return`${it}:${Ze.x}:${Ze.y}`}for(let it=0;it<ee.length;it++){const lt=ee[it],ht=lt.geometry,Ze=lt.text?lt.text.toString():null;if(!Ze){Pe(it);continue}const st=ut(Ze,ht),$e=ut(Ze,ht,!0);if(st in fe&&$e in ae&&fe[st]!==ae[$e]){const We=He(st,$e,ht),gt=De(st,$e,Ae[We].geometry);delete ae[st],delete fe[$e],fe[ut(Ze,Ae[gt].geometry,!0)]=gt,Ae[We].geometry=null}else st in fe?De(st,$e,ht):$e in ae?He(st,$e,ht):(Pe(it),ae[st]=Ee-1,fe[$e]=Ee-1)}return Ae.filter(it=>it.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ee of r.elevationFeatures)this.elevationFeatureIdToIndex.set(ee.id,this.elevationFeatures.length),this.elevationFeatures.push(ee)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ee,ae)=>ee.sortKey-ae.sortKey)}update(e,r,l,c,p,f,x){this.text.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,r,p,l,c,f,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;const l=qe(e),c=1/l;let p=!1,f=!1;for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x),S=It(1,0,0),I=It(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:M,numIconVertices:N,numVerticalIconVertices:z}=b,B=A>0||M>0,q=N>0,K=this.elevationFeatures[b.elevationFeatureIndex];if(K){const ne=new wt(b.tileAnchorX,b.tileAnchorY),se=.075+K.pointElevation(ne);b.zOffset!==se&&(r=!0,b.zOffset=se);const V=K.computeSlopeNormal(ne,c),ee=Zo(Fn(),It(0,0,1),V);wr(S,S,ee),wr(I,I,ee),S[2]*=l,I[2]*=l,S[0]===1&&S[1]===0&&S[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(p=p||B,f=f||q)}if(B&&(h0(this.text.orientationVertexArray,A,S,I),h0(this.text.orientationVertexArray,M,S,I)),q){const{placedIconSymbolIndex:ne,verticalPlacedIconSymbolIndex:se}=b;ne>=0&&h0(this.icon.orientationVertexArray,N,S,I),se>=0&&h0(this.icon.orientationVertexArray,z,S,I)}}p||(this.text.orientationVertexArray=void 0),f||(this.icon.orientationVertexArray=void 0),r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,f,x)=>{l+=f,l>p.length&&p.resize(l);for(let b=-f;b<0;b++)p.emplace(b+l,x)},r=(p,f,x)=>{c+=f,c>p.length&&p.resize(c);for(let b=-f;b<0;b++)p.emplace(b+c,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,c=0;for(let p=0;p<this.symbolInstances.length;p++){const f=this.symbolInstances.get(p),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:b,numIconVertices:S}=f,I=f.zOffset,A=S>0;if((x>0||b>0)&&(e(this.text.zOffsetVertexArray,x,I),e(this.text.zOffsetVertexArray,b,I)),A){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:N}=f;M>=0&&r(this.icon.zOffsetVertexArray,S,I),N>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=SA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:p}of r)this.lineVertexArray.emplaceBack(c,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,c,p,f,x,b,S,I,A,M,N,z,B,q){const K=e.indexArray,ne=e.layoutVertexArray,se=e.globeExtVertexArray,V=e.segments.prepareSegment(4*r.length,ne,K,this.canOverlap?f.sortKey:void 0),ee=this.glyphOffsetArray.length,ae=V.vertexLength,fe=this.allowVerticalPlacement&&x===yo.vertical?Math.PI/2:0,Ae=f.text&&f.text.sections;for(let Pe=0;Pe<r.length;Pe++){const{tl:De,tr:He,bl:ut,br:it,texPrimary:lt,texSecondary:ht,pixelOffsetTL:Ze,pixelOffsetBR:st,minFontScaleX:$e,minFontScaleY:We,glyphOffset:gt,isSDF:yt,sectionIndex:Xt}=r[Pe],zt=V.vertexLength,Tt=gt[1];if(l0(ne,S.x,S.y,De.x,Tt+De.y,lt.x,lt.y,l,yt,Ze.x,Ze.y,$e,We),l0(ne,S.x,S.y,He.x,Tt+He.y,lt.x+lt.w,lt.y,l,yt,st.x,Ze.y,$e,We),l0(ne,S.x,S.y,ut.x,Tt+ut.y,lt.x,lt.y+lt.h,l,yt,Ze.x,st.y,$e,We),l0(ne,S.x,S.y,it.x,Tt+it.y,lt.x+lt.w,lt.y+lt.h,l,yt,st.x,st.y,$e,We),b){const{x:mt,y:gi,z:jt}=b.anchor,[Lt,oi,Ti]=b.up;u0(se,mt,gi,jt,Lt,oi,Ti),u0(se,mt,gi,jt,Lt,oi,Ti),u0(se,mt,gi,jt,Lt,oi,Ti),u0(se,mt,gi,jt,Lt,oi,Ti),d0(e.dynamicLayoutVertexArray,mt,gi,jt,fe)}else d0(e.dynamicLayoutVertexArray,S.x,S.y,S.z,fe);if(q){const mt=ht||lt;c0(e.iconTransitioningVertexArray,mt.x,mt.y),c0(e.iconTransitioningVertexArray,mt.x+mt.w,mt.y),c0(e.iconTransitioningVertexArray,mt.x,mt.y+mt.h),c0(e.iconTransitioningVertexArray,mt.x+mt.w,mt.y+mt.h)}K.emplaceBack(zt,zt+1,zt+2),K.emplaceBack(zt+1,zt+2,zt+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Pe!==r.length-1&&Xt===r[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,f,f.index,{},N,z,B,Ae&&Ae[Xt],this.worldview)}const Ee=b?b.anchor:S;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,S.x,S.y,ee,this.glyphOffsetArray.length-ee,ae,I,A,S.segment,l?l[0]:0,l?l[1]:0,c[0],c[1],x,0,0,0,M,0)}_commitLayoutVertex(e,r,l,c,p,f,x){e.emplaceBack(r,l,c,p,f,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,l,c,p,f,x){const b=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),S=b.vertexLength,I=x.tileAnchorX,A=x.tileAnchorY;for(let N=0;N<4;N++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,r,e.padding,x.zOffset),this._commitLayoutVertex(l.layoutVertexArray,c,p,f,I,A,new wt(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,c,p,f,I,A,new wt(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,c,p,f,I,A,new wt(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,c,p,f,I,A,new wt(e.x1,e.y2)),b.vertexLength+=4;const M=l.indexArray;M.emplaceBack(S,S+1),M.emplaceBack(S+1,S+2),M.emplaceBack(S+2,S+3),M.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,l,c,p,f){for(let x=c;x<p;x++){const b=l.get(x),S=this.getSymbolInstanceTextSize(e,f,r,x);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,l,c,p,f){for(let x=c;x<p;x++){const b=l.get(x),S=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ab(sf,FI.members,Ml),this.iconCollisionBox=new Ab(sf,FI.members,Ml);const c=o_(this.iconSizeData,e),p=o_(this.textSizeData,e,l);for(let f=0;f<this.symbolInstances.length;f++){const x=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(p,e,r,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,r,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,r,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,r,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,r,l,c){const p=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),f=vb(this.textSizeData,e,p)/ts;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,l){const c=this.icon.placedSymbolArray.get(l),p=vb(this.iconSizeData,e,c);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,r,l,c){e.emplaceBack(r,-l,-l,c),e.emplaceBack(r,l,-l,c),e.emplaceBack(r,l,l,c),e.emplaceBack(r,-l,l,c)}_updateTextDebugCollisionBoxes(e,r,l,c,p,f,x){for(let b=c;b<p;b++){const S=l.get(b),I=this.getSymbolInstanceTextSize(e,f,r,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,S.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,r,l,c,p,f,x){for(let b=c;b<p;b++){const S=l.get(b),I=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,S.padding,f.zOffset)}}updateCollisionDebugBuffers(e,r,l,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=o_(this.iconSizeData,e,c),f=o_(this.textSizeData,e,l);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(f,e,r,b.textBoxStartIndex,b.textBoxEndIndex,b,l),this._updateTextDebugCollisionBoxes(f,e,r,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,l),this._updateIconDebugCollisionBoxes(p,e,r,b.iconBoxStartIndex,b.iconBoxEndIndex,b,c),this._updateIconDebugCollisionBoxes(p,e,r,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,l,c,p,f,x,b,S){const I={};if(r<l){const{x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V,featureIndex:ee}=e.get(r);I.textBox={x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V},I.textFeatureIndex=ee}if(c<p){const{x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V,featureIndex:ee}=e.get(c);I.verticalTextBox={x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V},I.verticalTextFeatureIndex=ee}if(f<x){const{x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V,featureIndex:ee}=e.get(f);I.iconBox={x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V},I.iconFeatureIndex=ee}if(b<S){const{x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V,featureIndex:ee}=e.get(b);I.verticalIconBox={x1:A,y1:M,x2:N,y2:z,padding:B,projectedAnchorX:q,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:V},I.verticalIconFeatureIndex=ee}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),c=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<c;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),c=[],p=[],f=[];for(let x=0;x<this.symbolInstances.length;++x){f.push(x);const b=this.symbolInstances.get(x);c.push(0|Math.round(r*b.tileAnchorX+l*b.tileAnchorY)),p.push(b.featureIndex)}return f.sort((x,b)=>c[x]-c[b]||p[b]-p[x]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=l;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),f>=0&&f!==p&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let TA,EA,Pb;Rt(p0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),p0.addDynamicAttributes=d0;class CA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Kc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(CA,"FormatSectionOverride",{omit:["defaultValue"]});const Mb=()=>Pb||(Pb={layout:TA||(TA=new hn({"symbol-placement":new ft(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(ze.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ft(ze.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ft(ze.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ft(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ft(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(ze.layout_symbol["icon-size"]),"icon-size-scale-range":new ft(ze.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new At(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(ze.layout_symbol["icon-image"]),"icon-rotate":new At(ze.layout_symbol["icon-rotate"]),"icon-padding":new ft(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new At(ze.layout_symbol["icon-offset"]),"icon-anchor":new At(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(ze.layout_symbol["text-rotation-alignment"]),"text-field":new At(ze.layout_symbol["text-field"]),"text-font":new At(ze.layout_symbol["text-font"]),"text-size":new At(ze.layout_symbol["text-size"]),"text-size-scale-range":new ft(ze.layout_symbol["text-size-scale-range"]),"text-max-width":new At(ze.layout_symbol["text-max-width"]),"text-line-height":new At(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new At(ze.layout_symbol["text-letter-spacing"]),"text-justify":new At(ze.layout_symbol["text-justify"]),"text-radial-offset":new At(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new At(ze.layout_symbol["text-anchor"]),"text-max-angle":new ft(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(ze.layout_symbol["text-writing-mode"]),"text-rotate":new At(ze.layout_symbol["text-rotate"]),"text-padding":new ft(ze.layout_symbol["text-padding"]),"text-keep-upright":new ft(ze.layout_symbol["text-keep-upright"]),"text-transform":new At(ze.layout_symbol["text-transform"]),"text-offset":new At(ze.layout_symbol["text-offset"]),"text-allow-overlap":new ft(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ft(ze.layout_symbol["text-ignore-placement"]),"text-optional":new ft(ze.layout_symbol["text-optional"]),visibility:new ft(ze.layout_symbol.visibility)})),paint:EA||(EA=new hn({"icon-opacity":new At(ze.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new At(ze.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new At(ze.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new At(ze.paint_symbol["text-emissive-strength"]),"icon-color":new At(ze.paint_symbol["icon-color"]),"icon-halo-color":new At(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(ze.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ft(ze.paint_symbol["icon-image-cross-fade"]),"text-opacity":new At(ze.paint_symbol["text-opacity"]),"text-occlusion-opacity":new At(ze.paint_symbol["text-occlusion-opacity"]),"text-color":new At(ze.paint_symbol["text-color"],{runtimeType:Qs,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new At(ze.paint_symbol["text-halo-color"]),"text-halo-width":new At(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new At(ze.paint_symbol["text-halo-blur"]),"text-translate":new ft(ze.paint_symbol["text-translate"]),"text-translate-anchor":new ft(ze.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ft(ze.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ft(ze.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ft(ze.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ft(ze.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new At(ze.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},Pb);class f0 extends Ss{constructor(e,r,l,c){super(e,Mb(),r,l,c),this._colorAdjustmentMatrix=Y([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const c=[];for(const p of l)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,l,c){return this._saturation===e&&this._contrast===r&&this._brightnessMin===l&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(p,f,x,b){p=vs(p),f=Bs(f);const S=de(),I=p/3,A=1-2*I,M=[A,I,I,0,I,A,I,0,I,I,A,0,0,0,0,1],N=.5-.5*f,z=b-x;return re(S,[z,0,0,0,0,z,0,0,0,0,z,0,x,x,x,1],[f,0,0,0,0,f,0,0,0,0,f,0,N,N,N,1]),re(S,S,M),S}(e,r,l,c),this._saturation=e,this._contrast=r,this._brightnessMin=l,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,l,c){const p=this.layout.get(e).evaluate(r,{},l,c),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Zp(f.value)||!p?p:function(x,b){return b.replace(/{([^{}]+)}/g,(S,I)=>I in x?String(x[I]):"")}(r.properties,p)}createBucket(e){return new p0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Mb().paint.overridableProperties){if(!f0.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new CA(r),c=new du(l,r.property.specification,this.scope,this.options);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new id("source",c):new rd("composite",c,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new gu(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&f0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),c=Mb().paint.properties[r];let p=!1;const f=x=>{for(const b of x)if(c.overrides&&c.overrides.hasOverride(b))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Ms)f(l.value.value.sections);else if(l.value.kind==="source"){const x=S=>{p||(S instanceof mi&&Mt(S.value)===Oh?f(S.value.sections):S instanceof Jc?f(S.sections):S.eachChild(x))},b=l.value;b._styleExpression&&x(b._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,l){return{config:new Cu(this,{zoom:r,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let IA,AA,PA,MA;var Rb=er([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function kb(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Db(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Nb{constructor(e,r,l,c){this.context=e,this.format=l,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:c&&c.premultiply})}update(e,r){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:f}=p,{x,y:b}=r&&r.position?r.position:{x:0,y:0},S=x+l,I=b+c;!this.size||this.size[0]===S&&this.size[1]===I||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!r||r.premultiply!==!1));const A=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&I>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(S,I)))+1:1;f.texStorage2D(f.TEXTURE_2D,M,this.format,S,I),this.size=[S,I]}if(this.size)if(A)f.texSubImage2D(f.TEXTURE_2D,0,x,b,kb(this.format),Db(this.format),e);else{const M=e.data;M&&f.texSubImage2D(f.TEXTURE_2D,0,x,b,l,c,kb(this.format),Db(this.format),M)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r,l=!1){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,l,c,p){const{context:f}=this,{gl:x}=f;x.bindTexture(x.TEXTURE_2D,this.texture),r!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),this.wrapS=l),c!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapT=c),p!==this.compareMode&&(p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,p)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class m0{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:l}=this,{gl:c}=l;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}}function g0(n,e,r,l,c,p,f,x){const b=[n,e,1,r,l,1,c,p,1],S=[f,x,1],I=U([],b),[A,M,N]=Er(S,S,I);return he(b,b,[A,0,0,0,M,0,0,0,N])}function RA(n,e,r,l,c,p,f,x){const b=function(S,I,A,M,N,z,B,q){const K=g0(0,0,1,0,1,1,0,1),ne=g0(S,I,A,M,N,z,B,q);return he(ne,ne,U([],K))}(n,e,r,l,c,p,f,x);return[b[2]/b[8]/bt,b[5]/b[8]/bt]}function _0(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ke)]}class kA extends lc{constructor(e,r,l,c){super(),this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new ac("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Om(this.map._requestManager.transformRequest(this.url,Nh.Image),(l,c)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new wp(l)):c&&(this.image=c instanceof HTMLImageElement?Qo.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new m0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ac("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof m0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],l=e[0][1];for(const p of e)p[1]>l&&(l=p[1]),p[1]<r&&(r=p[1]);const c=(l+r)/2;if(c>Ke?this.onNorthPole=!0:c<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Re.fromLngLat);this.tileID=function(f){let x=1/0,b=1/0,S=-1/0,I=-1/0;for(const B of f)x=Math.min(x,B.x),b=Math.min(b,B.y),S=Math.max(S,B.x),I=Math.max(I,B.y);const A=Math.max(S-x,I-b),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),N=Math.pow(2,M);let z=Math.floor((x+S)/2*N);return z>1&&(z-=1),new bd(M,z,Math.floor((b+I)/2*N))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ac("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const ne=this.tiles[K];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=c_(new bd(0,0,0),this.map.transform.projection),l=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const ne=K[1].x-K[0].x,se=K[1].y-K[0].y,V=K[2].x-K[1].x,ee=K[2].y-K[1].y,ae=K[3].x-K[2].x,fe=K[3].y-K[2].y,Ae=K[0].x-K[3].x,Ee=K[0].y-K[3].y,Pe=ne*ee-V*se,De=V*fe-ae*ee,He=ae*Ee-Ae*fe,ut=Ae*se-ne*Ee;return Pe>0&&De>0&&He>0&&ut>0||Pe<0&&De<0&&He<0&&ut<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=c_(this.tileID,this.map.transform.projection),[p,f,x,b]=this.coordinates.map(K=>{const ne=c.projection.project(K[0],K[1]);return yA(c,ne)._round()});this.perspectiveTransform=RA(p.x,p.y,f.x,f.y,x.x,x.y,b.x,b.y);const S=this._boundsArray=new yu;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(f.x,f.y,bt,0),S.emplaceBack(b.x,b.y,0,bt),S.emplaceBack(x.x,x.y,bt,bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Rb.members),this.boundsSegments=fn.simpleSegment(0,0,4,2);const I=[],A=[_0((M=this.coordinates)[0]),_0(M[1]),_0(M[2]),_0(M[3])];var M;const[N,z,B,q]=function(K){let ne=K[0][0],se=ne,V=K[0][1],ee=V;for(let ae=1;ae<K.length;ae++)K[ae][0]<ne?ne=K[ae][0]:K[ae][0]>se&&(se=K[ae][0]),K[ae][1]<V?V=K[ae][1]:K[ae][1]>ee&&(ee=K[ae][1]);return[ne,V,se-ne,ee-V]}(A);{const K=new yu,[ne,se,V,ee]=function(Ze){let st=Ze[0].x,$e=st,We=Ze[0].y,gt=We;for(let yt=1;yt<Ze.length;yt++)Ze[yt].x<st?st=Ze[yt].x:Ze[yt].x>$e&&($e=Ze[yt].x),Ze[yt].y<We?We=Ze[yt].y:Ze[yt].y>gt&&(gt=Ze[yt].y);return[st,We,$e-st,gt-We]}(l),ae=Ze=>[(Ze.x-ne)/V,(Ze.y-se)/ee],[fe,Ae,Ee,Pe]=l.map(ae),De=function(Ze,st,$e,We,gt,yt,Xt,zt){const Tt=g0(0,0,1,0,1,1,0,1);return he(Tt,Tt,U([],g0(Ze,st,$e,We,gt,yt,Xt,zt)))}(fe[0],fe[1],Ae[0],Ae[1],Ee[0],Ee[1],Pe[0],Pe[1]);this.elevatedGlobePerspectiveTransform=RA(fe[0],fe[1],Ae[0],Ae[1],Ee[0],Ee[1],Pe[0],Pe[1]);const He=(Ze,st)=>{I.push(Ze.lng);const $e=Math.round((Ze.lng-N)/B*bt),We=Math.round((Ze.lat-z)/q*bt),gt=ae(st),yt=Er([],[gt[0],gt[1],1],De),Xt=Math.round(yt[0]/yt[2]*bt),zt=Math.round(yt[1]/yt[2]*bt);K.emplaceBack($e,We,Xt,zt)},ut=l[3].x-l[0].x,it=l[3].y-l[0].y,lt=l[2].x-l[1].x,ht=l[2].y-l[1].y;for(let Ze=0;Ze<65;Ze++){const st=Ze/64,$e=[l[0].x+st*ut,l[0].y+st*it],We=[l[1].x+st*lt,l[1].y+st*ht],gt=We[0]-$e[0],yt=We[1]-$e[1];for(let Xt=0;Xt<65;Xt++){const zt=Xt/64,Tt={x:$e[0]+gt*zt,y:$e[1]+yt*zt};He(r.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,Rb.members)}{this.maxLongitudeTriangleSize=0;let K=[],ne=new ls;const se=(V,ee,ae)=>{ne.emplaceBack(V,ee,ae);const fe=I[V],Ae=I[ee],Ee=I[ae],Pe=Math.min(Math.min(fe,Ae),Ee),De=Math.max(Math.max(fe,Ae),Ee)-Pe;De>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=De),K.push(Pe+De/2)};for(let V=0;V<64;V++)for(let ee=0;ee<64;ee++){const ae=65*V+ee,fe=ae+1,Ae=ae+65,Ee=Ae+1;se(ae,Ae,fe),se(fe,Ae,Ee)}[K,ne]=function(V,ee){const ae=Array.from({length:V.length},(Ee,Pe)=>Pe);ae.sort((Ee,Pe)=>V[Ee]-V[Pe]);const fe=[],Ae=new ls;for(let Ee=0;Ee<ae.length;Ee++){const Pe=ae[Ee];fe.push(V[Pe]);const De=3*Pe,He=De+1;Ae.emplaceBack(ee.uint16[De],ee.uint16[He],ee.uint16[He+1])}return[fe,Ae]}(K,ne),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ne)}this.elevatedGlobeSegments=fn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/bt,0,q/bt,0,0,z,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,l=r.gl;!this._dirty||this.texture instanceof m0||(this.texture?this.texture.update(this.image):(this.texture=new Nb(r,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let c=(p=e+180)+360*Math.round((l[0]-p)/360);var p;const f=new fn,x=(A,M)=>{f.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:r.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-c)<=b){const A=Jn(l,0,l.length,c+b);return A===l.length||x(A,sn(l,A+1,l.length,c+360-b)-A),f}c<l[0]&&(c+=360);const S=sn(l,0,l.length,c-b);if(S===l.length)return x(0,l.length),f;x(0,S-0);const I=Jn(l,S+1,l.length,c+b);return I!==l.length&&x(I,l.length-I),f}}const iO=(Math.pow(256,2)-1)/16907520;class DA extends Ss{constructor(e,r,l,c){super(e,{layout:PA||(PA=new hn({visibility:new ft(ze.layout_raster.visibility)})),paint:MA||(MA=new hn({"raster-opacity":new ft(ze.paint_raster["raster-opacity"]),"raster-color":new bc(ze.paint_raster["raster-color"]),"raster-color-mix":new ft(ze.paint_raster["raster-color-mix"]),"raster-color-range":new ft(ze.paint_raster["raster-color-range"]),"raster-hue-rotate":new ft(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(ze.paint_raster["raster-saturation"]),"raster-contrast":new ft(ze.paint_raster["raster-contrast"]),"raster-resampling":new ft(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(ze.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ft(ze.paint_raster["raster-emissive-strength"]),"raster-array-band":new ft(ze.paint_raster["raster-array-band"]),"raster-elevation":new ft(ze.paint_raster["raster-elevation"]),"raster-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},r,l,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof kA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[l,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(c)||l===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Gg({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,c])}}let NA,jA,zA,LA,FA;class OA extends Ss{constructor(e,r,l,c){super(e,{layout:NA||(NA=new hn({visibility:new ft(ze["layout_raster-particle"].visibility)})),paint:jA||(jA=new hn({"raster-particle-array-band":new ft(ze["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ft(ze["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new bc(ze["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ft(ze["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ft(ze["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ft(ze["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ft(ze["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ft(ze["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},r,l,c),this._updateColorRamp(),this.lastInvalidatedAt=Qo.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Gg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class rO extends Ss{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function jb(n,e,r){const l=[0,0,1],c=Co([]);return Os(c,c,r?-Qi(n)+Math.PI:Qi(n)),Io(c,c,-Qi(e)),wr(l,l,c),Hi(l,l)}function BA(n,e){const r=y0(n.projection,n.zoom,n.width,n.height),l=function(p,f,x,b,S){const I=new te(x.lng-180*Nu,x.lat),A=new te(x.lng+180*Nu,x.lat),M=p.project(I.lng,I.lat),N=p.project(A.lng,A.lat),z=-Math.atan2(N.y-M.y,N.x-M.x),B=Re.fromLngLat(x);B.y=ve(B.y,-1+Nu,1-Nu);const q=B.toLngLat(),K=p.project(q.lng,q.lat),ne=Re.fromLngLat(q);ne.x+=Nu;const se=ne.toLngLat(),V=p.project(se.lng,se.lat),ee=UA(V.x-K.x,V.y-K.y,z),ae=Re.fromLngLat(q);ae.y+=Nu;const fe=ae.toLngLat(),Ae=p.project(fe.lng,fe.lat),Ee=UA(Ae.x-K.x,Ae.y-K.y,z),Pe=Math.abs(ee.x)/Math.abs(Ee.y),De=Y([]);pt(De,De,-z*(1-(S?0:b)));const He=Y([]);return _e(He,He,[1,1-(1-Pe)*b,1]),He[4]=-Ee.x/Ee.y*b,pt(He,He,z),re(He,De,He),He}(n.projection,0,n.center,r,e),c=VA(n);return _e(l,l,[c,c,1]),l}function VA(n){const e=n.projection,r=y0(n.projection,n.zoom,n.width,n.height),l=zb(e,n.center),c=zb(e,te.convert(e.center));return Math.pow(2,l*r+(1-r)*c)}function y0(n,e,r,l,c=1/0){const p=n.range;if(!p)return 0;const f=Math.min(c,Math.max(r,l)),x=Math.log(f/1024)/Math.LN2;return ke(p[0]+x,p[1]+x,e)}const Nu=1/4e4;function zb(n,e){const r=ve(e.lat,-85.051129,Ke),l=new te(e.lng-180*Nu,r),c=new te(e.lng+180*Nu,r),p=n.project(l.lng,r),f=n.project(c.lng,r),x=Re.fromLngLat(l),b=Re.fromLngLat(c),S=f.x-p.x,I=f.y-p.y,A=b.x-x.x,M=b.y-x.y,N=Math.sqrt((A*A+M*M)/(S*S+I*I));return Math.log(N)/Math.LN2}function UA(n,e,r){const l=Math.cos(r),c=Math.sin(r);return{x:n*l-e*c,y:n*c+e*l}}function GA(n,e,r){Y(n),pt(n,n,Qi(e[2])),Ne(n,n,Qi(e[0])),Ge(n,n,Qi(e[1])),_e(n,n,r),re(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function x0(n,e,r,l,c,p,f,x){const b=[r[0]-e[0],r[1]-e[1],0],S=[l[0]-e[0],l[1]-e[1],0];if(xi(b)<1e-12||xi(S)<1e-12)return Co(n);const I=hi([],b,S);Hi(I,I),Zt(S,l,e),b[2]=(p-c)*x,S[2]=(f-c)*x;const A=b;return hi(A,b,S),Hi(A,A),Zo(n,I,A)}function Lb(n,e,r=!1){const l=Pu(e.zoom),c=function(p,f,x){const b=f.worldSize,S=[p[12],p[13],p[14]],I=Le(S[1]/b),A=Ce(S[0]/b),M=Y([]),N=Te(1,I)*b,z=Te(1,0)*b*at(I,f.zoom),B=1/$w(b);let q=z*B;if(x){const V=y0(f.projection,f.zoom,f.width,f.height,1024);q=B*f.projection.pixelSpaceConversion(f.center.lat,b,V)}const K=$(I,A);ui(K,K,Gt([],Hi([],K),N*q*S[2]));const ne=function(V){const ee=[V[0],V[1],V[2]];let ae=[0,1,0];const fe=hi([],ae,ee);return hi(ae,ee,fe),Ki(ae)===0&&(ae=[0,1,0],hi(fe,ee,ae)),Hi(fe,fe),Hi(ae,ae),Hi(ee,ee),[fe[0],fe[1],fe[2],0,ae[0],ae[1],ae[2],0,ee[0],ee[1],ee[2],0,V[0],V[1],V[2],1]}(K);_e(M,M,[q,q,q*N]),oe(M,M,[-S[0],-S[1],-S[2]]);const se=re([],f.globeMatrix,ne);return re(se,se,M),re(se,se,p),se}(n,e,r);if(l>0){const p=function(f,x){const b=x.worldSize,S=Te(1,0)*b*at(x.center.lat,x.zoom)/$w(b),I=Te(1,x.center.lat)*b,A=Y([]);return Ge(A,A,Qi(x.center.lng)),Ne(A,A,Qi(x.center.lat)),oe(A,A,[0,0,v]),_e(A,A,[S,S,S*I]),oe(A,A,[x.point.x-.5*b,x.point.y-.5*b,0]),re(A,A,f),re(A,x.globeMatrix,A)}(n,e);return function(f,x,b){const S=(z,B,q)=>{const K=xi(z),ne=xi(B),se=Cc(z,B,q);return Gt(se,se,1/xi(se)*si(K,ne,q))},I=S([f[0],f[1],f[2]],[x[0],x[1],x[2]],b),A=S([f[4],f[5],f[6]],[x[4],x[5],x[6]],b),M=S([f[8],f[9],f[10]],[x[8],x[9],x[10]],b),N=Cc([f[12],f[13],f[14]],[x[12],x[13],x[14]],b);return[I[0],I[1],I[2],0,A[0],A[1],A[2],0,M[0],M[1],M[2],0,N[0],N[1],N[2],1]}(c,p,l)}return c}function $A(n,e,r,l){const c=rr.projectAabbCorners(l,r);let p=Number.MAX_VALUE,f=-1;for(let S=0;S<c.length;++S){const I=c[S];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<p&&(f=S,p=I[2])}const x=S=>new wt(c[S][0],c[S][1]);let b;switch(f){case 0:case 6:b=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:b=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:b=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:b=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if($s(n,b))return p}const nO=er([{name:"a_pos_3f",components:3,type:"Float32"}]),sO=er([{name:"a_color_3f",components:3,type:"Float32"}]),oO=er([{name:"a_color_4f",components:4,type:"Float32"}]),aO=er([{name:"a_uv_2f",components:2,type:"Float32"}]),lO=er([{name:"a_normal_3f",components:3,type:"Float32"}]),cO=er([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uO=er([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),qA={None:0,Model:1,Symbol:2,FillExtrusion:4};class v0{constructor(e,r,l,c){this.message=(e?`${e}: `:"")+l,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Fb(n,e){const r=n.indexOf("://")===-1;try{return new URL(n,r&&e?"http://example.com":void 0),!0}catch{return!1}}class HA{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WA{constructor(){this.instancedDataArray=new Su,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Ob{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,r){}populate(e,r,l,c){this.tileToMeter=qe(l);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:x,index:b,sourceLayerIndex:S}of e){const I=x??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),A=Pt(f,p);if(!this.layers[0]._featureFilter.filter(new Cr(this.zoom,{worldview:this.worldview}),A,l))continue;const M={id:I,sourceLayerIndex:S,index:b,geometry:p?A.geometry:Dt(f,l,c),properties:f.properties,type:f.type,patterns:{}},N=this.addFeature(M,M.geometry,A);N&&r.featureIndex.insert(f,M.geometry,b,S,this.index,this.instancesPerModel[N].instancedDataArray.length,bt/32)}this.lookup=null}update(e,r,l,c){for(const p in this.instancesPerModel){const f=this.instancesPerModel[p];for(const x in e)f.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(f.features[f.idToFeaturesIndex[x]],e[x],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];for(const c of l.features){const p=this.layers[0],f=c.feature,x=this.canonical,b=p.paint.get("model-rotation").evaluate(f,{},x),S=p.paint.get("model-scale").evaluate(f,{},x),I=p.paint.get("model-translation").evaluate(f,{},x);nr(c.rotation,b)&&nr(c.scale,S)&&nr(c.translation,I)||(this.evaluate(c,c.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,r,l,c){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const p=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(ib(this.activeReplacements,p))return!1;this.activeReplacements=p;let f=!1;for(const x in this.instancesPerModel){const b=this.instancesPerModel[x],S=b.instancedDataArray;for(const I of b.features){const A=I.instancedDataOffset,M=I.instancedDataCount;for(let N=0;N<M;N++){const z=16*(N+A);let B=S.float32[z+0];const q=B>bt;B=q?B-bt:B;const K=Math.floor(B),ne=S.float32[z+1];let se=!1;for(const V of this.activeReplacements)if(!OC(V,l,qA.Model,c)&&!(V.min.x>K||K>V.max.x||V.min.y>ne||ne>V.max.y)&&(se=qC($C(K,ne,e.canonical,V.footprintTileId.canonical),V.footprint),se))break;S.float32[z]=se?B+bt:B,f=f||se!==q}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,cO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const l=this.instancesPerModel[r];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)e.removeModel(r,"",!0)}addFeature(e,r,l){const c=this.layers[0],p=c.layout.get("model-id").evaluate(l,{},this.canonical);if(!p)return Ei(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),p;(Fb(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new WA);const f=this.instancesPerModel[p],x=f.instancedDataArray,b=new HA(l,x.length);for(const S of r)for(const I of S){if(I.x<0||I.x>=bt||I.y<0||I.y>=bt)continue;const A=(this.lookupDim-1)/bt,M=this.lookupDim*(I.y*A|0)+I.x*A|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const N=x.length;x.resize(N+1),f.instancesEvaluatedElevation.push(0),x.float32[16*N]=I.x,x.float32[16*N+1]=I.y}return b.instancedDataCount=f.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(b),this.evaluate(b,{},f,!1)),p}getModelUris(){return this.modelUris}evaluate(e,r,l,c){const p=this.layers[0],f=e.feature,x=this.canonical,b=e.rotation=p.paint.get("model-rotation").evaluate(f,r,x),S=e.scale=p.paint.get("model-scale").evaluate(f,r,x),I=e.translation=p.paint.get("model-translation").evaluate(f,r,x),A=p.paint.get("model-color").evaluate(f,r,x);A.a=p.paint.get("model-color-mix-intensity").evaluate(f,r,x);const M=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),GA(M,b,S);const N=Math.round(100*A.a)+A.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const B=e.instancedDataOffset+z,q=16*B,K=l.instancedDataArray.float32;let ne=0;c&&(ne=K[q+6]-l.instancesEvaluatedElevation[B]);const se=0|K[q+1];K[q]=(0|K[q])+A.r/1.05,K[q+1]=se+A.g/1.05,K[q+2]=N,K[q+3]=1/(x.z>10?this.tileToMeter:qe(x,se)),K[q+4]=I[0],K[q+5]=I[1],K[q+6]=I[2]+ne,K[q+7]=M[0],K[q+8]=M[1],K[q+9]=M[2],K[q+10]=M[4],K[q+11]=M[5],K[q+12]=M[6],K[q+13]=M[8],K[q+14]=M[9],K[q+15]=M[10],l.instancesEvaluatedElevation[B]=I[2]}}}let ZA,XA;Rt(Ob,"ModelBucket",{omit:["layers"]}),Rt(WA,"PerModelAttributes"),Rt(HA,"ModelFeature");const Pd=64,If={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YA(n,e,r,l,c,p,f,x,b,S=!1){const I=r.zoom,A=r.project(l),M=at(l.lat,I),N=1/M;Y(n),oe(n,n,[A.x+f[0]*N,A.y+f[1]*N,f[2]]);let z=1,B=1;const q=r.worldSize;if(S){if(r.projection.name==="mercator"){let V=0;r.elevation&&(V=r.elevation.getAtPointOrZero(new Re(A.x/q,A.y/q),0));const ee=Ur([],[A.x,A.y,V,1],r.projMatrix)[3]/r.cameraToCenterDistance;z=ee,B=ee*at(r.center.lat,I)}else if(r.projection.name==="globe"){const V=Lb(n,r),ee=[0,0,0,1];Ur(ee,ee,re([],r.projMatrix,V));const ae=ee[3]/r.cameraToCenterDistance,fe=Pu(I),Ae=r.projection.pixelsPerMeter(l.lat,q)*at(l.lat,I),Ee=r.projection.pixelsPerMeter(r.center.lat,q)*at(r.center.lat,I);z=ae/si(Ae,Qe(r.center.lat),fe),B=ae*M/Ae,z*=Ee,B*=Ee}}else z=N;_e(n,n,[z,z,B]);const K=[...n],ne=e.orientation,se=[];if(GA(se,[ne[0]+c[0],ne[1]+c[1],ne[2]+c[2]],p),re(n,K,se),x&&r.elevation){let V=0;const ee=[];if(b&&r.elevation){V=function(fe,Ae,Ee,Pe,De){const He=Ae.elevation;if(!He)return 0;const ut=rr.projectAabbCorners(Ee,Pe),it=Te(1,De.lat)*Ae.worldSize,lt=function(mt,gi){const jt=[0,0,1],Lt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const oi of Lt){const Ti=mt[oi.corners[0]],bi=mt[oi.corners[1]],Li=mt[oi.corners[2]],Pi=[bi[0]-Ti[0],bi[1]-Ti[1],gi*(bi[2]-Ti[2])],Fi=hi(Pi,Pi,[Li[0]-Ti[0],Li[1]-Ti[1],gi*(Li[2]-Ti[2])]);Hi(Fi,Fi),oi.dotProductWithUp=Ii(Fi,jt)}return Lt.sort((oi,Ti)=>oi.dotProductWithUp-Ti.dotProductWithUp),Lt[0].corners}(ut,it),ht=ut[lt[0]],Ze=ut[lt[1]],st=ut[lt[2]],$e=ut[lt[3]],We=He.getAtPointOrZero(new Re(ht[0]/Ae.worldSize,ht[1]/Ae.worldSize),0),gt=He.getAtPointOrZero(new Re(Ze[0]/Ae.worldSize,Ze[1]/Ae.worldSize),0),yt=He.getAtPointOrZero(new Re(st[0]/Ae.worldSize,st[1]/Ae.worldSize),0),Xt=He.getAtPointOrZero(new Re($e[0]/Ae.worldSize,$e[1]/Ae.worldSize),0),zt=(We+Xt)/2,Tt=(gt+yt)/2;return zt>Tt?gt<yt?x0(fe,Ze,$e,ht,gt,Xt,We,it):x0(fe,st,ht,$e,yt,We,Xt,it):We<Xt?x0(fe,ht,Ze,st,We,gt,yt,it):x0(fe,$e,st,Ze,Xt,yt,gt,it),Math.max(zt,Tt)}(ee,r,e.aabb,n,l);const ae=re([],Bt([],ee),se);re(n,K,ae)}else V=r.elevation.getAtPointOrZero(new Re(A.x/q,A.y/q),0);V!==0&&(n[14]+=V)}}function f_(n,e,r=!1){n.uploaded||(n.gfxTexture=new Nb(e,n.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function hO(n,e,r){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,nO.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,lO.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,aO.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?sO:oO).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,uO.members,!0)),n.segments=fn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const l=n.material;l.pbrMetallicRoughness.baseColorTexture&&f_(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&f_(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&f_(l.normalTexture,e),l.occlusionTexture&&f_(l.occlusionTexture,e,r),l.emissionTexture&&f_(l.emissionTexture,e)}function Bb(n,e,r){if(n.meshes)for(const l of n.meshes)hO(l,e,r);if(n.children)for(const l of n.children)Bb(l,e,r)}function w0(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)w0(e)}function Vb(n){if(n.meshes)for(const r of n.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const r of n.children)Vb(r)}class Af{constructor(e,r,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=l}static create(e,r,l){const c=l||e.findDEMTileFor(r);if(!c||!c.dem)return;const p=c.dem,f=c.tileID,x=1<<r.canonical.z-f.canonical.z;return new Af(c,p.dim/bt/x,[(r.canonical.x/x-f.canonical.x)*p.dim,(r.canonical.y/x-f.canonical.y)*p.dim])}tileCoordToPixel(e,r){const l=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new wt(c,p)}getElevationAt(e,r,l,c){const p=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],x=Math.floor(p),b=Math.floor(f),S=this._dem;return c=!!c,l?si(si(S.get(x,b,c),S.get(x,b+1,c),f-b),si(S.get(x+1,b,c),S.get(x+1,b+1,c),f-b),p-x):S.get(x,b,c)}getElevationAtPixel(e,r,l){return this._dem.get(e,r,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Te(1,e)*this._dem.stride}}const Ub=new Float32Array(262144),Md=new Uint8Array(262144);function KA(n){let e=0;if(n.meshes)for(const r of n.meshes)e=Math.max(e,r.aabb.max[2]);if(n.children)for(const r of n.children)e=Math.max(e,KA(r));return e}function QA(n,e,r){if(n.meshes)for(const l of n.meshes){if(l.aabb.min[0]===1/0)continue;const c=rr.applyTransform(l.aabb,n.matrix);r.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const l of n.children)QA(l,e,r)}const JA=["","wall","door","roof","window","lamp","logo"];class eP{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:KA(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=rr.applyTransformFast(l.aabb,this.node.matrix),r.encapsulate(l.transformedAabb)),e++;this.aabb=r}return this.aabb}}class b0{constructor(e,r,l,c,p,f,x,b){this.id=l,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=If.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=If.HasMapboxMeshFeatures),p&&(this.modelTraits|=If.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of r)this.nodesInfo.push(new eP(S)),QA(S,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const l of this.getNodesInfo()){const c=l.node;c.footprint&&r.push({footprint:c.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const l=r?this.stateDependentLayers:this.layers;if(!Ko(e,this.states))for(const c of l)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const l of r){const c=l.node;this.uploaded?this.updatePbrBuffer(c):Bb(c,e,!0)}for(const l of r)w0(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),r=!0);return r}needsReEvaluation(e,r,l){const c=e.transform.projectionOptions,p=e.style.getBrightness(),f=this.brightness!==p;if(!this.uploaded||this.dirty||c.name!==this.projection.name||m_(l.paint.get("model-color").value,f)||m_(l.paint.get("model-color-mix-intensity").value,f)||m_(l.paint.get("model-roughness").value,f)||m_(l.paint.get("model-emissive-strength").value,f)||m_(l.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=c,this.brightness=p;const x=this.getNodesInfo();for(const b of x)b.state=null;return!0}return!1}evaluateTransform(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),c=this.id.canonical;for(const p of l){const f=p.feature;p.evaluatedTranslation=r.paint.get("model-translation").evaluate(f,{},c),p.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},c)}}evaluate(e,r){const l=this.getNodesInfo();for(const c of l){if(!c.node.meshes)continue;const p=c.feature,f=r&&r[p.id];if(Ko(f,c.state))continue;c.state=structuredClone(f);const x=c.node.meshes&&c.node.meshes[0].featureData,b=c.evaluatedColor[2],S=c.evaluatedRMEA[2],I=this.id.canonical;if(c.hasTranslucentParts=!1,x){for(let A=0;A<JA.length;A++){const M=JA[A];M.length&&(p.properties.part=M);const N=e.paint.get("model-color").evaluate(p,f,I).toPremultipliedRenderColor(null),z=e.paint.get("model-color-mix-intensity").evaluate(p,f,I);c.evaluatedColor[A]=[N.r,N.g,N.b,z],c.evaluatedRMEA[A][0]=e.paint.get("model-roughness").evaluate(p,f,I),c.evaluatedRMEA[A][2]=e.paint.get("model-emissive-strength").evaluate(p,f,I),c.evaluatedRMEA[A][3]=N.a,c.emissionHeightBasedParams[A]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,f,I),!c.hasTranslucentParts&&N.a<1&&(c.hasTranslucentParts=!0)}delete p.properties.part,pO(c,b!==c.evaluatedColor[2]||S!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,f,I);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,f,I),c.evaluatedScale=e.paint.get("model-scale").evaluate(p,f,I),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,l,c){const p=e.findDEMTileFor(l);if(p&&(p.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const f=Af.create(e,l,p);if(!f)return;this.modelTraits&If.HasMapboxMeshFeatures&&this.updateDEM(e,f,l,c);for(const x of this.getNodesInfo()){const b=x.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let I=f.getElevationAt(S[0].x,S[0].y,!0,!0);for(let A=1;A<S.length;A++)I=Math.min(I,f.getElevationAt(S[A].x,S[A].y,!0,!0));b.elevation=I}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,l,c){let p=r._dem._modifiedForSources[c];if(p===void 0&&(r._dem._modifiedForSources[c]=[],p=r._dem._modifiedForSources[c]),p.includes(l.canonical))return;const f=r._dem.dim;p.push(l.canonical);let x=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const I=S.footprint.grid,A=r.tileCoordToPixel(I.min.x,I.min.y),M=r.tileCoordToPixel(I.max.x,I.max.y),N=Math.min(Math.min(f-M.y,A.x),Math.min(A.y,f-M.x));if(N<0)continue;const z=ve(N,2,5);let B=Math.max(0,A.x-z),q=Math.max(0,A.y-z),K=Math.min(M.x+z,f-1),ne=Math.min(M.y+z,f-1);for(let ae=q;ae<=ne;++ae)for(let fe=B;fe<=K;++fe)Md[ae*f+fe]=255;let se=0,V=0;for(let ae=0;ae<I.cellsY;++ae)for(let fe=0;fe<I.cellsX;++fe){if(!I.cells[ae*I.cellsX+fe])continue;const Ae=r.tileCoordToPixel(I.min.x+fe/I.xScale,I.min.y+ae/I.yScale),Ee=r.tileCoordToPixel(I.min.x+(fe+1)/I.xScale,I.min.y+(ae+1)/I.yScale);for(let Pe=Ae.y;Pe<=Math.min(Ee.y+1,f-1);++Pe)for(let De=Ae.x;De<=Math.min(Ee.x+1,f-1);++De)Md[Pe*f+De]===255&&(Md[Pe*f+De]=0,se+=r.getElevationAtPixel(De,Pe),V++)}const ee=se/V;B=Math.max(1,A.x-z),q=Math.max(1,A.y-z),K=Math.min(M.x+z,f-2),ne=Math.min(M.y+z,f-2),x=!0;for(let ae=q;ae<=ne;++ae)for(let fe=B;fe<=K;++fe)Md[ae*f+fe]===0&&(Ub[ae*f+fe]=r._dem.set(fe,ae,ee));for(let ae=1;ae<z;++ae){B=Math.max(1,A.x-ae),q=Math.max(1,A.y-ae),K=Math.min(M.x+ae,f-2),ne=Math.min(M.y+ae,f-2);for(let fe=q;fe<=ne;++fe)for(let Ae=B;Ae<=K;++Ae){const Ee=fe*f+Ae;if(Md[Ee]===255){let Pe=0,De=0,He=-1,ut=-1;for(let it=-1;it<=1;++it)for(let lt=-1;lt<=1;++lt){const ht=(fe+it)*f+Ae+lt;if(Md[ht]>=ae)continue;const Ze=Ub[ht],st=Math.abs(Ze);st>De&&(Pe=Ze,De=st,He=lt,ut=it)}if(De>.1){const it=1-(ae+.5*Math.abs(He*ut))/z;let lt=r._dem.get(Ae,fe)+Pe*it;const ht=r._dem.get(Ae+He,fe+ut),Ze=r._dem.get(Ae-He,fe-ut,!0);(lt-ht)*(lt-Ze)>0&&(lt=(ht+Ze)/2),Ub[Ee]=r._dem.set(Ae,fe,lt),Md[Ee]=ae}}}}}x&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=Qo.now())}setFilter(e){this.filter=e?wg(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Cr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)w0(r.node),Vb(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const p=c.node.footprint;c.hiddenByReplacement=!!p&&!l.find(f=>f.footprint===p)}}getHeightAtTileCoord(e,r){const l=[],c=[0,0,0],p=Y([]);for(const f of this.getNodesInfo()){const x=f.node.meshes[0],b=x.transformedAabb;if(e<b.min[0]||r<b.min[1]||e>b.max[0]||r>b.max[1])continue;if(f.node.hidden===!0)return{height:1/0,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};le(p,f.node.matrix),c[0]=e,c[1]=r,ji(c,c,p);const S=(c[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Pd|0,I=Math.min(63,(c[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Pd|0)*Pd+Math.min(63,S),A=x.heightmap[I];if(!(A<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:A,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new wt(e,r),new wt(e,r),l),l.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function m_(n,e){return n instanceof id&&!n.isLightConstant&&e}function dO(n,e,r,l,c,p,f,x){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;r[3]>0&&(b=si(b,255*r[0],r[3]),S=si(S,255*r[1],r[3]),I=si(I,255*r[2],r[3]));const A=b<<8|S,M=I<<8|Math.floor(255*l[3]),N=function(ae){const fe=ve(ae,0,2);return Math.min(Math.round(.5*fe*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],z=ve(c[0],0,1),B=ve(c[1],0,1),q=ve(c[2],0,1),K=ve(c[3],0,1);let ne,se,V,ee;if(z!==B&&f!==p&&B!==z){const ae=f-p;se=1/(ae*(B-z)),V=-(p+ae*z)/(ae*(B-z));const fe=ve(c[4],-1,1);ee=Math.pow(10,fe),ne=255*q<<8|255*K}else ne=65535,se=0,V=1,ee=1;if(n.emplaceBack(A,M,N,ne,se,V,ee),x){const ae=x.length;x.clear();for(let fe=0;fe<ae;fe++)x.emplaceBack(A,M,N,ne,se,V,ee)}}function pO(n,e,r){const l=n.node;let c=0;const p=r&If.HasMeshoptCompression;for(const f of l.meshes){if(l.lights&&l.lightMeshIndex===c||!f.featureData)continue;f.featureArray=new fd,f.featureArray.reserve(f.featureData.length);let x=e;for(const b of f.featureData){const S=p?65535&b:b>>16&65535,I=p?b>>16&65535:65535&b,A=(15&I)<8?15&I:0,M=n.evaluatedRMEA[A],N=n.evaluatedColor[A],z=n.emissionHeightBasedParams[A];let B;if(x&&A===2&&l.lights&&(B=new fd,B.resize(10*l.lights.length)),dO(f.featureArray,S,N,M,z,f.aabb.min[2],f.aabb.max[2],B),B&&x){x=!1;const q=l.meshes[l.lightMeshIndex];q.featureArray=B,q.featureArray._trim()}}f.featureArray._trim(),c++}}function tP(n,e,r,l){const c=1<<n.z;e.lat=Le((l/bt+n.y)/c),e.lng=Ce((r/bt+n.x)/c)}function fO(n,e,r,l){const c=n.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let p=Number.MAX_VALUE;const f=c.node,x=r.tile,b=l.calculatePosMatrix(x.tileID.toUnwrapped(),l.worldSize),S=c.evaluatedScale;let I=0;l.elevation&&f.elevation&&(I=f.elevation*l.elevation.exaggeration()),oe(b,b,[(f.anchor?f.anchor[0]:0)*(S[0]-1),(f.anchor?f.anchor[1]:0)*(S[1]-1),I]),_e(b,b,S);const A=r.queryGeometry,M=A.isPointQuery()?A.screenBounds:A.screenGeometry,N=function(B){const q=re([],b,B.matrix);re(q,l.expandedFarZProjMatrix,q);for(let K=0;K<B.meshes.length;++K){const ne=B.meshes[K];if(K===B.lightMeshIndex)continue;const se=$A(M,l,q,ne.aabb);se!=null&&(p=Math.min(se,p))}if(B.children)for(const K of B.children)N(K)};if(N(f),p===Number.MAX_VALUE)return;const z=new te(0,0);return tP(x.tileID.canonical,z,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:p,position:z,feature:c.feature}}Rt(b0,"Tiled3dModelBucket",{omit:["layers"]}),Rt(eP,"Tiled3dModelFeature");const mO={circle:class extends Ss{constructor(n,e,r,l){super(n,{layout:JE||(JE=new hn({"circle-sort-key":new At(ze.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ft(ze.layout_circle["circle-elevation-reference"]),visibility:new ft(ze.layout_circle.visibility)})),paint:eC||(eC=new hn({"circle-radius":new At(ze.paint_circle["circle-radius"]),"circle-color":new At(ze.paint_circle["circle-color"]),"circle-blur":new At(ze.paint_circle["circle-blur"]),"circle-opacity":new At(ze.paint_circle["circle-opacity"]),"circle-translate":new ft(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(ze.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ft(ze.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}createBucket(n){return new Lo(n)}queryRadius(n){const e=n;return gf("circle-radius",this,e)+gf("circle-stroke-width",this,e)+Nx(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,l,c,p,f,x){const b=QE(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return pC(n,l,p,f,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,r){const l=dC(this);return{config:new Cu(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ss{createBucket(n){return new mC(n)}constructor(n,e,r,l){super(n,{layout:gC||(gC=new hn({visibility:new ft(ze.layout_heatmap.visibility)})),paint:_C||(_C=new hn({"heatmap-radius":new At(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bc(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(ze.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return gf("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,l,c,p,f,x){const b=this.paint.get("heatmap-radius").evaluate(e,r);return pC(n,l,p,f,x,!0,!0,new wt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,r){return n==="heatmap"?{config:new Cu(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Ss{constructor(n,e,r,l){super(n,{layout:yC||(yC=new hn({visibility:new ft(ze.layout_hillshade.visibility)})),paint:xC||(xC=new hn({"hillshade-illumination-direction":new ft(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(ze.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ft(ze.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,r){return{overrideFog:!1}}},fill:class extends Ss{constructor(n,e,r,l){super(n,{layout:NC||(NC=new hn({"fill-sort-key":new At(ze.layout_fill["fill-sort-key"]),visibility:new ft(ze.layout_fill.visibility),"fill-elevation-reference":new ft(ze.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new At(ze.layout_fill["fill-construct-bridge-guard-rail"])})),paint:jC||(jC=new hn({"fill-antialias":new ft(ze.paint_fill["fill-antialias"]),"fill-opacity":new At(ze.paint_fill["fill-opacity"]),"fill-color":new At(ze.paint_fill["fill-color"]),"fill-outline-color":new At(ze.paint_fill["fill-outline-color"]),"fill-translate":new ft(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new At(ze.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ft(ze.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ft(ze.paint_fill["fill-emissive-strength"]),"fill-z-offset":new At(ze.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new At(ze.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new At(ze.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(n,e,r){return{config:new Cu(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Jw(n)}queryRadius(){return Nx(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,l,c,p){return!n.queryGeometry.isAboveHorizon&&sa(KE(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ss{constructor(n,e,r,l){super(n,{layout:oI||(oI=new hn({visibility:new ft(ze["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ft(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:aI||(aI=new hn({"fill-extrusion-opacity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new At(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ft(ze["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new At(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ft(ze["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ft(ze["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ft(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new At(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new At(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ft(ze["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ft(ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ft(ze["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new At(ze["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new At(ze["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ft(ze["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Wx(n)}queryRadius(){return Nx(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,r,l,c,p,f,x,b){const S=QE(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],N=x&&p.elevation,z=p.elevation?p.elevation.exaggeration():1,B=n.tile.getBucket(this);if(N&&B instanceof Wx){const V=B.centroidVertexArray,ee=b+1;ee<V.length&&(M[0]=V.geta_centroid_pos0(ee),M[1]=V.geta_centroid_pos1(ee))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(l=sI([l],[new wt(0,0),new wt(bt,bt)],n.tileID.canonical).map(V=>V.polygon).flat());const q=N?x:null,[K,ne]=function(V,ee,ae,fe,Ae,Ee,Pe,De,He,ut,it){return V.projection.name==="globe"?function(lt,ht,Ze,st,$e,We,gt,yt,Xt,zt,Tt){const mt=[],gi=[],jt=lt.projection.upVectorScale(Tt,lt.center.lat,lt.worldSize).metersToTile,Lt=[0,0,0,1],oi=[0,0,0,1],Ti=(Li,Pi,Fi,gr)=>{Li[0]=Pi,Li[1]=Fi,Li[2]=gr,Li[3]=1},bi=nI();Ze>0&&(Ze+=bi),st+=bi;for(const Li of ht){const Pi=[],Fi=[];for(const gr of Li){const Fr=gr.x+$e.x,ue=gr.y+$e.y,ge=lt.projection.projectTilePoint(Fr,ue,Tt),Ye=lt.projection.upVector(Tt,gr.x,gr.y);let vt=Ze,Et=st;if(gt){const St=pI(Fr,ue,Ze,st,gt,yt,Xt,zt);vt+=St.base,Et+=St.top}Ze!==0?Ti(Lt,ge.x+Ye[0]*jt*vt,ge.y+Ye[1]*jt*vt,ge.z+Ye[2]*jt*vt):Ti(Lt,ge.x,ge.y,ge.z),Ti(oi,ge.x+Ye[0]*jt*Et,ge.y+Ye[1]*jt*Et,ge.z+Ye[2]*jt*Et),ji(Lt,Lt,We),ji(oi,oi,We),Pi.push(new Ed(Lt[0],Lt[1],Lt[2])),Fi.push(new Ed(oi[0],oi[1],oi[2]))}mt.push(Pi),gi.push(Fi)}return[mt,gi]}(V,ee,ae,fe,Ae,Ee,Pe,De,He,ut,it):Pe?function(lt,ht,Ze,st,$e,We,gt,yt,Xt){const zt=[],Tt=[],mt=[0,0,0,1];for(const gi of lt){const jt=[],Lt=[];for(const oi of gi){const Ti=oi.x+st.x,bi=oi.y+st.y,Li=pI(Ti,bi,ht,Ze,We,gt,yt,Xt);mt[0]=Ti,mt[1]=bi,mt[2]=Li.base,mt[3]=1,Ur(mt,mt,$e),mt[3]=Math.max(mt[3],1e-5);const Pi=new Ed(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);mt[0]=Ti,mt[1]=bi,mt[2]=Li.top,mt[3]=1,Ur(mt,mt,$e),mt[3]=Math.max(mt[3],1e-5);const Fi=new Ed(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);jt.push(Pi),Lt.push(Fi)}zt.push(jt),Tt.push(Lt)}return[zt,Tt]}(ee,ae,fe,Ae,Ee,Pe,De,He,ut):function(lt,ht,Ze,st,$e){const We=[],gt=[],yt=$e[8]*ht,Xt=$e[9]*ht,zt=$e[10]*ht,Tt=$e[11]*ht,mt=$e[8]*Ze,gi=$e[9]*Ze,jt=$e[10]*Ze,Lt=$e[11]*Ze;for(const oi of lt){const Ti=[],bi=[];for(const Li of oi){const Pi=Li.x+st.x,Fi=Li.y+st.y,gr=$e[0]*Pi+$e[4]*Fi+$e[12],Fr=$e[1]*Pi+$e[5]*Fi+$e[13],ue=$e[2]*Pi+$e[6]*Fi+$e[14],ge=$e[3]*Pi+$e[7]*Fi+$e[15],Ye=gr+yt,vt=Fr+Xt,Et=ue+zt,St=Math.max(ge+Tt,1e-5),Nt=gr+mt,ni=Fr+gi,Vi=ue+jt,Ui=Math.max(ge+Lt,1e-5);Ti.push(new Ed(Ye/St,vt/St,Et/St)),bi.push(new Ed(Nt/Ui,ni/Ui,Vi/Ui))}We.push(Ti),gt.push(bi)}return[We,gt]}(ee,ae,fe,Ae,Ee)}(p,l,A,I,S,f,q,M,z,p.center.lat,n.tileID.canonical),se=n.queryGeometry;return function(V,ee,ae){let fe=1/0;sa(ae,ee)&&(fe=dI(ae,ee[0]));for(let Ae=0;Ae<ee.length;Ae++){const Ee=ee[Ae],Pe=V[Ae];for(let De=0;De<Ee.length-1;De++){const He=Ee[De],ut=[He,Ee[De+1],Pe[De+1],Pe[De],He];$s(ae,ut)&&(fe=Math.min(fe,dI(ae,ut)))}}return fe!==1/0&&fe}(K,ne,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends Ss{constructor(n,e,r,l){super(n,{layout:EI||(EI=new hn({visibility:new ft(ze.layout_building.visibility),"building-roof-shape":new At(ze.layout_building["building-roof-shape"]),"building-height":new At(ze.layout_building["building-height"]),"building-base":new At(ze.layout_building["building-base"])})),paint:CI||(CI=new hn({"building-opacity":new ft(ze.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new ft(ze.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new ft(ze.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ft(ze.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ft(ze.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ft(ze.paint_building["building-vertical-scale"]),"building-cast-shadows":new ft(ze.paint_building["building-cast-shadows"]),"building-color":new At(ze.paint_building["building-color"]),"building-emissive-strength":new At(ze.paint_building["building-emissive-strength"]),"building-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new TI(n)}},line:class extends Ss{constructor(n,e,r,l){const c=zI();super(n,c,e,r,l),c.layout&&(this.layout=new wc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Xh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(r_)return r_;const r=zI();return r_=new dF(r.paint.properties["line-width"].specification),r_.useIntegerZoom=!0,r_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new db(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,r){const l=NI(this);return{config:new Cu(this,{zoom:e,lut:r}),defines:l,overrideFog:!1}}queryRadius(n){const e=n,r=LI(gf("line-width",this,e),gf("line-gap-width",this,e)),l=gf("line-offset",this,e);return r/2+Math.abs(l)+Nx(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,l,c,p){if(n.queryGeometry.isAboveHorizon)return!1;const f=KE(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*LI(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(l=function(S,I){const A=[],M=new wt(0,0);for(let N=0;N<S.length;N++){const z=S[N],B=[];for(let q=0;q<z.length;q++){const K=z[q],ne=z[q+1],se=q===0?M:K.sub(z[q-1])._unit()._perp(),V=q===z.length-1?M:ne.sub(K)._unit()._perp(),ee=se._add(V)._unit();ee._mult(1/(ee.x*V.x+ee.y*V.y)),B.push(ee._mult(I)._add(K))}A.push(B)}return A}(l,b*n.pixelToTileUnitsFactor)),function(S,I,A){for(let M=0;M<I.length;M++){const N=I[M];if(S.length>=3){for(let z=0;z<N.length;z++)if(Ea(S,N[z]))return!0}if(Dl(S,N,A))return!0}return!1}(f,l,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:f0,background:class extends Ss{constructor(n,e,r,l){super(n,{layout:IA||(IA=new hn({visibility:new ft(ze.layout_background.visibility)})),paint:AA||(AA=new hn({"background-pitch-alignment":new ft(ze.paint_background["background-pitch-alignment"]),"background-color":new ft(ze.paint_background["background-color"]),"background-pattern":new ft(ze.paint_background["background-pattern"]),"background-opacity":new ft(ze.paint_background["background-opacity"]),"background-emissive-strength":new ft(ze.paint_background["background-emissive-strength"]),"background-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,r){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:DA,"raster-particle":OA,sky:class extends Ss{constructor(n,e,r,l){super(n,{layout:zA||(zA=new hn({visibility:new ft(ze.layout_sky.visibility)})),paint:LA||(LA=new hn({"sky-type":new ft(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new ft(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ft(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ft(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ft(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new bc(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ft(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ft(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ft(ze.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),c=!l,p=n.style.light,f=p.properties.get("position");return c&&p.properties.get("anchor")==="viewport"&&Ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?jb(f.azimuthal,90-f.polar,e):jb(l[0],90-l[1],e)}const r=this.paint.get("sky-gradient-center");return jb(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Ss{constructor(n,e,r,l){super(n,{paint:FA||(FA=new hn({}))},e,null)}},model:class extends Ss{constructor(n,e,r,l){super(n,{layout:ZA||(ZA=new hn({visibility:new ft(ze.layout_model.visibility),"model-id":new At(ze.layout_model["model-id"])})),paint:XA||(XA=new hn({"model-opacity":new At(ze.paint_model["model-opacity"]),"model-rotation":new At(ze.paint_model["model-rotation"]),"model-scale":new At(ze.paint_model["model-scale"]),"model-translation":new At(ze.paint_model["model-translation"]),"model-color":new At(ze.paint_model["model-color"]),"model-color-mix-intensity":new At(ze.paint_model["model-color-mix-intensity"]),"model-type":new ft(ze.paint_model["model-type"]),"model-cast-shadows":new ft(ze.paint_model["model-cast-shadows"]),"model-receive-shadows":new ft(ze.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ft(ze.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new At(ze.paint_model["model-emissive-strength"]),"model-roughness":new At(ze.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new At(ze.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ft(ze.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ft(ze.paint_model["model-front-cutoff"]),"model-color-use-theme":new At({type:"string",default:"default","property-type":"data-driven"})}))},e,r,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Ob(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof b0?bt-1:0}queryIntersectsFeature(n,e,r,l,c,p){if(!this.modelManager)return!1;const f=this.modelManager,x=n.tile.getBucket(this);if(!(x&&x instanceof Ob))return!1;for(const b in x.instancesPerModel){const S=x.instancesPerModel[b],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(I)){const A=S.features[S.idToFeaturesIndex[I]],M=f.getModel(b,this.scope);if(!M)return!1;let N=de();const z=new te(0,0),B=x.canonical;let q=Number.MAX_VALUE;for(let K=0;K<A.instancedDataCount;++K){const ne=16*(A.instancedDataOffset+K),se=S.instancedDataArray.float32,V=[se[ne+4],se[ne+5],se[ne+6]];tP(B,z,se[ne],0|se[ne+1]),YA(N,M,p,z,A.rotation,A.scale,V,!1,!1,!1),p.projection.name==="globe"&&(N=Lb(N,p));const ee=re([],p.projMatrix,N),ae=n.queryGeometry,fe=$A(ae.isPointQuery()?ae.screenBounds:ae.screenGeometry,p,ee,M.aabb);fe!=null&&(q=Math.min(fe,q))}return q!==Number.MAX_VALUE&&q}}return!1}_handleOverridablePaintPropertyUpdate(n,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof rd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ss{constructor(n,e,r,l){super(n,{layout:zC||(zC=new hn({"clip-layer-types":new ft(ze.layout_clip["clip-layer-types"]),"clip-layer-scope":new ft(ze.layout_clip["clip-layer-scope"])})),paint:LC||(LC=new hn({}))},e,r,l)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new FC(n)}is3D(n){return!0}}},Gb=new pr(0,0,0),$b={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},qb={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},S0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},gO={PAINT_ORDER_FILL_AND_STROKE:1},g_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},iP={MASK_TYPE_LUMINANCE:1};function _O(n,e,r){n===1&&e.icons.push(function(l,c){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:f}=p;if(f.content_area){const{content_area:x}=f;x.top==null&&(x.top=x.left),x.width==null&&(x.width=p.usvg_tree.width),x.height==null&&(x.height=x.width)}return f.stretch_x&&f.stretch_x.length&&rP(f,"x"),f.stretch_y&&f.stretch_y.length&&rP(f,"y"),p}(l.readFields(yO,{name:void 0},c))}(r,r.readVarint()+r.pos))}function rP(n,e){const r=[],l=n[`stretch_${e}`];let c=null;for(let p=0;p<l.length;p++)c===null?c=r.length===0?l[0]:r[r.length-1][1]+l[p]:(r.push([c,c+l[p]]),c=null);n[`stretch_${e}_areas`]=r}function yO(n,e,r){n===1?e.name=r.readString():n===2?e.metadata=function(l,c){return l.readFields(xO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(r,r.readVarint()+r.pos):n===3&&(e.usvg_tree=function(l,c){return l.readFields(bO,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function xO(n,e,r){n===1?e.stretch_x=r.readPackedVarint():n===2?e.stretch_y=r.readPackedVarint():n===3?e.content_area=function(l,c){return l.readFields(vO,{left:0},c)}(r,r.readVarint()+r.pos):n===4&&e.variables.push(function(l,c){return l.readFields(wO,{name:void 0},c)}(r,r.readVarint()+r.pos))}function vO(n,e,r){n===1?e.left=r.readVarint():n===2?e.width=r.readVarint():n===3?e.top=r.readVarint():n===4&&(e.height=r.readVarint())}function wO(n,e,r){n===1?e.name=r.readString():n===2&&(e.rgb_color=C0(r.readVarint()),e.value="rgb_color")}function bO(n,e,r){n===1?e.width=e.height=r.readVarint():n===2?e.height=r.readVarint():n===3?e.children.push(T0(r,r.readVarint()+r.pos)):n===4?e.linear_gradients.push(function(l,c){return l.readFields(PO,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(r,r.readVarint()+r.pos)):n===5?e.radial_gradients.push(function(l,c){return l.readFields(RO,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(r,r.readVarint()+r.pos)):n===7?e.clip_paths.push(function(l,c){return l.readFields(kO,{children:[]},c)}(r,r.readVarint()+r.pos)):n===8&&e.masks.push(function(l,c){const p=l.readFields(DO,{left:0,width:20,mask_type:iP.MASK_TYPE_LUMINANCE,children:[]},c);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(r,r.readVarint()+r.pos))}function T0(n,e){return n.readFields(SO,{},e)}function SO(n,e,r){n===1?(e.group=function(l,c){return l.readFields(TO,{opacity:255,children:[]},c)}(r,r.readVarint()+r.pos),e.node="group"):n===2&&(e.path=function(l,c){return l.readFields(CO,{paint_order:1,commands:[],step:1,diffs:[],rule:$b.PATH_RULE_NON_ZERO},c)}(r,r.readVarint()+r.pos),e.node="path")}function TO(n,e,r){n===1?e.transform=E0(r,r.readVarint()+r.pos):n===2?e.opacity=r.readVarint():n===5?e.clip_path_idx=r.readVarint():n===6?e.mask_idx=r.readVarint():n===7&&e.children.push(T0(r,r.readVarint()+r.pos))}function E0(n,e){return n.readFields(EO,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function EO(n,e,r){n===1?e.sx=r.readFloat():n===2?e.ky=r.readFloat():n===3?e.kx=r.readFloat():n===4?e.sy=r.readFloat():n===5?e.tx=r.readFloat():n===6&&(e.ty=r.readFloat())}function CO(n,e,r){n===1?e.fill=function(l,c){return l.readFields(IO,{rgb_color:Gb,paint:"rgb_color",opacity:255},c)}(r,r.readVarint()+r.pos):n===2?e.stroke=function(l,c){return l.readFields(AO,{rgb_color:Gb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(r,r.readVarint()+r.pos):n===3?e.paint_order=r.readVarint():n===5?r.readPackedVarint(e.commands):n===6?e.step=r.readFloat():n===7?r.readPackedSVarint(e.diffs):n===8&&(e.rule=r.readVarint())}function IO(n,e,r){n===1?(e.rgb_color=C0(r.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=r.readVarint())}function C0(n){return new pr((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function AO(n,e,r){n===1?(e.rgb_color=C0(r.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):n===5?r.readPackedFloat(e.dasharray):n===6?e.dashoffset=r.readFloat():n===7?e.miterlimit=r.readFloat():n===8?e.opacity=r.readVarint():n===9?e.width=r.readFloat():n===10?e.linecap=r.readVarint():n===11&&(e.linejoin=r.readVarint())}function PO(n,e,r){n===1?e.transform=E0(r,r.readVarint()+r.pos):n===2?e.spread_method=r.readVarint():n===3?e.stops.push(nP(r,r.readVarint()+r.pos)):n===4?e.x1=r.readFloat():n===5?e.y1=r.readFloat():n===6?e.x2=r.readFloat():n===7&&(e.y2=r.readFloat())}function nP(n,e){return n.readFields(MO,{offset:0,opacity:255,rgb_color:Gb},e)}function MO(n,e,r){n===1?e.offset=r.readFloat():n===2?e.opacity=r.readVarint():n===3&&(e.rgb_color=C0(r.readVarint()))}function RO(n,e,r){n===1?e.transform=E0(r,r.readVarint()+r.pos):n===2?e.spread_method=r.readVarint():n===3?e.stops.push(nP(r,r.readVarint()+r.pos)):n===4?e.cx=r.readFloat():n===5?e.cy=r.readFloat():n===6?e.r=r.readFloat():n===7?e.fx=r.readFloat():n===8?e.fy=r.readFloat():n===9&&(e.fr=r.readFloat())}function kO(n,e,r){n===1?e.transform=E0(r,r.readVarint()+r.pos):n===2?e.clip_path_idx=r.readVarint():n===3&&e.children.push(T0(r,r.readVarint()+r.pos))}function DO(n,e,r){n===1?e.left=e.top=r.readFloat():n===2?e.width=e.height=r.readFloat():n===3?e.top=r.readFloat():n===4?e.height=r.readFloat():n===5?e.mask_type=r.readVarint():n===6?e.mask_idx=r.readVarint():n===7&&e.children.push(T0(r,r.readVarint()+r.pos))}class NO{static calculate(e={},r=[]){const l=new Map,c=new Map;if(Object.keys(e).length===0)return l;r.forEach(p=>{c.set(p.name,p.rgb_color||new pr(0,0,0))});for(const[p,f]of Object.entries(e))c.has(p)?l.set(c.get(p).toString(),f):console.warn(`Ignoring unknown image variable "${p}"`);return l}}function Pf(n,e=255,r){const l=e/255,c=n.toString(),p=r.has(c)?r.get(c).clone():n.clone();return p.a*=l,p.toString()}function __(n,e){if(!_p()){const r=document.createElement("canvas");return r.width=n,r.height=e,r}return new OffscreenCanvas(n,e)}function jO(n,e){const r=NO.calculate(e.params,n.metadata?n.metadata.variables:[]),l=n.usvg_tree,c=l.width,p=l.height,f=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(c*f.a)),b=Math.max(1,Math.round(p*f.d)),S=new DOMMatrix([x/c,0,0,b/p,0,0]),I=__(x,b).getContext("2d");return Hb(I,S,l,l,r),I.getImageData(0,0,x,b)}function Hb(n,e,r,l,c){for(const p of l.children)sP(n,e,r,p,c)}function sP(n,e,r,l,c){l.group?(n.save(),function(p,f,x,b,S){const I=b.mask_idx!=null?x.masks[b.mask_idx]:null,A=b.clip_path_idx!=null?x.clip_paths[b.clip_path_idx]:null;if(b.transform&&(f=Mf(b.transform).preMultiplySelf(f)),!function(z,B,q){return z.opacity!==255||B||q}(b,A!=null,I!=null))return void Hb(p,f,x,b,S);const M=__(p.canvas.width,p.canvas.height),N=M.getContext("2d");Hb(N,f,x,b,S),A&&dP(N,f,x,A),I&&pP(N,f,x,I,S),p.globalAlpha=b.opacity/255,p.drawImage(M,0,0)}(n,e,r,l.group,c),n.restore()):l.path&&(n.save(),function(p,f,x,b,S){p.setTransform(f),b.paint_order===gO.PAINT_ORDER_FILL_AND_STROKE?(oP(p,x,b,S),lP(p,x,b,S)):(lP(p,x,b,S),oP(p,x,b,S))}(n,e,r,l.path,c),n.restore())}function oP(n,e,r,l){const c=r.fill;if(!c)return;const p=c.opacity/255;switch(n.save(),n.beginPath(),fP(r,n),c.paint){case"rgb_color":n.fillStyle=Pf(c.rgb_color,c.opacity,l);break;case"linear_gradient_idx":{const f=e.linear_gradients[c.linear_gradient_idx];f.transform&&n.setTransform(Mf(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=cP(n,f,p,l);break}case"radial_gradient_idx":{const f=e.radial_gradients[c.radial_gradient_idx];f.transform&&n.setTransform(Mf(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=uP(n,f,p,l)}}n.fill(aP(r)),n.restore()}function aP(n){return n.rule===$b.PATH_RULE_NON_ZERO?"nonzero":n.rule===$b.PATH_RULE_EVEN_ODD?"evenodd":void 0}function lP(n,e,r,l){const c=r.stroke;if(!c)return;const p=mP(r);n.lineWidth=c.width,n.miterLimit=c.miterlimit,n.setLineDash(c.dasharray),n.lineDashOffset=c.dashoffset;const f=c.opacity/255;switch(c.paint){case"rgb_color":n.strokeStyle=Pf(c.rgb_color,c.opacity,l);break;case"linear_gradient_idx":n.strokeStyle=cP(n,e.linear_gradients[c.linear_gradient_idx],f,l,!0);break;case"radial_gradient_idx":n.strokeStyle=uP(n,e.radial_gradients[c.radial_gradient_idx],f,l,!0)}switch(c.linejoin){case S0.LINE_JOIN_MITER_CLIP:case S0.LINE_JOIN_MITER:n.lineJoin="miter";break;case S0.LINE_JOIN_ROUND:n.lineJoin="round";break;case S0.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(c.linecap){case qb.LINE_CAP_BUTT:n.lineCap="butt";break;case qb.LINE_CAP_ROUND:n.lineCap="round";break;case qb.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(p)}function cP(n,e,r,l,c=!1){if(e.stops.length===1){const M=e.stops[0];return Pf(M.rgb_color,M.opacity*r,l)}const{x1:p,y1:f,x2:x,y2:b}=e;let S=new DOMPoint(p,f),I=new DOMPoint(x,b);if(c){const M=Mf(e.transform);S=M.transformPoint(S),I=M.transformPoint(I)}const A=n.createLinearGradient(S.x,S.y,I.x,I.y);for(const M of e.stops)A.addColorStop(M.offset,Pf(M.rgb_color,M.opacity*r,l));return A}function uP(n,e,r,l,c=!1){if(e.stops.length===1){const K=e.stops[0];return Pf(K.rgb_color,K.opacity*r,l)}const p=Mf(e.transform),{fx:f,fy:x,fr:b,cx:S,cy:I,r:A}=e;let M=new DOMPoint(f,x),N=new DOMPoint(S,I),z=b,B=A;if(c){M=p.transformPoint(M),N=p.transformPoint(N);const K=(p.a+p.d)/2;z=b*K,B=e.r*K}const q=n.createRadialGradient(M.x,M.y,z,N.x,N.y,B);for(const K of e.stops)q.addColorStop(K.offset,Pf(K.rgb_color,K.opacity*r,l));return q}function hP(n,e,r,l){const c=l.transform?Mf(l.transform).preMultiplySelf(e):e,p=__(n.canvas.width,n.canvas.height),f=p.getContext("2d");for(const b of l.children)if(b.group)hP(f,c,r,b.group);else if(b.path){const S=b.path,I=new Path2D;I.addPath(mP(S),c),f.fill(I,aP(S))}const x=l.clip_path_idx!=null?r.clip_paths[l.clip_path_idx]:null;x&&dP(f,c,r,x),n.globalCompositeOperation="source-over",n.drawImage(p,0,0)}function dP(n,e,r,l){const c=__(n.canvas.width,n.canvas.height);hP(c.getContext("2d"),e,r,l),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function pP(n,e,r,l,c){if(l.children.length===0)return;const p=l.mask_idx!=null?r.masks[l.mask_idx]:null;p&&pP(n,e,r,p,c);const f=n.canvas.width,x=n.canvas.height,b=__(f,x),S=b.getContext("2d"),I=l.width,A=l.height,M=l.left,N=l.top,z=new Path2D,B=new Path2D;B.rect(M,N,I,A),z.addPath(B,e),S.clip(z);for(const ne of l.children)sP(S,e,r,ne,c);const q=S.getImageData(0,0,f,x),K=q.data;if(l.mask_type===iP.MASK_TYPE_LUMINANCE)for(let ne=0;ne<K.length;ne+=4)K[ne+3]=K[ne+3]/255*(.2126*K[ne]+.7152*K[ne+1]+.0722*K[ne+2]);S.putImageData(q,0,0),n.globalCompositeOperation="destination-in",n.drawImage(b,0,0)}function Mf(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function fP(n,e){const r=n.step;let l=n.diffs[0]*r,c=n.diffs[1]*r;e.moveTo(l,c);for(let p=0,f=2;p<n.commands.length;p++)switch(n.commands[p]){case g_.PATH_COMMAND_MOVE:l+=n.diffs[f++]*r,c+=n.diffs[f++]*r,e.moveTo(l,c);break;case g_.PATH_COMMAND_LINE:l+=n.diffs[f++]*r,c+=n.diffs[f++]*r,e.lineTo(l,c);break;case g_.PATH_COMMAND_QUAD:{const x=l+n.diffs[f++]*r,b=c+n.diffs[f++]*r;l=x+n.diffs[f++]*r,c=b+n.diffs[f++]*r,e.quadraticCurveTo(x,b,l,c);break}case g_.PATH_COMMAND_CUBIC:{const x=l+n.diffs[f++]*r,b=c+n.diffs[f++]*r,S=x+n.diffs[f++]*r,I=b+n.diffs[f++]*r;l=S+n.diffs[f++]*r,c=I+n.diffs[f++]*r,e.bezierCurveTo(x,b,S,I,l,c);break}case g_.PATH_COMMAND_CLOSE:e.closePath()}return e}function mP(n){return fP(n,new Path2D)}class I0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}Rt(I0,"LRUCache");class Wb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ps(e,e.data)}getFromCache(e,r,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new I0(150)),this.cacheMap.get(l).get(Sc(e.toString(),r))}setInCache(e,r,l,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new I0(150));const p=this.cacheDependenciesMap.get(c),f=Sc(e.id.toString(),l);p.get(f)||p.set(f,new Set);const x=this.cacheMap.get(c),b=e.toString();p.get(f).add(b),x.put(Sc(e.toString(),l),r)}removeImagesFromCacheByIds(e,r,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const c=this.cacheMap.get(l),p=this.cacheDependenciesMap.get(l);for(const f of e){const x=Sc(f.toString(),r);if(p.has(x)){for(const b of p.get(x))c.delete(b);p.delete(x)}}}rasterize(e,r,l,c,p=jO){const f=this.getFromCache(e,l,c);if(f)return f.clone();const x=p(r.icon,e.options),b=Wb._getImage(x);return this.setInCache(e,b,l,c),b.clone()}}class gP{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const l=this.toIdx(e,r);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function _P(n,e,r,l){let c=0,p=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(l[f])<1e-15){if(r[f]<n[f]||r[f]>e[f])return null}else{const x=1/l[f];let b=(n[f]-r[f])*x,S=(e[f]-r[f])*x;if(b>S){const I=b;b=S,S=I}if(b>c&&(c=b),S<p&&(p=S),c>p)return null}return c}function yP(n,e,r,l,c,p,f,x,b,S,I){const A=l-n,M=c-e,N=p-r,z=f-n,B=x-e,q=b-r,K=I[1]*q-I[2]*B,ne=I[2]*z-I[0]*q,se=I[0]*B-I[1]*z,V=A*K+M*ne+N*se;if(Math.abs(V)<1e-15)return null;const ee=1/V,ae=S[0]-n,fe=S[1]-e,Ae=S[2]-r,Ee=(ae*K+fe*ne+Ae*se)*ee;if(Ee<0||Ee>1)return null;const Pe=fe*N-Ae*M,De=Ae*A-ae*N,He=ae*M-fe*A,ut=(I[0]*Pe+I[1]*De+I[2]*He)*ee;return ut<0||Ee+ut>1?null:(z*Pe+B*De+q*He)*ee}function xP(n,e,r){return(n-e)/(r-e)}function vP(n,e,r,l,c,p,f,x,b){const S=1<<r,I=p-l,A=f-c,M=(n+1)/S*I+l,N=(e+0)/S*A+c,z=(e+1)/S*A+c;x[0]=(n+0)/S*I+l,x[1]=N,b[0]=M,b[1]=z}class wP{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(p){const f=Math.ceil(Math.log2(p.dim/8)),x=[];let b=Math.ceil(Math.pow(2,f));const S=1/b,I=(N,z,B,q,K)=>{const ne=q?1:0,se=(N+1)*B-ne,V=z*B,ee=(z+1)*B-ne;K[0]=N*B,K[1]=V,K[2]=se,K[3]=ee};let A=new gP(b);const M=[];for(let N=0;N<b*b;N++){I(N%b,Math.floor(N/b),S,!1,M);const z=ju(M[0],M[1],p),B=ju(M[2],M[1],p),q=ju(M[2],M[3],p),K=ju(M[0],M[3],p);A.minimums.push(Math.min(z,B,q,K)),A.maximums.push(Math.max(z,B,q,K)),A.leaves.push(1)}for(x.push(A),b/=2;b>=1;b/=2){const N=x[x.length-1];A=new gP(b);for(let z=0;z<b*b;z++){I(z%b,Math.floor(z/b),2,!0,M);const B=N.getElevation(M[0],M[1]),q=N.getElevation(M[2],M[1]),K=N.getElevation(M[2],M[3]),ne=N.getElevation(M[0],M[3]),se=N.isLeaf(M[0],M[1]),V=N.isLeaf(M[2],M[1]),ee=N.isLeaf(M[2],M[3]),ae=N.isLeaf(M[0],M[3]),fe=Math.min(B.min,q.min,K.min,ne.min),Ae=Math.max(B.max,q.max,K.max,ne.max),Ee=se&&V&&ee&&ae;A.maximums.push(Ae),A.minimums.push(fe),A.leaves.push(Ae-fe<=5&&Ee?1:0)}x.push(A)}return x}(this.dem),l=r.length-1,c=r[l];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,l,0)}raycastRoot(e,r,l,c,p,f,x=1){return _P([e,r,-100],[l,c,this.maximums[0]*x],p,f)}raycast(e,r,l,c,p,f,x=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,l,c,p,f,x);if(b==null)return null;const S=[],I=[],A=[],M=[],N=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:z,t:B,nodex:q,nodey:K,depth:ne}=N.pop();if(this.leaves[z]){vP(q,K,ne,e,r,l,c,A,M);const V=1<<ne,ee=(q+0)/V,ae=(q+1)/V,fe=(K+0)/V,Ae=(K+1)/V,Ee=ju(ee,fe,this.dem)*x,Pe=ju(ae,fe,this.dem)*x,De=ju(ae,Ae,this.dem)*x,He=ju(ee,Ae,this.dem)*x,ut=yP(A[0],A[1],Ee,M[0],A[1],Pe,M[0],M[1],De,p,f),it=yP(M[0],M[1],De,A[0],M[1],He,A[0],A[1],Ee,p,f),lt=Math.min(ut!==null?ut:Number.MAX_VALUE,it!==null?it:Number.MAX_VALUE);if(lt!==Number.MAX_VALUE)return lt;{const ht=ti([],p,f,B);if(bP(Ee,Pe,He,De,xP(ht[0],A[0],M[0]),xP(ht[1],A[1],M[1]))>=ht[2])return B}continue}let se=0;for(let V=0;V<this._siblingOffset.length;V++){vP((q<<1)+this._siblingOffset[V][0],(K<<1)+this._siblingOffset[V][1],ne+1,e,r,l,c,A,M),A[2]=-100,M[2]=this.maximums[this.childOffsets[z]+V]*x;const ee=_P(A,M,p,f);if(ee!=null){const ae=ee;S[V]=ae;let fe=!1;for(let Ae=0;Ae<se&&!fe;Ae++)ae>=S[I[Ae]]&&(I.splice(Ae,0,V),fe=!0);fe||(I[se]=V),se++}}for(let V=0;V<se;V++){const ee=I[V];N.push({idx:this.childOffsets[z]+ee,t:S[ee],nodex:(q<<1)+this._siblingOffset[ee][0],nodey:(K<<1)+this._siblingOffset[ee][1],depth:ne+1})}}return null}_addNode(e,r,l){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,l,c,p){if(e[c].isLeaf(r,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const f=c-1,x=e[f];let b=0,S=0;for(let I=0;I<this._siblingOffset.length;I++){const A=2*r+this._siblingOffset[I][0],M=2*l+this._siblingOffset[I][1],N=x.getElevation(A,M),z=x.isLeaf(A,M),B=this._addNode(N.min,N.max,z);z&&(b|=1<<I),S||(S=B)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(e,2*r+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],f,S+I)}}function bP(n,e,r,l,c,p){return si(si(n,r,p),si(e,l,p),c)}function ju(n,e,r){const l=r.dim,c=ve(n*l-.5,0,l-1),p=ve(e*l-.5,0,l-1),f=Math.floor(c),x=Math.floor(p),b=Math.min(f+1,l-1),S=Math.min(x+1,l-1);return bP(r.get(f,x),r.get(b,x),r.get(f,S),r.get(b,S),c-f,p-x)}const zO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function LO(n,e,r){return(256*n*256+256*e+r)/10-1e4}function FO(n,e,r){return 256*n+e+r/256-32768}class A0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,l,c=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Ei(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let b=0;b<p;b++)f[this._idx(-1,b)]=f[this._idx(0,b)],f[this._idx(p,b)]=f[this._idx(p-1,b)],f[this._idx(b,-1)]=f[this._idx(b,0)],f[this._idx(b,p)]=f[this._idx(b,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)]}const x=l==="terrarium"?FO:LO;for(let b=0;b<f.length;++b){const S=4*b;this.floatView[b]=x(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Qo.now()}_buildQuadTree(){this._tree=new wP(this)}get(e,r,l=!1){l&&(e=ve(e,-1,this.dim),r=ve(r,-1,this.dim));const c=this._idx(e,r);return this.floatView[c]}set(e,r,l){const c=this._idx(e,r),p=this.floatView[c];return this.floatView[c]=l,l-p}static getUnpackVector(e){return zO[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const l=[0,0,0,0],c=A0.getUnpackVector(r);let p=Math.floor((e+c[3])/c[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new bC({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,p=r*this.dim+this.dim,f=l*this.dim,x=l*this.dim+this.dim;switch(r){case-1:c=p-1;break;case 1:p=c+1}switch(l){case-1:f=x-1;break;case 1:x=f+1}const b=-r*this.dim,S=-l*this.dim;for(let I=f;I<x;I++)for(let A=c;A<p;A++){const M=4*this._idx(A,I),N=4*this._idx(A+b,I+S);this.pixels[M+0]=e.pixels[N+0],this.pixels[M+1]=e.pixels[N+1],this.pixels[M+2]=e.pixels[N+2],this.pixels[M+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function OO(n,e,r){n===1?e.headerLength=r.readFixed32():n===2?e.x=r.readVarint():n===3?e.y=r.readVarint():n===4?e.z=r.readVarint():n===5&&e.layers.push(function(l,c){return l.readFields($O,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(r,r.readVarint()+r.pos))}function BO(n,e,r){n===1?(e.delta_filter=function(l,c){return l.readFields(VO,{blockSize:0},c)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):n===2?(r.readVarint(),e.filter="zigzag_filter"):n===3?(r.readVarint(),e.filter="bitshuffle_filter"):n===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function VO(n,e,r){n===1&&(e.blockSize=r.readVarint())}function UO(n,e,r){n===1?(r.readVarint(),e.codec="gzip_data"):n===2?(r.readVarint(),e.codec="jpeg_image"):n===3?(r.readVarint(),e.codec="webp_image"):n===4&&(r.readVarint(),e.codec="png_image")}function GO(n,e,r){let l=0,c=0;n===1?e.firstByte=r.readFixed64():n===2?e.lastByte=r.readFixed64():n===3?e.filters.push(function(p,f){return p.readFields(BO,{},f)}(r,r.readVarint()+r.pos)):n===4?e.codec=function(p,f){return p.readFields(UO,{},f)}(r,r.readVarint()+r.pos):n===5?c=r.readFloat():n===6?l=r.readFloat():n===7?e.bands.push(r.readString()):n===8?e.offset=r.readDouble():n===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=l)}function $O(n,e,r){n===1?e.version=r.readVarint():n===2?e.name=r.readString():n===3?e.units=r.readString():n===4?e.tileSize=r.readVarint():n===5?e.buffer=r.readVarint():n===6?e.pixelFormat=r.readVarint():n===7&&e.dataIndex.push(function(l,c){return l.readFields(GO,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(r,r.readVarint()+r.pos))}function qO(n,e,r){if(n===2)(function(l,c,p){l.readFields(HO,p,c)})(r,r.readVarint()+r.pos,e);else if(n===3)throw new Error("Not implemented")}function HO(n,e,r){if(n===1){let l=0;const c=r.readVarint()+r.pos;for(;r.pos<c;)e[l++]=r.readVarint()}}function WO(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let l=2;l>=1;l--){const c=l===1?1:0,p=l===2?1:0;for(let f=0;f<e[0];f++){const x=e[1]*f;for(let b=c;b<e[1];b++){const S=e[2]*(b+x);for(let I=p;I<e[2];I++){const A=e[3]*(I+S);for(let M=0;M<e[3];M++){const N=A+M;n[N]+=n[N-r]}}}}r*=e[l]}return n}function ZO(n){for(let e=0,r=n.length;e<r;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function XO(n,e){switch(e){case"uint32":return n;case"uint16":for(let r=0;r<n.length;r+=2){const l=n[r],c=n[r+1];n[r]=(240&l)>>4|(61440&l)>>8|(240&c)<<4|61440&c,n[r+1]=15&l|(3840&l)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let r=0;r<n.length;r+=4){const l=n[r],c=n[r+1],p=n[r+2],f=n[r+3];n[r+0]=(192&l)>>6|(192&c)>>4|(192&p)>>2|192&f,n[r+1]=(48&l)>>4|(48&c)>>2|48&p|(48&f)<<2,n[r+2]=(12&l)>>2|12&c|(12&p)<<2|(12&f)<<4,n[r+3]=3&l|(3&c)<<2|(3&p)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Rt(A0,"DEMData"),Rt(wP,"DemMinMaxQuadTree",{omit:["dem"]});var oa=Uint8Array,y_=Uint16Array,YO=Int32Array,SP=new oa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),TP=new oa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),KO=new oa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),EP=function(n,e){for(var r=new y_(31),l=0;l<31;++l)r[l]=e+=1<<n[l-1];var c=new YO(r[30]);for(l=1;l<30;++l)for(var p=r[l];p<r[l+1];++p)c[p]=p-r[l]<<5|l;return{b:r,r:c}},CP=EP(SP,2),IP=CP.b,QO=CP.r;IP[28]=258,QO[258]=28;for(var JO=EP(TP,0).b,AP=new y_(32768),Bn=0;Bn<32768;++Bn){var Rf=(43690&Bn)>>1|(21845&Bn)<<1;AP[Bn]=((65280&(Rf=(61680&(Rf=(52428&Rf)>>2|(13107&Rf)<<2))>>4|(3855&Rf)<<4))>>8|(255&Rf)<<8)>>1}var x_=function(n,e,r){for(var l=n.length,c=0,p=new y_(e);c<l;++c)n[c]&&++p[n[c]-1];var f,x=new y_(e);for(c=1;c<e;++c)x[c]=x[c-1]+p[c-1]<<1;f=new y_(1<<e);var b=15-e;for(c=0;c<l;++c)if(n[c])for(var S=c<<4|n[c],I=e-n[c],A=x[n[c]-1]++<<I,M=A|(1<<I)-1;A<=M;++A)f[AP[A]>>b]=S;return f},v_=new oa(288);for(Bn=0;Bn<144;++Bn)v_[Bn]=8;for(Bn=144;Bn<256;++Bn)v_[Bn]=9;for(Bn=256;Bn<280;++Bn)v_[Bn]=7;for(Bn=280;Bn<288;++Bn)v_[Bn]=8;var PP=new oa(32);for(Bn=0;Bn<32;++Bn)PP[Bn]=5;var e4=x_(v_,9),t4=x_(PP,5),Zb=function(n){for(var e=n[0],r=1;r<n.length;++r)n[r]>e&&(e=n[r]);return e},Ja=function(n,e,r){var l=e/8|0;return(n[l]|n[l+1]<<8)>>(7&e)&r},Xb=function(n,e){var r=e/8|0;return(n[r]|n[r+1]<<8|n[r+2]<<16)>>(7&e)},i4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],el=function(n,e,r){var l=new Error(e||i4[n]);if(l.code=n,Error.captureStackTrace&&Error.captureStackTrace(l,el),!r)throw l;return l},r4=new oa(0),n4=typeof TextDecoder<"u"&&new TextDecoder;try{n4.decode(r4,{stream:!0})}catch{}const s4={gzip_data:"gzip"};class Ca extends Error{constructor(e){super(e),this.name="MRTError"}}const o4={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},MP={uint32:1,uint16:2,uint8:4},a4={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Yb;class P0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new Ca(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),l=new DataView(e);if(r[0]!==13)throw new Ca("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),l=this.getHeaderLength(e);if(r.length<l)throw new Ca(`Expected header with length >= ${l} but got buffer of length ${r.length}`);const c=function(p,f){return p.readFields(OO,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Yb(r.subarray(0,l)));if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new Ca(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const p of c.layers)this.layers[p.name]=new RP(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],l=this.getLayer(e.layerName);for(let c of e.blockIndices){const p=l.dataIndex[c],f=p.firstByte-e.firstByte,x=p.lastByte-e.firstByte;if(l._blocksInProgress.has(c))continue;const b={layerName:l.name,firstByte:f,lastByte:x,pixelFormat:l.pixelFormat,blockIndex:c,blockShape:[p.bands.length].concat(l.bandShape),buffer:l.buffer,codec:p.codec.codec,filters:p.filters.map(S=>S.filter)};l._blocksInProgress.add(c),r.push(b)}return new kP(r,()=>{r.forEach(c=>l._blocksInProgress.delete(c.blockIndex))},(c,p)=>{if(r.forEach(f=>l._blocksInProgress.delete(f.blockIndex)),c)throw c;p.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class RP{constructor({version:e,name:r,units:l,tileSize:c,pixelFormat:p,buffer:f,dataIndex:x},b){if(this.version=e,this.version!==1)throw new Ca(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=l,this.tileSize=c,this.buffer=f,this.pixelFormat=o4[p],this.dataIndex=x,this.bandShape=[c+2*f,c+2*f,MP[this.pixelFormat]],this._decodedBlocks=new I0(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return MP[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[l,c]of this.dataIndex.entries()){for(const[p,f]of c.bands.entries())if(f===e)return{bandIndex:r+p,blockIndex:l,blockBandIndex:p};r+=c.bands.length}break;case"number":for(const[l,c]of this.dataIndex.entries()){if(e>=r&&e<r+c.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-r};r+=c.bands.length}break;default:throw new Ca(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,l=-1/0;const c=[],p=new Set;for(const f of e){const{blockIndex:x}=this.getBlockForBand(f);if(x<0)throw new Ca(`Invalid band: ${JSON.stringify(f)}`);const b=this.dataIndex[x];c.includes(x)||c.push(x),p.add(x),r=Math.min(r,b.firstByte),l=Math.max(l,b.lastByte)}if(p.size>this.cacheSize)throw new Ca(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:l,blockIndices:c}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:l}=this.getBlockForBand(e);if(r<0)throw new Ca(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(r.toString());if(!c)throw new Ca(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[r],f=this.bandShape.reduce((S,I)=>S*I,1),x=l*f,b=c.subarray(x,x+f);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}P0.setPbf=function(n){Yb=n};class kP{constructor(e,r,l){this.tasks=e,this._onCancel=r,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}function Rd(n,e){const r=n.json.bufferViews[e.bufferView],l=Yx[e.componentType];return new l(n.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==i_[e.type]*l.BYTES_PER_ELEMENT?r.byteStride/l.BYTES_PER_ELEMENT:i_[e.type]))}function Kb(n,e,r,l){const c=Yx[e.componentType],p=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),f=n.json.bufferViews[e.bufferView],x=f.byteStride?f.byteStride/c.BYTES_PER_ELEMENT:i_[e.type],b=r.float32,S=b.length/r.capacity;for(let I=0,A=0;I<e.count*x;I+=x,A+=S)for(let M=0;M<S;M++)b[A+M]=l[I+M]*p;r._trim()}function l4(n,e,r){const l=n.indices,c=n.attributes,p={};p.indexArray=new ls;const f=e.json.accessors[l],x=f.count/3;p.indexArray.reserve(x);const b=Rd(e,f);for(let M=0;M<x;M++)p.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);p.indexArray._trim(),p.vertexArray=new ba;const S=e.json.accessors[c.POSITION];p.vertexArray.reserve(S.count);const I=Rd(e,S);for(let M=0;M<S.count;M++)p.vertexArray.emplaceBack(I[3*M],I[3*M+1],I[3*M+2]);if(p.vertexArray._trim(),p.aabb=new rr(S.min,S.max),p.centroid=function(M,N){const z=[0,0,0],B=M.length;if(B>0){for(let q=0;q<B;q++){const K=3*M[q];z[0]+=N[K],z[1]+=N[K+1],z[2]+=N[K+2]}z[0]/=B,z[1]/=B,z[2]/=B}return z}(b,I),c.COLOR_0!==void 0){const M=e.json.accessors[c.COLOR_0],N=i_[M.type],z=Rd(e,M);p.colorArray=N===3?new ba:new as,p.colorArray.resize(M.count),Kb(e,M,p.colorArray,z)}if(c.NORMAL!==void 0){p.normalArray=new ba;const M=e.json.accessors[c.NORMAL];p.normalArray.resize(M.count);const N=Rd(e,M);Kb(e,M,p.normalArray,N)}if(c.TEXCOORD_0!==void 0&&r.length>0){p.texcoordArray=new Tc;const M=e.json.accessors[c.TEXCOORD_0];p.texcoordArray.resize(M.count);const N=Rd(e,M);Kb(e,M,p.texcoordArray,N)}if(c._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Rd(e,M))}c._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Rd(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const A=n.material;return p.material=function(M,N){const{emissiveFactor:z=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:q=.5,normalTexture:K,occlusionTexture:ne,emissiveTexture:se,doubleSided:V}=M,{baseColorFactor:ee=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:fe=1,baseColorTexture:Ae,metallicRoughnessTexture:Ee}=M.pbrMetallicRoughness||{},Pe=ne?N[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&Pe){const De=ne.extensions.KHR_texture_transform;Pe.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new pr(...ee),metallicFactor:ae,roughnessFactor:fe,baseColorTexture:Ae?N[Ae.index]:void 0,metallicRoughnessTexture:Ee?N[Ee.index]:void 0},doubleSided:V,emissiveFactor:new pr(...z),alphaMode:B,alphaCutoff:q,normalTexture:K?N[K.index]:void 0,occlusionTexture:Pe,emissionTexture:se?N[se.index]:void 0,defined:M.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},r),p}function DP(n,e,r){const{matrix:l,rotation:c,translation:p,scale:f,mesh:x,extras:b,children:S}=n,I={};if(I.matrix=l||function(A,M,N,z){var B=M[0],q=M[1],K=M[2],ne=M[3],se=B+B,V=q+q,ee=K+K,ae=B*se,fe=B*V,Ae=B*ee,Ee=q*V,Pe=q*ee,De=K*ee,He=ne*se,ut=ne*V,it=ne*ee,lt=z[0],ht=z[1],Ze=z[2];return A[0]=(1-(Ee+De))*lt,A[1]=(fe+it)*lt,A[2]=(Ae-ut)*lt,A[3]=0,A[4]=(fe-it)*ht,A[5]=(1-(ae+De))*ht,A[6]=(Pe+He)*ht,A[7]=0,A[8]=(Ae+ut)*Ze,A[9]=(Pe-He)*Ze,A[10]=(1-(ae+Ee))*Ze,A[11]=0,A[12]=N[0],A[13]=N[1],A[14]=N[2],A[15]=1,A}([],c||[0,0,0,1],p||[0,0,0],f||[1,1,1]),x!==void 0){I.meshes=r[x];const A=I.anchor=[0,0];for(const M of I.meshes){const{min:N,max:z}=M.aabb;A[0]+=N[0]+z[0],A[1]+=N[1]+z[1]}A[0]=Math.floor(A[0]/I.meshes.length/2),A[1]=Math.floor(A[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=function(A){if(!A.length)return[];const M=function(K){const ne=atob(K),se=new Uint8Array(ne.length);for(let V=0;V<ne.length;V++)se[V]=ne.codePointAt(V);return se}(A),N=[],z=M.length/24,B=new Uint16Array(M.buffer),q=new Float32Array(M.buffer);for(let K=0;K<z;K++){const ne=B[2*K*6]/30,se=B[2*K*6+1]/30,V=B[2*K*6+10]/100,ee=q[6*K+1],ae=q[6*K+2],fe=q[6*K+3],Ae=q[6*K+4],Ee=fe-ee,Pe=Ae-ae,De=Math.hypot(Ee,Pe);N.push({pos:[ee+.5*Ee,ae+.5*Pe,se],normal:[Pe/De,-Ee/De,0],width:De,height:ne,depth:V,points:[ee,ae,fe,Ae]})}return N}(b.lights))),S){const A=[];for(const M of S)A.push(DP(e.json.nodes[M],e,r));I.children=A}return I}function c4(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new eb(n.vertices,n.indices,8,256),[r,l]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:r,max:l}}function u4(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const l=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const x=f[0],b=f[1];typeof x=="number"&&typeof b=="number"&&l.push(new wt(x,b))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let c=0;for(let f=0;f<l.length;f++){const x=l[f],b=l[(f+1)%l.length],S=l[(f+2)%l.length];c+=(x.x-b.x)*(S.y-b.y)-(S.x-b.x)*(x.y-b.y)}c>0&&l.reverse();const p=$g(l.flatMap(f=>[f.x,f.y]),[]);return p.length===0?null:{vertices:l,indices:p}}function h4(n,e){const r=[],l=[];let c=0;const p=[];for(const f of n){c=r.length;const x=f.vertexArray.float32,b=f.indexArray.uint16;for(let S=0;S<f.vertexArray.length;S++)p[0]=x[3*S+0],p[1]=x[3*S+1],p[2]=x[3*S+2],ji(p,p,e),r.push(new wt(p[0],p[1]));for(let S=0;S<3*f.indexArray.length;S++)l.push(b[S]+c)}if(l.length%3!=0)return null;for(let f=0;f<l.length;f+=3){const x=r[l[f+0]],b=r[l[f+1]],S=r[l[f+2]];(x.x-b.x)*(S.y-b.y)-(S.x-b.x)*(x.y-b.y)>0&&([l[f+1],l[f+2]]=[l[f+2],l[f+1]])}return{vertices:r,indices:l}}function NP(n){const e=function(b,S){const I=[],A=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const N={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};M.sampler!==void 0&&Object.assign(N,b.json.samplers[M.sampler]),I.push({image:S[M.source],sampler:N,uploaded:!1})}return I}(n,n.images),r=function(b,S){const I=[];for(const A of b.json.meshes){const M=[];for(const N of A.primitives)M.push(l4(N,b,S));I.push(M)}return I}(n,e),{scenes:l,scene:c,nodes:p}=n.json,f=l?l[c||0].nodes:p,x=[];for(const b of f)x.push(DP(p[b],n,r));return function(b,S,I){const A={},M=new Set;for(let N=0;N<b.length;N++){const z=I[S[N]];if(!z.extras)continue;const B=z.extras["mapbox:footprint:version"],q=z.extras["mapbox:footprint:id"];(B||q)&&M.add(N),B==="1.0.0"&&q&&(A[q]=N)}for(let N=0;N<b.length;N++){if(M.has(N))continue;const z=b[N],B=I[S[N]];if(!B.extras)continue;let q=null;z.id in A&&(q=h4(b[A[z.id]].meshes,z.matrix)),q||(q=u4(B)),q&&(z.footprint=c4(q))}if(M.size>0){const N=Array.from(M.values()).sort((z,B)=>z-B);for(let z=N.length-1;z>=0;z--)b.splice(N[z],1)}}(x,f,n.json.nodes),x}function d4(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,r=n.aabb.min[0]-1,l=n.aabb.min[1]-1,c=Pd/(n.aabb.max[0]-r+2),p=Pd/(n.aabb.max[1]-l+2);for(let f=0;f<e.length;f+=3){const x=e[f+2],b=(e[f+0]-r)*c|0,S=(e[f+1]-l)*p|0;x>n.heightmap[S*Pd+b]&&(n.heightmap[S*Pd+b]=x)}}function p4(n,e){const r={};r.indexArray=new ls,r.indexArray.reserve(4*n.length),r.vertexArray=new ba,r.vertexArray.reserve(10*n.length),r.colorArray=new as,r.vertexArray.reserve(10*n.length);let l=0;for(const f of n){const x=Math.min(10,Math.max(4,1.3*f.height))*e,b=[-f.normal[1],f.normal[0],0],S=Math.min(.29,.1*f.width/f.depth),I=f.width-2*f.depth*e*(S+.01),A=ti([],f.pos,b,I/2),M=ti([],f.pos,b,-I/2),N=[A[0],A[1],A[2]+f.height],z=[M[0],M[1],M[2]+f.height],B=ti([],f.normal,b,S);Gt(B,B,x);const q=ti([],f.normal,b,-S);Gt(q,q,x),ui(B,A,B),ui(q,M,q),A[2]+=.1,M[2]+=.1,r.vertexArray.emplaceBack(B[0],B[1],B[2]),r.vertexArray.emplaceBack(q[0],q[1],q[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]),r.vertexArray.emplaceBack(z[0],z[1],z[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(B[0],B[1],B[2]),r.vertexArray.emplaceBack(q[0],q[1],q[2]);const K=I/x/2;r.colorArray.emplaceBack(-K-S,-1,K,.8),r.colorArray.emplaceBack(K+S,-1,K,.8),r.colorArray.emplaceBack(-K,0,K,1.3),r.colorArray.emplaceBack(K,0,K,1.3),r.colorArray.emplaceBack(K+S,-.8,K,.7),r.colorArray.emplaceBack(K+S,-.8,K,.7),r.colorArray.emplaceBack(0,0,K,1.3),r.colorArray.emplaceBack(0,0,K,1.3),r.colorArray.emplaceBack(K+S,-1.2,K,.8),r.colorArray.emplaceBack(K+S,-1.2,K,.8),r.indexArray.emplaceBack(6+l,4+l,8+l),r.indexArray.emplaceBack(7+l,9+l,5+l),r.indexArray.emplaceBack(0+l,1+l,2+l),r.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const c={defined:!0};c.emissiveFactor=pr.black;const p={};return p.baseColorFactor=pr.white,c.pbrMetallicRoughness=p,r.material=c,r.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}P0.performDecoding=function(n,e){const r=new Uint8Array(n);return Promise.all(e.tasks.map(l=>{const{layerName:c,firstByte:p,lastByte:f,pixelFormat:x,blockShape:b,blockIndex:S,filters:I,codec:A}=l,M=r.subarray(p,f+1),N=new Uint32Array(b[0]*b[1]*b[2]);let z;if(A!=="gzip_data")throw new Ca(`Unhandled codec: ${A}`);return z=function(B,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((V=function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||el(6,"invalid gzip data");var Ae=fe[3],Ee=10;4&Ae&&(Ee+=2+(fe[10]|fe[11]<<8));for(var Pe=(Ae>>3&1)+(Ae>>4&1);Pe>0;Pe-=!fe[Ee++]);return Ee+(2&Ae)}(se=B))+8>se.length&&el(6,"invalid gzip data"),function(fe,Ae,Ee,Pe){var De=fe.length;if(!De||Ae.f&&!Ae.l)return Ee||new oa(0);var He=!Ee,ut=He||Ae.i!=2,it=Ae.i;He&&(Ee=new oa(3*De));var lt,ht,Ze=function(vn){var Hr=Ee.length;if(vn>Hr){var kr=new oa(Math.max(2*Hr,vn));kr.set(Ee),Ee=kr}},st=Ae.f||0,$e=Ae.p||0,We=Ae.b||0,gt=Ae.l,yt=Ae.d,Xt=Ae.m,zt=Ae.n,Tt=8*De;do{if(!gt){st=Ja(fe,$e,1);var mt=Ja(fe,$e+1,3);if($e+=3,!mt){var gi=fe[(ue=4+(($e+7)/8|0))-4]|fe[ue-3]<<8,jt=ue+gi;if(jt>De){it&&el(0);break}ut&&Ze(We+gi),Ee.set(fe.subarray(ue,jt),We),Ae.b=We+=gi,Ae.p=$e=8*jt,Ae.f=st;continue}if(mt==1)gt=e4,yt=t4,Xt=9,zt=5;else if(mt==2){var Lt=Ja(fe,$e,31)+257,oi=Ja(fe,$e+10,15)+4,Ti=Lt+Ja(fe,$e+5,31)+1;$e+=14;for(var bi=new oa(Ti),Li=new oa(19),Pi=0;Pi<oi;++Pi)Li[KO[Pi]]=Ja(fe,$e+3*Pi,7);$e+=3*oi;var Fi=Zb(Li),gr=(1<<Fi)-1,Fr=x_(Li,Fi);for(Pi=0;Pi<Ti;){var ue,ge=Fr[Ja(fe,$e,gr)];if($e+=15&ge,(ue=ge>>4)<16)bi[Pi++]=ue;else{var Ye=0,vt=0;for(ue==16?(vt=3+Ja(fe,$e,3),$e+=2,Ye=bi[Pi-1]):ue==17?(vt=3+Ja(fe,$e,7),$e+=3):ue==18&&(vt=11+Ja(fe,$e,127),$e+=7);vt--;)bi[Pi++]=Ye}}var Et=bi.subarray(0,Lt),St=bi.subarray(Lt);Xt=Zb(Et),zt=Zb(St),gt=x_(Et,Xt),yt=x_(St,zt)}else el(1);if($e>Tt){it&&el(0);break}}ut&&Ze(We+131072);for(var Nt=(1<<Xt)-1,ni=(1<<zt)-1,Vi=$e;;Vi=$e){var Ui=(Ye=gt[Xb(fe,$e)&Nt])>>4;if(($e+=15&Ye)>Tt){it&&el(0);break}if(Ye||el(2),Ui<256)Ee[We++]=Ui;else{if(Ui==256){Vi=$e,gt=null;break}var Mi=Ui-254;Ui>264&&(Mi=Ja(fe,$e,(1<<(Gi=SP[Pi=Ui-257]))-1)+IP[Pi],$e+=Gi);var vr=yt[Xb(fe,$e)&ni],Rr=vr>>4;if(vr||el(3),$e+=15&vr,St=JO[Rr],Rr>3){var Gi=TP[Rr];St+=Xb(fe,$e)&(1<<Gi)-1,$e+=Gi}if($e>Tt){it&&el(0);break}ut&&Ze(We+131072);var an=We+Mi;if(We<St){var Or=0-St,_r=Math.min(St,an);for(Or+We<0&&el(3);We<_r;++We)Ee[We]=(void 0)[Or+We]}for(;We<an;++We)Ee[We]=Ee[We-St]}}Ae.l=gt,Ae.p=Vi,Ae.b=We,Ae.f=st,gt&&(st=1,Ae.m=Xt,Ae.d=yt,Ae.n=zt)}while(!st);return We!=Ee.length&&He?(lt=Ee,((ht=We)==null||ht>lt.length)&&(ht=lt.length),new oa(lt.subarray(0,ht))):Ee.subarray(0,We)}(se.subarray(V,-8),{i:2},new oa(((K=se)[(ne=K.length)-4]|K[ne-3]<<8|K[ne-2]<<16|K[ne-1]<<24)>>>0))));var K,ne,se,V;const ee=s4[q];if(!ee)throw new Error(`Unhandled codec: ${q}`);const ae=new globalThis.DecompressionStream(ee);return new Response(new Blob([B]).stream().pipeThrough(ae)).arrayBuffer().then(fe=>new Uint8Array(fe))}(M,A).then(B=>(function(q,K){q.readFields(qO,K)}(new Yb(B),N),new a4[x](N.buffer))),z.then(B=>{for(let q=I.length-1;q>=0;q--)switch(I[q]){case"delta_filter":WO(B,b);break;case"zigzag_filter":ZO(B);break;case"bitshuffle_filter":XO(B,x);break;default:throw new Ca(`Unhandled filter "${I[q]}"`)}return{layerName:c,blockIndex:S,data:B}}).catch(B=>{throw B})}))},Rt(kP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Rt(P0,"MapboxRasterTile"),Rt(RP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class jP{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const f4=["id","tile","layer","source","sourceLayer","state"];class kf{constructor(e,r,l,c,p){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=l,this._y=c,this.properties=e.properties,this.id=p}clone(){const e=new kf(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of f4)this[r]!==void 0&&(e[r]=this[r]);return e}}class zP{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $a(bt,16,0),this.featureIndexArray=new Ix,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,l,c,p,f=0,x=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,c,p,f);const S=this.grid;for(let I=0;I<r.length;I++){const A=r[I],M=[1/0,1/0,-1/0,-1/0];for(let N=0;N<A.length;N++){const z=A[N];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}x!==0&&(M[0]-=x,M[1]-=x,M[2]+=x,M[3]+=x),M[0]<bt&&M[1]<bt&&M[2]>=0&&M[3]>=0&&S.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ri.VectorTile(new Qx(this.rawTileData)).layers,this.sourceLayerCoder=new jP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:l,transform:c,tileTransform:p,pixelPosMatrix:f,availableImages:x,worldview:b}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const S=l.bufferedTilespaceBounds,I=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(z,B,q,K)=>Au(l.bufferedTilespaceGeometry,z,B,q,K));I.sort(m4);let A=null;c.elevation&&I.length>0&&(A=Af.create(c.elevation,this.tileID));const M={};let N;for(let z=0;z<I.length;z++){const B=I[z];if(B===N)continue;N=B;const q=this.featureIndexArray.get(B);let K=null;this.is3DTile?this.loadMatchingModelFeature(M,q,e,l,c,b):this.loadMatchingFeature(M,q,e,x,b,(ne,se,V,ee=0)=>(K||(K=Dt(ne,this.tileID.canonical,p)),se.queryIntersectsFeature(l,ne,V,K,this.z,c,f,A,ee)))}return M}loadMatchingFeature(e,r,l,c,p,f){const{featureIndex:x,bucketIndex:b,sourceLayerIndex:S,layoutVertexArrayOffset:I}=r,A=this.bucketLayerIDs[b],M=l.layers,N=Object.keys(M);if(N.length&&!yi(N,A))return;const z=l.sourceCache,B=this.sourceLayerCoder.decode(S),q=this.vtLayers[B].feature(x),K=this.getId(q,B);for(let ne=0;ne<A.length;ne++){const se=A[ne];if(!M[se])continue;const{styleLayer:V,targets:ee}=M[se];let ae={};K!==void 0&&(ae=z.getFeatureState(V.sourceLayer,K));const fe=!f||f(q,V,ae,I);if(!fe)continue;const Ae=new kf(q,this.z,this.x,this.y,K);Ae.tile=this.tileID.canonical,Ae.state=ae;let Ee=this.serializedLayersCache.get(se);Ee||(Ee=V.serialize(),Ee.id=se,this.serializedLayersCache.set(se,Ee)),Ae.source=Ee.source,Ae.sourceLayer=Ee["source-layer"],Ae.layer=Be({},Ee),Ae.layer.paint=LP(Ee.paint,V.paint,q,ae,c),Ae.layer.layout=LP(Ee.layout,V.layout,q,ae,c);let Pe=!1;for(const De of ee){this.updateFeatureProperties(Ae,De);const{filter:He}=De;if(He){if(q.properties=Ae.properties,He.needGeometry){const ut=Pt(q,!0);if(!He.filter(new Cr(this.tileID.overscaledZ,{worldview:p}),ut,this.tileID.canonical))continue}else if(!He.filter(new Cr(this.tileID.overscaledZ,{worldview:p}),q))continue}Pe=!0,De.targetId&&this.addFeatureVariant(Ae,De)}Pe&&this.appendToResult(e,se,x,Ae,fe)}}loadMatchingModelFeature(e,r,l,c,p,f){const{featureIndex:x,bucketIndex:b}=r,S=this.bucketLayerIDs[b],I=l.layers,A=Object.keys(I);if(!A.length||yi(A,S))for(let M=0;M<S.length;M++){const N=S[M],{styleLayer:z,targets:B}=I[N];if(z.type!=="model")continue;const q=c.tile,K=q.getBucket(z);if(!(K&&K instanceof b0))continue;const ne=fO(K,x,c,p);if(!ne)continue;const{z:se,x:V,y:ee}=q.tileID.canonical,{feature:ae,intersectionZ:fe,position:Ae}=ne;let Ee={};ae.id!==void 0&&(Ee=l.sourceCache.getFeatureState(z.sourceLayer,ae.id));const Pe=new kf({},se,V,ee,ae.id);Pe.tile=this.tileID.canonical,Pe.state=Ee,Pe.properties=ae.properties,Pe.geometry={type:"Point",coordinates:[Ae.lng,Ae.lat]};let De=this.serializedLayersCache.get(N);De||(De=z.serialize(),De.id=N,this.serializedLayersCache.set(N,De)),Pe.source=De.source,Pe.sourceLayer=De["source-layer"],Pe.layer=Be({},De);let He=!1;for(const ut of B){this.updateFeatureProperties(Pe,ut);const{filter:it}=ut;if(it){if(ae.properties=Pe.properties,it.needGeometry){if(!it.filter(new Cr(this.tileID.overscaledZ,{worldview:f}),ae,this.tileID.canonical))continue}else if(!it.filter(new Cr(this.tileID.overscaledZ,{worldview:f}),ae))continue}He=!0,ut.targetId&&this.addFeatureVariant(Pe,ut)}He&&this.appendToResult(e,N,x,Pe,fe)}}updateFeatureProperties(e,r,l){if(r.properties){const c={};for(const p in r.properties){const f=r.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);f!=null&&(c[p]=f)}e.properties=c}}addFeatureVariant(e,r,l){const c={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(c)}appendToResult(e,r,l,c,p){let f=e[r];f===void 0&&(f=e[r]=[]),f.push({featureIndex:l,feature:c,intersectionZ:p})}lookupSymbolFeatures(e,r,l,c,p,f){const x={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(x,{bucketIndex:r,sourceLayerIndex:l,featureIndex:b,layoutVertexArrayOffset:0},c,p,f);return x}loadFeature(e){const{featureIndex:r,sourceLayerIndex:l}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(l),p=this.vtFeatures[c];if(p[r])return p[r];const f=this.vtLayers[c].feature(r);return p[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const p=Ga(c);if(p.result!=="success"){const f=p.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Ei(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new $h),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[c];typeof l=="boolean"&&(l=Number(l))}return l}}function LP(n,e,r,l,c){return Ot(n,(p,f)=>{const x=e instanceof wc?e.get(f):null;return x&&x.evaluate?x.evaluate(r,l,void 0,c):x})}function m4(n,e){return e-n}Rt(zP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const FP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=l>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=FP[15&l];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Qb(x,f,p,e)}constructor(e,r=64,l=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=FP.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${l}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+x+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Jb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:x}=this,b=[0,p.length-1,0],S=[];for(;b.length;){const I=b.pop()||0,A=b.pop()||0,M=b.pop()||0;if(A-M<=x){for(let q=M;q<=A;q++){const K=f[2*q],ne=f[2*q+1];K>=e&&K<=l&&ne>=r&&ne<=c&&S.push(p[q])}continue}const N=M+A>>1,z=f[2*N],B=f[2*N+1];z>=e&&z<=l&&B>=r&&B<=c&&S.push(p[N]),(I===0?e<=z:r<=B)&&(b.push(M),b.push(N-1),b.push(1-I)),(I===0?l>=z:c>=B)&&(b.push(N+1),b.push(A),b.push(1-I))}return S}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:f}=this,x=[0,c.length-1,0],b=[],S=l*l;for(;x.length;){const I=x.pop()||0,A=x.pop()||0,M=x.pop()||0;if(A-M<=f){for(let q=M;q<=A;q++)BP(p[2*q],p[2*q+1],e,r)<=S&&b.push(c[q]);continue}const N=M+A>>1,z=p[2*N],B=p[2*N+1];BP(z,B,e,r)<=S&&b.push(c[N]),(I===0?e-l<=z:r-l<=B)&&(x.push(M),x.push(N-1),x.push(1-I)),(I===0?e+l>=z:r+l>=B)&&(x.push(N+1),x.push(A),x.push(1-I))}return b}}function Jb(n,e,r,l,c,p){if(c-l<=r)return;const f=l+c>>1;OP(n,e,f,l,c,p),Jb(n,e,r,l,f-1,1-p),Jb(n,e,r,f+1,c,1-p)}function OP(n,e,r,l,c,p){for(;c>l;){if(c-l>600){const S=c-l+1,I=r-l+1,A=Math.log(S),M=.5*Math.exp(2*A/3),N=.5*Math.sqrt(A*M*(S-M)/S)*(I-S/2<0?-1:1);OP(n,e,r,Math.max(l,Math.floor(r-I*M/S+N)),Math.min(c,Math.floor(r+(S-I)*M/S+N)),p)}const f=e[2*r+p];let x=l,b=c;for(w_(n,e,l,r),e[2*c+p]>f&&w_(n,e,l,c);x<b;){for(w_(n,e,x,b),x++,b--;e[2*x+p]<f;)x++;for(;e[2*b+p]>f;)b--}e[2*l+p]===f?w_(n,e,l,b):(b++,w_(n,e,b,c)),b<=r&&(l=b+1),r<=b&&(c=b-1)}}function w_(n,e,r,l){e2(n,r,l),e2(e,2*r,2*l),e2(e,2*r+1,2*l+1)}function e2(n,e,r){const l=n[e];n[e]=n[r],n[r]=l}function BP(n,e,r,l){const c=n-r,p=e-l;return c*c+p*p}s.$=es,s.A=ac,s.B=Va,s.C=Sc,s.D=xf,s.E=lc,s.F=2,s.G=a_,s.H=nA,s.I=Ks,s.J=yl,s.K=class extends v0{},s.L=uc,s.M=ia,s.N=ed,s.O=Jh,s.P=wt,s.Q=mg,s.R=Nh,s.S=Zp,s.T=Nb,s.U=Qp,s.V=v0,s.W=ax,s.X=Ga,s.Y=jp,s.Z=cu,s._=lu,s.a=function(n){return os.API_CDN_URL_REGEX.test(n)},s.a$=ce,s.a0=cc,s.a1=Jp,s.a2=td,s.a3=fg,s.a4=function(n){const e=n.value;let r=[];if(!e)return r;const l=yl(e);return l!=="string"?(r=r.concat([new v0(n.key,e,`string expected, "${l}" found`)]),r):(Fb(e,!0)||(r=r.concat([new v0(n.key,e,`invalid url "${e}"`)])),r)},s.a5=ze,s.a6=px,s.a7=hn,s.a8=ft,s.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Qr(n.expression.evaluate(e))}interpolate(n,e,r){return{x:si(n.x,e.x,r),y:si(n.y,e.y,r),z:si(n.z,e.z,r),azimuthal:si(n.azimuthal,e.azimuthal,r),polar:si(n.polar,e.polar,r)}}},s.aA=Ur,s.aB=v,s.aC=Ea,s.aD=we,s.aE=Ue,s.aF=function(n,e){const r={};for(let l=0;l<e.length;l++){const c=e[l];c in n&&(r[c]=n[c])}return r},s.aG=pe,s.aH=xe,s.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,r,l){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[p,f]=c.result;return this.scheduler?this.scheduler.add(()=>{l(p,f)},e):l(p,f),()=>{}}return c.callbacks.push(l),c.cancel||(c.cancel=r((p,f)=>{c.result=[p,f];for(const x of c.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,f)},e):x(p,f);setTimeout(()=>delete this.entries[n],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(p=>p!==l),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},s.aJ=function(n,e,r){const l=JSON.stringify(n.request);return n.data&&(this.deduped.entries[l]={result:[null,n.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const p=jh(n.request,(f,x,b,S)=>{f?c(f):x&&c(null,{vectorTile:r?void 0:new Ri.VectorTile(new Qx(x)),rawData:x,cacheControl:b,expires:S})});return()=>{p.cancel(),c()}},e)},s.aK=function(n){Lm++,Lm>Fa&&(n.getActor().send("enforceCacheSizeLimit",Jo),Lm=0)},s.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.aM=Ds,s.aN=DA,s.aO=OA,s.aP=kA,s.aQ=function(n,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let l=0;l<n.length;l++){const c=document.createElement("source");iw(n[l])||(r.crossOrigin="Anonymous"),c.src=n[l],r.appendChild(c)}return{cancel:()=>{}}},s.aR=m0,s.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>SI(e,0,n))},s.aT=NP,s.aU=class{constructor(n,e,r,l){this.id=n,this.position=e!=null?new te(e[0],e[1]):new te(0,0),this.orientation=r??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(re(n.matrix,e,n.matrix),n.meshes)for(const r of n.meshes){const l=rr.applyTransformFast(r.aabb,n.matrix);this.aabb.encapsulate(l)}if(n.children)for(const r of n.children)this._applyTransformations(r,n.matrix)}computeBoundsAndApplyParent(){const n=Y([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,r,l,c,p,f=!1){YA(this.matrix,this,n.transform,this.position,e,r,l,c,p,f)}upload(n){if(!this.uploaded){for(const e of this.nodes)Bb(e,n);for(const e of this.nodes)w0(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)Vb(n)}},s.aV=Ct,s.aW=c_,s.aX=Ce,s.aY=Le,s.aZ=yu,s.a_=ls,s.aa=Cr,s.ab=rd,s.ac=Re,s.ad=ji,s.ae=xi,s.af=ke,s.ag=wc,s.ah=Pu,s.ai=si,s.aj=bt,s.ak=Sp,s.al=Qi,s.am=pr,s.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([r,l]){const c=Qr([1,r,l]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,r){return{x:si(n.x,e.x,r),y:si(n.y,e.y,r),z:si(n.z,e.z,r)}}},s.ao=function(n,e,r=0,l=!0){const c=new wt(r,r),p=n.sub(c),f=e.add(c),x=[p,new wt(f.x,p.y),f,new wt(p.x,f.y)];return l&&x.push(p.clone()),x},s.ap=function(n,e){const r=[];for(let l=0;l<n.length;l++){const c=Oe(l-1,-1,n.length-1),p=Oe(l+1,-1,n.length-1),f=n[l],x=n[p],b=n[c].sub(f).unit(),S=x.sub(f).unit(),I=S.angleWithSep(b.x,b.y),A=b.add(S).unit().mult(-1*e/Math.sin(I/2));r.push(f.add(A))}return r},s.aq=yA,s.ar=Au,s.as=function(n,e,r=0){return It(((e.x-r)*n.scale-n.x)*bt,(e.y*n.scale-n.y)*bt,Fe(e.z,e.y))},s.at=dr,s.au=Hi,s.av=$r,s.aw=MI,s.ax=function(n){let e=1/0,r=1/0,l=-1/0,c=-1/0;for(const p of n)e=Math.min(e,p.x),r=Math.min(r,p.y),l=Math.max(l,p.x),c=Math.max(c,p.y);return{min:new wt(e,r),max:new wt(l,c)}},s.ay=ve,s.az=re,s.b=function(n){return os.API_FONTS_REGEX.test(n)},s.b$=function(n,e,r){r*=.5;var l=e[0],c=e[1],p=e[2],f=e[3],x=Math.sin(r),b=Math.cos(r);return n[0]=l*b+c*x,n[1]=c*b-l*x,n[2]=p*b+f*x,n[3]=f*b-p*x,n},s.b0=lf,s.b1=p0,s.b2=function(){Wa.isLoading()||Wa.isLoaded()||mu()!=="deferred"||dx()},s.b3=wg,s.b4=Pt,s.b5=kf,s.b6=sr,s.b7=db,s.b8=Jw,s.b9=Dt,s.bA=function(n,e){const{x:r,y:l}=n.point,c=cC(r,l,n.worldSize/n._pixelsPerMercatorPixel,0,0);return re(c,c,Gw(jl(e)))},s.bB=H,s.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},s.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.bE=ti,s.bF=hi,s.bG=Ii,s.bH=o_,s.bI=yo,s.bJ=vb,s.bK=function(n,e,r,l,c){const p=5*e+2;n.float32[p+0]=r,n.float32[p+1]=l,n.float32[p+2]=c},s.bL=d0,s.bM=Zx,s.bN=$s,s.bO=ts,s.bP=OC,s.bQ=qA,s.bR=$C,s.bS=qC,s.bT=xb,s.bU=hA,s.bV=Tb,s.bW=Qb,s.bX=Oe,s.bY=Gt,s.bZ=ns,s.b_=Co,s.ba=Za,s.bb=pd,s.bc=rC,s.bd=fn,s.be=$g,s.bf=Rb,s.bg=function(n,e){const r=Pu(e.zoom);if(r===0)return jl(n);const l=Lx(n),c=Uw(l),p=we(l.getWest())*e.worldSize,f=we(l.getEast())*e.worldSize,x=xe(l.getNorth())*e.worldSize,b=xe(l.getSouth())*e.worldSize,S=[p,x,0],I=[f,x,0],A=[p,b,0],M=[f,b,0],N=le([],e.globeMatrix);return ji(S,S,N),ji(I,I,N),ji(A,A,N),ji(M,M,N),c[0]=Cc(c[0],A,r),c[1]=Cc(c[1],M,r),c[2]=Cc(c[2],I,r),c[3]=Cc(c[3],S,r),rr.fromPoints(c)},s.bh=Ox,s.bi=le,s.bj=Ug,s.bk=Cc,s.bl=ld,s.bm=s3,s.bn=ot,s.bo=oe,s.bp=P0,s.bq=Qx,s.br=jh,s.bs=function(n,e){const r=[];for(const l in n)l in e||r.push(l);return r},s.bt=Me,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=Ko,s.bw=function(n){var e=new O(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.bx=Y,s.by=pt,s.bz=de,s.c=fp,s.c$=Xx,s.c0=Io,s.c1=un,s.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.c3=Bt,s.c4=function(n,e,r,l,c){var p,f=1/Math.tan(e/2);return n[0]=f/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+l)*(p=1/(l-c)),n[14]=2*c*l*p):(n[10]=-1,n[14]=-2*l),n},s.c5=function(n,e,r,l,c,p,f){var x=1/(e-r),b=1/(l-c),S=1/(p-f);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(e+r)*x,n[13]=(c+l)*b,n[14]=(f+p)*S,n[15]=1,n},s.c6=Te,s.c7=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},s.c8=df,s.c9=_d,s.cA=y0,s.cB=Wt,s.cC=BA,s.cD=function(n){const e=BA(n,!0);return H([],[e[0],e[1],e[4],e[5]])},s.cE=_e,s.cF=Mr,s.cG=Ne,s.cH=function(n){const{x:e,y:r}=n.point,{lng:l,lat:c}=n._center;return cC(e,r,n.worldSize,l,c)},s.cI=Ni,s.cJ=Ve,s.cK=_f,s.cL=T,s.cM=function(n,e,r){let l=0;for(let c=0;c<2;++c)n[c]>0&&(l+=(n[c]-0)*(n[c]-0)),e[c]<0&&(l+=(0-e[c])*(0-e[c]));return l},s.cN=function(n){return n*n*n*n*n},s.cO=be,s.cP=45,s.cQ=pf,s.cR=function(n,e,r){const l=Math.sqrt(n*n+e*e+r*r),c=l>0?Math.acos(r/l)*tc:0;let p=n!==0||e!==0?Math.atan2(-e,-n)*tc+90:0;return p<0&&(p+=360),[l,p,c]},s.cS=It,s.cT=Qr,s.cU=qe,s.cV=ui,s.cW=rr,s.cX=Zt,s.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},s.cZ=Fb,s.c_=function(n,e){return n.readFields(_O,{icons:[]},e)},s.ca=Sn,s.cb=Sa,s.cc=Tu,s.cd=te,s.ce=SA,s.cf=function(){var n=new O(4);return O!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},s.cg=function(n,e,r){var l=e[0],c=e[1],p=e[2],f=e[3],x=Math.sin(r),b=Math.cos(r);return n[0]=l*b+p*x,n[1]=c*b+f*x,n[2]=l*-x+p*b,n[3]=c*-x+f*b,n},s.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.ci=nr,s.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.ck=ds,s.cl=wr,s.cm=iC,s.cn=en,s.co=VA,s.cp=bd,s.cq=oC,s.cr=function(n,e,r,l,c,p,f,x,b){if(b.name==="globe")return oC(n,e,new bd(r,l,c),!1);const S=c_({z:r,x:l,y:c},b);return new rr([(p+S.x/S.scale)*e,e*(S.y/S.scale),f],[(p+S.x2/S.scale)*e,e*(S.y2/S.scale),x])},s.cs=function(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n[3]=Math.min(e[3],r[3]),n},s.ct=function(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n[3]=Math.max(e[3],r[3]),n},s.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return Q[e]},s.cv=Ke,s.cw=ys,s.cx=C,s.cy=function(n){const e=Y(new Float64Array(16));re(e,n.pixelMatrix,n.globeMatrix);const r=[0,j,0],l=[0,F,0];return ji(r,r,e),ji(l,l,e),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!qw(n,new te(n.center.lat,90)),l[0]>0&&l[0]<=n.width&&l[1]>0&&l[1]<=n.height&&!qw(n,new te(n.center.lat,-90))]},s.cz=function(n,e){const{scale:r}=n.tileTransform,l=r*bt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(c,p,f){var x=p[1],b=p[2],S=p[3],I=f[0],A=f[1];return c[0]=p[0]*I,c[1]=x*I,c[2]=b*A,c[3]=S*A,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},s.d=function(n){return os.API_TILEJSON_REGEX.test(n)},s.d$=Ng,s.d0=Tf,s.d1=bb,s.d2=yp,s.d3=vc,s.d4=Ro,s.d5=Lh,s.d6=ci,s.d7=function(n){const e=n.indexOf(od);return e>=0?n.slice(0,e):n},s.d8=function(n){return n.indexOf(od)>=0},s.d9=function(n){const e=n.lastIndexOf(od);return e>=0?n.slice(e+1):""},s.dA=lC,s.dB=Bs,s.dC=vs,s.dD=256,s.dE=function(n,e){const r=[0,0,0];return ji(r,r,Ox(jl(e.canonical))),ji(r,r,n),r},s.dF=n=>({u_matrix:new Tu(n),u_texsize:new Sa(n),u_pixels_to_tile_units:new yd(n),u_device_pixel_ratio:new Sn(n),u_width_scale:new Sn(n),u_floor_width_scale:new Sn(n),u_image:new df(n),u_units_to_pixels:new Sa(n),u_tile_units_to_pixels:new Sn(n),u_alpha_discard_threshold:new Sn(n),u_trim_offset:new Sa(n),u_trim_fade_range:new Sa(n),u_trim_color:new pf(n),u_emissive_strength:new Sn(n),u_zbias_factor:new Sn(n),u_tile_to_meter:new Sn(n),u_ground_shadow_factor:new _d(n),u_pattern_transition:new Sn(n)}),s.dG=n=>({u_matrix:new Tu(n),u_pixels_to_tile_units:new yd(n),u_device_pixel_ratio:new Sn(n),u_width_scale:new Sn(n),u_floor_width_scale:new Sn(n),u_units_to_pixels:new Sa(n),u_dash_image:new df(n),u_gradient_image:new df(n),u_image_height:new Sn(n),u_texsize:new Sa(n),u_tile_units_to_pixels:new Sn(n),u_alpha_discard_threshold:new Sn(n),u_trim_offset:new Sa(n),u_trim_fade_range:new Sa(n),u_trim_color:new pf(n),u_emissive_strength:new Sn(n),u_zbias_factor:new Sn(n),u_tile_to_meter:new Sn(n),u_ground_shadow_factor:new _d(n)}),s.dH=n=>({u_camera_to_center_distance:new Sn(n),u_extrude_scale:new yd(n),u_device_pixel_ratio:new Sn(n),u_matrix:new Tu(n),u_inv_rot_matrix:new Tu(n),u_merc_center:new Sa(n),u_tile_id:new _d(n),u_zoom_transition:new Sn(n),u_up_dir:new _d(n),u_emissive_strength:new Sn(n)}),s.dI=Pg,s.dJ=wF,s.dK=dC,s.dL=(n,e,r,l,c,p)=>{const f=n.transform,x=f.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(x){const I=lC(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([I,0,0,I])}else b=f.calculatePixelsToTileUnitsMatrix(r);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,r,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qo.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:u3,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(x){S.u_inv_rot_matrix=l,S.u_merc_center=c,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Pu(f.zoom);const I=c[0]*bt,A=c[1]*bt;S.u_up_dir=f.projection.upVector(new bd(0,0,0),I,A)}return S},s.dM=NI,s.dN=Us,s.dO=(n,e,r,l,c,p,f,x,b,S)=>{const I=n.transform,A=I.pitch<15?RI(.07,.7,ve((14-I.zoom)/5,0,1)):.07,M=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:DI(n,e,r,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:p,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:kI(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:qe(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:S}},s.dP=(n,e,r,l,c,p,f,x,b,S)=>{const I=n.transform,A=I.calculatePixelsToTileUnitsMatrix(e),M=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=I.pitch<15?RI(.07,.7,ve((14-I.zoom)/5,0,1)):.07;return{u_matrix:DI(n,e,r,l),u_pixels_to_tile_units:A,u_device_pixel_ratio:p,u_width_scale:f,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:jI(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kI(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:qe(e.tileID.canonical,0),u_ground_shadow_factor:S}},s.dQ=rt,s.dR=Gg,s.dS=Fe,s.dT=r3,s.dU=Wx,s.dV=nI,s.dW=Ru,s.dX=450,s.dY=7,s.dZ=iO,s.d_=er,s.da=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.db=function(n,e,r,l){return n.type==="custom"?new rO(n,e):new mO[n.type](n,e,r,l)},s.dc=li,s.dd=function(n){const e=n.indexOf(od);return e>=0?n.slice(e+1):""},s.de=class extends kf{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},s.df=Kp,s.dg=Xc,s.dh=function(n){return n({pluginStatus:ks,pluginURL:Ha}),Kp.on("pluginStateChange",n),n},s.di=Dx,s.dj=class extends Xa{constructor(n){super(n),this.current=Fg}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let l=0;l<9;l++)if(r[l]!==this.current[l]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dk=ie,s.dl=function(n,e,r){const l=Pu(r.zoom),c=n.style.map._antialias,p=n.terrain&&n.terrain.exaggeration()>0;return l===0&&!c&&!p},s.dm=function(n){const e=n.pixelsPerMeter,r=e/Te(1,n.center.lat),l=Y(new Float64Array(16));return oe(l,l,[n.point.x,n.point.y,0]),_e(l,l,[r,r,e]),Float32Array.from(l)},s.dn=Lx,s.dp=function(n){const e=Ke-5;n=ve(n,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Qi(n))),3);return Math.round(r*(L.length-1))},s.dq=function(n,e,r,l){const c=e.getNorth(),p=e.getSouth(),f=e.getWest(),x=e.getEast(),b=1<<n.z,S=x-f,I=c-p,A=S/k,M=-I/L[r],N=[0,A,0,M,0,0,c,f,0];if(n.z>0){const z=180/l;he(N,N,[z/S+1,0,0,0,z/I+1,0,-.5*z/A,.5*z/M,1])}return N[2]=b,N[5]=n.x,N[8]=n.y,N},s.dr=jl,s.ds=function(n,e,r){const l=Y(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return Ge(l,r.globeMatrix,c),Float32Array.from(l)},s.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,l=1<<r,c=Math.floor(n.x),p=Math.floor((n.x-c)*l),f=Math.floor(n.y*l),x=this.findDEMTileFor(new Ds(r,c,r,p,f));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||n.y<0||n.y>1)return e;const c=l.getSource().maxzoom,p=1<<c,f=Math.floor(n.x),x=n.x-f,b=new Ds(c,f,c,Math.floor(x*p),Math.floor(n.y*p)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const I=S.dem,A=1<<S.tileID.canonical.z,M=(x*A-S.tileID.canonical.x)*I.dim,N=(n.y*A-S.tileID.canonical.y)*I.dim,z=Math.floor(M),B=Math.floor(N);return(r?this.exaggeration():1)*si(si(I.get(z,B),I.get(z,B+1),N-B),si(I.get(z+1,B),I.get(z+1,B+1),N-B),M-z)}getAtTileOffset(n,e,r){const l=1<<n.canonical.z;return this.getAtPointOrZero(new Re(n.wrap+(n.canonical.x+e/bt)/l,(n.canonical.y+r/bt)/l))}getAtTileOffsetFunc(n,e,r,l){return c=>{const p=this.getAtTileOffset(n,c.x,c.y),f=l.upVector(n.canonical,c.x,c.y);return Gt(f,f,p*l.upVectorScale(n.canonical,e,r).metersToTile),f}}getForTilePoints(n,e,r,l){if(this.isUsingMockSource())return!1;const c=Af.create(this,n,l);return!!c&&(e.forEach(p=>{p[2]=this.exaggeration()*c.getElevationAt(p[0],p[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,l=e.tileID,c=1<<n.canonical.z-l.canonical.z;let p=n.canonical.x/c-l.canonical.x,f=n.canonical.y/c-l.canonical.y,x=0;for(let b=0;b<n.canonical.z-l.canonical.z&&!r.leaves[x];b++){p*=2,f*=2;const S=2*Math.floor(f)+Math.floor(p);x=r.childOffsets[x]+S,p%=1,f%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,r=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const c of n){const p=this.getMinMaxForTile(c.tileID);p&&(r=Math.min(r,p.min),l=Math.max(l,p.max),e=!0)}return e?{min:r,max:l}:null}},s.du=bC,s.dv=zx,s.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},s.dx=G,s.dy=function(n,e){var r=Math.sin(e),l=Math.cos(e);return n[0]=l,n[1]=r,n[2]=0,n[3]=-r,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.dz=Er,s.e=os,s.e$=jP,s.e0=256,s.e1=Gw,s.e2=ba,s.e3=Ge,s.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.e5=Rl,s.e6=dd,s.e7=ix,s.e8=function(n,e,r,l,c){return ve((n-e)/(r-e)*(c-l)+l,l,c)},s.e9=Os,s.eA=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},s.eB=Ln,s.eC=$,s.eD=Ki,s.eE=function(n,e,r,l){return n[0]=e,n[1]=r,n[2]=l,n},s.eF=function([n,e,r]){const l=Math.hypot(n,e,r),c=Math.atan2(n,r),p=.5*Math.PI-Math.acos(-e/l);return new te(Ve(c),Ve(p))},s.eG=Eo,s.eH=zb,s.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(r){if(yn==null){const l=r.navigator?r.navigator.userAgent:null;yn=!!r.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return yn}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eJ=function(n,e){Jo=n,Fa=e},s.eK=qw,s.eL=uC,s.eM=function(n){const e=[0,0,0],r=Y(new Float64Array(16));return re(r,n.pixelMatrix,n.globeMatrix),ji(e,e,r),new wt(e[0],e[1])},s.eN=function(){const n=e_;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(ob),e_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.eO=function(){Xx().acquire(ob)},s.eP=mu,s.eQ=function(n,e,r=!1){if(ks===Js.deferred||ks===Js.loading||ks===Js.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ha=Qo.resolveURL(n),ks=Js.deferred,vg=e,Yp(),r||dx()},s.eR=function(n){vf=Qo.resolveURL(n),wf||(wf=new xf(Xx(),new lc)),wf.broadcast("setMeshoptUrl",vf)},s.eS=_I,s.eT=function(n){lb=Qo.resolveURL(n),wf||(wf=new xf(Xx(),new lc)),wf.broadcast("setDracoUrl",lb)},s.eU=gI,s.eV=Jg,s.eW=function(n){const e=rc();if(!e)return;const r=e.delete(La);n&&r.then(()=>n()).catch(n)},s.eX=Cd,s.eY=Rt,s.eZ=Mu,s.e_=Qa,s.ea=function(n,e){var r=e[0],l=e[1],c=e[2],p=e[3],f=e[4],x=e[5],b=e[6],S=e[7],I=e[8],A=I*f-x*S,M=-I*p+x*b,N=S*p-f*b,z=r*A+l*M+c*N;return z?(n[0]=A*(z=1/z),n[1]=(-I*l+c*S)*z,n[2]=(x*l-c*f)*z,n[3]=M*z,n[4]=(I*r-c*b)*z,n[5]=(-x*r+c*p)*z,n[6]=N*z,n[7]=(-S*r+l*b)*z,n[8]=(f*r-l*p)*z,n):null},s.eb=Zi,s.ec=at,s.ed=Lb,s.ee=function(n,e){if(n===e){var r=e[1],l=e[2],c=e[3],p=e[6],f=e[7],x=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=r,n[6]=e[9],n[7]=e[13],n[8]=l,n[9]=p,n[11]=e[14],n[12]=c,n[13]=f,n[14]=x}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},s.ef=Ht,s.eg=[1,1,1],s.eh=class{constructor(n,e,r,l){this.context=n,this.format=l,this.size=r,this.texture=n.gl.createTexture();const[c,p,f]=this.size,{gl:x}=n;x.bindTexture(x.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,c,p,f,0,kb(this.format),Db(this.format),e.data)}bind(n,e){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_3D,this.texture),n!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,n),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},s.ei=Af,s.ej=function(n,e,r,l){var c=new O(4);return c[0]=n,c[1]=e,c[2]=r,c[3]=l,c},s.ek=pn,s.el=function(n,e,r,l){var c=e[0],p=e[1],f=e[2],x=e[3];return n[0]=c+l*(r[0]-c),n[1]=p+l*(r[1]-p),n[2]=f+l*(r[2]-f),n[3]=x+l*(r[3]-x),n},s.em=If,s.en=Ml,s.eo=Tc,s.ep=function(n,e,r,l,c,p,f,x,b,S,I,A,M,N,z,B){var q=new O(16);return q[0]=n,q[1]=e,q[2]=r,q[3]=l,q[4]=c,q[5]=p,q[6]=f,q[7]=x,q[8]=b,q[9]=S,q[10]=I,q[11]=A,q[12]=M,q[13]=N,q[14]=z,q[15]=B,q},s.eq=X,s.er=of,s.es=kg,s.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const r=VC(new wt(0,0),new wt(bt,bt),n),l=[];if(e&&!tb(r,this._globalClipBounds))return l;for(const c of this._activeRegions){if(c.hiddenByOverlap||!tb(r,c))continue;const p=F3(c.min,c.max,n);l.push({min:p.min,max:p.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return l}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const l of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(l).buckets[e.layer];c&&c.updateFootprints(l.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const r=n.getOrder(),l=n.getClipMask(),c=n.getClipScope();for(const p of e){if(!p.footprint)continue;const f=VC(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:r,clipMask:l,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||qx(e.min,r.min)||qx(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(l,c){const p=(f,x)=>f+x;return l.length-c.length||l.reduce(p,"").localeCompare(c.reduce(p,""))}(e.clipScope,r.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const r=this._activeRegions[e],l=this._prevRegions[e];n=r.priority!==l.priority||!BC(r,l)||r.order!==l.order||r.clipMask!==l.clipMask||!Ko(r.clipScope,l.clipScope),++e}}if(n){++this._updateTime;for(const r of this._activeRegions)r.order!==$x&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const l=this._activeRegions;if(r>=l.length)return r;const c=l[r].priority;for(;r<l.length&&l[r].priority===c;)++r;return r};if(this._sourceIds.length>1){let r=0,l=e(r);for(;r!==l;){let c=r;const p=r;for(;c!==l;){const f=this._activeRegions[c];f.hiddenByOverlap=!1;for(let x=0;x<p;x++){const b=this._activeRegions[x];if(!b.hiddenByOverlap&&f.order===$x&&tb(f,b)&&(f.hiddenByOverlap=GC(f.footprint,f.tileId,b.footprint,b.tileId),f.hiddenByOverlap))break}++c}r=l,l=e(r)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},s.eu=$x,s.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const r=new Za,l=new ls,c=[],p=n+1+2,f=e[0]+1,x=e[0]+1+(1+e.length),b=(S,I,A)=>{let M=S===p-1?S-2:S===0?S:S-1;return M+=A?24575:0,[M,I]};for(let S=0;S<p;++S)r.emplaceBack(...b(S,0,!0));for(let S=0;S<f;++S)for(let I=0;I<p;++I)r.emplaceBack(...b(I,S,(I===0||I===p-1)&&!0));for(let S=0;S<e.length;++S){const I=e[S];for(let A=0;A<p;++A)r.emplaceBack(...b(A,I,!0))}for(let S=0;S<e.length;++S){const I=l.length,A=e[S]+1+2,M=new ls;for(let B=0;B<A-1;B++){const q=B===A-2,K=q?p*(x-e.length+S-B):p;for(let ne=0;ne<p-1;ne++){const se=B*p+ne;B===0||q||ne===0||ne===p-2?(M.emplaceBack(se+1,se,se+K),M.emplaceBack(se+K,se+K+1,se+1)):(l.emplaceBack(se+1,se,se+K),l.emplaceBack(se+K,se+K+1,se+1))}}const N=fn.simpleSegment(0,I,r.length,l.length-I);for(let B=0;B<M.uint16.length;B+=3)l.emplaceBack(M.uint16[B],M.uint16[B+1],M.uint16[B+2]);const z=fn.simpleSegment(0,I,r.length,l.length-I);c.push({withoutSkirts:N,withSkirts:z})}return{vertices:r,indices:l,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(k,L);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,rC.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new ls;for(let f=0;f<=k;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new Rl,l=new Rl,c=new Rl,p=new Rl;this._poleSegments=[];for(let f=0,x=0;f<T;f++){const b=360/(1<<f);r.emplaceBack(0,-v,0,.5,0),l.emplaceBack(0,-v,0,.5,1),c.emplaceBack(0,-v,0,.5,.5),p.emplaceBack(0,-v,0,.5,.5);for(let S=0;S<=k;S++){let I=S/k,A=0;const M=si(0,b,I),[N,z,B]=Z(l3,c3,M,v);r.emplaceBack(N,z,B,I,A),l.emplaceBack(N,z,B,I,1-A);const q=Qi(M);I=.5+.5*Math.sin(q),A=.5+.5*Math.cos(q),c.emplaceBack(N,z,B,I,A),p.emplaceBack(N,z,B,I,1-A)}this._poleSegments.push(fn.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,jx,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(l,jx,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,jx,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(p,jx,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},s.ew=me,s.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.ey=Ie,s.ez=je,s.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},s.f0=zP,s.f1=II,s.f2=Bi,s.f3="hd_road_elevation",s.f4=_o,s.f5=Ot,s.f6=Td,s.f7=wb,s.f8=Id,s.f9=function(n,e,r,l,c,p,f,x=1,b,S,I){n.createArrays(),n.tilePixelRatio=bt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,M=n.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=x,N.textSizeScaleRange=A.get("text-size-scale-range"),N.iconSizeScaleRange=A.get("icon-size-scale-range");const[z,B]=N.textSizeScaleRange,[q,K]=N.iconSizeScaleRange;N.textScaleFactor=ve(N.scaleFactor,z,B),N.iconScaleFactor=ve(N.scaleFactor,q,K);const ne=M["text-size"],se=M["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Ee,maxZoom:Pe}=n.textSizeData;N.compositeTextSizes=[ne.possiblyEvaluate(new Cr(Ee,{worldview:I}),p),ne.possiblyEvaluate(new Cr(Pe,{worldview:I}),p)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Ee,maxZoom:Pe}=n.iconSizeData;N.compositeIconSizes=[se.possiblyEvaluate(new Cr(Ee,{worldview:I}),p),se.possiblyEvaluate(new Cr(Pe,{worldview:I}),p)]}N.layoutTextSize=ne.possiblyEvaluate(new Cr(f+1,{worldview:I}),p),N.layoutIconSize=se.possiblyEvaluate(new Cr(f+1,{worldview:I}),p),N.textMaxSize=ne.possiblyEvaluate(new Cr(18,{worldview:I}),p);const V=A.get("symbol-placement"),ee=A.get("text-rotation-alignment")==="map"&&V!=="point",ae=A.get("text-size");let fe=!1;const Ae=[];for(const Ee of n.features){const Pe=A.get("text-font").evaluate(Ee,{},p).join(","),De=ae.evaluate(Ee,{},p)*N.textScaleFactor,He=N.layoutTextSize.evaluate(Ee,{},p)*N.textScaleFactor,ut=N.layoutIconSize.evaluate(Ee,{},p)*N.iconScaleFactor,it={horizontal:{},vertical:void 0},lt=Ee.text;let ht,Ze=[0,0];if(lt){const oi=lt.toString(),Ti=A.get("text-letter-spacing").evaluate(Ee,{},p)*ts,bi=A.get("text-line-height").evaluate(Ee,{},p)*ts,Li=Aw(oi)?Ti:0,Pi=A.get("text-anchor").evaluate(Ee,{},p),Fi=A.get("text-variable-anchor");if(!Fi){const Ye=A.get("text-radial-offset").evaluate(Ee,{},p);if(Ye)Ze=hA(Pi,[Ye*ts,Sb]);else{const vt=A.get("text-offset").evaluate(Ee,{},p);Ze=[vt[0]*ts,vt[1]*ts]}}let gr=ee?"center":A.get("text-justify").evaluate(Ee,{},p);const Fr=V==="point",ue=Fr?A.get("text-max-width").evaluate(Ee,{},p)*ts:1/0,ge=Ye=>{n.allowVerticalPlacement&&nd(oi)&&(it.vertical=yb(lt,e,r,c,Pe,ue,bi,Pi,Ye,Li,Ze,yo.vertical,!0,He,De,b))};if(!ee&&Fi){const Ye=gr==="auto"?Fi.map(Et=>Tb(Et)):[gr];let vt=!1;for(let Et=0;Et<Ye.length;Et++){const St=Ye[Et];if(!it.horizontal[St])if(vt)it.horizontal[St]=it.horizontal[0];else{const Nt=yb(lt,e,r,c,Pe,ue,bi,"center",St,Li,Ze,yo.horizontal,!1,He,De,b);Nt&&(it.horizontal[St]=Nt,vt=Nt.positionedLines.length===1)}}ge("left")}else{if(gr==="auto"&&(gr=Tb(Pi)),Fr||A.get("text-writing-mode").indexOf("horizontal")>=0||!nd(oi)){const Ye=yb(lt,e,r,c,Pe,ue,bi,Pi,gr,Li,Ze,yo.horizontal,!1,He,De,b);Ye&&(it.horizontal[gr]=Ye)}ge(Fr?"left":gr)}}let st,$e,We,gt,yt,Xt,zt=!1;const Tt=A.get("icon-text-fit").evaluate(Ee,{},p);if(Ee.icon&&Ee.icon.hasPrimary()){const oi=pA(Ee.icon,n.iconSizeData,M["icon-size"],p,n.zoom,Ee,b,N.iconScaleFactor,I);st=oi.iconPrimary,We=oi.iconSecondary;const Ti=st.toString();if($e=l.get(Ti),$e&&(yt=A.get("icon-offset").evaluate(Ee,{},p),Xt=A.get("icon-anchor").evaluate(Ee,{},p),ht=kF(c.get(Ti),We?c.get(We.toString()):void 0,yt,Xt),zt=$e.sdf,n.sdfIcons===void 0?n.sdfIcons=$e.sdf:n.sdfIcons!==$e.sdf&&Ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==n.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),We){const bi=We.toString();gt=l.get(bi)}}fe=fe||!(!Ee.icon||!Ee.icon.hasSecondary());const mt=Eb(it.horizontal)||it.vertical;n.iconsInText||(n.iconsInText=!!mt&&mt.iconsInText);const gi=He*N.textScaleFactor/ts,{defaultShapedIcon:jt,verticallyShapedIcon:Lt}=UF(n,ht,A,Ee,p,it,gi,yt,Tt);Tt!=="none"&&ht&&(XI(ht)||YI(ht))&&(n0(0,$e,st,ht,jt,Tt,S,l,c),n0(0,gt,We,ht,jt,Tt,S,l,c),Lt&&(n0(0,$e,st,ht,Lt,Tt,S,l,c),n0(0,gt,We,ht,Lt,Tt,S,l,c))),ht=jt,Ae.push({feature:Ee,shapedTextOrientations:it,shapedText:mt,shapedIcon:ht,iconPrimary:st,iconSecondary:We,iconOffset:yt,iconAnchor:Xt,verticallyShapedIcon:Lt,layoutTextSize:He,layoutIconSize:ut,textOffset:Ze,isSDFIcon:zt,iconTextFit:Tt})}return{featureData:Ae,sizes:N,hasAnySecondaryIcon:fe,textAlongLine:ee,symbolPlacement:V}},s.fa=sA,s.fb=function(n,e,r,l,c,p,f,x,b,S){const{featureData:I,hasAnySecondaryIcon:A,sizes:M,textAlongLine:N,symbolPlacement:z}=e;for(const B of I){const{shapedIcon:q,verticallyShapedIcon:K,feature:ne,shapedTextOrientations:se,shapedText:V,layoutTextSize:ee,textOffset:ae,isSDFIcon:fe,iconPrimary:Ae,iconSecondary:Ee,iconTextFit:Pe,iconOffset:De}=B;fA(q,S.iconPositions,Ae,Ee),fA(K,S.iconPositions,Ae,Ee),VF(se,S.iconPositions),BF(Ae,Ee,S.iconPositions),(V||q)&&GF(n,ne,se,q,K,b,M,ee,0,ae,fe,l,c,f,x,A,Pe,De,N,z)}r&&n.generateCollisionDebugBuffers(p,n.collisionBoxArray,M.textScaleFactor)},s.fc=Ri,s.fd=A0,s.fe=Yo,s.ff=wi,s.fg=VI,s.fh=Yr,s.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==xI){const r=new Uint32Array(n,0,7),[,,l,c,p,f]=r;e=r.byteLength+c+p+f+p,(l!==n.byteLength||e>=n.byteLength)&&Ei("Invalid b3dm header information.")}return SI(n,e)},s.fj=function(n,e){const r=NP(n);for(const l of r){for(const c of l.meshes)d4(c);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(p4(l.lights,e)))}return r},s.fk=b0,s.fl=yr,s.fm=fI,s.fn=Wa,s.fo=Js,s.fp=function(n){Wc(),xa!=null&&xa.then(e=>{e.keys().then(r=>{for(let l=0;l<r.length-n;l++)e.delete(r[l]).catch(c=>Ei(c.message))}).catch(r=>Ei(r.message))}).catch(e=>Ei(e.message))},s.g=function(n,e){return Xc(Be(n,{method:"GET"}),e)},s.h=Be,s.i=function(n){return os.API_STYLE_REGEX.test(n)&&!fp(n)},s.j=function(n){return n.indexOf("mapbox:")===0},s.k=ml,s.l=Fm,s.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.n=function(n,e){return Xc(Be(n,{type:"json"}),e)},s.o=Om,s.p=function(n,e){return Xc(Be(n,{method:"POST"}),e)},s.q=Qo,s.r=ps,s.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=_p,s.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},s.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},s.w=Ei,s.x=function(){return ab||(ab=new Cd),ab},s.y=Wb,s.z=wp}),E(["./shared"],function(s){function D(Ve){const Q=Ve?Ve.url.toString():void 0;return Q?performance.getEntriesByName(Q):[]}function O(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let ie="[";for(const me of Ve)ie+=`${O(me)},`;return`${ie}]`}let Q="{";for(const ie of Object.keys(Ve).sort())Q+=`${ie}:${O(Ve[ie])},`;return`${Q}}`}function H(Ve){let Q="";for(const ie of s.bu)Q+=`/${O(Ve[ie])}`;return Q}class G{constructor(Q){this.keyCache={},this._layers={},this._layerConfigs={},Q&&this.replace(Q)}replace(Q,ie){this._layerConfigs={},this._layers={},this.update(Q,[],ie)}update(Q,ie,me){this._options=me;for(const ve of Q)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=s.db(ve,this.scope,null,this._options)).compileFilter(me),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of ie)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const Ie=function(ve,ke){const Oe={};for(let Be=0;Be<ve.length;Be++){const tt=ve[Be];let ce=ke&&ke[tt.id];ce||(tt.type==="symbol"?ce=tt.id:(ce=H(tt),tt.type==="line"&&tt.paint&&function Ct(Ot){return typeof Ot=="string"&&Ot==="line-progress"||(Array.isArray(Ot)?Ot.some(Ct):!(!Ot||typeof Ot!="object")&&Object.values(Ot).some(Ct))}(tt.paint["line-width"])&&(ce+=`/${O(tt.paint["line-width"])}`))),ke&&(ke[tt.id]=ce);let rt=Oe[ce];rt||(rt=Oe[ce]=[]),rt.push(tt)}const Me=[];for(const Be in Oe)Me.push(Oe[Be]);return Me}(Object.values(this._layerConfigs),this.keyCache);for(const ve of Ie){const ke=ve.map(rt=>this._layers[rt.id]),Oe=ke[0];if(Oe.visibility==="none")continue;const Me=Oe.source||"";let Be=this.familiesBySource[Me];Be||(Be=this.familiesBySource[Me]={});const tt=Oe.sourceLayer||"_geojsonTileLayer";let ce=Be[tt];ce||(ce=Be[tt]=[]),ce.push(ke)}}}const U=1*s.e_;class he{constructor(Q){const ie={},me=[];for(const Oe in Q){const Me=Q[Oe],Be=ie[Oe]={};for(const tt in Me.glyphs){const ce=Me.glyphs[+tt];if(!ce||ce.bitmap.width===0||ce.bitmap.height===0)continue;const rt=ce.metrics.localGlyph?U:1,Ct={x:0,y:0,w:ce.bitmap.width+2*rt,h:ce.bitmap.height+2*rt};me.push(Ct),Be[tt]=Ct}}const{w:Ie,h:ve}=s.H(me),ke=new s.eZ({width:Ie||1,height:ve||1});for(const Oe in Q){const Me=Q[Oe];for(const Be in Me.glyphs){const tt=Me.glyphs[+Be];if(!tt||tt.bitmap.width===0||tt.bitmap.height===0)continue;const ce=ie[Oe][Be],rt=tt.metrics.localGlyph?U:1;s.eZ.copy(tt.bitmap,ke,{x:0,y:0},{x:ce.x+rt,y:ce.y+rt},tt.bitmap)}}this.image=ke,this.positions=ie}}s.eY(he,"GlyphAtlas");class de{constructor(Q){this.tileID=new s.aM(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.lut=Q.lut,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.scope=Q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.request&&Q.request.collectResourceTiming,this.promoteId=Q.promoteId,this.isSymbolTile=Q.isSymbolTile,this.tileTransform=s.aW(Q.tileID.canonical,Q.projection),this.projection=Q.projection,this.worldview=Q.worldview,this.localizableLayerIds=Q.localizableLayerIds,this.brightness=Q.brightness,this.extraShadowCaster=!!Q.extraShadowCaster,this.tessellationStep=Q.tessellationStep,this.scaleFactor=Q.scaleFactor,this.worldview=Q.worldview}parse(Q,ie,me,Ie,ve,ke){this.status="parsing",this.data=Q,this.collisionBoxArray=new s.b0;const Oe=new s.e$(Object.keys(Q.layers).sort()),Me=new s.f0(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Be={},tt=new s.f1(256,256),ce={featureIndex:Me,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:tt,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},rt=[],Ct=ie.familiesBySource[this.source];for(const li in Ct){const ci=Q.layers[li];if(!ci)continue;let yi=!1,Oi=!1,Ei=!1;for(const yr of Ct[li])yr[0].type==="symbol"?yi=!0:Oi=!0,yr[0].is3D()&&yr[0].type!=="model"&&(Ei=!0);if(this.extraShadowCaster&&!Ei||this.isSymbolTile===!0&&!yi||this.isSymbolTile===!1&&!Oi)continue;ci.version===1&&s.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pr=Oe.encode(li),Kr=[];let Qr=!1;for(let yr=0,sr=0;yr<ci.length;yr++){const yn=ci.feature(yr),un=Me.getId(yn,li);if(this.localizableLayerIds&&this.localizableLayerIds.has(li)){const sn=yn.properties?yn.properties.worldview:null;if(this.worldview&&typeof sn=="string")if(sn==="all")yn.properties.$localized=!0;else{if(!sn.split(",").includes(this.worldview))continue;yn.properties.$localized=!0,yn.properties.worldview=this.worldview}}!Qr&&yn.properties&&yn.properties.hasOwnProperty(s.f2)&&(Qr=!0),Kr.push({feature:yn,id:un,index:sr,sourceLayerIndex:Pr}),sr++}Qr&&!ce.elevationFeatures&&Q.layers.hasOwnProperty(s.f3)&&(ce.elevationFeatures=s.f4.parseFrom(Q.layers[s.f3],this.canonical));for(const yr of Ct[li]){const sr=yr[0];if(this.extraShadowCaster&&(!sr.is3D()||sr.type==="model")||this.isSymbolTile!==void 0&&sr.type==="symbol"!==this.isSymbolTile||sr.minzoom&&this.zoom<Math.floor(sr.minzoom)||sr.maxzoom&&this.zoom>=sr.maxzoom||sr.visibility==="none")continue;Y(yr,this.zoom,ce.brightness,me,this.worldview);const yn=Be[sr.id]=sr.createBucket({index:Me.bucketLayerIDs.length,layers:yr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ie,worldview:this.worldview});Me.bucketLayerIDs.push(yr.map(sn=>s.C(sn.id,sn.scope)));let un=yn.prepare?yn.prepare():null;un!=null?(un=un.then(()=>yn.populate(Kr,ce,this.tileID.canonical,this.tileTransform)),rt.push(un)):yn.populate(Kr,ce,this.tileID.canonical,this.tileTransform)}}const Ot=()=>{let li,ci,yi,Oi,Ei,Pr;tt.trim();const Kr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qr=()=>{if(li)return this.status="done",ke(li);if(this.extraShadowCaster)this.status="done",ke(null,{buckets:Object.values(Be).filter(sr=>!sr.isEmpty()),featureIndex:Me,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ce.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ci&&yi&&Oi){const sr=new he(ci),yn=new Map;for(const[Jn,Bs]of yi.entries()){const{imagePosition:vs}=s.f7(Jn,Bs,s.f8);yn.set(Jn,vs)}const un={};for(const Jn in Be){const Bs=Be[Jn];Bs instanceof s.b1&&(Y(Bs.layers,this.zoom,ce.brightness,me,this.worldview),un[Jn]=s.f9(Bs,ci,sr.positions,yi,yn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ei,this.worldview))}const sn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,yi,Ei,()=>{sn.iconsPending=!1,yr(un,sr,sn)}),this.rasterizeIfNeeded(ve,Oi,Pr,()=>{sn.patternsPending=!1,yr(un,sr,sn)})}},yr=(sr,yn,un,sn)=>{if(un.iconsPending||un.patternsPending)return;const Jn=new s.fa(yi,Oi,this.lut);for(const Bs in Be){const vs=Be[Bs];if(Bs in sr)s.fb(vs,sr[Bs],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,yi,Jn);else if(vs.hasPattern&&(vs instanceof s.b7||vs instanceof s.b8||vs instanceof s.dU)){Y(vs.layers,this.zoom,ce.brightness,me,this.worldview);const Ih=Object.fromEntries(Jn.patternPositions);vs.addFeatures(ce,this.tileID.canonical,Ih,me,this.tileTransform,this.brightness)}}this.status="done",ke(null,{buckets:Object.values(Be).filter(Bs=>!Bs.isEmpty()),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yn.image,lineAtlas:tt,imageAtlas:Jn,brightness:ce.brightness})};if(!this.extraShadowCaster){const sr=s.f5(ce.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(sr).length?ve.send("getGlyphs",{uid:this.uid,stacks:sr,scope:this.scope},(sn,Jn)=>{li||(li=sn,ci=Jn,Qr())},void 0,!1,Kr):ci={};const yn=Array.from(ce.iconDependencies.keys()).map(sn=>s.I.parse(sn));yn.length?ve.send("getImages",{images:yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sn,Jn)=>{li||(li=sn,yi=new Map,Ei=this.updateImageMapAndGetImageTaskQueue(yi,Jn,ce.iconDependencies),Qr())},void 0,!1,Kr):(yi=new Map,Ei=new Map);const un=Array.from(ce.patternDependencies.keys()).map(sn=>s.I.parse(sn));un.length?ve.send("getImages",{images:un,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sn,Jn)=>{li||(li=sn,Oi=new Map,Pr=this.updateImageMapAndGetImageTaskQueue(Oi,Jn,ce.patternDependencies),Qr())},void 0,!1,Kr):(Oi=new Map,Pr=new Map)}if(ce.elevationFeatures&&ce.elevationFeatures.length>0){const sr=[];for(const un of Object.values(Be))if(un instanceof s.b8){const sn=un.getUnevaluatedPortalGraph();sn&&sr.push(sn)}const yn=s.f6.evaluate(sr);for(const un of Object.values(Be))if(un instanceof s.b8){const sn=Q.layers[Oe.decode(un.sourceLayerIndex)];un.setEvaluatedPortalGraph(yn,sn,this.tileID.canonical,ce.availableImages,ce.brightness)}}Qr()};rt.length>0?Promise.allSettled(rt).then(Ot).catch(ke):Ot()}rasterizeIfNeeded(Q,ie,me,Ie){Array.from(ie.values()).some(ve=>ve.usvg)?this.rasterize(Q,ie,me,Ie):Ie()}updateImageMapAndGetImageTaskQueue(Q,ie,me){const Ie=new Map;for(const ve of ie.keys()){const ke=me.get(ve)||[];for(const Oe of ke){const Me=Oe.toString(),Be=ie.get(Oe.id.toString());Be.usvg?Ie.has(Me)||(Ie.set(Me,Oe),Q.set(Me,Object.assign({},Be))):Q.set(Me,Be)}}return Ie}rasterize(Q,ie,me,Ie){this.rasterizeTask=Q.send("rasterizeImages",{scope:this.scope,tasks:me},(ve,ke)=>{if(!ve)for(const[Oe,Me]of ke.entries()){const Be=Object.assign(ie.get(Oe),{data:Me});ie.set(Oe,Be)}Ie()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Y(Ve,Q,ie,me,Ie){const ve=new s.aa(Q,{brightness:ie,worldview:Ie});for(const ke of Ve)ke.recalculate(ve,me)}class le extends s.E{constructor(Q,ie,me,Ie,ve,ke,Oe){super(),this.actor=Q,this.layerIndex=ie,this.availableImages=me,this.availableModels=Ie,this.loadVectorData=ke||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(Q.scheduler),this.isSpriteLoaded=ve,this.scheduler=Q.scheduler,this.brightness=Oe}loadTile(Q,ie){const me=Q.uid,Ie=Q&&Q.request,ve=Ie&&Ie.collectResourceTiming,ke=this.loading[me]=new de(Q);ke.abort=this.loadVectorData(Q,(Oe,Me)=>{const Be=!this.loading[me];if(delete this.loading[me],ke.cancelRasterize(),Be||Oe||!Me)return ke.status="done",Be||(this.loaded[me]=ke),ie(Oe);const tt=Me.rawData,ce={};Me.expires&&(ce.expires=Me.expires),Me.cacheControl&&(ce.cacheControl=Me.cacheControl),ke.vectorTile=Me.vectorTile||new s.fc.VectorTile(new s.bq(tt));const rt=()=>{ke.parse(ke.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ct,Ot)=>{if(Ct||!Ot)return ie(Ct);const li={};if(ve){const ci=D(Ie);ci.length>0&&(li.resourceTiming=JSON.parse(JSON.stringify(ci)))}ie(null,s.h({rawTileData:tt.slice(0)},Ot,ce,li))})};this.isSpriteLoaded?rt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(rt,{type:"parseTile",isSymbolTile:Q.isSymbolTile,zoom:Q.tileZoom}):rt()}),this.loaded=this.loaded||{},this.loaded[me]=ke})}reloadTile(Q,ie){const me=this.loaded,Ie=Q.uid;if(me&&me[Ie]){const ve=me[Ie];ve.scaleFactor=Q.scaleFactor,ve.showCollisionBoxes=Q.showCollisionBoxes,ve.projection=Q.projection,ve.brightness=Q.brightness,ve.tileTransform=s.aW(Q.tileID.canonical,Q.projection),ve.extraShadowCaster=Q.extraShadowCaster,ve.lut=Q.lut,ve.worldview=Q.worldview;const ke=(Oe,Me)=>{const Be=ve.reloadCallback;Be&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Be)),ie(Oe,Me)};ve.status==="parsing"?ve.reloadCallback=ke:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke):ke())}else ie(null,void 0)}abortTile(Q,ie){const me=Q.uid,Ie=this.loading[me];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[me]),ie()}removeTile(Q,ie){const me=this.loaded,Ie=Q.uid;me&&me[Ie]&&delete me[Ie],ie()}}class re{loadTile(Q,ie){const{uid:me,encoding:Ie,rawImageData:ve,padding:ke}=Q,Oe=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,ke):ve;ie(null,new s.fd(me,Oe,Ie,ke<1))}reloadTile(Q,ie){ie(null,null)}abortTile(Q,ie){ie()}removeTile(Q,ie){ie()}getImageData(Q,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const me=this.offscreenCanvasContext.getImageData(-ie,-ie,Q.width+2*ie,Q.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}s.bp.setPbf(s.bq);class oe{constructor(Q){this._mrt=new s.bp(Q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Q.uid,this.tileID=Q.tileID,this.source=Q.source}parse(Q,ie){const me=this._mrt;this.status="parsing",this._entireBuffer=Q;try{me.parseHeader(Q),this._isHeaderLoaded=!0;const Ie=[];for(const ve in me.layers){const ke=me.getLayer(ve),Oe=ke.getDataRange(ke.getBandList()),Me=me.createDecodingTask(Oe),Be=Q.slice(Oe.firstByte,Oe.lastByte+1),tt=s.bp.performDecoding(Be,Me).then(ce=>Me.complete(null,ce)).catch(ce=>Me.complete(ce,null));Ie.push(tt)}Promise.allSettled(Ie).then(()=>ie(null,me)).catch(ve=>ie(ve))}catch(Ie){ie(Ie)}}}class _e{constructor(Q){this.actor=Q,this.loading={},this.loaded={}}loadTile(Q,ie){const me=Q.uid,Ie=Q.request,ve=this.loading[me]=new oe(Q),{cancel:ke}=s.br(Ie,(Oe,Me,Be,tt)=>{const ce=!this.loading[me];if(delete this.loading[me],ce||Oe||!Me)return ve.status="done",ce||(this.loaded[me]=ve),ie(Oe);ve.parse(Me,(rt,Ct)=>{if(rt||!Ct)return ie(rt);ie(null,Ct,Be,tt)}),this.loaded[me]=ve});ve.abort=ke}reloadTile(Q,ie){ie(null,void 0)}abortTile(Q,ie){const me=Q.uid,Ie=this.loading[me];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[me]),ie()}removeTile(Q,ie){const me=Q.uid;this.loaded[me]&&delete this.loaded[me],ie()}decodeRasterArray(Q,ie){s.bp.performDecoding(Q.buffer,Q.task).then(me=>ie(null,me)).catch(me=>ie(me))}}const Ne=s.fc.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(Q){this._feature=Q,this.extent=s.aj,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const ie of this._feature.geometry)Q.push([new s.P(ie[0],ie[1])]);return Q}{const Q=[];for(const ie of this._feature.geometry){const me=[];for(const Ie of ie)me.push(new s.P(Ie[0],Ie[1]));Q.push(me)}return Q}}toGeoJSON(Q,ie,me){return Ne.call(this,Q,ie,me)}}class pt{constructor(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.aj,this.length=Q.length,this._features=Q}feature(Q){return new Ge(this._features[Q])}}class ot{constructor(Q,ie){this.name=Q,this.extent=s.aj,this.length=ie.length,this._features=ie}feature(Q){return new Ge(this._features[Q])}}class dt extends pt{constructor(Q){super([]),this.layers={};for(const ie in Q)this.layers[ie]=new ot(ie,Q[ie])}}const Bt=64/4096,Wt=128;class Ht{constructor(){this.features=new Map}clear(){this.features.clear()}load(Q=[],ie){for(const me of Q){const Ie=me.id;if(Ie==null)continue;let ve=this.features.get(Ie);ve&&this.updateCache(ve,ie),me.geometry?(ve=xi(me),this.updateCache(ve,ie),this.features.set(Ie,ve)):this.features.delete(Ie),this.updateCache(ve,ie)}}updateCache(Q,ie){for(const{canonical:me,uid:Ie}of Object.values(ie)){const{z:ve,x:ke,y:Oe}=me;ei(Q,Math.pow(2,ve),ke,Oe)&&delete ie[Ie]}}getTile(Q,ie,me){const Ie=Math.pow(2,Q),ve=[];for(const ke of this.features.values())ei(ke,Ie,ie,me)&&ve.push(Ni(ke,Ie,ie,me));return{features:ve}}getFeatures(){return[...this.features.values()]}}function ei({minX:Ve,minY:Q,maxX:ie,maxY:me},Ie,ve,ke){return Ve<(ve+1+Bt)/Ie&&Q<(ke+1+Bt)/Ie&&ie>(ve-Bt)/Ie&&me>(ke-Bt)/Ie}function xi(Ve){const{id:Q,geometry:ie,properties:me}=Ve;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ie,coordinates:ve}=ie,ke={id:Q,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=ke.geometry;if(Ie==="Point")It(ve,Oe,ke);else if(Ie==="MultiPoint")for(const Me of ve)It(Me,Oe,ke);else if(Ie==="LineString")ke.type=2,ui(ve,Oe,ke);else if(Ie==="MultiLineString")ke.type=2,Zt(ve,Oe,ke);else if(Ie==="Polygon")ke.type=3,Zt(ve,Oe,ke,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ke.type=3;for(const Me of ve)Zt(Me,Oe,ke,!0)}return ke}function It([Ve,Q],ie,me){const Ie=s.aD(Ve);let ve=s.aH(Q);ve=ve<0?0:ve>1?1:ve,ie.push(Ie,ve),me.minX=Math.min(me.minX,Ie),me.minY=Math.min(me.minY,ve),me.maxX=Math.max(me.maxX,Ie),me.maxY=Math.max(me.maxY,ve)}function ui(Ve,Q,ie,me=!1,Ie=!1){const ve=[];for(const ke of Ve)It(ke,ve,ie);Q.push(ve),me&&function(ke,Oe){let Me=0;for(let Be=0,tt=ke.length,ce=tt-2;Be<tt;ce=Be,Be+=2)Me+=(ke[Be]-ke[ce])*(ke[Be+1]+ke[ce+1]);if(Me>0===Oe)for(let Be=0,tt=ke.length;Be<tt/2;Be+=2){const ce=ke[Be],rt=ke[Be+1];ke[Be]=ke[tt-2-Be],ke[Be+1]=ke[tt-1-Be],ke[tt-2-Be]=ce,ke[tt-1-Be]=rt}}(ve,Ie)}function Zt(Ve,Q,ie,me=!1){for(let Ie=0;Ie<Ve.length;Ie++)ui(Ve[Ie],Q,ie,me,Ie===0)}function Ni(Ve,Q,ie,me){const{id:Ie,type:ve,geometry:ke,tags:Oe}=Ve,Me=[];if(ve===1)(function(Be,tt,ce,rt,Ct){for(let Ot=0;Ot<Be.length;Ot+=2){const li=Math.round(s.aj*(Be[Ot+0]*tt-ce)),ci=Math.round(s.aj*(Be[Ot+1]*tt-rt));Ct.push([li,ci])}})(ke,Q,ie,me,Me);else for(const Be of ke)ct(Be,Q,ie,me,Me);return{id:Ie,type:ve,geometry:Me,tags:Oe}}function ct(Ve,Q,ie,me,Ie){const ke=s.aj+Wt;let Oe;for(let Me=0;Me<Ve.length-2;Me+=2){let Be=Math.round(s.aj*(Ve[Me+0]*Q-ie)),tt=Math.round(s.aj*(Ve[Me+1]*Q-me)),ce=Math.round(s.aj*(Ve[Me+2]*Q-ie)),rt=Math.round(s.aj*(Ve[Me+3]*Q-me));const Ct=ce-Be,Ot=rt-tt;Be<-128&&ce<-128||(Be<-128?(tt+=Math.round(Ot*((-128-Be)/Ct)),Be=-128):ce<-128&&(rt=tt+Math.round(Ot*((-128-Be)/Ct)),ce=-128),tt<-128&&rt<-128||(tt<-128?(Be+=Math.round(Ct*((-128-tt)/Ot)),tt=-128):rt<-128&&(ce=Be+Math.round(Ct*((-128-tt)/Ot)),rt=-128),Be>=ke&&ce>=ke||(Be>=ke?(tt+=Math.round(Ot*((ke-Be)/Ct)),Be=ke):ce>=ke&&(rt=tt+Math.round(Ot*((ke-Be)/Ct)),ce=ke),tt>=ke&&rt>=ke||(tt>=ke?(Be+=Math.round(Ct*((ke-tt)/Ot)),tt=ke):rt>=ke&&(ce=Be+Math.round(Ct*((ke-tt)/Ot)),rt=ke),Oe&&Be===Oe[Oe.length-1][0]&&tt===Oe[Oe.length-1][1]||(Oe=[[Be,tt]],Ie.push(Oe)),Oe.push([ce,rt])))))}}var Vt,Gt,ti,vi={exports:{}},Ki=function(){if(ti)return vi.exports;ti=1;var Ve=s.fg(),Q=function(){if(Gt)return Vt;Gt=1;var tt=s.fe(),ce=s.ff().VectorTileFeature;function rt(Ot,li){this.options=li||{},this.features=Ot,this.length=Ot.length}function Ct(Ot,li){this.id=typeof Ot.id=="number"?Ot.id:void 0,this.type=Ot.type,this.rawGeometry=Ot.type===1?[Ot.geometry]:Ot.geometry,this.properties=Ot.tags,this.extent=li||4096}return Vt=rt,rt.prototype.feature=function(Ot){return new Ct(this.features[Ot],this.options.extent)},Ct.prototype.loadGeometry=function(){var Ot=this.rawGeometry;this.geometry=[];for(var li=0;li<Ot.length;li++){for(var ci=Ot[li],yi=[],Oi=0;Oi<ci.length;Oi++)yi.push(new tt(ci[Oi][0],ci[Oi][1]));this.geometry.push(yi)}return this.geometry},Ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ot=this.geometry,li=1/0,ci=-1/0,yi=1/0,Oi=-1/0,Ei=0;Ei<Ot.length;Ei++)for(var Pr=Ot[Ei],Kr=0;Kr<Pr.length;Kr++){var Qr=Pr[Kr];li=Math.min(li,Qr.x),ci=Math.max(ci,Qr.x),yi=Math.min(yi,Qr.y),Oi=Math.max(Oi,Qr.y)}return[li,yi,ci,Oi]},Ct.prototype.toGeoJSON=ce.prototype.toGeoJSON,Vt}();function ie(tt){var ce=new Ve;return function(rt,Ct){for(var Ot in rt.layers)Ct.writeMessage(3,me,rt.layers[Ot])}(tt,ce),ce.finish()}function me(tt,ce){var rt;ce.writeVarintField(15,tt.version||1),ce.writeStringField(1,tt.name||""),ce.writeVarintField(5,tt.extent||4096);var Ct={keys:[],values:[],keycache:{},valuecache:{}};for(rt=0;rt<tt.length;rt++)Ct.feature=tt.feature(rt),ce.writeMessage(2,Ie,Ct);var Ot=Ct.keys;for(rt=0;rt<Ot.length;rt++)ce.writeStringField(3,Ot[rt]);var li=Ct.values;for(rt=0;rt<li.length;rt++)ce.writeMessage(4,Be,li[rt])}function Ie(tt,ce){var rt=tt.feature;rt.id!==void 0&&ce.writeVarintField(1,rt.id),ce.writeMessage(2,ve,tt),ce.writeVarintField(3,rt.type),ce.writeMessage(4,Me,rt)}function ve(tt,ce){var rt=tt.feature,Ct=tt.keys,Ot=tt.values,li=tt.keycache,ci=tt.valuecache;for(var yi in rt.properties){var Oi=rt.properties[yi],Ei=li[yi];if(Oi!==null){Ei===void 0&&(Ct.push(yi),li[yi]=Ei=Ct.length-1),ce.writeVarint(Ei);var Pr=typeof Oi;Pr!=="string"&&Pr!=="boolean"&&Pr!=="number"&&(Oi=JSON.stringify(Oi));var Kr=Pr+":"+Oi,Qr=ci[Kr];Qr===void 0&&(Ot.push(Oi),ci[Kr]=Qr=Ot.length-1),ce.writeVarint(Qr)}}}function ke(tt,ce){return(ce<<3)+(7&tt)}function Oe(tt){return tt<<1^tt>>31}function Me(tt,ce){for(var rt=tt.loadGeometry(),Ct=tt.type,Ot=0,li=0,ci=rt.length,yi=0;yi<ci;yi++){var Oi=rt[yi],Ei=1;Ct===1&&(Ei=Oi.length),ce.writeVarint(ke(1,Ei));for(var Pr=Ct===3?Oi.length-1:Oi.length,Kr=0;Kr<Pr;Kr++){Kr===1&&Ct!==1&&ce.writeVarint(ke(2,Pr-1));var Qr=Oi[Kr].x-Ot,yr=Oi[Kr].y-li;ce.writeVarint(Oe(Qr)),ce.writeVarint(Oe(yr)),Ot+=Qr,li+=yr}Ct===3&&ce.writeVarint(ke(7,1))}}function Be(tt,ce){var rt=typeof tt;rt==="string"?ce.writeStringField(1,tt):rt==="boolean"?ce.writeBooleanField(7,tt):rt==="number"&&(tt%1!=0?ce.writeDoubleField(3,tt):tt<0?ce.writeSVarintField(6,tt):ce.writeVarintField(5,tt))}return vi.exports=ie,vi.exports.fromVectorTileJs=ie,vi.exports.fromGeojsonVt=function(tt,ce){ce=ce||{};var rt={};for(var Ct in tt)rt[Ct]=new Q(tt[Ct].features,ce),rt[Ct].name=Ct,rt[Ct].version=ce.version,rt[Ct].extent=ce.extent;return ie({layers:rt})},vi.exports.GeoJSONWrapper=Q,vi.exports}(),Zi=s.fh(Ki);const Hi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},Ii=Math.fround||(hi=new Float32Array(1),Ve=>(hi[0]=+Ve,hi[0]));var hi;const _i=3,ji=5,Er=6;class wr{constructor(Q){this.options=Object.assign(Object.create(Hi),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ie,minZoom:me,maxZoom:Ie}=this.options;ie&&console.time("total time");const ve=`prepare ${Q.length} points`;ie&&console.time(ve),this.points=Q;const ke=[];for(let Me=0;Me<Q.length;Me++){const Be=Q[Me];if(!Be.geometry)continue;const[tt,ce]=Be.geometry.coordinates,rt=Ii(Ln(tt)),Ct=Ii(ns(ce));ke.push(rt,Ct,1/0,Me,-1,1),this.options.reduce&&ke.push(0)}let Oe=this.trees[Ie+1]=this._createTree(ke);ie&&console.timeEnd(ve);for(let Me=Ie;Me>=me;Me--){const Be=+Date.now();Oe=this.trees[Me]=this._createTree(this._cluster(Oe,Me)),ie&&console.log("z%d: %d clusters in %dms",Me,Oe.numItems,+Date.now()-Be)}return ie&&console.timeEnd("total time"),this}getClusters(Q,ie){let me=((Q[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,Q[1]));let ve=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)me=-180,ve=180;else if(me>ve){const ce=this.getClusters([me,Ie,180,ke],ie),rt=this.getClusters([-180,Ie,ve,ke],ie);return ce.concat(rt)}const Oe=this.trees[this._limitZoom(ie)],Me=Oe.range(Ln(me),ns(ke),Ln(ve),ns(Ie)),Be=Oe.data,tt=[];for(const ce of Me){const rt=this.stride*ce;tt.push(Be[rt+ji]>1?nr(Be,rt,this.clusterProps):this.points[Be[rt+_i]])}return tt}getChildren(Q){const ie=this._getOriginId(Q),me=this._getOriginZoom(Q),Ie="No cluster with the specified id.",ve=this.trees[me];if(!ve)throw new Error(Ie);const ke=ve.data;if(ie*this.stride>=ke.length)throw new Error(Ie);const Oe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Me=ve.within(ke[ie*this.stride],ke[ie*this.stride+1],Oe),Be=[];for(const tt of Me){const ce=tt*this.stride;ke[ce+4]===Q&&Be.push(ke[ce+ji]>1?nr(ke,ce,this.clusterProps):this.points[ke[ce+_i]])}if(Be.length===0)throw new Error(Ie);return Be}getLeaves(Q,ie,me){const Ie=[];return this._appendLeaves(Ie,Q,ie=ie||10,me=me||0,0),Ie}getTile(Q,ie,me){const Ie=this.trees[this._limitZoom(Q)],ve=Math.pow(2,Q),{extent:ke,radius:Oe}=this.options,Me=Oe/ke,Be=(me-Me)/ve,tt=(me+1+Me)/ve,ce={features:[]};return this._addTileFeatures(Ie.range((ie-Me)/ve,Be,(ie+1+Me)/ve,tt),Ie.data,ie,me,ve,ce),ie===0&&this._addTileFeatures(Ie.range(1-Me/ve,Be,1,tt),Ie.data,ve,me,ve,ce),ie===ve-1&&this._addTileFeatures(Ie.range(0,Be,Me/ve,tt),Ie.data,-1,me,ve,ce),ce.features.length?ce:null}getClusterExpansionZoom(Q){let ie=this._getOriginZoom(Q)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(Q);if(ie++,me.length!==1)break;Q=me[0].properties.cluster_id}return ie}_appendLeaves(Q,ie,me,Ie,ve){const ke=this.getChildren(ie);for(const Oe of ke){const Me=Oe.properties;if(Me&&Me.cluster?ve+Me.point_count<=Ie?ve+=Me.point_count:ve=this._appendLeaves(Q,Me.cluster_id,me,Ie,ve):ve<Ie?ve++:Q.push(Oe),Q.length===me)break}return ve}_createTree(Q){const ie=new s.bW(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<Q.length;me+=this.stride)ie.add(Q[me],Q[me+1]);return ie.finish(),ie.data=Q,ie}_addTileFeatures(Q,ie,me,Ie,ve,ke){for(const Oe of Q){const Me=Oe*this.stride,Be=ie[Me+ji]>1;let tt,ce,rt;if(Be)tt=dr(ie,Me,this.clusterProps),ce=ie[Me],rt=ie[Me+1];else{const li=this.points[ie[Me+_i]];tt=li.properties;const[ci,yi]=li.geometry.coordinates;ce=Ln(ci),rt=ns(yi)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(ce*ve-me)),Math.round(this.options.extent*(rt*ve-Ie))]],tags:tt};let Ot;Ot=Be||this.options.generateId?ie[Me+_i]:this.points[ie[Me+_i]].id,Ot!==void 0&&(Ct.id=Ot),ke.features.push(Ct)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ie){const{radius:me,extent:Ie,reduce:ve,minPoints:ke}=this.options,Oe=me/(Ie*Math.pow(2,ie)),Me=Q.data,Be=[],tt=this.stride;for(let ce=0;ce<Me.length;ce+=tt){if(Me[ce+2]<=ie)continue;Me[ce+2]=ie;const rt=Me[ce],Ct=Me[ce+1],Ot=Q.within(Me[ce],Me[ce+1],Oe),li=Me[ce+ji];let ci=li;for(const yi of Ot){const Oi=yi*tt;Me[Oi+2]>ie&&(ci+=Me[Oi+ji])}if(ci>li&&ci>=ke){let yi,Oi=rt*li,Ei=Ct*li,Pr=-1;const Kr=(ce/tt<<5)+(ie+1)+this.points.length;for(const Qr of Ot){const yr=Qr*tt;if(Me[yr+2]<=ie)continue;Me[yr+2]=ie;const sr=Me[yr+ji];Oi+=Me[yr]*sr,Ei+=Me[yr+1]*sr,Me[yr+4]=Kr,ve&&(yi||(yi=this._map(Me,ce,!0),Pr=this.clusterProps.length,this.clusterProps.push(yi)),ve(yi,this._map(Me,yr)))}Me[ce+4]=Kr,Be.push(Oi/ci,Ei/ci,1/0,Kr,-1,ci),ve&&Be.push(Pr)}else{for(let yi=0;yi<tt;yi++)Be.push(Me[ce+yi]);if(ci>1)for(const yi of Ot){const Oi=yi*tt;if(!(Me[Oi+2]<=ie)){Me[Oi+2]=ie;for(let Ei=0;Ei<tt;Ei++)Be.push(Me[Oi+Ei])}}}}return Be}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ie,me){if(Q[ie+ji]>1){const ke=this.clusterProps[Q[ie+Er]];return me?Object.assign({},ke):ke}const Ie=this.points[Q[ie+_i]].properties,ve=this.options.map(Ie);return me&&ve===Ie?Object.assign({},ve):ve}}function nr(Ve,Q,ie){return{type:"Feature",id:Ve[Q+_i],properties:dr(Ve,Q,ie),geometry:{type:"Point",coordinates:[(me=Ve[Q],360*(me-.5)),pn(Ve[Q+1])]}};var me}function dr(Ve,Q,ie){const me=Ve[Q+ji],Ie=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,ve=Ve[Q+Er],ke=ve===-1?{}:Object.assign({},ie[ve]);return Object.assign(ke,{cluster:!0,cluster_id:Ve[Q+_i],point_count:me,point_count_abbreviated:Ie})}function Ln(Ve){return Ve/360+.5}function ns(Ve){const Q=Math.sin(Ve*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function pn(Ve){const Q=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function ys(Ve,Q,ie,me){let Ie=me;const ve=Q+(ie-Q>>1);let ke,Oe=ie-Q;const Me=Ve[Q],Be=Ve[Q+1],tt=Ve[ie],ce=Ve[ie+1];for(let rt=Q+3;rt<ie;rt+=3){const Ct=Eo(Ve[rt],Ve[rt+1],Me,Be,tt,ce);if(Ct>Ie)ke=rt,Ie=Ct;else if(Ct===Ie){const Ot=Math.abs(rt-ve);Ot<Oe&&(ke=rt,Oe=Ot)}}Ie>me&&(ke-Q>3&&ys(Ve,Q,ke,me),Ve[ke+2]=Ie,ie-ke>3&&ys(Ve,ke,ie,me))}function Eo(Ve,Q,ie,me,Ie,ve){let ke=Ie-ie,Oe=ve-me;if(ke!==0||Oe!==0){const Me=((Ve-ie)*ke+(Q-me)*Oe)/(ke*ke+Oe*Oe);Me>1?(ie=Ie,me=ve):Me>0&&(ie+=ke*Me,me+=Oe*Me)}return ke=Ve-ie,Oe=Q-me,ke*ke+Oe*Oe}function Ur(Ve,Q,ie,me){const Ie={id:Ve??null,type:Q,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")Fn(Ie,ie);else if(Q==="Polygon")Fn(Ie,ie[0]);else if(Q==="MultiLineString")for(const ve of ie)Fn(Ie,ve);else if(Q==="MultiPolygon")for(const ve of ie)Fn(Ie,ve[0]);return Ie}function Fn(Ve,Q){for(let ie=0;ie<Q.length;ie+=3)Ve.minX=Math.min(Ve.minX,Q[ie]),Ve.minY=Math.min(Ve.minY,Q[ie+1]),Ve.maxX=Math.max(Ve.maxX,Q[ie]),Ve.maxY=Math.max(Ve.maxY,Q[ie+1])}function Co(Ve,Q,ie,me){if(!Q.geometry)return;const Ie=Q.geometry.coordinates;if(Ie&&Ie.length===0)return;const ve=Q.geometry.type,ke=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let Oe=[],Me=Q.id;if(ie.promoteId?Me=Q.properties[ie.promoteId]:ie.generateId&&(Me=me||0),ve==="Point")Io(Ie,Oe);else if(ve==="MultiPoint")for(const Be of Ie)Io(Be,Oe);else if(ve==="LineString")Os(Ie,Oe,ke,!1);else if(ve==="MultiLineString"){if(ie.lineMetrics){for(const Be of Ie)Oe=[],Os(Be,Oe,ke,!1),Ve.push(Ur(Me,"LineString",Oe,Q.properties));return}Qn(Ie,Oe,ke,!1)}else if(ve==="Polygon")Qn(Ie,Oe,ke,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const Be of Q.geometry.geometries)Co(Ve,{id:Me,geometry:Be,properties:Q.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Be of Ie){const tt=[];Qn(Be,tt,ke,!0),Oe.push(tt)}}Ve.push(Ur(Me,ve,Oe,Q.properties))}function Io(Ve,Q){Q.push(Wo(Ve[0]),Ao(Ve[1]),0)}function Os(Ve,Q,ie,me){let Ie,ve,ke=0;for(let Me=0;Me<Ve.length;Me++){const Be=Wo(Ve[Me][0]),tt=Ao(Ve[Me][1]);Q.push(Be,tt,0),Me>0&&(ke+=me?(Ie*tt-Be*ve)/2:Math.sqrt(Math.pow(Be-Ie,2)+Math.pow(tt-ve,2))),Ie=Be,ve=tt}const Oe=Q.length-3;Q[2]=1,ys(Q,0,Oe,ie),Q[Oe+2]=1,Q.size=Math.abs(ke),Q.start=0,Q.end=Q.size}function Qn(Ve,Q,ie,me){for(let Ie=0;Ie<Ve.length;Ie++){const ve=[];Os(Ve[Ie],ve,ie,me),Q.push(ve)}}function Wo(Ve){return Ve/360+.5}function Ao(Ve){const Q=Math.sin(Ve*Math.PI/180),ie=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ie<0?0:ie>1?1:ie}function On(Ve,Q,ie,me,Ie,ve,ke,Oe){if(me/=Q,ve>=(ie/=Q)&&ke<me)return Ve;if(ke<ie||ve>=me)return null;const Me=[];for(const Be of Ve){const tt=Be.geometry;let ce=Be.type;const rt=Ie===0?Be.minX:Be.minY,Ct=Ie===0?Be.maxX:Be.maxY;if(rt>=ie&&Ct<me){Me.push(Be);continue}if(Ct<ie||rt>=me)continue;let Ot=[];if(ce==="Point"||ce==="MultiPoint")_a(tt,Ot,ie,me,Ie);else if(ce==="LineString")ds(tt,Ot,ie,me,Ie,!1,Oe.lineMetrics);else if(ce==="MultiLineString")Hn(tt,Ot,ie,me,Ie,!1);else if(ce==="Polygon")Hn(tt,Ot,ie,me,Ie,!0);else if(ce==="MultiPolygon")for(const li of tt){const ci=[];Hn(li,ci,ie,me,Ie,!0),ci.length&&Ot.push(ci)}if(Ot.length){if(Oe.lineMetrics&&ce==="LineString"){for(const li of Ot)Me.push(Ur(Be.id,ce,li,Be.tags));continue}ce!=="LineString"&&ce!=="MultiLineString"||(Ot.length===1?(ce="LineString",Ot=Ot[0]):ce="MultiLineString"),ce!=="Point"&&ce!=="MultiPoint"||(ce=Ot.length===3?"Point":"MultiPoint"),Me.push(Ur(Be.id,ce,Ot,Be.tags))}}return Me.length?Me:null}function _a(Ve,Q,ie,me,Ie){for(let ve=0;ve<Ve.length;ve+=3){const ke=Ve[ve+Ie];ke>=ie&&ke<=me&&xs(Q,Ve[ve],Ve[ve+1],Ve[ve+2])}}function ds(Ve,Q,ie,me,Ie,ve,ke){let Oe=Zo(Ve);const Me=Ie===0?Po:Mo;let Be,tt,ce=Ve.start;for(let ci=0;ci<Ve.length-3;ci+=3){const yi=Ve[ci],Oi=Ve[ci+1],Ei=Ve[ci+2],Pr=Ve[ci+3],Kr=Ve[ci+4],Qr=Ie===0?yi:Oi,yr=Ie===0?Pr:Kr;let sr=!1;ke&&(Be=Math.sqrt(Math.pow(yi-Pr,2)+Math.pow(Oi-Kr,2))),Qr<ie?yr>ie&&(tt=Me(Oe,yi,Oi,Pr,Kr,ie),ke&&(Oe.start=ce+Be*tt)):Qr>me?yr<me&&(tt=Me(Oe,yi,Oi,Pr,Kr,me),ke&&(Oe.start=ce+Be*tt)):xs(Oe,yi,Oi,Ei),yr<ie&&Qr>=ie&&(tt=Me(Oe,yi,Oi,Pr,Kr,ie),sr=!0),yr>me&&Qr<=me&&(tt=Me(Oe,yi,Oi,Pr,Kr,me),sr=!0),!ve&&sr&&(ke&&(Oe.end=ce+Be*tt),Q.push(Oe),Oe=Zo(Ve)),ke&&(ce+=Be)}let rt=Ve.length-3;const Ct=Ve[rt],Ot=Ve[rt+1],li=Ie===0?Ct:Ot;li>=ie&&li<=me&&xs(Oe,Ct,Ot,Ve[rt+2]),rt=Oe.length-3,ve&&rt>=3&&(Oe[rt]!==Oe[0]||Oe[rt+1]!==Oe[1])&&xs(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Q.push(Oe)}function Zo(Ve){const Q=[];return Q.size=Ve.size,Q.start=Ve.start,Q.end=Ve.end,Q}function Hn(Ve,Q,ie,me,Ie,ve){for(const ke of Ve)ds(ke,Q,ie,me,Ie,ve,!1)}function xs(Ve,Q,ie,me){Ve.push(Q,ie,me)}function Po(Ve,Q,ie,me,Ie,ve){const ke=(ve-Q)/(me-Q);return xs(Ve,ve,ie+(Ie-ie)*ke,1),ke}function Mo(Ve,Q,ie,me,Ie,ve){const ke=(ve-ie)/(Ie-ie);return xs(Ve,Q+(me-Q)*ke,ve,1),ke}function ho(Ve,Q){const ie=[];for(let me=0;me<Ve.length;me++){const Ie=Ve[me],ve=Ie.type;let ke;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")ke=ss(Ie.geometry,Q);else if(ve==="MultiLineString"||ve==="Polygon"){ke=[];for(const Oe of Ie.geometry)ke.push(ss(Oe,Q))}else if(ve==="MultiPolygon"){ke=[];for(const Oe of Ie.geometry){const Me=[];for(const Be of Oe)Me.push(ss(Be,Q));ke.push(Me)}}ie.push(Ur(Ie.id,ve,ke,Ie.tags))}return ie}function ss(Ve,Q){const ie=[];ie.size=Ve.size,Ve.start!==void 0&&(ie.start=Ve.start,ie.end=Ve.end);for(let me=0;me<Ve.length;me+=3)ie.push(Ve[me]+Q,Ve[me+1],Ve[me+2]);return ie}function ya(Ve,Q){if(Ve.transformed)return Ve;const ie=1<<Ve.z,me=Ve.x,Ie=Ve.y;for(const ve of Ve.features){const ke=ve.geometry,Oe=ve.type;if(ve.geometry=[],Oe===1)for(let Me=0;Me<ke.length;Me+=2)ve.geometry.push(di(ke[Me],ke[Me+1],Q,ie,me,Ie));else for(let Me=0;Me<ke.length;Me++){const Be=[];for(let tt=0;tt<ke[Me].length;tt+=2)Be.push(di(ke[Me][tt],ke[Me][tt+1],Q,ie,me,Ie));ve.geometry.push(Be)}}return Ve.transformed=!0,Ve}function di(Ve,Q,ie,me,Ie,ve){return[Math.round(ie*(Ve*me-Ie)),Math.round(ie*(Q*me-ve))]}function Yr(Ve,Q,ie,me,Ie){const ve=Q===Ie.maxZoom?0:Ie.tolerance/((1<<Q)*Ie.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:ie,y:me,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Ve)rn(ke,Oe,ve,Ie);return ke}function rn(Ve,Q,ie,me){const Ie=Q.geometry,ve=Q.type,ke=[];if(Ve.minX=Math.min(Ve.minX,Q.minX),Ve.minY=Math.min(Ve.minY,Q.minY),Ve.maxX=Math.max(Ve.maxX,Q.maxX),Ve.maxY=Math.max(Ve.maxY,Q.maxY),ve==="Point"||ve==="MultiPoint")for(let Oe=0;Oe<Ie.length;Oe+=3)ke.push(Ie[Oe],Ie[Oe+1]),Ve.numPoints++,Ve.numSimplified++;else if(ve==="LineString")bn(ke,Ie,Ve,ie,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let Oe=0;Oe<Ie.length;Oe++)bn(ke,Ie[Oe],Ve,ie,ve==="Polygon",Oe===0);else if(ve==="MultiPolygon")for(let Oe=0;Oe<Ie.length;Oe++){const Me=Ie[Oe];for(let Be=0;Be<Me.length;Be++)bn(ke,Me[Be],Ve,ie,!0,Be===0)}if(ke.length){let Oe=Q.tags||null;if(ve==="LineString"&&me.lineMetrics){Oe={};for(const Be in Q.tags)Oe[Be]=Q.tags[Be];Oe.mapbox_clip_start=Ie.start/Ie.size,Oe.mapbox_clip_end=Ie.end/Ie.size}const Me={geometry:ke,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Oe};Q.id!==null&&(Me.id=Q.id),Ve.features.push(Me)}}function bn(Ve,Q,ie,me,Ie,ve){const ke=me*me;if(me>0&&Q.size<(Ie?ke:me))return void(ie.numPoints+=Q.length/3);const Oe=[];for(let Me=0;Me<Q.length;Me+=3)(me===0||Q[Me+2]>ke)&&(ie.numSimplified++,Oe.push(Q[Me],Q[Me+1])),ie.numPoints++;Ie&&function(Me,Be){let tt=0;for(let ce=0,rt=Me.length,Ct=rt-2;ce<rt;Ct=ce,ce+=2)tt+=(Me[ce]-Me[Ct])*(Me[ce+1]+Me[Ct+1]);if(tt>0===Be)for(let ce=0,rt=Me.length;ce<rt/2;ce+=2){const Ct=Me[ce],Ot=Me[ce+1];Me[ce]=Me[rt-2-ce],Me[ce+1]=Me[rt-1-ce],Me[rt-2-ce]=Ct,Me[rt-1-ce]=Ot}}(Oe,ve),Ve.push(Oe)}const As={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xo{constructor(Q,ie){const me=(ie=this.options=function(ve,ke){for(const Oe in ke)ve[Oe]=ke[Oe];return ve}(Object.create(As),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(ve,ke){const Oe=[];if(ve.type==="FeatureCollection")for(let Me=0;Me<ve.features.length;Me++)Co(Oe,ve.features[Me],ke,Me);else Co(Oe,ve.type==="Feature"?ve:{geometry:ve},ke);return Oe}(Q,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(ve,ke){const Oe=ke.buffer/ke.extent;let Me=ve;const Be=On(ve,1,-1-Oe,Oe,0,-1,2,ke),tt=On(ve,1,1-Oe,2+Oe,0,-1,2,ke);return(Be||tt)&&(Me=On(ve,1,-Oe,1+Oe,0,-1,2,ke)||[],Be&&(Me=ho(Be,1).concat(Me)),tt&&(Me=Me.concat(ho(tt,-1)))),Me}(Ie,ie),Ie.length&&this.splitTile(Ie,0,0,0),me&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ie,me,Ie,ve,ke,Oe){const Me=[Q,ie,me,Ie],Be=this.options,tt=Be.debug;for(;Me.length;){Ie=Me.pop(),me=Me.pop(),ie=Me.pop(),Q=Me.pop();const ce=1<<ie,rt=Yo(ie,me,Ie);let Ct=this.tiles[rt];if(!Ct&&(tt>1&&console.time("creation"),Ct=this.tiles[rt]=Yr(Q,ie,me,Ie,Be),this.tileCoords.push({z:ie,x:me,y:Ie}),tt)){tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Ie,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));const sr=`z${ie}`;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(Ct.source=Q,ve==null){if(ie===Be.indexMaxZoom||Ct.numPoints<=Be.indexMaxPoints)continue}else{if(ie===Be.maxZoom||ie===ve)continue;if(ve!=null){const sr=ve-ie;if(me!==ke>>sr||Ie!==Oe>>sr)continue}}if(Ct.source=null,Q.length===0)continue;tt>1&&console.time("clipping");const Ot=.5*Be.buffer/Be.extent,li=.5-Ot,ci=.5+Ot,yi=1+Ot;let Oi=null,Ei=null,Pr=null,Kr=null,Qr=On(Q,ce,me-Ot,me+ci,0,Ct.minX,Ct.maxX,Be),yr=On(Q,ce,me+li,me+yi,0,Ct.minX,Ct.maxX,Be);Q=null,Qr&&(Oi=On(Qr,ce,Ie-Ot,Ie+ci,1,Ct.minY,Ct.maxY,Be),Ei=On(Qr,ce,Ie+li,Ie+yi,1,Ct.minY,Ct.maxY,Be),Qr=null),yr&&(Pr=On(yr,ce,Ie-Ot,Ie+ci,1,Ct.minY,Ct.maxY,Be),Kr=On(yr,ce,Ie+li,Ie+yi,1,Ct.minY,Ct.maxY,Be),yr=null),tt>1&&console.timeEnd("clipping"),Me.push(Oi||[],ie+1,2*me,2*Ie),Me.push(Ei||[],ie+1,2*me,2*Ie+1),Me.push(Pr||[],ie+1,2*me+1,2*Ie),Me.push(Kr||[],ie+1,2*me+1,2*Ie+1)}}getTile(Q,ie,me){Q=+Q,ie=+ie,me=+me;const Ie=this.options,{extent:ve,debug:ke}=Ie;if(Q<0||Q>24)return null;const Oe=1<<Q,Me=Yo(Q,ie=ie+Oe&Oe-1,me);if(this.tiles[Me])return ya(this.tiles[Me],ve);ke>1&&console.log("drilling down to z%d-%d-%d",Q,ie,me);let Be,tt=Q,ce=ie,rt=me;for(;!Be&&tt>0;)tt--,ce>>=1,rt>>=1,Be=this.tiles[Yo(tt,ce,rt)];return Be&&Be.source?(ke>1&&(console.log("found parent tile z%d-%d-%d",tt,ce,rt),console.time("drilling down")),this.splitTile(Be.source,tt,ce,rt,Q,ie,me),ke>1&&console.timeEnd("drilling down"),this.tiles[Me]?ya(this.tiles[Me],ve):null):null}}function Yo(Ve,Q,ie){return 32*((1<<Ve)*ie+Q)+Ve}function wt(Ve,Q){const ie=Ve.tileID.canonical;if(!this._geoJSONIndex)return void Q(null,null);const me=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!me)return void Q(null,null);const Ie=Me=>Me.tags&&"3d_elevation_id"in Me.tags&&"source"in Me.tags&&Me.tags.source==="elevation",ve=me.features.filter(Me=>Ie(Me));let ke;if(ve.length>0){const Me=me.features.filter(Be=>!Ie(Be));ke=new dt({_geojsonTileLayer:Me,hd_road_elevation:ve})}else ke=new pt(me.features);let Oe=Zi(ke);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),Q(null,{vectorTile:ke,rawData:Oe.buffer})}class Ko extends le{constructor(Q,ie,me,Ie,ve,ke,Oe){super(Q,ie,me,Ie,ve,wt,Oe),ke&&(this.loadGeoJSON=ke),this._dynamicIndex=new Ht}loadData(Q,ie){const me=Q&&Q.request,Ie=me&&me.collectResourceTiming;this.loadGeoJSON(Q,(ve,ke)=>{if(ve||!ke)return ie(ve);if(typeof ke!="object")return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{try{if(Q.filter){const Me=s.X(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Me.result==="error")throw new Error(Me.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));ke.features=ke.features.filter(Be=>Me.value.evaluate({zoom:0},Be))}Q.dynamic?(ke.type==="Feature"&&(ke={type:"FeatureCollection",features:[ke]}),Q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ke.features,this.loaded),Q.cluster&&(ke.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Q.cluster?new wr(function({superclusterOptions:Me,clusterProperties:Be}){if(!Be||!Me)return Me;const tt={},ce={},rt={accumulated:null,zoom:0},Ct={properties:null},Ot=Object.keys(Be);for(const li of Ot){const[ci,yi]=Be[li],Oi=s.X(yi),Ei=s.X(typeof ci=="string"?[ci,["accumulated"],["get",li]]:ci);tt[li]=Oi.value,ce[li]=Ei.value}return Me.map=li=>{Ct.properties=li;const ci={};for(const yi of Ot)ci[yi]=tt[yi].evaluate(rt,Ct);return ci},Me.reduce=(li,ci)=>{Ct.properties=ci;for(const yi of Ot)rt.accumulated=li[yi],li[yi]=ce[yi].evaluate(rt,Ct)},Me}(Q)).load(ke.features):Q.dynamic?this._dynamicIndex:function(Me,Be){return new Xo(Me,Be)}(ke,Q.geojsonVtOptions)}catch(Me){return ie(Me)}const Oe={};if(Ie){const Me=D(me);Me&&(Oe.resourceTiming={},Oe.resourceTiming[Q.source]=JSON.parse(JSON.stringify(Me)))}ie(null,Oe)}})}reloadTile(Q,ie){const me=this.loaded;return me&&me[Q.uid]?Q.partial?ie(null,void 0):super.reloadTile(Q,ie):this.loadTile(Q,ie)}loadGeoJSON(Q,ie){if(Q.request)s.n(Q.request,ie);else{if(typeof Q.data!="string")return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Q.data))}catch{return ie(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Q,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(me){ie(me)}}getClusterChildren(Q,ie){try{ie(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(me){ie(me)}}getClusterLeaves(Q,ie){try{ie(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(me){ie(me)}}}class Ch{constructor(Q,ie,me){this.tileID=new s.aM(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Q.projection,this.brightness=ie,this.worldview=me}parse(Q,ie,me,Ie){this.status="parsing";const ve=new s.aM(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),ke=[],Oe=ie.familiesBySource[me.source],Me=new s.f0(ve,me.promoteId);Me.bucketLayerIDs=[],Me.is3DTile=!0,s.fi(Q).then(Be=>{if(!Be)return Ie(new Error("Could not parse tile"));const tt=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("MAPBOX_mesh_features")||Be.json.asset.extras&&Be.json.asset.extras.MAPBOX_mesh_features,ce=Be.json.extensionsUsed&&Be.json.extensionsUsed.includes("EXT_meshopt_compression"),rt=new s.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ct in Oe)for(const Ot of Oe[Ct]){const li=Ot[0];Me.bucketLayerIDs.push(Ot.map(Oi=>s.C(Oi.id,Oi.scope))),li.recalculate(rt,[]);const ci=s.fj(Be,1/s.cU(me.tileID.canonical)),yi=new s.fk(Ot,ci,ve,tt,ce,this.brightness,Me,this.worldview);tt||(yi.needsUpload=!0),ke.push(yi),yi.evaluate(li)}this.status="done",Ie(null,{buckets:ke,featureIndex:Me,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Be=>Ie(new Error(Be.message)))}}class tc{constructor(Q,ie,me,Ie,ve,ke,Oe,Me){this.actor=Q,this.layerIndex=ie,this.availableImages=me,this.availableModels=Ie,this.brightness=Oe,this.loading={},this.loaded={},this.worldview=Me}loadTile(Q,ie){const me=Q.uid,Ie=this.loading[me]=new Ch(Q,this.brightness,this.worldview);s.br(Q.request,(ve,ke)=>{const Oe=!this.loading[me];return delete this.loading[me],Oe||ve?(Ie.status="done",Oe||(this.loaded[me]=Ie),ie(ve)):ke&&ke.byteLength!==0?void Ie.parse(ke,this.layerIndex,Q,(Me,Be)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[me]=Ie,Me||!Be?ie(Me):ie(null,Be)}):(Ie.status="done",this.loaded[me]=Ie,ie())})}reloadTile(Q,ie){const me=this.loaded,Ie=Q.uid;if(me&&me[Ie]){const ve=me[Ie];ve.projection=Q.projection,ve.brightness=Q.brightness;const ke=(Oe,Me)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(Q,ie)),ie(Oe,Me)};ve.status==="parsing"?ve.reloadCallback=ke:ve.status==="done"&&this.loadTile(Q,ie)}}abortTile(Q,ie){const me=Q.uid;this.loading[me]&&delete this.loading[me],ie()}removeTile(Q,ie){const me=this.loaded,Ie=Q.uid;me&&me[Ie]&&delete me[Ie],ie()}}class Qi{constructor(Q){this.self=Q,this.actor=new s.fm(Q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.ce({name:"mercator"}),this.workerSourceTypes={vector:le,geojson:Ko,"raster-dem":re,"raster-array":_e,"batched-model":tc},this.workerSources={},this.self.registerWorkerSource=(ie,me)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=me},this.self.registerRTLTextPlugin=ie=>{if(s.fn.isParsed())throw new Error("RTL text plugin already registered.");s.fn.setState({pluginStatus:s.fo.parsed,pluginURL:s.fn.getPluginURL()}),s.fn.applyArabicShaping=ie.applyArabicShaping,s.fn.processBidirectionalText=ie.processBidirectionalText,s.fn.processStyledBidirectionalText=ie.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Q,ie,me){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.availableModels[Q],delete this.workerSources[Q],me()}checkIfReady(Q,ie,me){me()}setReferrer(Q,ie){this.referrer=ie}spriteLoaded(Q,ie){this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={});const{scope:me,isLoaded:Ie}=ie;if(this.isSpriteLoaded[Q][me]=Ie,this.workerSources[Q]&&this.workerSources[Q][me])for(const ve in this.workerSources[Q][me]){const ke=this.workerSources[Q][me][ve];for(const Oe in ke){const Me=ke[Oe];Me instanceof le&&(Me.isSpriteLoaded=Ie,Me.fire(new s.A("isSpriteLoaded")))}}}setImages(Q,ie,me){this.availableImages[Q]||(this.availableImages[Q]={});const{scope:Ie,images:ve}=ie;if(this.availableImages[Q][Ie]=ve,this.workerSources[Q]&&this.workerSources[Q][Ie]){for(const ke in this.workerSources[Q][Ie]){const Oe=this.workerSources[Q][Ie][ke];for(const Me in Oe)Oe[Me].availableImages=ve}me()}else me()}setModels(Q,{scope:ie,models:me},Ie){if(this.availableModels[Q]||(this.availableModels[Q]={}),this.availableModels[Q][ie]=me,this.workerSources[Q]&&this.workerSources[Q][ie]){for(const ve in this.workerSources[Q][ie]){const ke=this.workerSources[Q][ie][ve];for(const Oe in ke)ke[Oe].availableModels=me}Ie()}else Ie()}setProjection(Q,ie){this.projections[Q]=s.ce(ie)}setBrightness(Q,ie,me){this.brightness=ie,me()}setWorldview(Q,ie,me){this.worldview=ie,me()}setLayers(Q,ie,me){this.getLayerIndex(Q,ie.scope).replace(ie.layers,ie.options),me()}updateLayers(Q,ie,me){this.getLayerIndex(Q,ie.scope).update(ie.layers,ie.removedIds,ie.options),me()}loadTile(Q,ie,me){ie.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source,ie.scope).loadTile(ie,me)}decodeRasterArray(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source,ie.scope).decodeRasterArray(ie,me)}reloadTile(Q,ie,me){ie.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ie.type,ie.source,ie.scope).reloadTile(ie,me)}abortTile(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source,ie.scope).abortTile(ie,me)}removeTile(Q,ie,me){this.getWorkerSource(Q,ie.type,ie.source,ie.scope).removeTile(ie,me)}removeSource(Q,ie,me){if(!(this.workerSources[Q]&&this.workerSources[Q][ie.scope]&&this.workerSources[Q][ie.scope][ie.type]&&this.workerSources[Q][ie.scope][ie.type][ie.source]))return;const Ie=this.workerSources[Q][ie.scope][ie.type][ie.source];delete this.workerSources[Q][ie.scope][ie.type][ie.source],Ie.removeSource!==void 0?Ie.removeSource(ie,me):me()}loadWorkerSource(Q,ie,me){try{this.self.importScripts(ie.url),me()}catch(Ie){me(Ie.toString())}}syncRTLPluginState(Q,ie,me){if(s.fn.isParsed())me(null,!0);else if(s.fn.isParsing())this.rtlPluginParsingListeners.push(me);else try{s.fn.setState(ie);const Ie=s.fn.getPluginURL();!s.fn.isLoaded()||s.fn.isParsed()||s.fn.isParsing()||Ie==null||(s.fn.setState({pluginStatus:s.fo.parsing,pluginURL:s.fn.getPluginURL()}),this.self.importScripts(Ie),s.fn.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(Ie){me(Ie.toString())}}setDracoUrl(Q,ie){this.dracoUrl=ie}getAvailableImages(Q,ie){this.availableImages[Q]||(this.availableImages[Q]={});let me=this.availableImages[Q][ie];return me||(me=[]),me}getAvailableModels(Q,ie){this.availableModels[Q]||(this.availableModels[Q]={});let me=this.availableModels[Q][ie];return me||(me={}),me}getLayerIndex(Q,ie){this.layerIndexes[Q]||(this.layerIndexes[Q]={});let me=this.layerIndexes[Q][ie];return me||(me=this.layerIndexes[Q][ie]=new G,me.scope=ie),me}getWorkerSource(Q,ie,me,Ie){const ve=this.workerSources;return ve[Q]||(ve[Q]={}),ve[Q][Ie]||(ve[Q][Ie]={}),ve[Q][Ie][ie]||(ve[Q][Ie][ie]={}),this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),ve[Q][Ie][ie][me]||(ve[Q][Ie][ie][me]=new this.workerSourceTypes[ie]({send:(ke,Oe,Me,Be,tt,ce)=>this.actor.send(ke,Oe,Me,Q,tt,ce),scheduler:this.actor.scheduler},this.getLayerIndex(Q,Ie),this.getAvailableImages(Q,Ie),this.getAvailableModels(Q,Ie),this.isSpriteLoaded[Q][Ie],void 0,this.brightness,this.worldview)),ve[Q][Ie][ie][me]}rasterizeImagesWorker(Q,ie,me){const Ie=new Map;for(const[ve,{image:ke,imageVariant:Oe}]of ie.tasks.entries()){const Me=this.imageRasterizer.rasterize(Oe,ke,ie.scope,Q);Ie.set(ve,Me)}me(void 0,Ie)}removeRasterizedImages(Q,ie,me){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,Q),me()}enforceCacheSizeLimit(Q,ie){s.fp(ie)}getWorkerPerformanceMetrics(Q,ie,me){me(void 0,void 0)}}return s.fl(self)&&(self.worker=new Qi(self)),Qi}),E(["./shared"],function(s){var D="3.13.0";const O={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(h){performance.mark(h)},measure(h,t,a){performance.measure(h,t,a)}};function G(h){const t=h.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var U,he={},de=function(){if(U)return he;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,v,T=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(T);try{v=new Worker(C),y=!0}catch{y=!1}return v&&v.terminate(),URL.revokeObjectURL(C),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var v=y.getContext("2d");if(!v)return!1;var T=v.getImageData(0,0,1,1);return T&&T.width===y.width}()?(a[g=d&&d.failIfMajorPerformanceCaveat]===void 0&&(a[g]=function(y){var v,T=function(C){var R=document.createElement("canvas"),k=Object.create(h.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=C,R.getContext("webgl2",k)}(y);if(!T)return!1;try{v=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!v||T.isContextLost())&&(T.shaderSource(v,"void main() {}"),T.compileShader(v),T.getShaderParameter(v,T.COMPILE_STATUS)===!0)}(g)),a[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}U=1,he.supported=h,he.notSupportedReason=t;var a={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},he}();function Y(h,t,a){const d=document.createElement(h);return t!=null&&(d.className=t),a&&a.appendChild(d),d}function le(h,t,a){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(t))d.setAttributeNS(null,g,String(t[g]));return a&&a.appendChild(d),d}const re=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=re&&re.userSelect!==void 0?"userSelect":"WebkitUserSelect";let _e;function Ne(){re&&oe&&(_e=re[oe],re[oe]="none")}function Ge(){re&&oe&&(re[oe]=_e)}function pt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",pt,!0)}function ot(){window.addEventListener("click",pt,!0),window.setTimeout(()=>{window.removeEventListener("click",pt,!0)},0)}function dt(h,t){const a=h.getBoundingClientRect();return Ht(h,a,t)}function Bt(h,t){const a=h.getBoundingClientRect(),d=[];for(let g=0;g<t.length;g++)d.push(Ht(h,a,t[g]));return d}function Wt(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Ht(h,t,a){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new s.P((a.clientX-t.left)*d,(a.clientY-t.top)*d)}const ei="01",xi="NO_ACCESS_TOKEN";class It{constructor(t,a,d){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let a="";for(let d=0;d<10;d++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ei,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!s.j(t))return t;const d=Zt(t);return d.params.push(`sdk=js-${D}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!s.j(t))return t;const d=Zt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeModelURL(t,a){if(!s.j(t))return t;const d=Zt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeSourceURL(t,a,d,g){if(!s.j(t))return t;const y=Zt(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||a)}normalizeIconsetURL(t,a){const d=Zt(t);return s.j(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||a)):Ni(d)}normalizeSpriteURL(t,a,d,g){const y=Zt(t);return s.j(t)?(y.path=`/styles/v1${y.path}/sprite${a}${d}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${a}${d}`,Ni(y))}normalizeTileURL(t,a,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.j(t))return t;const g=Zt(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||d&&g.authority!=="raster"&&d===512?"@2x":""}${s.l.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${s.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${s.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${s.e.TILE_URL_VERSION}${g.path}`);const y=this._customAccessToken||function(v){for(const T of v){const C=T.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(g.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(t,a){const d=Zt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let g="mapbox://";d.path.match(/^\/raster\/v1\//)?g+=`raster/${d.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${d.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${d.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return a&&(y=y.filter(v=>!v.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(t,a){const d=!!a&&s.j(a),g=[];for(const y of t.tiles||[])s.k(y)?g.push(this.canonicalizeTileURL(y,d)):g.push(y);return g}_makeAPIURL(t,a){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=Zt(s.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Ni(t);if(a=a||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),Ni(t)}}const ui=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zt(h){const t=h.match(ui);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ni(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const ct="mapbox.eventData";function Vt(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.m(t[1]))}catch{return null}}class Gt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=Vt(s.e.ACCESS_TOKEN);let d="";return d=a&&a.u?s.f(a.u):s.e.ACCESS_TOKEN||"",t?`${ct}.${t}:${d}`:`${ct}:${d}`}fetchEventData(){const t=s.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const g=localStorage.getItem(a);g&&(this.eventData=JSON.parse(g));const y=localStorage.getItem(d);y&&(this.anonId=y)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(d,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,d,g){if(!s.e.EVENTS_URL)return;const y=Zt(s.e.EVENTS_URL);y.params.push(`access_token=${g||s.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},T=a?s.h(v,a):v,C={url:Ni(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=s.p(C,R=>{this.pendingRequest=null,d(R),this.saveEventData(),this.processRequests(g)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const ti=new class extends Gt{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(a=>s.j(a)||s.k(a))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Vt(s.e.ACCESS_TOKEN),a=t?t.u:s.e.ACCESS_TOKEN;let d=a!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),d=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),v=new Date(g),T=(g-this.eventData.lastSuccess)/864e5;d=d||T>=1||T<-1||y.getDate()!==v.getDate()}else d=!0;d?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:ei,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=a)},h):this.processRequests()}},vi=ti.postTurnstileEvent.bind(ti),Ki=new class extends Gt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,a,d){this.skuToken=t,this.errorCb=d,s.e.EVENTS_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(xi)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:ei,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},Zi=Ki.postMapLoadEvent.bind(Ki),Hi=new class extends Gt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=s.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:a,style:d,importedStyles:g}=t;if(!s.e.EVENTS_URL||!h&&!s.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(a),v={mapInstanceId:y,eventId:this.getEventId(y),style:d};g.length&&(v.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:v},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},h)}},Ii=Hi.postStyleLoadEvent.bind(Hi),hi=new class extends Gt{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){s.e.EVENTS_URL&&(h||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),d=function(g){const y=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),T=function(F){const Z={};if(F){for(const $ in F)if($!=="other")for(const X of F[$]){const J=`${$}ResolveRangeMin`,te=`${$}ResolveRangeMax`,pe=`${$}RequestCount`,ye=`${$}RequestCachedCount`;Z[J]=Math.min(Z[J]||1/0,X.startTime),Z[te]=Math.max(Z[te]||-1/0,X.responseEnd);const Se=be=>{Z[be]===void 0&&(Z[be]=0),++Z[be]};X.transferSize!==void 0&&X.transferSize===0&&Se(ye),Se(pe)}}return Z}(function(F,Z){const $={};if(F)for(const X of F){const J=Z(X);$[J]===void 0&&($[J]=[]),$[J].push(X)}return $}(y,G)),C=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=R?R.effectiveType:void 0,L={counters:[],metadata:[],attributes:[]},j=(F,Z,$)=>{$!=null&&F.push({name:Z,value:$.toString()})};for(const F in T)j(L.counters,F,T[F]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(j(L.counters,"interactionRangeMin",g.interactionRange[0]),j(L.counters,"interactionRangeMax",g.interactionRange[1])),v)for(const F of Object.keys(O)){const Z=O[F],$=v.find(X=>X.name===Z);$&&j(L.counters,Z,$.startTime)}return j(L.counters,"visibilityHidden",g.visibilityHidden),j(L.attributes,"style",function(F){if(F)for(const Z of F){const $=Z.name.split("?")[0];if(s.i($)){const X=$.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(y)),j(L.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),j(L.attributes,"fogEnabled",g.fogEnabled?"true":"false"),j(L.attributes,"projection",g.projection),j(L.attributes,"zoom",g.zoom),j(L.metadata,"devicePixelRatio",C),j(L.metadata,"connectionEffectiveType",k),j(L.metadata,"navigatorUserAgent",navigator.userAgent),j(L.metadata,"screenWidth",window.screen.width),j(L.metadata,"screenHeight",window.screen.height),j(L.metadata,"windowWidth",window.innerWidth),j(L.metadata,"windowHeight",window.innerHeight),j(L.metadata,"mapWidth",g.width/C),j(L.metadata,"mapHeight",g.height/C),j(L.metadata,"webglRenderer",g.renderer),j(L.metadata,"webglVendor",g.vendor),j(L.metadata,"sdkVersion",D),j(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(a);for(const g of d.metadata);for(const g of d.counters);for(const g of d.attributes);this.postEvent(t,d,()=>{},h)}},_i=hi.postPerformanceEvent.bind(hi),ji=new class extends Gt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,a,d){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const g=Zt(s.e.API_URL+s.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${d||s.e.ACCESS_TOKEN||""}`);const y={url:Ni(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(y,v=>{this.pendingRequest=null,a(v),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,t,a,d){this.skuToken=t,this.errorCb=d,s.e.SESSION_PATH&&s.e.API_URL&&(a||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(xi)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},Er=ji.getSessionAPI.bind(ji),wr=new Set;function nr(h,t){t?wr.add(h):wr.delete(h)}class dr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ln(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class ns extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const d of a.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:d,callback:g}of this.requestors)this._notify(d,a,g);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,d){this._validate(t,d)&&this.images.get(a).set(t.toString(),d)}_validate(t,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const g of t){if(g[0]<d||g[1]<g[0]||a<g[1])return!1;d=g[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,d){const g=this.images.get(a).get(t.toString());d.version=g.version+1,this.images.get(a).set(t.toString(),d),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const d=this.images.get(a),g=d.get(t.toString());d.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(a=>s.I.from(a))}getImages(t,a,d){const g=[],y=[],v=this.imageProviders.get(a);for(const k of t){if(!k.iconsetId){g.push(k);continue}const L=v.get(k.iconsetId);L&&(this.getImage(k,a)?y.push(k):L.addPendingRequest(k))}if(g.length===0)return void this._notify(y,a,d);let T=!0;const C=!!this.loaded.get(a),R=this.images.get(a);if(!C)for(const k of g)R.has(k.toString())||(T=!1);C||T?this._notify(g,a,d):this.requestors.push({ids:g,scope:a,callback:d})}rasterizeImages(t,a){const d=new Map,{tasks:g,scope:y}=t;for(const[v,T]of g.entries()){const C=this.getImage(T.id,y);C&&d.set(v,{image:C,imageVariant:T})}this._rasterizeImages(y,d,a)}_rasterizeImages(t,a,d){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},d);else{const g=new Map;for(const[y,{image:v,imageVariant:T}]of a.entries())g.set(y,this.imageRasterizer.rasterize(T,v,t,0));d(void 0,g)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,d){const g=this.images.get(a),y=new Map;for(const v of t){if(!g.get(v.toString())){if(v.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:v.name}))}const T=g.get(v.toString());if(!T){s.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)};T.usvg&&Object.assign(C,{width:T.icon.usvg_tree.width,height:T.icon.usvg_tree.height}),y.set(s.I.toString(v),C)}d(null,y)}getPixelSize(t){const{width:a,height:d}=this.atlasImage.get(t);return{width:a,height:d}}getPattern(t,a,d){const g=t.toString(),y=this.patterns.get(a),v=y.get(g),T=this.getImage(t,a);if(!T)return null;if(v){if(v.position.version===T.version)return v.position;v.position.version=T.version}else{if(T.usvg&&!T.data){const C=this.getPatternInFlightId(g,a);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const R=new s.B(t).scaleSelf(s.q.devicePixelRatio),k=new Map([[R.toString(),{image:T,imageVariant:R}]]);return this._rasterizeImages(a,k,(L,j)=>this.storePatternImage(R,a,T,d,j)),null}this.storePattern(t,a,T)}return this._updatePatternAtlas(a,d),y.get(g).position}getPatternInFlightId(t,a){return s.C(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,d,g,y){const v=t.toString(),T=y?y.get(v):void 0;T&&(d.data=T,this.storePattern(t.id,a,d),this._updatePatternAtlas(a,g),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,d){const g={w:d.data.width+2*s.F,h:d.data.height+2*s.F,x:0,y:0},y=new s.G(g,d,s.F);this.patterns.get(a).set(t.toString(),{bin:g,position:y})}bind(t,a){const d=t.gl;let g=this.atlasTexture.get(a);g?this.dirty&&(g.update(this.atlasImage.get(a)),this.dirty=!1):(g=new s.T(t,this.atlasImage.get(a),d.RGBA8),this.atlasTexture.set(a,g)),g.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const d=this.patterns.get(t),g=Array.from(d.values()).map(({bin:R})=>R),{w:y,h:v}=s.H(g),T=this.atlasImage.get(t);T.resize({width:y||1,height:v||1});const C=this.images.get(t);for(const[R,{bin:k,position:L}]of d.entries()){let j=L.padding;const F=k.x+j,Z=k.y+j,$=C.get(R).data,X=$.width,J=$.height;j=j>1?j-1:j,s.r.copy($,T,{x:0,y:0},{x:F,y:Z},{width:X,height:J},a),s.r.copy($,T,{x:0,y:J-j},{x:F,y:Z-j},{width:X,height:j},a),s.r.copy($,T,{x:0,y:0},{x:F,y:Z+J},{width:X,height:j},a),s.r.copy($,T,{x:X-j,y:0},{x:F-j,y:Z},{width:j,height:J},a),s.r.copy($,T,{x:0,y:0},{x:F+X,y:Z},{width:j,height:J},a),s.r.copy($,T,{x:X-j,y:J-j},{x:F-j,y:Z-j},{width:j,height:j},a),s.r.copy($,T,{x:0,y:J-j},{x:F+X,y:Z-j},{width:j,height:j},a),s.r.copy($,T,{x:0,y:0},{x:F+X,y:Z+J},{width:j,height:j},a),s.r.copy($,T,{x:X-j,y:0},{x:F-j,y:Z+J},{width:j,height:j},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const d=this.images.get(a);for(const g of t){if(this.callbackDispatchedThisFrame.get(a).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(g.toString());const y=d.get(g.toString());Ln(y)&&this.updateImage(g,a,y)}}}function pn(h){const t=h.key,a=h.value,d=h.valueSpec||{},g=h.objectElementValidators||{},y=h.style,v=h.styleSpec;let T=[];const C=s.J(a);if(C!=="object")return[new s.V(t,a,`object expected, ${C} found`)];for(const R in a){const k=R.split(".")[0];let L;g[k]?L=g[k]:d[k]?L=di:g["*"]?L=g["*"]:d["*"]&&(L=di),L?T=T.concat(L({key:(t&&`${t}.`)+R,value:a[R],valueSpec:d[k]||d["*"],style:y,styleSpec:v,object:a,objectKey:R},a)):T.push(new s.K(t,a[R],`unknown property "${R}"`))}for(const R in d)g[R]||d[R].required&&d[R].default===void 0&&a[R]===void 0&&T.push(new s.V(t,a,`missing required property "${R}"`));return T}function ys(h){const t=h.value,a=h.valueSpec,d=h.style,g=h.styleSpec,y=h.key,v=h.arrayElementValidator||di;if(s.J(t)!=="array")return[new s.V(y,t,`array expected, ${s.J(t)} found`)];if(a.length&&t.length!==a.length)return[new s.V(y,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new s.V(y,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};g.$version<7&&(T.function=a.function),s.J(a.value)==="object"&&(T=a.value);let C=[];for(let R=0;R<t.length;R++)C=C.concat(v({array:t,arrayIndex:R,value:t[R],valueSpec:T,style:d,styleSpec:g,key:`${y}[${R}]`},!0));return C}function Eo(h){const t=h.key,a=h.value,d=h.valueSpec;let g=s.J(a);if(g==="number"&&a!=a&&(g="NaN"),g!=="number")return[new s.V(t,a,`number expected, ${g} found`)];if("minimum"in d){let y=d.minimum;if(s.J(d.minimum)==="array"&&(y=d.minimum[h.arrayIndex]),a<y)return[new s.V(t,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(s.J(d.maximum)==="array"&&(y=d.maximum[h.arrayIndex]),a>y)return[new s.V(t,a,`${a} is greater than the maximum value ${y}`)]}return[]}function Ur(h){const t=h.valueSpec,a=s.M(h.value.type);let d,g,y,v={};const T=a!=="categorical"&&h.value.property===void 0,C=!T,R=s.J(h.value.stops)==="array"&&s.J(h.value.stops[0])==="array"&&s.J(h.value.stops[0][0])==="object",k=pn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(F){if(a==="identity")return[new s.V(F.key,F.value,'identity function may not have a "stops" property')];let Z=[];const $=F.value;return Z=Z.concat(ys({key:F.key,value:$,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:L})),s.J($)==="array"&&$.length===0&&Z.push(new s.V(F.key,$,"array must have at least one stop")),Z},default:function(F){return di({key:F.key,value:F.value,valueSpec:t,style:F.style,styleSpec:F.styleSpec})}}});return a==="identity"&&T&&k.push(new s.V(h.key,h.value,'missing required property "property"')),a==="identity"||h.value.stops||k.push(new s.V(h.key,h.value,'missing required property "stops"')),a==="exponential"&&h.valueSpec.expression&&!s.N(h.valueSpec)&&k.push(new s.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(C&&!s.O(h.valueSpec)?k.push(new s.V(h.key,h.value,"property functions not supported")):T&&!s.Q(h.valueSpec)&&k.push(new s.V(h.key,h.value,"zoom functions not supported"))),a!=="categorical"&&!R||h.value.property!==void 0||k.push(new s.V(h.key,h.value,'"property" property is required')),k;function L(F){let Z=[];const $=F.value,X=F.key;if(s.J($)!=="array")return[new s.V(X,$,`array expected, ${s.J($)} found`)];if($.length!==2)return[new s.V(X,$,`array length 2 expected, length ${$.length} found`)];if(R){if(s.J($[0])!=="object")return[new s.V(X,$,`object expected, ${s.J($[0])} found`)];if($[0].zoom===void 0)return[new s.V(X,$,"object stop key must have zoom")];if($[0].value===void 0)return[new s.V(X,$,"object stop key must have value")];const J=s.M($[0].zoom);if(typeof J!="number")return[new s.V(X,$[0].zoom,"stop zoom values must be numbers")];if(y&&y>J)return[new s.V(X,$[0].zoom,"stop zoom values must appear in ascending order")];J!==y&&(y=J,g=void 0,v={}),Z=Z.concat(pn({key:`${X}[0]`,value:$[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Eo,value:j}}))}else Z=Z.concat(j({key:`${X}[0]`,value:$[0],style:F.style,styleSpec:F.styleSpec},$));return s.S(s.U($[1]))?Z.concat([new s.V(`${X}[1]`,$[1],"expressions are not allowed in function stops.")]):Z.concat(di({key:`${X}[1]`,value:$[1],valueSpec:t,style:F.style,styleSpec:F.styleSpec}))}function j(F,Z){const $=s.J(F.value),X=s.M(F.value),J=F.value!==null?F.value:Z;if(d){if($!==d)return[new s.V(F.key,J,`${$} stop domain type must match previous stop domain type ${d}`)]}else d=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new s.V(F.key,J,"stop domain value must be a number, string, or boolean")];if($!=="number"&&a!=="categorical"){let te=`number expected, ${$} found`;return s.O(t)&&a===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(F.key,J,te)]}return a!=="categorical"||$!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?a!=="categorical"&&$==="number"&&typeof X=="number"&&typeof g=="number"&&g!==void 0&&X<g?[new s.V(F.key,J,"stop domain values must appear in ascending order")]:(g=X,a==="categorical"&&X in v?[new s.V(F.key,J,"stop domain values must be unique")]:(v[X]=!0,[])):[new s.V(F.key,J,`integer expected, found ${String(X)}`)]}}function Fn(h){const t=(h.expressionContext==="property"?s.W:s.X)(s.U(h.value),h.valueSpec);if(t.result==="error")return t.value.map(d=>new s.V(`${h.key}${d.key}`,h.value,d.message));const a=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new s.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!s.Y(a))return[new s.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Co(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!s.Z(a,["zoom","feature-state"]))return[new s.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!s._(a))return[new s.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Co(h,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)a.delete(g);if(a.size===0)return[];const d=[];return h instanceof s.$&&a.has(h.name)?[new s.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(g=>{d.push(...Co(g,t))}),d)}function Io(h){const t=h.key,a=h.value,d=h.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(s.M(a))===-1&&g.push(new s.V(t,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(s.M(a))===-1&&g.push(new s.V(t,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Os(h){return s.a1(s.U(h.value))?Fn(s.L({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Qn(h)}function Qn(h){const t=h.value,a=h.key;if(s.J(t)!=="array")return[new s.V(a,t,`array expected, ${s.J(t)} found`)];const d=h.styleSpec;let g,y=[];if(t.length<1)return[new s.V(a,t,"filter array must have at least 1 element")];switch(y=y.concat(Io({key:`${a}[0]`,value:t[0],valueSpec:d.filter_operator,style:h.style,styleSpec:h.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&y.push(new s.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new s.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=s.J(t[1]),g!=="string"&&y.push(new s.V(`${a}[1]`,t[1],`string expected, ${g} found`)));for(let v=2;v<t.length;v++)g=s.J(t[v]),s.M(t[1])==="$type"?y=y.concat(Io({key:`${a}[${v}]`,value:t[v],valueSpec:d.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new s.V(`${a}[${v}]`,t[v],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Qn({key:`${a}[${v}]`,value:t[v],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=s.J(t[1]),t.length!==2?y.push(new s.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new s.V(`${a}[1]`,t[1],`string expected, ${g} found`))}return y}function Wo(h,t){const a=h.key,d=h.style,g=h.layer,y=h.styleSpec,v=h.value,T=h.objectKey,C=y[`${t}_${h.layerType}`];if(!C)return[];const R=T.match(/^(.*)-use-theme$/);if(t==="paint"&&R&&C[R[1]])return s.S(v)?[].concat(di({key:h.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:T})):di({key:a,value:v,valueSpec:{type:"string"},style:d,styleSpec:y});const k=T.match(/^(.*)-transition$/);if(t==="paint"&&k&&C[k[1]]&&C[k[1]].transition)return di({key:a,value:v,valueSpec:y.transition,style:d,styleSpec:y});const L=h.valueSpec||C[T];if(!L)return[new s.K(a,v,`unknown property "${T}"`)];let j;if(s.J(v)==="string"&&s.O(L)&&!L.tokens&&(j=/^{([^}]+)}$/.exec(v))){const Z=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new s.V(a,v,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const F=[];if(h.layerType==="symbol")T!=="text-field"||!d||d.glyphs||d.imports||F.push(new s.V(a,v,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&s.a2(s.U(v))&&s.M(v.type)==="identity"&&F.push(new s.V(a,v,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&s.O(L)&&(s.a3(L)||s.Q(L))){const Z=s.W(s.U(v),L),$=Z.value.expression||Z.value._styleExpression.expression;$&&!s.Z($,["measure-light"])&&(T==="model-emissive-strength"&&s._($)&&s.Y($)||F.push(new s.V(a,v,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(di({key:h.key,value:v,valueSpec:L,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:T}))}function Ao(h){return Wo(h,"paint")}function On(h){return Wo(h,"layout")}function _a(h){let t=[];const a=h.value,d=h.key,g=h.style,y=h.styleSpec;a.type||a.ref||t.push(new s.V(d,a,'either "type" or "ref" is required'));let v=s.M(a.type);const T=s.M(a.ref);if(a.id){const C=s.M(a.id);for(let R=0;R<h.arrayIndex;R++){const k=g.layers[R];s.M(k.id)===C&&t.push(new s.V(d,a.id,`duplicate layer id "${a.id}", previously used at line ${k.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(R=>{R in a&&t.push(new s.V(d,a[R],`"${R}" is prohibited for ref layers`))}),g.layers.forEach(R=>{s.M(R.id)===T&&(C=R)}),C?C.ref?t.push(new s.V(d,a.ref,"ref cannot reference another ref layer")):v=s.M(C.type):typeof T=="string"&&t.push(new s.V(d,a.ref,`ref layer "${T}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(a.source){const C=g.sources&&g.sources[a.source],R=C&&s.M(C.type);C?R==="vector"&&v==="raster"?t.push(new s.V(d,a.source,`layer "${a.id}" requires a raster source`)):R==="raster"&&v!=="raster"?t.push(new s.V(d,a.source,`layer "${a.id}" requires a vector source`)):R!=="vector"||a["source-layer"]?R==="raster-dem"&&v!=="hillshade"?t.push(new s.V(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&R==="geojson"&&!C.lineMetrics?t.push(new s.V(d,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&R!=="raster-array"&&t.push(new s.V(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new s.V(d,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(d,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new s.V(d,a.source,`source "${a.source}" not found`))}else t.push(new s.V(d,a,'missing required property "source"'));return t=t.concat(pn({key:d,value:a,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>di({key:`${d}.type`,value:a.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:C=>Os(s.L({layerType:v},C)),layout:C=>pn({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>On(s.L({layerType:v},R))}}),paint:C=>pn({layer:a,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":R=>Ao(s.L({layerType:v,layer:a},R))}})}})),t}function ds(h){const t=h.value,a=h.key,d=s.J(t);return d!=="string"?[new s.V(a,t,`string expected, ${d} found`)]:[]}const Zo={promoteId:function h({key:t,value:a}){if(s.J(a)==="string")return ds({key:t,value:a});if(Array.isArray(a)){const d=[],g=s.U(a),y=s.X(g);return y.result==="error"&&y.value.forEach(v=>{d.push(new s.V(`${t}${v.key}`,null,`${v.message}`))}),s.Z(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const g in a)d.push(...h({key:`${t}.${g}`,value:a[g]}));return d}}};function Hn(h){const t=h.value,a=h.key,d=h.styleSpec,g=h.style;if(!t.type)return[new s.V(a,t,'"type" is required')];const y=s.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||v.push(new s.K(a,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(pn({key:a,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Zo})),v;case"geojson":if(v=pn({key:a,value:t,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Zo}),t.cluster)for(const T in t.clusterProperties){const[C,R]=t.clusterProperties[T],k=typeof C=="string"?[C,["accumulated"],["get",T]]:C;v.push(...Fn({key:`${a}.${T}.map`,value:R,expressionContext:"cluster-map"})),v.push(...Fn({key:`${a}.${T}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return v;case"video":return pn({key:a,value:t,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return pn({key:a,value:t,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new s.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${a}.type`,value:t.type,valueSpec:{values:xs(d)}})}}function xs(h){return h.source.reduce((t,a)=>{const d=h[a];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function Po(h){const t=h.value,a=h.styleSpec,d=a.light,g=h.style;let y=[];const v=s.J(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new s.V("light",t,`object expected, ${v} found`)]),y;for(const T in t){const C=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);y=y.concat(R&&d[R[1]]?di({key:T,value:t[T],valueSpec:{type:"string"},style:g,styleSpec:a}):C&&d[C[1]]&&d[C[1]].transition?di({key:T,value:t[T],valueSpec:a.transition,style:g,styleSpec:a}):d[T]?di({key:T,value:t[T],valueSpec:d[T],style:g,styleSpec:a}):[new s.V(T,t[T],`unknown property "${T}"`)])}return y}function Mo(h){const t=h.value;let a=[];if(!t)return a;const d=s.J(t);if(d!=="object")return a=a.concat([new s.V("light-3d",t,`object expected, ${d} found`)]),a;const g=h.styleSpec,y=g["light-3d"],v=h.key,T=h.style,C=h.style.lights;for(const L of["type","id"])if(!(L in t))return a=a.concat([new s.V("light-3d",t,`missing property ${L} on light`)]),a;if(t.type&&C)for(let L=0;L<h.arrayIndex;L++){const j=s.M(t.type),F=C[L];s.M(F.type)===j&&a.push(new s.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in g))return a=a.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),a;const k=g[R];for(const L in t)if(L==="properties"){const j=t[L],F=s.J(j);if(F!=="object")return a=a.concat([new s.V("properties",j,`object expected, ${F} found`)]),a;for(const Z in j){const $=Z.match(/^(.*)-transition$/),X=Z.match(/^(.*)-use-theme$/);a=a.concat(X&&k[X[1]]?di({key:L,value:j[Z],valueSpec:{type:"string"},style:T,styleSpec:g}):$&&k[$[1]]&&k[$[1]].transition?di({key:L,value:t[L],valueSpec:g.transition,style:T,styleSpec:g}):k[Z]?di({key:Z,value:j[Z],valueSpec:k[Z],style:T,styleSpec:g}):[new s.K(h.key,j[Z],`unknown property "${Z}"`)])}}else a=a.concat(y[L]?di({key:L,value:t[L],valueSpec:y[L],style:T,styleSpec:g}):[new s.K(L,t[L],`unknown property "${L}"`)]);return a}function ho(h){const t=h.value,a=h.key,d=h.style,g=h.styleSpec,y=g.terrain;let v=[];const T=s.J(t);if(t===void 0||T==="null")return v;if(T!=="object")return v=v.concat([new s.V("terrain",t,`object expected, ${T} found`)]),v;for(const C in t){const R=C.match(/^(.*)-transition$/),k=C.match(/^(.*)-use-theme$/);v=v.concat(k&&y[k[1]]?di({key:C,value:t[C],valueSpec:{type:"string"},style:d,styleSpec:g}):R&&y[R[1]]&&y[R[1]].transition?di({key:C,value:t[C],valueSpec:g.transition,style:d,styleSpec:g}):y[C]?di({key:C,value:t[C],valueSpec:y[C],style:d,styleSpec:g}):[new s.K(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=d.sources&&d.sources[t.source],R=C&&s.M(C.type);C?R!=="raster-dem"&&v.push(new s.V(a,t.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):v.push(new s.V(a,t.source,`source "${t.source}" not found`))}else v.push(new s.V(a,t,'terrain is missing required property "source"'));return v}function ss(h){const t=h.value,a=h.style,d=h.styleSpec,g=d.fog;let y=[];const v=s.J(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new s.V("fog",t,`object expected, ${v} found`)]),y;for(const T in t){const C=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);y=y.concat(R&&g[R[1]]?di({key:T,value:t[T],valueSpec:{type:"string"},style:a,styleSpec:d}):C&&g[C[1]]&&g[C[1]].transition?di({key:T,value:t[T],valueSpec:d.transition,style:a,styleSpec:d}):g[T]?di({key:T,value:t[T],valueSpec:g[T],style:a,styleSpec:d}):[new s.K(T,t[T],`unknown property "${T}"`)])}return y}const ya={"*":()=>[],array:ys,boolean:function(h){const t=h.value,a=h.key,d=s.J(t);return d!=="boolean"?[new s.V(a,t,`boolean expected, ${d} found`)]:[]},number:Eo,color:function(h){const t=h.key,a=h.value,d=s.J(a);return d!=="string"?[new s.V(t,a,`color expected, ${d} found`)]:s.a0.parseCSSColor(a)===null?[new s.V(t,a,`color expected, "${a}" found`)]:[]},enum:Io,filter:Os,function:Ur,layer:_a,object:pn,source:Hn,model:s.a4,light:Po,"light-3d":Mo,terrain:ho,fog:ss,string:ds,formatted:function(h){return ds(h).length===0?[]:Fn(h)},resolvedImage:function(h){return ds(h).length===0?[]:Fn(h)},projection:function(h){const t=h.value,a=h.styleSpec,d=a.projection,g=h.style;let y=[];const v=s.J(t);if(v==="object")for(const T in t)y=y.concat(di({key:T,value:t[T],valueSpec:d[T],style:g,styleSpec:a}));else v!=="string"&&(y=y.concat([new s.V("projection",t,`object or string expected, ${v} found`)]));return y},import:function(h){const{value:t,styleSpec:a}=h,{data:d,...g}=t;Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let y=pn(s.L({},h,{value:g,valueSpec:a.import}));return s.M(g.id)===""&&y.push(new s.V(`${h.key}.id`,g,"import id can't be an empty string")),d&&(y=y.concat(rn(d,a,{key:`${h.key}.data`}))),y},iconset:function(h){const t=h.value,a=h.key,d=h.styleSpec,g=h.style;if(!t.type)return[new s.V(a,t,'"type" is required')];const y=s.M(t.type);let v=[];if(v=v.concat(pn({key:a,value:t,valueSpec:d[`iconset_${y}`],style:g,styleSpec:d})),y==="source"&&t.source){const T=g.sources&&g.sources[t.source],C=T&&s.M(T.type);T?C!=="raster-array"&&v.push(new s.V(a,t.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):v.push(new s.V(a,t.source,`source "${t.source}" not found`))}return v}};function di(h,t=!1){const a=h.value,d=h.valueSpec,g=h.styleSpec;if(d.expression&&s.a2(s.M(a)))return Ur(h);if(d.expression&&s.S(s.U(a)))return Fn(h);if(d.type&&ya[d.type]){const y=ya[d.type](h);return t===!0&&y.length>0&&s.J(h.value)==="array"?Fn(h):y}return pn(s.L({},h,{valueSpec:d.type?g[d.type]:d}))}function Yr(h){const t=h.value,a=h.key,d=ds(h);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new s.V(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new s.V(a,t,'"glyphs" url must include a "{range}" token'))),d}function rn(h,t=s.a5,a={}){return di({key:a.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:Yr,"*":()=>[]}})}function bn(h,t=s.a5){return Ie(rn(h,t))}const As=h=>Ie(Hn(h)),Xo=h=>Ie(Po(h)),Yo=h=>Ie(Mo(h)),wt=h=>Ie(ho(h)),Ko=h=>Ie(ss(h)),Ch=h=>Ie(function(t){const a=t.value,d=t.style,g=t.styleSpec,y=g.snow;let v=[];const T=s.J(a);if(a===void 0)return v;if(T!=="object")return v=v.concat([new s.V("snow",a,`object expected, ${T} found`)]),v;for(const C in a){const R=C.match(/^(.*)-transition$/);v=v.concat(R&&y[R[1]]&&y[R[1]].transition?di({key:C,value:a[C],valueSpec:g.transition,style:d,styleSpec:g}):y[C]?di({key:C,value:a[C],valueSpec:y[C],style:d,styleSpec:g}):[new s.K(C,a[C],`unknown property "${C}"`)])}return v}(h)),tc=h=>Ie(function(t){const a=t.value,d=t.style,g=t.styleSpec,y=g.rain;let v=[];const T=s.J(a);if(a===void 0)return v;if(T!=="object")return v=v.concat([new s.V("rain",a,`object expected, ${T} found`)]),v;for(const C in a){const R=C.match(/^(.*)-transition$/);v=v.concat(R&&y[R[1]]&&y[R[1]].transition?di({key:C,value:a[C],valueSpec:g.transition,style:d,styleSpec:g}):y[C]?di({key:C,value:a[C],valueSpec:y[C],style:d,styleSpec:g}):[new s.K(C,a[C],`unknown property "${C}"`)])}return v}(h)),Qi=h=>Ie(_a(h)),Ve=h=>Ie(Os(h)),Q=h=>Ie(Ao(h)),ie=h=>Ie(On(h)),me=h=>Ie(s.a4(h));function Ie(h){return h.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function ve(h,t){let a=!1;if(t&&t.length)for(const d of t)d instanceof s.K?s.w(d.message):(h.fire(new s.z(new Error(d.message))),a=!0);return a}let ke;class Oe extends s.E{constructor(t,a="flat"){super(),this._transitionable=new s.a6(ke||(ke=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,d={}){this._validate(Xo,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&ve(this,t.call(bn,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Me=class extends s.E{constructor(h,t,a,d,g){super(),this.scope=a,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=g}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new s.aa(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let a=-1,d=-1,g=1;for(const y of t.zoomStops)g=t.evaluate(new s.aa(y,{worldview:this.worldview})),g>.01?(a=y,d=-1):d=y;return g<.01&&a>0&&d>a?[a,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof s.ab}};const Be=45,tt=65,ce=.05;function rt(h,t,a,d){const g=s.af(Be,tt,a),[y,v]=Ct(h,d);let T=1-Math.min(1,Math.exp((t-y)/(v-y)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*h.alpha}function Ct(h,t){const a=.5/Math.tan(.5*t);return[h.range[0]+a,h.range[1]+a]}function Ot(h,t,a,d,g){const y=s.ad([],[t,a,d],g.mercatorFogMatrix);return rt(h,s.ae(y),g.pitch,g._fov)}function li(h,t,a,d,g,y,v){const T=[[a,d,0],[g,d,0],[g,y,0],[a,y,0]];let C=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const k of T){const L=s.ad([],k,t),j=s.ae(L);C=Math.min(C,j),R=Math.max(R,j)}return[rt(h,C,v.pitch,v._fov),rt(h,R,v.pitch,v._fov)]}class ci extends s.E{constructor(t,a,d,g){super();const y=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(y,d,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new s.ag(y),this.scope=d}get state(){const t=this._transform,a=t.projection.name==="globe",d=s.ah(t.zoom),g=this.properties.get("range"),y=[.5,3];return{range:a?[s.ai(y[0],g[0],d),s.ai(y[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,d={}){if(this._validate(Ko,t,d))return;const g=s.h({},t);for(const y of Object.keys(s.a5.fog))g[y]===void 0&&(g[y]=s.a5.fog[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(Be,tt,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(d,g,y){const v=s.ac.fromLngLat(g),T=y.elevation?y.elevation.getAtPointOrZero(v):0;return Ot(d,v.x,v.y,T,y)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return li(this.state,a,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(t,a,d,g,y){return this._transform.projection.supportsFog?li(this.state,t,a,d,g,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ct(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const d of a){const g=t.points[d];let y;if(g[2]>=0)y=g;else{const v=t.points[d-4];y=s.ak(v,g,v[2]/(v[2]-g[2]))}if(Ot(this.state,y[0],y[1],0,this._transform)>=ce)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&ve(this,t.call(bn,s.h({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let yi,Oi,Ei,Pr,Kr=class extends s.E{constructor(h,t,a,d){super();const g=yi||(yi=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(g,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),y=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],v=this.properties.get("vignette"),T=this.properties.get("vignette-color");return T.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(Ch,h,a))return;const d=s.h({},h);for(const g of Object.keys(s.a5.snow))d[g]===void 0&&(d[g]=s.a5.snow[g].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&ve(this,h.call(bn,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},Qr=class extends s.E{constructor(h,t,a,d){super();const g=Oi||(Oi=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(g,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(g),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=s.al(a[0]),g=-Math.max(s.al(a[1]),.01),y=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(tc,h,a))return;const d=s.h({},h);for(const g of Object.keys(s.a5.rain))d[g]===void 0&&(d[g]=s.a5.rain[g].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&ve(this,h.call(bn,s.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class yr extends s.E{constructor(t,a,d,g){super(),this.scope=d,this._options=t,this.properties=new s.ag(a),this._transitionable=new s.a6(a,d,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class sr{constructor(t,a,d,g){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,a){let d,g;if(t instanceof s.P||typeof t[0]=="number"){const y=s.P.convert(t);d=[y],g=a.isPointAboveHorizon(y)}else{const y=s.P.convert(t[0]),v=s.P.convert(t[1]),T=y.add(v)._div(2);d=[y,v],g=s.ao(y,v).every(C=>a.isPointAboveHorizon(C))&&a.isPointAboveHorizon(T)}return new sr(d,a.getCameraPoint(),g,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),s.ap(g,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],g=s.ao(a,d,t),y=this.cameraPoint.clone();switch(3*((y.y>a.y)+(y.y>d.y))+((y.x>a.x)+(y.x>d.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(t,a,d,g=0){const y=t.queryPadding/a._pixelsPerMercatorPixel+1,v=d?this._bufferedCameraMercator(y,a):this._bufferedScreenMercator(y,a);let T=t.tileID.wrap+(v.unwrapped?g:0);const C=v.polygon.map(X=>s.aq(t.tileTransform,X,T));if(!s.ar(C,0,0,s.aj,s.aj))return;T=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const R=this.screenGeometryMercator.polygon.map(X=>s.as(t.tileTransform,X,T)),k=R.map(X=>new s.P(X[0],X[1])),L=a.getFreeCameraOptions().position||new s.ac(0,0,0),j=s.as(t.tileTransform,L,T),F=R.map(X=>{const J=s.at(X,X,j);return s.au(J,J),new s.av(j,J)}),Z=s.aw(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:F,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:($=s.ax(C),$.min.x=s.ay($.min.x,0,s.aj),$.min.y=s.ay($.min.y,0,s.aj),$.max.x=s.ay($.max.x,0,s.aj),$.max.y=s.ay($.max.y,0,s.aj),$),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var $}_bufferedScreenMercator(t,a){const d=sn(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(t,a){const d=sn(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(y=>a.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(t,a){const d=function(y,v){const T=s.az([],v.pixelMatrix,v.globeMatrix),C=[0,-s.aB,0,1],R=[0,s.aB,0,1],k=[0,0,0,1];s.aA(C,C,T),s.aA(R,R,T),s.aA(k,k,T);const L=new s.P(C[0]/C[3],C[1]/C[3]),j=new s.P(R[0]/R[3],R[1]/R[3]),F=s.aC(y,L)&&C[3]<k[3],Z=s.aC(y,j)&&R[3]<k[3];if(!F&&!Z)return null;const $=function(we,xe,Te){for(let Ce=1;Ce<we.length;Ce++){const Le=un(xe.pointCoordinate3D(we[Ce-1]).x),Fe=un(xe.pointCoordinate3D(we[Ce]).x);if(Te<0){if(Le<Fe)return{idx:Ce,t:-Le/(Fe-1-Le)}}else if(Fe<Le)return{idx:Ce,t:(1-Le)/(Fe+1-Le)}}return null}(y,v,F?-1:1);if(!$)return null;const{idx:X,t:J}=$;let te=X>1?yn(y.slice(0,X),v):[],pe=X<y.length?yn(y.slice(X),v):[];te=te.map(we=>new s.P(un(we.x),we.y)),pe=pe.map(we=>new s.P(un(we.x),we.y));const ye=[...te];ye.length===0&&ye.push(pe[pe.length-1]);const Se=s.ai(ye[ye.length-1].y,(pe.length===0?te[0]:pe[0]).y,J);let be;return be=F?[new s.P(0,Se),new s.P(0,0),new s.P(1,0),new s.P(1,Se)]:[new s.P(1,Se),new s.P(1,1),new s.P(0,1),new s.P(0,Se)],ye.push(...be),pe.length===0?ye.push(te[0]):ye.push(...pe),{polygon:ye.map(we=>new s.ac(we.x,we.y)),unwrapped:!1}}(t,a);if(d)return d;const g=function(y,v){let T=!1,C=-1/0,R=0;for(let L=0;L<y.length-1;L++)y[L].x>C&&(C=y[L].x,R=L);for(let L=0;L<y.length-1;L++){const j=(R+L)%(y.length-1),F=y[j],Z=y[j+1];Math.abs(F.x-Z.x)>.5&&(F.x<Z.x?(F.x+=1,j===0&&(y[y.length-1].x+=1)):(Z.x+=1,j+1===y.length-1&&(y[0].x+=1)),T=!0)}const k=s.aD(v.center.lng);return T&&k<Math.abs(k-1)&&y.forEach(L=>{L.x-=1}),{polygon:y,unwrapped:T}}(yn(t,a).map(y=>new s.P(un(y.x),y.y)),a);return{polygon:g.polygon.map(y=>new s.ac(y.x,y.y)),unwrapped:g.unwrapped}}}function yn(h,t){return s.aE(h,a=>{const d=t.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function un(h){return h<0?1+h%1:h%1}function sn(h){return 100*h|0}function Jn(h,t,a,d,g){const y=function(T,C){if(T)return g(T);if(C){if(h.url&&C.tiles&&h.tiles&&delete h.tiles,C.variants){if(!Array.isArray(C.variants))return g(new Error("variants must be an array"));for(const k of C.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return g(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){C=s.h(C,k);break}}}const R=s.aF(s.h({},C,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=t.canonicalizeTileset(R,h.url),g(null,R)}},v=function(T,C,R){if(!T)return null;if(!C&&!R)return T;R=R||T.worldview_default;const k=Object.values(T.language||{});if(k.length===0)return null;const L=Object.values(T.worldview||{});if(L.length===0)return null;const j=k.every(Z=>Z===C),F=L.every(Z=>Z===R);return j&&F?T:C in(T.language_options||{})||R in(T.worldview_options||{})?null:T.language_options&&T.worldview_options?T:null}(h.data,a,d);return v?s.q.frame(()=>y(null,v)):h.url?s.n(t.transformRequest(t.normalizeSourceURL(h.url,null,a,d),s.R.Source),y):s.q.frame(()=>{const{data:T,...C}=h;y(null,C)})}function Bs(h,t){const a=Math.pow(2,t.z),d=Math.floor(s.aD(h.getWest())*a),g=Math.floor(s.aH(h.getNorth())*a),y=Math.ceil(s.aD(h.getEast())*a),v=Math.ceil(s.aH(h.getSouth())*a);return t.x>=d&&t.x<y&&t.y>=g&&t.y<v}class vs{constructor(t,a,d){this.bounds=t?s.aG.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(s.aG.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Bs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(Bs(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new vs(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class Ih extends s.E{constructor(t,a,d,g){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.h(this,s.aF(a,["url","scheme","tileSize","promoteId"])),this._options=s.h({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new s.aI}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Jn(this._options,this.map._requestManager,a,d,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new s.z(g));else if(y){if(s.h(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of y.vector_layers)this.vectorLayerIds.push(v.id),y.worldview&&y.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=vs.fromTileJSON(y),vi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(g,s.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,T=v?{image:v.image.clone()}:null,C={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:T,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.j(d)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",C,R.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,R.bind(this),void 0,!0);else{const k=s.aJ.call({deduped:this._deduped},C,(L,j)=>{L||!j?R.call(this,L):(C.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},t.actor&&t.actor.send("loadTile",C,R.bind(this),void 0,!0))},!0);t.request={cancel:k}}function R(k,L){return delete t.request,t.aborted?a(null):k&&k.status!==404?a(k):(L&&L.resourceTiming&&(t.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&t.setExpiryData(L),t.loadVectorData(L,this.map.painter),s.aK(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class os extends s.E{constructor(t,a,d,g){super(),this.id=t,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.h({type:"raster"},a),s.h(this,s.aF(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=Jn(this._options,this.map._requestManager,null,a,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new s.z(d)):g&&(s.h(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=vs.fromTileJSON(g),vi(g.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=s.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(g,s.R.Tile),(y,v,T,C)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):y?(t.state="errored",a(y)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:T,expires:C}),t.setTexture(v,this.map.painter),t.state="loaded",s.aK(this.dispatcher),void a(null)):a(null)))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ml extends os{constructor(t,a,d,g){super(t,a,d,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.h({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,s.R.Tile),y={request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor());const v=(T,C,R,k)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(T)return T.name==="AbortError"?void 0:(t.state="errored",a(T));if(this.map._refreshExpiredTiles&&C&&t.setExpiryData({cacheControl:R,expires:k}),this.partial)t.state="empty";else{if(!C)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=C}a(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",y,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const d=t.texture;d&&d instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,a,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(a,d,(g,y)=>{if(g)return t.state="errored",this.fire(new s.z(g)),void this.triggerRepaint(t);y&&(t._isHeaderLoaded=!0,t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:y})=>y===t),d=a&&a.fields,g=d&&d.bands&&d.bands;return g?g[0]:0}getTextureDescriptor(t,a,d){if(!t)return;const g=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;a instanceof s.aN?y=a.paint.get("raster-array-band"):a instanceof s.aO&&(y=a.paint.get("raster-particle-array-band"));const v=y||this.getInitialBand(g);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,v)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,v)}getImages(t,a){const d=new Map;for(const g of t)for(const y of a){const[v,T]=y.split("/"),C=g.getLayer(v);if(!C||!C.hasBand(T)||!C.hasDataForBand(T))continue;const{bytes:R,tileSize:k,buffer:L}=C.getBandView(T),j=k+2*L,F={data:new s.r({width:j,height:j},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(y,F)}return d}}const fp={vector:Ih,raster:os,"raster-dem":class extends os{constructor(h,t,a,d){super(h,t,a,d),this.type="raster-dem",this.maxzoom=22,this._options=s.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,y){g&&(h.state="errored",t(g)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=s.o(this.map._requestManager.transformRequest(a,s.R.Tile),(function(g,y,v,T){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(g)h.state="errored",t(g);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:v,expires:T});const C=ImageBitmap&&y instanceof ImageBitmap&&s.t(),R=1-(y.width-s.aL(y.width))/2;R<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=C?y:s.q.getImageData(y,R),L={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:R};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",L,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,a=Math.pow(2,t.z),d=(t.x-1+a)%a,g=t.x===0?h.wrap-1:h.wrap,y=(t.x+1+a)%a,v=t.x+1===a?h.wrap+1:h.wrap,T={};return T[new s.aM(h.overscaledZ,g,t.z,d,t.y).key]={backfilled:!1},T[new s.aM(h.overscaledZ,v,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(T[new s.aM(h.overscaledZ,g,t.z,d,t.y-1).key]={backfilled:!1},T[new s.aM(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},T[new s.aM(h.overscaledZ,v,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<a&&(T[new s.aM(h.overscaledZ,g,t.z,d,t.y+1).key]={backfilled:!1},T[new s.aM(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},T[new s.aM(h.overscaledZ,v,t.z,y,t.y+1).key]={backfilled:!1}),T}},"raster-array":ml,geojson:class extends s.E{constructor(h,t,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=t.data,this._options=s.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=s.aj/this.tileSize;this.workerOptions=s.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of h.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:a},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.h({append:h},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(a),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,g)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new s.z(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new s.A("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,g=d?{image:d.image.clone()}:null,y=this._partialReload,v={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};h.request=this.actor.send(a,v,(T,C)=>y&&!C?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):T?t(T):(h.loadVectorData(C,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(h,t,a,d){super(h,t,a,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aQ(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new s.z(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(h,t,a,d){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const a=this._options.models[t],d=s.aS(this.map._requestManager.transformRequest(a.uri,s.R.Model).url).then(g=>{if(!g)return;const y=s.aT(g),v=new s.aU(t,a.position,a.orientation,y);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(g=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${a.uri}: ${g.message}`)))});h.push(d)}Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(h,t,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Jn(this._options,this.map._requestManager,t,a,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.z(d))):g&&(s.h(this,g),g.bounds&&(this.tileBounds=new vs(g.bounds,this.minzoom,this.maxzoom)),vi(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,s.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const y=Object.values(h.buckets);for(const v of y)v.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,g.bind(this),void 0,!0);function g(y,v){return h.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&v&&h.setExpiryData(v),h.loadModelData(v,this.map.painter),h.state="loaded",void t(null))}}serialize(){return s.h({},this._options)}},canvas:class extends s.aP{constructor(h,t,a,d){super(h,t,a,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new s.z(new s.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.E{constructor(h,t,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.h(this,s.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:a,y:d,z:g}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:g},{signal:y.signal})).then((function(v){return delete h.request,h.aborted?(h.state="unloaded",t(null)):v===void 0?(h.state="errored",t(null)):v===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(v)?(this.loadTileData(h,v),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(h.state="errored",t(v))}),h.request.cancel=()=>y.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof s.T?(h.destroy(!0),h.texture&&h.texture instanceof s.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:g})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ah=function(h,t,a,d){const g=new fp[t.type](h,t,a,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return s.aV(["load","abort","unload","serialize","prepare"],g),g};function Ph(h,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:g,importId:y}=d;return`featureset:${g}${y?`:import:${y}`:""}`}}(h.target)}`}function mp(h,t,a,d=""){if(h.uniqueFeatureID){const g=Ph(h,t,d);if(a.has(g))return!0;a.add(g)}return!1}function gp(h,t,a,d,g=!1){const y=t.sourceCache.transform,v=t.sourceCache.tilesIn(h,t.has3DLayers,g);v.sort(_p);const T=[];for(const C of v){const R=C.tile.queryRenderedFeatures(t,C,a,d,y,g);Object.keys(R).length&&T.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:R})}return T.length===0?{}:function(C){const R={},k={};for(const L of C){const j=L.queryResults,F=L.wrappedTileID,Z=k[F]=k[F]||{};for(const $ in j){const X=j[$],J=Z[$]=Z[$]||{},te=R[$]=R[$]||[];for(const pe of X)J[pe.featureIndex]||(J[pe.featureIndex]=!0,te.push(pe))}}return R}(T)}function ic(h,t,a,d,g,y){const v={},T=d.queryRenderedSymbols(h),C=[];for(const R of Object.keys(T).map(Number))C.push(g[R]);C.sort(_p);for(const R of C){const k=R.featureIndex.lookupSymbolFeatures(T[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,t,a,y);for(const L in k){const j=v[L]=v[L]||[],F=k[L];F.sort((Z,$)=>{const X=R.featureSortOrder;if(X){const J=X.indexOf(Z.featureIndex);return X.indexOf($.featureIndex)-J}return $.featureIndex-Z.featureIndex});for(const Z of F)j.push(Z)}}return v}function Mh(h,t){const a=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],g={};for(let y=0;y<a.length;y++){const v=a[y],T=v.tileID.canonical.key;g[T]||(g[T]=!0,v.querySourceFeatures(d,t))}return d}function _p(h,t){const a=h.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Qo(h,t){const a={};if(!t)return a;for(const d of h){const g=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(g.length!==0){d.layers=g,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>g.filter(v=>v.id===y)[0]));for(const y of g)a[y.fqid]=d}}return a}const po=32,Ro=33,La=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,a=0,d=0,g=0,y=0,v=0,T=0;for(1&t?g=y=v=po:a=d=T=po;(t>>=1)>1;){const R=a+g>>1,k=d+y>>1;1&t?(g=a,y=d,a=v,d=T):(a=g,d=y,g=v,y=T),v=R,T=k}const C=4*h;La[C+0]=a,La[C+1]=d,La[C+2]=g,La[C+3]=y}const Jo=new Uint16Array(2178),Fa=new Uint8Array(1089),Rh=new Uint16Array(1089);function xa(h){return h===0?-.03125:h===32?.03125:0}const kh={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class rc{constructor(t,a,d,g,y,v){this.tileID=t,this.uid=s.a$(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=v}registerFadeDuration(t){const a=t+this.timeAdded;a<s.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Qo(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof s.b1){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof s.b1&&y.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g],v=a.style.getOwnLayer(g);if(!v)continue;const T=v.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,T)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Qo(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(t)}const a=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new s.T(t,d.image,a.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=a.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(t,a,d,g,y,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const T=function(C,R){const k=s.bn([],[.5*C.width,.5*-C.height,1]);return s.bo(k,k,[1,-1,0]),s.az(k,k,C.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(k)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:T,transform:g,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),y=a?a.sourceLayer:"",v=g._geojsonTileLayer||g[y];if(!v)return;const T=s.b3(a&&a.filter),{z:C,x:R,y:k}=this.tileID.canonical,L={z:C,x:R,y:k};for(let j=0;j<v.length;j++){const F=v.feature(j);if(T.needGeometry){const X=s.b4(F,!0);if(!T.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!T.filter(new s.aa(this.tileID.overscaledZ,{worldview:this.worldview}),F))continue;const Z=d.getId(F,y),$=new s.b5(F,C,R,k,Z);$.tile=L,t.push($)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const d=s.b6(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{const y=this.expirationTime-a;y?this.expirationTime=d+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),g=t.style.listImages(),y=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const T=this.buckets[v],C=T.layers[0],R=C.sourceLayer||"_geojsonTileLayer",k=d[R],L=t.style.getLayerSourceCache(C);let j={};L&&(j=L._state.getState(R,void 0));const F=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(j).length>0&&!a;Z&&!T.stateDependentLayers.length&&!a||T.update(j,k,g,F,Z?T.stateDependentLayers:T.layers,a,y),(T instanceof s.b7||T instanceof s.b8)&&t._terrain&&t._terrain.enabled&&L&&T.uploadPending()&&t._terrain._clearRenderCacheForTile(L.id,this.tileID);const $=t&&t.style&&t.style.getOwnLayer(v);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,a){const d=a.context,g=d.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(d,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,a){const d={};for(const g of a)d[g]=!0;this.dependencies[t]=d}hasDependency(t,a){for(const d of t){const g=this.dependencies[d];if(g){for(const y of a)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const d=s.b9(kh,this.tileID.canonical,this.tileTransform)[0],g=new s.ba,y=new s.bb;for(let v=0;v<d.length;v++){const{x:T,y:C}=d[v];g.emplaceBack(T,C),y.emplaceBack(v)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const d=s.b9(kh,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const v=function(T,C){const R=s.aW(T,C),k=Math.pow(2,T.z);for(let X=0;X<Ro;X++)for(let J=0;J<Ro;J++){const te=s.aX((T.x+(J+xa(J))/po)/k),pe=s.aY((T.y+(X+xa(X))/po)/k),ye=C.project(te,pe),Se=X*Ro+J;Jo[2*Se+0]=Math.round((ye.x*R.scale-R.x)*s.aj),Jo[2*Se+1]=Math.round((ye.y*R.scale-R.y)*s.aj)}Fa.fill(0),Rh.fill(0);for(let X=2045;X>=0;X--){const J=4*X,te=La[J+0],pe=La[J+1],ye=La[J+2],Se=La[J+3],be=te+ye>>1,we=pe+Se>>1,xe=be+we-pe,Te=we+te-be,Ce=pe*Ro+te,Le=Se*Ro+ye,Fe=we*Ro+be,Ke=Math.hypot((Jo[2*Ce+0]+Jo[2*Le+0])/2-Jo[2*Fe+0],(Jo[2*Ce+1]+Jo[2*Le+1])/2-Jo[2*Fe+1])>=16;Fa[Fe]=Fa[Fe]||(Ke?1:0),X<1022&&(Fa[Fe]=Fa[Fe]||Fa[(pe+Te>>1)*Ro+(te+xe>>1)]||Fa[(Se+Te>>1)*Ro+(ye+xe>>1)])}const L=new s.aZ,j=new s.a_;let F=0;function Z(X,J){const te=J*Ro+X;return Rh[te]===0&&(L.emplaceBack(Jo[2*te+0],Jo[2*te+1],X*s.aj/po,J*s.aj/po),Rh[te]=++F),Rh[te]-1}function $(X,J,te,pe,ye,Se){const be=X+te>>1,we=J+pe>>1;if(Math.abs(X-ye)+Math.abs(J-Se)>1&&Fa[we*Ro+be])$(ye,Se,X,J,be,we),$(te,pe,ye,Se,be,we);else{const xe=Z(X,J),Te=Z(te,pe),Ce=Z(ye,Se);j.emplaceBack(xe,Te,Ce)}}return $(0,0,po,po,po,0),$(po,po,0,0,0,po),{vertices:L,indices:j}}(this.tileID.canonical,a);g=v.vertices,y=v.indices}else{g=new s.aZ,y=new s.a_;for(const{x:T,y:C}of d)g.emplaceBack(T,C,0,0);const v=s.be(g.int16.subarray(0,4*g.length),void 0,4);for(let T=0;T<v.length;T+=3)y.emplaceBack(v[T],v[T+1],v[T+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,s.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=s.bd.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(t,a){const d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;const g=this.tileID.canonical,y=s.bg(g,a),v=s.bh(y),T=s.ah(a.zoom);let C;T>0&&(C=s.bi(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,a,v,C,T),this._makeGlobeTileDebugTextBuffer(t,g,a,v,C,T)}_globePoint(t,a,d,g,y,v,T){let C=s.bj(t,a,d);if(v){const R=1<<d.z,k=s.aD(g.center.lng),L=s.aH(g.center.lat),j=(d.x+.5)/R-k;let F=0;j>.5?F=-1:j<-.5&&(F=1);let Z=(t/s.aj+d.x)/R+F,$=(a/s.aj+d.y)/R;Z=(Z-k)*g._pixelsPerMercatorPixel+k,$=($-L)*g._pixelsPerMercatorPixel+L;const X=[Z*g.worldSize,$*g.worldSize,0];s.ad(X,X,v),C=s.bk(C,X,T)}return s.ad(C,C,y)}_makeGlobeTileDebugBorderBuffer(t,a,d,g,y,v){const T=new s.ba,C=new s.bb,R=new s.bl,k=(j,F,Z,$,X)=>{const J=(Z-j)/(X-1),te=($-F)/(X-1),pe=T.length;for(let ye=0;ye<X;ye++){const Se=j+ye*J,be=F+ye*te;T.emplaceBack(Se,be);const we=this._globePoint(Se,be,a,d,g,y,v);R.emplaceBack(we[0],we[1],we[2]),C.emplaceBack(pe+ye)}},L=s.aj;k(0,0,L,0,16),k(L,0,L,L,16),k(L,L,0,L,16),k(0,L,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(T,s.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,T.length,C.length)}_makeGlobeTileDebugTextBuffer(t,a,d,g,y,v){const T=s.aj/4,C=new s.ba,R=new s.a_,k=new s.bl,L=25;R.reserve(32),C.reserve(L),k.reserve(L);const j=(F,Z)=>L*F+Z;for(let F=0;F<L;F++){const Z=F*T;for(let $=0;$<L;$++){const X=$*T;C.emplaceBack(X,Z);const J=this._globePoint(X,Z,a,d,g,y,v);k.emplaceBack(J[0],J[1],J[2])}}for(let F=0;F<4;F++)for(let Z=0;Z<4;Z++){const $=j(F,Z),X=j(F,Z+1),J=j(F+1,Z),te=j(F+1,Z+1);R.emplaceBack($,X,J),R.emplaceBack(J,X,te)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(R),this._tileDebugTextBuffer=t.createVertexBuffer(C,s.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,L,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class Wc extends rc{constructor(t,a,d,g,y){super(t,a,d,g,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,a){const d=a.context,g=d.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(d,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,a){const d=this._mrt=new s.bp(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.br(g,(y,v,T,C)=>{if(y)a(y);else try{const R=d.getHeaderLength(v);if(R>t)return void(this.request=this.fetchHeader(R,a));d.parseHeader(v),this._isHeaderLoaded=!0;let k=0;for(const L of Object.values(d.layers))k=Math.max(k,L.dataIndex[L.dataIndex.length-1].lastByte);v.byteLength>=k&&(this.entireBuffer=v),a(null,this.entireBuffer||v,T,C)}catch(R){a(R)}}),this.request}fetchBand(t,a,d){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void d(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let v;const T=(L,j)=>{v.complete(L,j),L?d(L):(this.updateTextureDescriptor(t,a),d(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(L,j)=>{if(L)return d(L);const F=y.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:j,task:v},T,void 0,!0);this._workQueue.push(()=>{F&&F.cancel(),v.cancel()})},R=g.getLayer(t);if(!R)return void d(new Error(`Unknown sourceLayer "${t}"`));if(R.hasDataForBand(a))return this.updateTextureDescriptor(t,a),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=R.getDataRange([a]);if(v=g.createDecodingTask(k),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const L=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),j=s.br(L,C);this._fetchQueue.push(()=>{j.cancel(),v.cancel()})}else d(null)}updateNeeded(t,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,a){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(a)||!d.hasDataForBand(a))return;const{bytes:g,tileSize:y,buffer:v,offset:T,scale:C}=d.getBandView(a),R=y+2*v,k=new s.r({width:R,height:R},g),L=this.texture;L&&L instanceof s.T&&L.update(k,{premultiply:!1}),this.textureDescriptor={layer:t,band:a,img:k,buffer:v,offset:T,tileSize:y,format:d.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class Lm{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,d){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:a,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const d=t.wrapped().key,g=a===void 0?0:this.data[d].indexOf(a),y=this.data[d][g];return this.data[d].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const d in this.data)for(const g of this.data[d])t(g.value)||a.push(g);for(const d of a)this.remove(d.value.tileID,d)}}class Fm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,d){const g=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},s.h(this.stateChanges[t][g],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==g&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const y in this.state[t][g])d[y]||(this.deletedStates[t][g][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][y]===null&&delete this.deletedStates[t][g][y]}removeFeatureState(t,a,d){if(this.deletedStates[t]===null)return;const g=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&a!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][d]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(d in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][d]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,a){const d=this.state[t]||{},g=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(a!==void 0){const T=String(a),C=s.h({},d[T],g[T]);if(y){const R=y[a];if(R===null)return{};for(const k in R)delete C[k]}return C}const v=s.h({},d,g);if(y)for(const T in y)delete v[T];return v}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const v in this.stateChanges[g])this.state[g][v]||(this.state[g][v]={}),s.h(this.state[g][v],this.stateChanges[g][v]),y[v]=this.state[g][v];d[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const v in this.state[g])y[v]={},this.state[g][v]={};else for(const v in this.deletedStates[g]){if(this.deletedStates[g][v]===null)this.state[g][v]={};else if(this.state[g][v])for(const T of Object.keys(this.deletedStates[g][v]))delete this.state[g][v][T];y[v]=this.state[g][v]}d[g]=d[g]||{},s.h(d[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in t)t[g].refreshFeatureState(a)}}class Vs extends s.E{constructor(t,a,d){super(),this.id=t,this._onlySymbols=d,a.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Lm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Fm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(nc).map(t=>t.key)}getRenderableIds(t,a){const d=[];for(const g in this._tiles)this._isIdRenderable(+g,t,a)&&d.push(this._tiles[g]);return t?d.sort((g,y)=>{const v=g.tileID,T=y.tileID,C=new s.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),R=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-T.overscaledZ||R.y-C.y||R.x-C.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(nc).map(g=>g.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,t,a)))}_tileLoaded(t,a,d,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new s.z(g,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const a=this.getRenderableIds();for(let g=0;g<a.length;g++){const y=a[g];if(t.neighboringTiles&&t.neighboringTiles[y]){const v=this.getTileByID(y);d(t,v),d(v,t)}}function d(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let v=y.tileID.canonical.x-g.tileID.canonical.x;const T=y.tileID.canonical.y-g.tileID.canonical.y,C=Math.pow(2,g.tileID.canonical.z),R=y.tileID.key;v===0&&T===0||Math.abs(T)>1||(Math.abs(v)>1&&(Math.abs(v+C)===1?v+=C:Math.abs(v-C)===1&&(v-=C)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,v,T),g.neighboringTiles&&g.neighboringTiles[R]&&(g.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,d,g){for(const y in this._tiles){let v=this._tiles[y];if(g[y]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>d)continue;let T=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){const R=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[R.key],v&&v.hasData()&&(T=R)}let C=T;for(;C.overscaledZ>a;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){g[T.key]=T;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=t.overscaledZ-1;d>=a;d--){const g=t.scaledTo(d),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const d=Math.ceil(t.width/a)+1,g=Math.ceil(t.height/a)+1,y=Math.floor(d*g*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(T)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const d={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),d[y.tileID.key]=y}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,a,d,g,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let T,C=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const j=R.attenuationRange()[0],F=Math.floor(j)-Math.log2(R.getDemUpscale());C>F&&(C=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new s.aM(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y));else if(this.tileCoverLift!==0){const j=t.clone();j.tileCoverLift=this.tileCoverLift,T=j.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(T.push(new s.aM(1,0,1,0,0)),T.push(new s.aM(1,0,1,1,0)),T.push(new s.aM(1,0,1,0,1)),T.push(new s.aM(1,0,1,1,1)))}else if(T=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const j=this._source.hasTile.bind(this._source);T=T.filter(F=>j(F))}}else T=[];if(T.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Dh(this._source.type)){const j=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),F=Math.min(j,this._source.maxzoom);if(v){const Z=t.extendTileCover(T,F);for(const $ of Z)T.push($)}else if(y){const Z=t.extendTileCover(T,F,this.transform._camera.forward());for(const $ of Z)T.push($)}else if(this.castsShadows&&g){const Z=t.extendTileCover(T,F,g);for(const $ of Z)this._shadowCasterTiles[$.key]=!0,T.push($)}}const k=this._updateRetainedTiles(T);if(Dh(this._source.type)&&T.length!==0){const j={},F={},Z=Object.keys(k);for(const X of Z){const J=k[X],te=this._tiles[X];if(!te||te.fadeEndTime&&te.fadeEndTime<=s.q.now())continue;const pe=this.findLoadedParent(J,Math.max(J.overscaledZ-Vs.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),j[pe.tileID.key]=pe.tileID),F[X]=J}const $=T[T.length-1].overscaledZ;for(const X in this._tiles){const J=this._tiles[X];if(k[X]||!J.hasData())continue;let te=J.tileID;for(;te.overscaledZ>$;){te=te.scaledTo(te.overscaledZ-1);const pe=this._tiles[te.key];if(pe&&pe.hasData()&&F[te.key]){k[X]=J.tileID;break}}}for(const X in j)k[X]||(this._coveredTiles[X]=!0,k[X]=j[X])}for(const j in k)this._tiles[j].clearFadeHold();const L=s.bs(this._tiles,k);for(const j of L){const F=this._tiles[j];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+j)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const d={},g=t.reduce((R,k)=>Math.min(R,k.overscaledZ),1/0),y=t[0].overscaledZ,v=Math.max(y-Vs.maxOverzooming,this._source.minzoom),T=Math.max(y+Vs.maxUnderzooming,this._source.minzoom),C={};for(const R of t){const k=this._addTile(R);a[R.key]=R,k.hasData()||g<this._source.maxzoom&&(C[R.key]=R)}this._retainLoadedChildren(C,g,T,a);for(const R of t){let k=this._tiles[R.key];if(k.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const j=R.children(this._source.maxzoom)[0],F=this.getTile(j);if(F&&F.hasData()){a[j.key]=j;continue}}else{const j=R.children(this._source.maxzoom);if(a[j[0].key]&&a[j[1].key]&&a[j[2].key]&&a[j[3].key])continue}let L=k.wasRequested();for(let j=R.overscaledZ-1;j>=v;--j){const F=R.scaledTo(j);if(d[F.key]||(d[F.key]=!0,k=this.getTile(F),!k&&L&&(k=this._addTile(F)),k&&(a[F.key]=F,L=k.wasRequested(),k.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let d,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}a.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;g=y}for(const y of a)this._loadedParentTiles[y]=d}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const d=!!a;if(!d){const g=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new Wc(t,y,this.transform.tileZoom,g,this._isRaster):new rc(t,y,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,d||this._source.fire(new s.A("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=a.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,d){const g=[],y=this.transform;if(!y)return g;const v=y.projection.name==="globe",T=s.aD(y.center.lng);for(const C in this._tiles){const R=this._tiles[C];if(d&&R.clearQueryDebugViz(),R.holdingForFade())continue;let k;if(v){const L=R.tileID.canonical;if(L.z===0){const j=[Math.abs(s.ay(T,...Zc(L,-1))-T),Math.abs(s.ay(T,...Zc(L,1))-T)];k=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(s.ay(T,...Zc(L,-1))-T),Math.abs(s.ay(T,...Zc(L,0))-T),Math.abs(s.ay(T,...Zc(L,1))-T)];k=[j.indexOf(Math.min(...j))-1]}}else k=[0];for(const L of k){const j=t.containsTile(R,y,a,L);j&&g.push(j)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const d=this.getRenderableIds(t,a).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){const a=t.slice(),d=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(const v of a){const T=1/(1<<v.canonical.z);y[v.key]=((v.canonical.x+.5)*T+v.wrap-d[0])*g[0]+((v.canonical.y+.5)*T-d[1])*g[1]-d[2]*g[2]}return a.sort((v,T)=>y[v.key]-y[T.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Dh(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,a,d){this._state.updateState(t=t||"_geojsonTileLayer",a,d)}removeFeatureState(t,a,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,d)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,d){const g=this._tiles[t];g&&g.setDependencies(a,d)}reloadTilesForDependencies(t,a){for(const d in this._tiles)this._tiles[d].hasDependency(t,a)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,a))};return void this._source.on("data",C)}const d=new Map,g=Array.isArray(t)?t:[t],y=this.map.painter.terrain,v=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const C of g){const R=C.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of R)d.set(k.key,k);this.usedForTerrain&&C.updateElevation(!1)}const T=Array.from(d.values());s.bt(T,(C,R)=>{const k=new rc(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,L=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),R(L,k)})},a)}}function nc(h,t){const a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-a||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Dh(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Zc(h,t){const a=1<<h.z;return[h.x/a+t,(h.x+1)/a+t]}Vs.maxOverzooming=10,Vs.maxUnderzooming=3;class Ny{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const d in this.style._mergedLayers){const g=this.style._mergedLayers[d];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:t,visibilityChanged:a});else if(g.type==="model"){const y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const d=a.layer;let g=!1;d.type==="fill-extrusion"?g=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?g=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(g=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&a.visible,a.visible=g}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const g of this.layers){const y=g.layer,v=this.style.getLayerSourceCache(y);let T=1;y.type==="fill-extrusion"?T=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(T=g.visible?y.paint.get("building-vertical-scale"):0);let C=v?v.getTile(a):null;if(!C&&v&&a.canonical.z>v.getSource().minzoom){let R=a.scaledTo(Math.min(v.getSource().maxzoom,a.overscaledZ-1));for(;R.overscaledZ>=v.getSource().minzoom&&(C=v.getTile(R),!C&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(y):null,tileID:C?C.tileID:a,verticalScale:T})}t.hasAnyZOffset=!1;let d=!1;for(let g=0;g<t.symbolInstances.length;g++){const y=t.symbolInstances.get(g),v=y.zOffset,T=this._getHeightAtTileOffset(a,y.tileAnchorX,y.tileAnchorY);y.zOffset=T!==Number.NEGATIVE_INFINITY?T:v,d||v===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,d,g){let y=a,v=d;if(t.canonical.z!==g.canonical.z){const T=g.canonical,C=1/(1<<t.canonical.z-T.z);y=(a+t.canonical.x*s.aj)*C-T.x*s.aj|0,v=(d+t.canonical.y*s.aj)*C-T.y*s.aj|0}return{tileX:y,tileY:v}}_getHeightAtTileOffset(t,a,d){let g,y;for(let v=0;v<this.layers.length;++v){const T=this.layers[v].layer;if(T.type!=="fill-extrusion"&&T.type!=="building")continue;const{bucket:C,tileID:R,verticalScale:k}=this.currentBuildingBuckets[v];if(!C)continue;const{tileX:L,tileY:j}=this._mapCoordToOverlappingTile(t,a,d,R),F=C.getHeightAtTileCoord(L,j);F&&F.height!==void 0&&(F.hidden?g=F.height:y=Math.max(F.height*k,y||0))}if(y!==void 0)return y;for(let v=0;v<this.layers.length;++v){const T=this.layers[v];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:C,tileID:R}=this.currentBuildingBuckets[v];if(!C)continue;const{tileX:k,tileY:L}=this._mapCoordToOverlappingTile(t,a,d,R),j=C.getHeightAtTileCoord(k,L);if(j&&!j.hidden)return j.height===void 0&&g!==void 0?Math.min(j.maxHeight,g)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function jy(h,t){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return s.bu.forEach(d=>{d in t&&(a[d]=t[d])}),a}function Nh(h){h=h.slice();const t=Object.create(null);for(let a=0;a<h.length;a++)t[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=jy(h[a],t[h[a].ref]));return h}const Ji={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function yp(h,t,a){a.push({command:Ji.addSource,args:[h,t[h]]})}function Xc(h,t,a){t.push({command:Ji.removeSource,args:[h]}),a[h]=!0}function jh(h,t,a,d){Xc(h,a,d),yp(h,t,a)}function iw(h,t,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!s.bv(h[a][d],t[a][d]))return!1;for(d in t[a])if(t[a].hasOwnProperty(d)&&d!=="data"&&!s.bv(h[a][d],t[a][d]))return!1;return!0}function zh(h,t,a,d,g,y){let v;for(v in t=t||{},h=h||{})h.hasOwnProperty(v)&&(s.bv(h[v],t[v])||a.push({command:y,args:[d,v,t[v],g]}));for(v in t)t.hasOwnProperty(v)&&!h.hasOwnProperty(v)&&(s.bv(h[v],t[v])||a.push({command:y,args:[d,v,t[v],g]}))}function sc(h){return h.id}function gl(h,t){return h[t.id]=t,h}class Om{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ay(t,0,1);let a=1,d=this._distances[a];const g=t*this.paddedLength+this.padding;for(;d<g&&a<this._distances.length;)d=this._distances[++a];const y=a-1,v=this._distances[y],T=d-v,C=T>0?(g-v)/T:0;return this.points[y].mult(1-C).add(this.points[a].mult(C))}}class Bm{constructor(t,a,d){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let v=0;v<this.xCellCount*this.yCellCount;v++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,g,y){this._forEachCell(a,d,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(t,a,d,g){this._forEachCell(a-g,d-g,a+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(g)}_insertBoxCell(t,a,d,g,y,v){this.boxCells[y].push(v)}_insertCircleCell(t,a,d,g,y,v){this.circleCells[y].push(v)}_query(t,a,d,g,y,v){if(d<0||t>this.width||g<0||a>this.height)return!y&&[];const T=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=g){if(y)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const R=this.circles[3*C],k=this.circles[3*C+1],L=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:R-L,y1:k-L,x2:R+L,y2:k+L})}return v?T.filter(v):T}return this._forEachCell(t,a,d,g,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},v),y?T.length>0:T}_queryCircle(t,a,d,g,y){const v=t-d,T=t+d,C=a-d,R=a+d;if(T<0||v>this.width||R<0||C>this.height)return!g&&[];const k=[];return this._forEachCell(v,C,T,R,this._queryCellCircle,k,{hitTest:g,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},y),g?k.length>0:k}query(t,a,d,g,y){return this._query(t,a,d,g,!1,y)}hitTest(t,a,d,g,y){return this._query(t,a,d,g,!0,y)}hitTestCircle(t,a,d,g){return this._queryCircle(t,a,d,!0,g)}_queryCell(t,a,d,g,y,v,T,C){const R=T.seenUids,k=this.boxCells[y];if(k!==null){const j=this.bboxes;for(const F of k)if(!R.box[F]){R.box[F]=!0;const Z=4*F;if(t<=j[Z+2]&&a<=j[Z+3]&&d>=j[Z+0]&&g>=j[Z+1]&&(!C||C(this.boxKeys[F]))){if(T.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[F],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const L=this.circleCells[y];if(L!==null){const j=this.circles;for(const F of L)if(!R.circle[F]){R.circle[F]=!0;const Z=3*F;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],t,a,d,g)&&(!C||C(this.circleKeys[F]))){if(T.hitTest)return v.push(!0),!0;{const $=j[Z],X=j[Z+1],J=j[Z+2];v.push({key:this.circleKeys[F],x1:$-J,y1:X-J,x2:$+J,y2:X+J})}}}}}_queryCellCircle(t,a,d,g,y,v,T,C){const R=T.circle,k=T.seenUids,L=this.boxCells[y];if(L!==null){const F=this.bboxes;for(const Z of L)if(!k.box[Z]){k.box[Z]=!0;const $=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,F[$+0],F[$+1],F[$+2],F[$+3])&&(!C||C(this.boxKeys[Z])))return v.push(!0),!0}}const j=this.circleCells[y];if(j!==null){const F=this.circles;for(const Z of j)if(!k.circle[Z]){k.circle[Z]=!0;const $=3*Z;if(this._circlesCollide(F[$],F[$+1],F[$+2],R.x,R.y,R.radius)&&(!C||C(this.circleKeys[Z])))return v.push(!0),!0}}}_forEachCell(t,a,d,g,y,v,T,C){const R=this._convertToXCellCoord(t),k=this._convertToYCellCoord(a),L=this._convertToXCellCoord(d),j=this._convertToYCellCoord(g);for(let F=R;F<=L;F++)for(let Z=k;Z<=j;Z++)if(y.call(this,t,a,d,g,this.xCellCount*Z+F,v,T,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,g,y,v){const T=g-t,C=y-a,R=d+v;return R*R>T*T+C*C}_circleAndRectCollide(t,a,d,g,y,v,T){const C=(v-g)/2,R=Math.abs(t-(g+C));if(R>C+d)return!1;const k=(T-y)/2,L=Math.abs(a-(y+k));if(L>k+d)return!1;if(R<=C||L<=k)return!0;const j=R-C,F=L-k;return j*j+F*F<=d*d}}const oc={unknown:0,flipRequired:1,flipNotRequired:2},zy=Math.tan(85*Math.PI/180);function Oa(h,t,a,d,g,y,v){const T=s.bz();if(a)if(y.name==="globe"){const C=s.bA(g,t);s.az(T,T,C)}else{const C=s.bB([],v);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3],d||s.by(T,T,g.angle)}else s.az(T,g.labelPlaneMatrix,h);return T}function xp(h,t,a,d,g,y,v){const T=Oa(h,t,a,d,g,y,v);return y.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function vp(h,t,a,d,g,y,v){if(a){if(y.name==="globe"){const T=Oa(h,t,a,d,g,y,v);return s.bi(T,T),s.az(T,h,T),T}{const T=s.bw(h),C=s.bx([]);return C[0]=v[0],C[1]=v[1],C[4]=v[2],C[5]=v[3],s.az(T,T,C),d||s.by(T,T,-g.angle),T}}return g.glCoordMatrix}function ea(h,t,a,d){const g=[h,t,a,1];a?s.aA(g,g,d):pr(g,g,d);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function Lh(h,t){return Math.min(.5+h/t*.5,1.5)}function ac(h,t){const a=h[0]/h[3],d=h[1]/h[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function wp(h,t,a,d,g,y,v,T,C,R){const k=a.transform,L=d?h.textSizeData:h.iconSizeData,j=s.bH(L,a.transform.zoom),F=k.projection.name==="globe",Z=[256/a.width*2+1,256/a.height*2+1],$=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;$.clear();let X=null;F&&(X=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const J=h.lineVertexArray,te=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,pe=a.transform.width/a.transform.height;let ye,Se=!1;for(let be=0;be<te.length;be++){const we=te.get(be),{numGlyphs:xe,writingMode:Te}=we;if(Te!==s.bI.vertical||Se||ye===s.bI.horizontal||(Se=!0),ye=Te,(we.hidden||Te===s.bI.vertical)&&!Se){cc(xe,$);continue}Se=!1;const Ce=new s.P(we.tileAnchorX,we.tileAnchorY);let{x:Le,y:Fe,z:Ke}=k.projection.projectTilePoint(Ce.x,Ce.y,R.canonical);if(C){const[kt,Dt,Pt]=C(Ce);Le+=kt,Fe+=Dt,Ke+=Pt}const Qe=[Le,Fe,Ke,1];if(s.aA(Qe,Qe,t),!ac(Qe,Z)){cc(xe,$);continue}const at=Qe[3],je=Lh(a.transform.getCameraToCenterDistance(k.projection),at),qe=s.bJ(L,j,we),Re=v?qe/je:qe*je,et=ea(Le,Fe,Ke,g);if(et[3]<=0){cc(xe,$);continue}let Ue={};const nt=s.al(h.layers[0].layout.get("text-max-angle")),xt=Math.cos(nt),Je=v?null:C,_t=lc(we,Re,!1,T,t,g,y,h.glyphOffsetArray,J,$,X,et,Ce,Ue,pe,Je,k.projection,R,v,xt);Se=_t.useVertical,Je&&_t.needsFlipping&&(Ue={}),(_t.notEnoughRoom||Se||_t.needsFlipping&&lc(we,Re,!0,T,t,g,y,h.glyphOffsetArray,J,$,X,et,Ce,Ue,pe,Je,k.projection,R,v,xt).notEnoughRoom)&&cc(xe,$)}d?(h.text.dynamicLayoutVertexBuffer.updateData($),X&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(X)):(h.icon.dynamicLayoutVertexBuffer.updateData($),X&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(X))}function Vm(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X){const{lineStartIndex:J,glyphStartIndex:te,segment:pe}=T,ye=te+T.numGlyphs,Se=J+T.lineLength,be=t.getoffsetX(te),we=t.getoffsetX(ye-1),xe=Yc(h*be,a,d,g,y,v,pe,J,Se,C,R,k,L,j,!0,F,Z,$,X);if(!xe)return null;const Te=Yc(h*we,a,d,g,y,v,pe,J,Se,C,R,k,L,j,!0,F,Z,$,X);return Te?{first:xe,last:Te}:null}function bp(h,t,a,d){return h===s.bI.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===s.bI.vertical?d>0?{needsFlipping:!0}:null:t!==oc.unknown&&function(g,y){return g===0||Math.abs(y/g)>zy}(a,d)?t===oc.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function lc(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te,pe){const ye=t/24,Se=h.lineOffsetX*ye,be=h.lineOffsetY*ye,{lineStartIndex:we,glyphStartIndex:xe,numGlyphs:Te,segment:Ce,writingMode:Le,flipState:Fe}=h,Ke=we+h.lineLength,Qe=at=>{if(k){const[et,Ue,nt]=at.up,xt=R.length;s.bK(k,xt+0,et,Ue,nt),s.bK(k,xt+1,et,Ue,nt),s.bK(k,xt+2,et,Ue,nt),s.bK(k,xt+3,et,Ue,nt)}const[je,qe,Re]=at.point;s.bL(R,je,qe,Re,at.angle)};if(Te>1){const at=Vm(ye,T,Se,be,a,L,j,h,C,y,F,$,!1,X,J,te,pe);if(!at)return{notEnoughRoom:!0};if(d&&!a){let[je,qe,Re]=at.first.point,[et,Ue,nt]=at.last.point;[je,qe]=ea(je,qe,Re,v),[et,Ue]=ea(et,Ue,nt,v);const xt=bp(Le,Fe,(et-je)*Z,Ue-qe);if(h.flipState=xt&&xt.needsFlipping?oc.flipRequired:oc.flipNotRequired,xt)return xt}Qe(at.first);for(let je=xe+1;je<xe+Te-1;je++){const qe=Yc(ye*T.getoffsetX(je),Se,be,a,L,j,Ce,we,Ke,C,y,F,$,!1,!1,X,J,te,pe);if(!qe)return R.length-=4*(je-xe),{notEnoughRoom:!0};Qe(qe)}Qe(at.last)}else{if(d&&!a){const je=ea(j.x,j.y,0,g),qe=we+Ce+1,Re=new s.P(C.getx(qe),C.gety(qe)),et=ea(Re.x,Re.y,0,g),Ue=et[3]>0?et:Um(j,Re,je,1,g,void 0,X,J.canonical),nt=bp(Le,Fe,(Ue[0]-je[0])*Z,Ue[1]-je[1]);if(h.flipState=nt&&nt.needsFlipping?oc.flipRequired:oc.flipNotRequired,nt)return nt}const at=Yc(ye*T.getoffsetX(xe),Se,be,a,L,j,Ce,we,Ke,C,y,F,$,!1,!1,X,J,te,pe);if(!at)return{notEnoughRoom:!0};Qe(at)}return{}}function Ks(h,t,a,d,g){const{x:y,y:v,z:T}=d.projectTilePoint(h.x,h.y,t);if(!g)return ea(y,v,T,a);const[C,R,k]=g(h);return ea(y+C,v+R,T+k,a)}function Um(h,t,a,d,g,y,v,T){const C=Ks(h.sub(t)._unit()._add(h),T,g,v,y);return s.at(C,a,C),s.au(C,C),s.bE(C,a,C,d)}function Yc(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te){const pe=d?h-t:h+t;let ye=pe>0?1:-1,Se=0;d&&(ye*=-1,Se=Math.PI),ye<0&&(Se+=Math.PI);let be=T+v+(ye>0?0:1)|0,we=g,xe=g,Te=0,Ce=0;const Le=Math.abs(pe),Fe=[],Ke=[];let Qe=y,at=Qe,je=s.bC([]);const qe=()=>Um(at,Qe,xe,Le-Te+1,k,j,$,X.canonical);for(;Te+Ce<=Le;){if(be+=ye,be<T||be>=C)return null;if(xe=we,at=Qe,Fe.push(xe),F&&Ke.push(at),Qe=new s.P(R.getx(be),R.gety(be)),we=L[be],!we){const Pt=Ks(Qe,X.canonical,k,$,j);we=Pt[3]>0?L[be]=Pt:qe()}Te+=Ce;const kt=s.at([],we,xe),Dt=s.bD(xe,we);if(a&&Dt>0&&Ce>0&&s.bG(je,kt)/(Ce*Dt)<te)return null;Ce=Dt,je=kt}Z&&j&&(L[be]&&(we=qe(),Ce=s.bD(xe,we),je=s.at([],we,xe)),L[be]=we);const Re=(Le-Te)/Ce,et=Qe.sub(at)._mult(Re)._add(at),Ue=s.bE([],xe,je,Re);let nt=[0,0,1],xt=je[0],Je=je[1];if(J&&(nt=$.upVector(X.canonical,et.x,et.y),nt[0]!==0||nt[1]!==0||nt[2]!==1)){const kt=[nt[2],0,-nt[0]],Dt=s.bF([],nt,kt);s.au(kt,kt),s.au(Dt,Dt),xt=s.bG(je,kt),Je=s.bG(je,Dt)}if(a){const kt=s.bF([],nt,je);s.au(kt,kt),s.bE(Ue,Ue,kt,a*ye)}const _t=Se+Math.atan2(Je,xt);return Fe.push(Ue),F&&Ke.push(et),{point:Ue,angle:_t,path:Fe,tilePath:Ke,up:nt}}function cc(h,t){const a=t.length,d=a+4*h;t.resize(d),t.float32.fill(-1/0,4*a,4*d)}function pr(h,t,a){const d=t[0],g=t[1];return h[0]=a[0]*d+a[4]*g+a[12],h[1]=a[1]*d+a[5]*g+a[13],h[3]=a[3]*d+a[7]*g+a[15],h}const ta=100;class rw{constructor(t,a,d=new Bm(t.width+200,t.height+200,25),g=new Bm(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ta,this.screenBottomBoundary=t.height+ta,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,d,g,y,v,T,C){let R=d.projectedAnchorX,k=d.projectedAnchorY,L=d.projectedAnchorZ;const j=d.elevation,F=d.tileID,Z=t.getProjection();if(j&&F){const[be,we,xe]=Z.upVector(F.canonical,d.tileAnchorX,d.tileAnchorY),Te=Z.upVectorScale(F.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=be*j*Te,k+=we*j*Te,L+=xe*j*Te}const $=this.projectAndGetPerspectiveRatio(T,R,k,L,d.tileID,Z.name==="globe"||!!j||this.transform.pitch>0,Z),X=v*$.perspectiveRatio,J=(d.x1*a+g.x-d.padding)*X+$.point.x,te=(d.y1*a+g.y-d.padding)*X+$.point.y,pe=(d.x2*a+g.x+d.padding)*X+$.point.x,ye=(d.y2*a+g.y+d.padding)*X+$.point.y,Se=$.perspectiveRatio<=.55||$.occluded;return!this.isInsideGrid(J,te,pe,ye)||!y&&this.grid.hitTest(J,te,pe,ye,C)||Se?{box:[],offscreen:!1,occluded:$.occluded}:{box:[J,te,pe,ye],offscreen:this.isOffscreen(J,te,pe,ye),occluded:!1}}placeCollisionCircles(t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$){const X=[],J=this.transform.elevation,te=t.getProjection(),pe=J?J.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,te):null,ye=new s.P(d.tileAnchorX,d.tileAnchorY);let{x:Se,y:be,z:we}=te.projectTilePoint(ye.x,ye.y,$.canonical);if(pe){const[nt,xt,Je]=pe(ye);Se+=nt,be+=xt,we+=Je}const xe=te.name==="globe",Te=this.projectAndGetPerspectiveRatio(T,Se,be,we,$,xe||!!J||this.transform.pitch>0,te),{perspectiveRatio:Ce}=Te,Le=(L?v/Ce:v*Ce)/s.bO,Fe=ea(Se,be,we,C),Ke=d.lineOffsetX*Le,Qe=d.lineOffsetY*Le,at=s.al(t.layers[0].layout.get("text-max-angle")),je=Math.cos(at),qe=Te.signedDistanceFromCamera>0?Vm(Le,y,Ke,Qe,!1,Fe,ye,d,g,C,{},J&&!L?pe:null,L&&!!J,te,$,L,je):null;let Re=!1,et=!1,Ue=!0;if(qe&&!Te.occluded){const nt=.5*F*Ce+Z,xt=new s.P(-100,-100),Je=new s.P(this.screenRightBoundary,this.screenBottomBoundary),_t=new Om,{first:kt,last:Dt}=qe,Pt=kt.path.length;let Ut=[];for(let pi=Pt-1;pi>=1;pi--)Ut.push(kt.path[pi]);for(let pi=1;pi<Dt.path.length;pi++)Ut.push(Dt.path[pi]);const qt=2.5*nt;R&&(Ut=Ut.map(([pi,Ai,mr],zr)=>(pe&&!xe&&(mr=pe(zr<Pt-1?kt.tilePath[Pt-1-zr]:Dt.tilePath[zr-Pt+2])[2]),ea(pi,Ai,mr,R))),Ut.some(pi=>pi[3]<=0)&&(Ut=[]));let Kt=[];if(Ut.length>0){let pi=1/0,Ai=-1/0,mr=1/0,zr=-1/0;for(const xr of Ut)pi=Math.min(pi,xr[0]),mr=Math.min(mr,xr[1]),Ai=Math.max(Ai,xr[0]),zr=Math.max(zr,xr[1]);Ai>=xt.x&&pi<=Je.x&&zr>=xt.y&&mr<=Je.y&&(Kt=[Ut.map(xr=>new s.P(xr[0],xr[1]))],(pi<xt.x||Ai>Je.x||mr<xt.y||zr>Je.y)&&(Kt=s.bM(Kt,xt.x,xt.y,Je.x,Je.y)))}for(const pi of Kt){_t.reset(pi,.25*nt);let Ai=0;Ai=_t.length<=.5*nt?1:Math.ceil(_t.paddedLength/qt)+1;for(let mr=0;mr<Ai;mr++){const zr=mr/Math.max(Ai-1,1),xr=_t.lerp(zr),Sr=xr.x+ta,xn=xr.y+ta;X.push(Sr,xn,nt,0);const wi=Sr-nt,Ri=xn-nt,Bi=Sr+nt,Gr=xn+nt;if(Ue=Ue&&this.isOffscreen(wi,Ri,Bi,Gr),et=et||this.isInsideGrid(wi,Ri,Bi,Gr),!a&&this.grid.hitTestCircle(Sr,xn,nt,j)&&(Re=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!k&&Re||!et?[]:X,offscreen:Ue,collisionDetected:Re,occluded:Te.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,g=1/0,y=-1/0,v=-1/0;for(const k of t){const L=new s.P(k.x+ta,k.y+ta);d=Math.min(d,L.x),g=Math.min(g,L.y),y=Math.max(y,L.x),v=Math.max(v,L.y),a.push(L)}const T=this.grid.query(d,g,y,v).concat(this.ignoredGrid.query(d,g,y,v)),C={},R={};for(const k of T){const L=k.key;if(C[L.bucketInstanceId]===void 0&&(C[L.bucketInstanceId]={}),C[L.bucketInstanceId][L.featureIndex])continue;const j=[new s.P(k.x1,k.y1),new s.P(k.x2,k.y1),new s.P(k.x2,k.y2),new s.P(k.x1,k.y2)];s.bN(a,j)&&(C[L.bucketInstanceId][L.featureIndex]=!0,R[L.bucketInstanceId]===void 0&&(R[L.bucketInstanceId]=[]),R[L.bucketInstanceId].push(L.featureIndex))}return R}insertCollisionBox(t,a,d,g,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,g,y){const v=a?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:g,collisionGroupID:y};for(let C=0;C<t.length;C+=4)v.insertCircle(T,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,a,d,g,y,v,T){const C=[a,d,g,1];let R=!1;g||this.transform.pitch>0?(s.aA(C,C,t),this.fogState&&y&&T.name!=="globe"&&(R=function(j,F,Z,$,X,J){const te=J.calculateFogTileMatrix(X),pe=[F,Z,$];return s.ad(pe,pe,te),rt(j,s.ae(pe),J.pitch,J._fov)}(this.fogState,a,d,g,y.toUnwrapped(),this.transform)>.9)):pr(C,C,t);const k=C[3];return{point:new s.P((C[0]/k+1)/2*this.transform.width+ta,(-C[1]/k+1)/2*this.transform.height+ta),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/k*.5,1.5),signedDistanceFromCamera:k,occluded:v&&C[2]>k||R}}isOffscreen(t,a,d,g){return d<ta||t>=this.screenRightBoundary||g<ta||a>this.screenBottomBoundary}isInsideGrid(t,a,d,g){return d>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=s.bx([]);return s.bo(t,t,[-100,-100,0]),t}}function Gm(h,t,a){const d=t.createTileMatrix(h,h.worldSize,a.toUnwrapped());return s.az(new Float32Array(16),h.projMatrix,d)}function si(h,t,a){if(t.projection.name===a.projection.name)return h.projMatrix;const d=a.clone();return d.setProjection(t.projection),Gm(d,t.getProjection(),h)}function Sp(h,t,a){return t.name===a.projection.name?h.projMatrix:Gm(a,t,h)}class Fh{constructor(t,a,d,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class uc{constructor(t,a,d,g,y,v=!1){this.text=new Fh(t?t.text:null,a,d,y),this.icon=new Fh(t?t.icon:null,a,g,y),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fo{constructor(t,a,d,g=!1){this.text=t,this.icon=a,this.skipFade=d,this.clipped=g}}class $m{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class Kc{constructor(t,a,d,g,y){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=y}}class $t{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function br(h,t,a,d,g){const{horizontalAlign:y,verticalAlign:v}=s.bT(h),T=-(y-.5)*t,C=-(v-.5)*a,R=s.bU(h,d);return new s.P(T+R[0]*g,C+R[1]*g)}function ar(h,t,a,d,g){const y=new s.P(h,t);return a&&y._rotate(d?g:-g),y}class Qs{constructor(t,a,d,g,y,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new rw(this.transform,y),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new $t(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,d,g,y=1){const v=d.getBucket(a),T=d.latestFeatureIndex;if(!v||!T||a.fqid!==v.layerIds[0])return;const C=v.layers[0].layout,R=v.layers[0].paint,k=d.collisionBoxArray,L=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),j=d.tileSize/s.aj,F=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Z=($=d.tileID,X=v.getProjection(),J=this.transform,X.name===this.projection?J.calculateProjMatrix($.toUnwrapped()):Gm(J,X,$));var $,X,J;const te=C.get("text-pitch-alignment")==="map",pe=C.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ye=a.dynamicFilter(),Se=a.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(d),we=xp(Z,d.tileID.canonical,te,pe,this.transform,v.getProjection(),be);let xe=null;if(te){const qe=vp(Z,d.tileID.canonical,te,pe,this.transform,v.getProjection(),be);xe=s.az([],this.transform.labelPlaneMatrix,qe)}let Te=null;ye&&d.latestFeatureIndex&&(Te={unwrappedTileID:F,dynamicFilter:ye,dynamicFilterNeedsFeature:Se}),this.retainedQueryData[v.bucketInstanceId]=new Kc(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,d.tileID);const[Ce,Le]=v.layers[0].layout.get("text-size-scale-range"),Fe=s.ay(y,Ce,Le),[Ke,Qe]=C.get("icon-size-scale-range"),at=s.ay(y,Ke,Qe),je={bucket:v,layout:C,paint:R,posMatrix:Z,textLabelPlaneMatrix:we,labelToScreenMatrix:xe,clippingData:Te,scale:L,textPixelRatio:j,holdingForFade:d.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:s.bH(v.textSizeData,this.transform.zoom,Fe),partiallyEvaluatedIconSize:s.bH(v.iconSizeData,this.transform.zoom,at),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(g)for(const qe of v.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:et,symbolInstanceEnd:Ue}=qe;t.push({sortKey:Re,symbolInstanceStart:et,symbolInstanceEnd:Ue,parameters:je})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:je})}attemptAnchorPlacement(t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te){const{textOffset0:pe,textOffset1:ye,crossTileID:Se}=j,be=[pe,ye],we=br(t,d,g,be,y),xe=this.collisionIndex.placeCollisionBox(Z,y,a,ar(we.x,we.y,v,T,this.transform.angle),L,C,R,k.predicate);if(X){const Te=Z.getSymbolInstanceIconSize(te,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Te,X,ar(we.x,we.y,v,T,this.transform.angle),L,C,R,k.predicate).box.length===0)return}if(xe.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[Se]&&this.prevPlacement.placements[Se]&&this.prevPlacement.placements[Se].text&&(Te=this.prevPlacement.variableOffsets[Se].anchor),this.variableOffsets[Se]={textOffset:be,width:d,height:g,anchor:t,textScale:y,prevAnchor:Te},this.markUsedJustification(Z,t,j,$),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,$,j),this.placedOrientations[Se]=$),{shift:we,placedGlyphBoxes:xe}}}placeLayerBucketPart(t,a,d,g,y=1){const{bucket:v,layout:T,paint:C,posMatrix:R,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:j,textPixelRatio:F,holdingForFade:Z,collisionBoxArray:$,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:J,collisionGroup:te,latestFeatureIndex:pe}=t.parameters,ye=T.get("text-optional"),Se=T.get("icon-optional"),be=T.get("text-allow-overlap"),we=T.get("icon-allow-overlap"),xe=T.get("text-rotation-alignment")==="map",Te=T.get("text-pitch-alignment")==="map",Ce=C.get("symbol-z-offset"),Le=T.get("symbol-elevation-reference")==="sea",[Fe,Ke]=T.get("text-size-scale-range"),[Qe,at]=T.get("icon-size-scale-range"),je=s.ay(y,Fe,Ke),qe=s.ay(y,Qe,at);this.transform.setProjection(v.projection);let Re=be&&(we||!v.hasIconData()||Se),et=we&&(be||!v.hasTextData()||ye);const Ue=!Ce.isConstant();!v.collisionArrays&&$&&v.deserializeCollisionBoxes($),d&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,$,je,qe);const nt=(Je,_t,kt)=>{const{crossTileID:Dt,numVerticalGlyphVertices:Pt}=Je;let Ut=null;if(j&&j.dynamicFilterNeedsFeature||Ue){const Mr=this.retainedQueryData[v.bucketInstanceId];Ut=pe.loadFeature({featureIndex:Je.featureIndex,bucketIndex:Mr.bucketIndex,sourceLayerIndex:Mr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ut,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.P(Je.tileAnchorX,Je.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[Dt]=new fo(!1,!1,!1,!0),void a.add(Dt);const qt=Ce.evaluate(Ut,{});if(a.has(Dt))return;if(Z)return void(this.placements[Dt]=new fo(!1,!1,!1));let Kt=!1,pi=!1,Ai=!0,mr=!1,zr=!1,xr=null,Sr={box:null,offscreen:null,occluded:null},xn={box:null},wi=null,Ri=null,Bi=null,Gr=0,An=0,Lr=0;kt.textFeatureIndex?Gr=kt.textFeatureIndex:Je.useRuntimeCollisionCircles&&(Gr=Je.featureIndex),kt.verticalTextFeatureIndex&&(An=kt.verticalTextFeatureIndex);const or=Mr=>{Mr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const qr=this.transform.elevation;Mr.elevation=Le?qt:qt+(qr?qr.getAtTileOffset(Mr.tileID,Mr.tileAnchorX,Mr.tileAnchorY):0),Mr.elevation+=Je.zOffset},dn=kt.textBox;if(dn){or(dn);const Mr=lr=>{let mn=s.bI.horizontal;if(v.allowVerticalPlacement&&!lr&&this.prevPlacement){const cs=this.prevPlacement.placedOrientations[Dt];cs&&(this.placedOrientations[Dt]=cs,mn=cs,this.markUsedOrientation(v,mn,Je))}return mn},qr=(lr,mn)=>{if(v.allowVerticalPlacement&&Pt>0&&kt.verticalTextBox){for(const cs of v.writingModes)if(cs===s.bI.vertical?(Sr=mn(),xn=Sr):Sr=lr(),Sr&&Sr.box&&Sr.box.length)break}else Sr=lr()};if(T.get("text-variable-anchor")){let lr=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Dt]){const en=this.prevPlacement.variableOffsets[Dt];lr.indexOf(en.anchor)>0&&(lr=lr.filter(rr=>rr!==en.anchor),lr.unshift(en.anchor))}const mn=(en,rr,eo)=>{const Gs=v.getSymbolInstanceTextSize(X,Je,this.transform.zoom,_t),_o=(en.x2-en.x1)*Gs+2*en.padding,na=(en.y2-en.y1)*Gs+2*en.padding,Lo=Je.hasIconTextFit&&!we?rr:null;Lo&&or(Lo);let $s={box:[],offscreen:!1,occluded:!1};const kl=be?2*lr.length:lr.length;for(let sa=0;sa<kl;++sa){const Dl=this.attemptAnchorPlacement(lr[sa%lr.length],en,_o,na,Gs,xe,Te,F,R,te,sa>=lr.length,Je,_t,v,eo,Lo,X,J);if(Dl&&($s=Dl.placedGlyphBoxes,$s&&$s.box&&$s.box.length)){Kt=!0,xr=Dl.shift;break}}return $s};qr(()=>mn(dn,kt.iconBox,s.bI.horizontal),()=>{const en=kt.verticalTextBox;return en&&or(en),v.allowVerticalPlacement&&!(Sr&&Sr.box&&Sr.box.length)&&Pt>0&&en?mn(en,kt.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),Sr&&(Kt=Sr.box,Ai=Sr.offscreen,mr=Sr.occluded);const cs=Mr(!(!Sr||!Sr.box));if(!Kt&&this.prevPlacement){const en=this.prevPlacement.variableOffsets[Dt];en&&(this.variableOffsets[Dt]=en,this.markUsedJustification(v,en.anchor,Je,cs))}}else{const lr=(mn,cs)=>{const en=v.getSymbolInstanceTextSize(X,Je,this.transform.zoom,_t,y),rr=this.collisionIndex.placeCollisionBox(v,en,mn,new s.P(0,0),be,F,R,te.predicate);return rr&&rr.box&&rr.box.length&&(this.markUsedOrientation(v,cs,Je),this.placedOrientations[Dt]=cs),rr};qr(()=>lr(dn,s.bI.horizontal),()=>{const mn=kt.verticalTextBox;return v.allowVerticalPlacement&&Pt>0&&mn?(or(mn),lr(mn,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Mr(!!(Sr&&Sr.box&&Sr.box.length))}}if(wi=Sr,Kt=wi&&wi.box&&wi.box.length>0,Ai=wi&&wi.offscreen,mr=wi&&wi.occluded,Je.useRuntimeCollisionCircles){const Mr=v.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex>=0?Je.centerJustifiedTextSymbolIndex:Je.verticalPlacedTextSymbolIndex),qr=s.bJ(v.textSizeData,X,Mr),lr=T.get("text-padding");Ri=this.collisionIndex.placeCollisionCircles(v,be,Mr,v.lineVertexArray,v.glyphOffsetArray,qr,R,k,L,d,Te,te.predicate,Je.collisionCircleDiameter*qr/s.bO,lr,this.retainedQueryData[v.bucketInstanceId].tileID),Kt=be||Ri.circles.length>0&&!Ri.collisionDetected,Ai=Ai&&Ri.offscreen,mr=Ri.occluded}if(kt.iconFeatureIndex&&(Lr=kt.iconFeatureIndex),kt.iconBox){const Mr=qr=>{or(qr);const lr=Je.hasIconTextFit&&xr?ar(xr.x,xr.y,xe,Te,this.transform.angle):new s.P(0,0),mn=v.getSymbolInstanceIconSize(J,this.transform.zoom,Je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,mn,qr,lr,we,F,R,te.predicate)};xn&&xn.box&&xn.box.length&&kt.verticalIconBox?(Bi=Mr(kt.verticalIconBox),pi=Bi.box.length>0):(Bi=Mr(kt.iconBox),pi=Bi.box.length>0),Ai=Ai&&Bi.offscreen,zr=Bi.occluded}const Xi=ye||Je.numHorizontalGlyphVertices===0&&Pt===0,Tn=Se||Je.numIconVertices===0;if(Xi||Tn?Tn?Xi||(pi=pi&&Kt):Kt=pi&&Kt:pi=Kt=pi&&Kt,Kt&&wi&&wi.box&&this.collisionIndex.insertCollisionBox(wi.box,T.get("text-ignore-placement"),v.bucketInstanceId,xn&&xn.box&&An?An:Gr,te.ID),pi&&Bi&&this.collisionIndex.insertCollisionBox(Bi.box,T.get("icon-ignore-placement"),v.bucketInstanceId,Lr,te.ID),Ri&&(Kt&&this.collisionIndex.insertCollisionCircles(Ri.circles,T.get("text-ignore-placement"),v.bucketInstanceId,Gr,te.ID),d)){const Mr=v.bucketInstanceId;let qr=this.collisionCircleArrays[Mr];qr===void 0&&(qr=this.collisionCircleArrays[Mr]=new $m);for(let lr=0;lr<Ri.circles.length;lr+=4)qr.circles.push(Ri.circles[lr+0]),qr.circles.push(Ri.circles[lr+1]),qr.circles.push(Ri.circles[lr+2]),qr.circles.push(Ri.collisionDetected?1:0)}const $r=v.projection.name!=="globe";Re=Re&&($r||!mr),et=et&&($r||!zr),this.placements[Dt]=new fo(Kt||Re,pi||et,Ai||v.justReloaded),a.add(Dt)},xt=this.retainedQueryData[v.bucketInstanceId].tileID;if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,xt),v.elevationType==="road"&&v.updateRoadElevation(xt.canonical),v.updateZOffset(),v.sortFeaturesByY){const Je=v.getSortedSymbolIndexes(this.transform.angle);for(let _t=Je.length-1;_t>=0;--_t){const kt=Je[_t];nt(v.symbolInstances.get(kt),kt,v.collisionArrays[kt])}v.hasAnyZOffset&&s.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Je=v.getSortedIndexesByZOffset();for(let _t=0;_t<Je.length;++_t){const kt=Je[_t];nt(v.symbolInstances.get(kt),kt,v.collisionArrays[kt])}}else for(let Je=t.symbolInstanceStart;Je<t.symbolInstanceEnd;Je++)nt(v.symbolInstances.get(Je),Je,v.collisionArrays[Je]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[v.bucketInstanceId];s.bi(Je.invProjMatrix,R),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,a,d,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:C,crossTileID:R}=d,k=s.bV(a),L=g===s.bI.vertical?C:k==="left"?y:k==="center"?v:k==="right"?T:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=L>=0&&y!==L?0:R),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=L>=0&&v!==L?0:R),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=L>=0&&T!==L?0:R),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=L>=0&&C!==L?0:R)}markUsedOrientation(t,a,d){const g=a===s.bI.horizontal||a===s.bI.horizontalOnly?a:0,y=a===s.bI.vertical?a:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R}=d,k=t.text.placedSymbolArray;v>=0&&(k.get(v).placedOrientation=g),T>=0&&(k.get(T).placedOrientation=g),C>=0&&(k.get(C).placedOrientation=g),R>=0&&(k.get(R).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(t):1,y=a?a.opacities:{},v=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const C in this.placements){const R=this.placements[C],k=y[C];k?(this.opacities[C]=new uc(k,g,R.text,R.icon,null,R.clipped),d=d||R.text!==k.text.placed||R.icon!==k.icon.placed):(this.opacities[C]=new uc(null,g,R.text,R.icon,R.skipFade,R.clipped),d=d||R.text||R.icon)}for(const C in y){const R=y[C];if(!this.opacities[C]){const k=new uc(R,g,!1,!1);k.isHidden()||(this.opacities[C]=k,d=d||R.text.placed||R.icon.placed)}}for(const C in v)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=v[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,d,g){const y=new Set;for(const v of a){const T=v.getBucket(t);T&&v.latestFeatureIndex&&t.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,y,v,v.collisionBoxArray,d,g,v.tileID,t.scope),T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,v.tileID),T.elevationType==="road"&&T.updateRoadElevation(v.tileID.canonical),T.updateZOffset())}}updateBucketOpacities(t,a,d,g,y,v,T,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const R=t.layers[0].layout,k=t.layers[0].paint,L=!!t.layers[0].dynamicFilter(),j=new uc(null,0,!1,!1,!0),F=R.get("text-allow-overlap"),Z=R.get("icon-allow-overlap"),$=R.get("text-variable-anchor"),X=R.get("text-rotation-alignment")==="map",J=R.get("text-pitch-alignment")==="map",te=k.get("symbol-z-offset"),pe=R.get("symbol-elevation-reference")==="sea",ye=!te.isConstant(),Se=new uc(null,0,F&&(Z||!t.hasIconData()||R.get("icon-optional")),Z&&(F||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const be=(xe,Te,Ce)=>{for(let Le=0;Le<Te/4;Le++)xe.opacityVertexArray.emplaceBack(Ce)};let we=0;v&&t.updateReplacement(T,v);for(let xe=0;xe<t.symbolInstances.length;xe++){const Te=t.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Le,crossTileID:Fe,numIconVertices:Ke,tileAnchorX:Qe,tileAnchorY:at}=Te;let je=null;const qe=this.retainedQueryData[t.bucketInstanceId];ye&&Te&&qe&&(je=d.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=te.evaluate(je,{}),et=a.has(Fe);let Ue=this.opacities[Fe];et?Ue=j:Ue||(Ue=Se,this.opacities[Fe]=Ue),a.add(Fe);const nt=Ce>0||Le>0,xt=Ke>0,Je=this.placedOrientations[Fe],_t=Je===s.bI.vertical,kt=Je===s.bI.horizontal||Je===s.bI.horizontalOnly;!nt&&!xt||Ue.isHidden()||we++;let Dt=!1;if((nt||xt)&&v)for(const Pt of t.activeReplacements){if(s.bP(Pt,y,s.bQ.Symbol,C)||Pt.min.x>Qe||Qe>Pt.max.x||Pt.min.y>at||at>Pt.max.y)continue;const Ut=s.bR(Qe,at,T.canonical,Pt.footprintTileId.canonical);if(Dt=s.bS(Ut,Pt.footprint),Dt)break}if(nt){const Pt=Dt?_l:Qc(Ue.text);be(t.text,Ce,_t?_l:Pt),be(t.text,Le,kt?_l:Pt);const Ut=Ue.text.isHidden(),{leftJustifiedTextSymbolIndex:qt,centerJustifiedTextSymbolIndex:Kt,rightJustifiedTextSymbolIndex:pi,verticalPlacedTextSymbolIndex:Ai}=Te,mr=t.text.placedSymbolArray,zr=Ut||_t?1:0;qt>=0&&(mr.get(qt).hidden=zr),Kt>=0&&(mr.get(Kt).hidden=zr),pi>=0&&(mr.get(pi).hidden=zr),Ai>=0&&(mr.get(Ai).hidden=Ut||kt?1:0);const xr=this.variableOffsets[Fe];xr&&this.markUsedJustification(t,xr.anchor,Te,Je);const Sr=this.placedOrientations[Fe];Sr&&(this.markUsedJustification(t,"left",Te,Sr),this.markUsedOrientation(t,Sr,Te))}if(xt){const Pt=Dt?_l:Qc(Ue.icon),{placedIconSymbolIndex:Ut,verticalPlacedIconSymbolIndex:qt}=Te,Kt=t.icon.placedSymbolArray,pi=Ue.icon.isHidden()?1:0;Ut>=0&&(be(t.icon,Ke,_t?_l:Pt),Kt.get(Ut).hidden=pi),qt>=0&&(be(t.icon,Te.numVerticalIconVertices,kt?_l:Pt),Kt.get(qt).hidden=pi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Pt=t.collisionArrays[xe];if(Pt){let Ut=new s.P(0,0),qt=!0;if(Pt.textBox||Pt.verticalTextBox){if($){const pi=this.variableOffsets[Fe];pi?(Ut=br(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textScale),X&&Ut._rotate(J?this.transform.angle:-this.transform.angle)):qt=!1}L&&(qt=!Ue.clipped),Pt.textBox&&Ba(t.textCollisionBox.collisionVertexArray,Ue.text.placed,!qt||_t,Re,pe,Ut.x,Ut.y),Pt.verticalTextBox&&Ba(t.textCollisionBox.collisionVertexArray,Ue.text.placed,!qt||kt,Re,pe,Ut.x,Ut.y)}const Kt=qt&&!!(!kt&&Pt.verticalIconBox);Pt.iconBox&&Ba(t.iconCollisionBox.collisionVertexArray,Ue.icon.placed,Kt,Re,pe,Te.hasIconTextFit?Ut.x:0,Te.hasIconTextFit?Ut.y:0),Pt.verticalIconBox&&Ba(t.iconCollisionBox.collisionVertexArray,Ue.icon.placed,!Kt,Re,pe,Te.hasIconTextFit?Ut.x:0,Te.hasIconTextFit?Ut.y:0)}}}if(t.fullyClipped=we===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=xe.invProjMatrix,t.placementViewportMatrix=xe.viewportMatrix,t.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Ba(h,t,a,d,g,y,v){h.emplaceBack(t?1:0,a?1:0,y||0,v||0,d,g?1:0),h.emplaceBack(t?1:0,a?1:0,y||0,v||0,d,g?1:0),h.emplaceBack(t?1:0,a?1:0,y||0,v||0,d,g?1:0),h.emplaceBack(t?1:0,a?1:0,y||0,v||0,d,g?1:0)}const fr=Math.pow(2,25),Tp=Math.pow(2,24),Oh=Math.pow(2,17),Bh=Math.pow(2,16),Ps=Math.pow(2,9),Dn=Math.pow(2,8),nw=Math.pow(2,1);function Qc(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,a=Math.floor(127*h.opacity);return a*fr+t*Tp+a*Oh+t*Bh+a*Ps+t*Dn+a*nw+t}const _l=0;class Vh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,d,g,y,v){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(T,g,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,R)=>C.sortKey-R.sortKey));this._currentPartIndex<T.length;){const C=T[this._currentPartIndex];if(a.placeLayerBucketPart(C,this._seenCrossTileIDs,d,C.symbolInstanceStart===0,v),this._currentPartIndex++,y())return!0}return!1}}class Ep{constructor(t,a,d,g,y,v,T,C,R){this.placement=new Qs(t,y,v,T,C,R),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d,g,y){const v=s.q.now(),T=()=>{const C=s.q.now()-v;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=a[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){const k=C,L=k.layout.get("symbol-z-elevate"),j=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,F=k.layout.get("symbol-z-order"),Z=F==="viewport-y"||F==="auto"&&!(F!=="viewport-y"&&j),$=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),X=Z&&$,J=this._inProgressLayer=this._inProgressLayer||new Vh(k),te=s.C(C.source,C.scope);if(J.continuePlacement(L||X?g[te]:d[te],this.placement,this._showCollisionBoxes,C,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Uh=512/s.aj/2;class Cp{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this.index=new s.bW(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*s.aj,y=t.canonical.y*s.aj;for(let v=0;v<a.length;v++){const{key:T,crossTileID:C,tileAnchorX:R,tileAnchorY:k}=a.get(v),L=Math.floor((g+R)*Uh),j=Math.floor((y+k)*Uh);this.index.add(L,j),this.keys.push(T),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,a,d){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),y=Uh/Math.pow(2,a.canonical.z-this.tileID.canonical.z),v=a.canonical.x*s.aj,T=a.canonical.y*s.aj;for(let C=0;C<t.length;C++){const R=t.get(C);if(R.crossTileID)continue;const{key:k,tileAnchorX:L,tileAnchorY:j}=R,F=Math.floor((v+L)*y),Z=Math.floor((T+j)*y),$=this.index.range(F-g,Z-g,F+g,Z+g).sort((X,J)=>X-J);for(const X of $){const J=this.crossTileIDs[X];if(this.keys[X]===k&&!d.has(J)){d.add(J),R.crossTileID=J;break}}}}}class Ms{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Va{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const g=this.indexes[d],y={};for(const v in g){const T=g[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),y[T.tileID.key]=T}this.indexes[d]=y}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const v=this.indexes[y];if(Number(y)>t.overscaledZ)for(const T in v){const C=v[T];C.tileID.isChildOf(t)&&C.findMatches(a.symbolInstances,t,g)}else{const T=v[t.scaledTo(Number(y)).key];T&&T.findMatches(a.symbolInstances,t,g)}}for(let y=0;y<a.symbolInstances.length;y++){const v=a.symbolInstances.get(y);v.crossTileID||(v.crossTileID=d.generate(),g.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Cp(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const g=this.indexes[d];for(const y in g)t[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[y]),delete g[y],a=!0)}return a}}class Us{constructor(){this.layerIndexes={},this.crossTileIDs=new Ms,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d,g){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new Va);let v=!1;const T={};g.name!=="globe"&&y.handleWrapJump(d);for(const C of a){const R=C.getBucket(t);R&&t.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,R,this.crossTileIDs)&&(v=!0),T[R.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const hc=771;class zi{constructor(t,a,d,g){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=g}}zi.Replace=[1,0,1,0],zi.disabled=new zi(zi.Replace,s.am.transparent,[!1,!1,!1,!1]),zi.unblended=new zi(zi.Replace,s.am.transparent,[!0,!0,!0,!0]),zi.alphaBlended=new zi([1,hc,1,hc],s.am.transparent,[!0,!0,!0,!0]),zi.alphaBlendedNonPremultiplied=new zi([770,hc,770,hc],s.am.transparent,[!0,!0,!0,!0]),zi.multiply=new zi([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Mt{constructor(t,a,d){this.func=t,this.mask=a,this.range=d}}Mt.ReadOnly=!1,Mt.ReadWrite=!0,Mt.disabled=new Mt(519,Mt.ReadOnly,[0,1]);const ko=7680;class mi{constructor(t,a,d,g,y,v){this.test=t,this.ref=a,this.mask=d,this.fail=g,this.depthFail=y,this.pass=v}}mi.disabled=new mi({func:519,mask:0},0,0,ko,ko,ko);const In=1029,Gh=2305;class ri{constructor(t,a,d){this.enable=t,this.mode=a,this.frontFace=d}}function Jc(h,t){const a=s.c1(h,3);s.c3(h,t),s.c7(h,3,a)}function eu(h,t){const a=s.b_([]);return s.b$(a,a,-t),s.c0(a,a,-h),a}function yl(h,t){const a=[h[0],h[1],0],d=[t[0],t[1],0];if(s.ae(a)>=1e-15){const v=s.au([],a);s.bY(d,v,s.bG(d,v)),t[0]=d[0],t[1]=d[1]}const g=s.bF([],t,h);if(s.bZ(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return eu(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}ri.disabled=new ri(!1,In,Gh),ri.backCCW=new ri(!0,In,Gh),ri.backCW=new ri(!0,In,2304),ri.frontCW=new ri(!0,1028,2304),ri.frontCCW=new ri(!0,1028,Gh);class Ly{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=s.bX(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,y=s.ac.fromLngLat(t,g),v=[y.x-d.x,y.y-d.y,y.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=yl(v,a)}setPitchBearing(t,a){this.orientation=eu(s.al(t),s.al(-a))}}class Do{constructor(t,a){this._transform=s.bx([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&s.c7(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.b_([]),t&&Jc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=eu(t,a),Jc(this._transform,this._orientation)}forward(){const t=s.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const d=new Float64Array(16);return s.bi(d,this.getWorldToCamera(t,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,d){const g=this.position;s.bY(g,g,-t);const y=new Float64Array(16);return s.bn(y,[d,d,d]),s.bo(y,y,g),y[10]*=a,y}getWorldToCamera(t,a){const d=new Float64Array(16),g=new Float64Array(4),y=this.position;return s.c2(g,this._orientation),s.bY(y,y,-t),s.c3(d,g),s.bo(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(t,a,d,g){const y=new Float64Array(16);return s.c4(y,t,a,d,g),y}getCameraToClipOrthographic(t,a,d,g,y,v){const T=new Float64Array(16);return s.c5(T,t,a,d,g,y,v),T}getDistanceToElevation(t,a=!1){const d=t===0?0:s.c6(t,a?s.aY(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new Do([...this.position],[...this.orientation])}}const Rs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class $h{constructor(t=0,a=0,d=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=g}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=s.ai(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=s.ai(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=s.ai(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=s.ai(t.right,a.right,d)),this}getCenter(t,a){const d=s.ay((this.left+t-this.right)/2,0,t),g=s.ay((this.top+a-this.bottom)/2,0,a);return new s.P(d,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new $h(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const es=15;class qm{constructor(t,a,d,g,y,v,T){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(v),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $h,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Do,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new qm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<es}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.ce(this.projectionOptions);const d=this.getProjection(),g=!s.bv(a,d);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.ce({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=s.cf(),s.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=s.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let g=0,y=0;for(let v=0;v<a.length;v++){const T=new s.P(a[v][0]*this.width,d+a[v][1]*(this.height-d)),C=t.pointCoordinate(T);if(!C)continue;const R=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);g+=C[3]*R,y+=R}return y===0?NaN:g/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),v=Math.max(g-d,y);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const g=s.ae(s.at([],this._camera.position,d));return s.ay(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!s.ch(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];s.ci(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new Ly;return a.position=new s.ac(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!s.cj(t))return!1;s.ck(t,t);const a=s.cl([],[0,0,-1],t),d=s.cl([],[0,-1,0],t);if(d[2]<0)return!1;const g=yl(a,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=s.ay(t[2],g/d,g/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new s.cm(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.P(0,0)),g=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),v=this.pointCoordinate(new s.P(0,this.height)),T=Math.floor(Math.min(d.x,g.x,y.x,v.x)),C=Math.floor(Math.max(d.x,g.x,y.x,v.x)),R=1;for(let k=T-R;k<=C+R;k++)k!==0&&a.push(new s.cm(k,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,d){let g=[];const y=d!=null,v=!y;if(v&&this.zoom<a||y&&d[0]===0&&d[1]===0)return g;const T=new Set,C=(k,L,j,F,Z)=>{const $=s.cK(L,k,j,F,Z);T.has($)||(g.push(new s.aM(k,L,j,F,Z)),T.add($))};for(let k=0;k<t.length;k++){const L=t[k];if(v&&L.canonical.z!==a)continue;const j=L.canonical,F=L.overscaledZ,Z=L.wrap,$=1<<j.z,X=j.x+1<$,J=j.x>0,te=j.y+1<$,pe=j.y>0,ye=L.wrap-(J?0:1),Se=L.wrap+(X?0:1),be=J?j.x-1:$-1,we=X?j.x+1:0;if(y)d[0]<0?(C(F,Se,j.z,we,j.y),d[1]<0&&te&&(C(F,Z,j.z,j.x,j.y+1),C(F,Se,j.z,we,j.y+1)),d[1]>0&&pe&&(C(F,Z,j.z,j.x,j.y-1),C(F,Se,j.z,we,j.y-1))):d[0]>0?(C(F,ye,j.z,be,j.y),d[1]<0&&te&&(C(F,Z,j.z,j.x,j.y+1),C(F,ye,j.z,be,j.y+1)),d[1]>0&&pe&&(C(F,Z,j.z,j.x,j.y-1),C(F,ye,j.z,be,j.y-1))):d[1]<0&&te?C(F,Z,j.z,j.x,j.y+1):pe&&C(F,Z,j.z,j.x,j.y-1);else{const xe=L.visibleQuadrants;1&xe&&(C(F,ye,j.z,be,j.y),pe&&(C(F,Z,j.z,j.x,j.y-1),C(F,ye,j.z,be,j.y-1))),2&xe&&(C(F,Se,j.z,we,j.y),pe&&(C(F,Z,j.z,j.x,j.y-1),C(F,Se,j.z,we,j.y-1))),4&xe&&(C(F,ye,j.z,be,j.y),te&&(C(F,Z,j.z,j.x,j.y+1),C(F,ye,j.z,be,j.y+1))),8&xe&&(C(F,Se,j.z,we,j.y),te&&(C(F,Z,j.z,j.x,j.y+1),C(F,Se,j.z,we,j.y+1)))}}const R=[];for(const k of g)g.some(L=>k.isChildOf(L))||R.push(k);if(g=R.filter(k=>!t.some(L=>!!(k.overscaledZ<a&&L.isChildOf(k))||k.equals(L)||k.isChildOf(L))),v){const k=1<<a,L=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[k*L.x,k*L.y],F=4,Z=F*F;g=g.filter($=>{const X=$.canonical.x+.5-j[0],J=$.canonical.y+.5-j[1];return X*X+J*J<Z})}return g}coveringTiles(t){let a=this.coveringZoomLevel(t);const d=a,g=this.elevation&&this.elevation.exaggeration(),y=g&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const T=this.locationCoordinate(this.center),C=this.center.lat,R=1<<a,k=[R*T.x,R*T.y,0],L=this.projection.name==="globe",j=!L,F=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,j),Z=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=R*s.c6(1,this.center.lat),X=this._camera.position[2]/s.c6(1,this.center.lat),J=[R*Z.x,R*Z.y,X*(j?1:$)],te=L||g,pe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ye=this.isLODDisabled(!0)?a:0;let Se;if(this._elevation&&t.isTerrainDEM)Se=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Se=Re?Re.max:this._centerAltitude}else Se=this._centerAltitude;const be=t.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?s.co(this):1,xe=Re=>{const Ue=new s.ac(Re.x+25e-6,Re.y,Re.z),nt=new s.ac(Re.x,Re.y+25e-6,Re.z),xt=Re.toLngLat(),Je=Ue.toLngLat(),_t=nt.toLngLat(),kt=this.locationCoordinate(xt),Dt=this.locationCoordinate(Je),Pt=this.locationCoordinate(_t),Ut=Math.hypot(Dt.x-kt.x,Dt.y-kt.y),qt=Math.hypot(Pt.x-kt.x,Pt.y-kt.y);return Math.sqrt(Ut*qt)*we/25e-6},Te=Re=>{const et=Se,Ue=be;return{aabb:s.cr(this,R,0,0,0,Re,Ue,et,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:et,wrap:Re,fullyVisible:!1}},Ce=[];let Le=[];const Fe=a,Ke=t.reparseOverscaled?d:a,Qe=(X-this._centerAltitude)*$,at=Re=>{if(!this._elevation||!Re.tileID||!v)return;const et=this._elevation.getMinMaxForTile(Re.tileID),Ue=Re.aabb;et?(Ue.min[2]=et.min,Ue.max[2]=et.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Re.shouldSplit=qe(Re),Re.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},je=(Re,et)=>{if(.707*et<Re)return 1;const Ue=et/Re;return Ue/(1.4144271570014144+(Math.pow(1.1,Ue-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=Re=>{if(Re.zoom<ye)return!0;if(Re.zoom===Fe)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const et=Re.aabb.distanceX(J),Ue=Re.aabb.distanceY(J);let nt=Qe,xt=1;if(L){nt=Re.aabb.distanceZ(J);const qt=Math.pow(2,Re.zoom),Kt=s.aY((Re.y+1)/qt),pi=s.aY(Re.y/qt),Ai=Math.min(Math.max(C,Kt),pi),mr=s.cO(Ai)/s.cO(C);if(xt=Ai===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,mr/this._mercatorScaleRatio),this.zoom<=s.cL&&Re.zoom===Fe-1&&mr>=.9)return!0}else if(y&&(nt=Re.aabb.distanceZ(J)*$),this.projection.isReprojectedInTileSpace&&d<=5){const qt=Math.pow(2,Re.zoom),Kt=xe(new s.ac((Re.x+.5)/qt,(Re.y+.5)/qt));xt=Kt>.85?1:Kt}if(!v){const qt=Math.sqrt(et*et+Ue*Ue+nt*nt);let Kt=(1<<Fe-Re.zoom)*pe*xt;return Kt*=je(Math.max(nt,Qe),qt),qt<Kt}let Je=Number.MAX_VALUE,_t=0;const kt=Re.aabb.getCorners(),Dt=[];for(const qt of kt){s.at(Dt,qt,J),L||(y?Dt[2]*=$:Dt[2]=Qe);const Kt=s.bG(Dt,this._camera.forward());Kt<Je&&(Je=Kt,_t=Math.abs(Dt[2]))}let Pt=(1<<Fe-Re.zoom)*pe*xt;if(Pt*=je(Math.max(_t,Qe),Je),Je<Pt)return!0;const Ut=Re.aabb.closestPoint(k);return Ut[0]===k[0]&&Ut[1]===k[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ce.push(Te(-Re)),Ce.push(Te(Re));for(Ce.push(Te(0));Ce.length>0;){const Re=Ce.pop(),et=Re.x,Ue=Re.y;let nt=Re.fullyVisible;const xt=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!nt){let Je=te?Re.aabb.intersects(F):Re.aabb.intersectsFlat(F);if(Je===0&&xt()){const _t=new s.cp(Re.zoom,et,Ue);Je=s.cq(this,R,_t,!0).intersects(F)}if(Je===0)continue;nt=Je===2}if(Re.zoom!==Fe&&qe(Re))for(let Je=0;Je<4;Je++){const _t=(et<<1)+Je%2,kt=(Ue<<1)+(Je>>1),Dt={aabb:v?Re.aabb.quadrant(Je):s.cr(this,R,Re.zoom+1,_t,kt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:_t,y:kt,wrap:Re.wrap,fullyVisible:nt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};y&&!L&&(Dt.tileID=new s.aM(Re.zoom+1===Fe?Ke:Re.zoom+1,Re.wrap,Re.zoom+1,_t,kt),at(Dt)),Ce.push(Dt)}else{const Je=Re.zoom===Fe?Ke:Re.zoom;if(t.minzoom&&t.minzoom>Je)continue;let _t=0;if(!nt){let Ut=te?Re.aabb.intersectsPrecise(F):Re.aabb.intersectsPreciseFlat(F);if(Ut===0&&xt()){const qt=new s.cp(Re.zoom,et,Ue);Ut=s.cq(this,R,qt,!0).intersectsPrecise(F)}if(Ut===0)continue;if(t.calculateQuadrantVisibility)if(F.containsPoint(Re.aabb.center))_t=15;else for(let qt=0;qt<4;qt++)Re.aabb.quadrant(qt).intersects(F)!==0&&(_t|=1<<qt)}const kt=k[0]-(.5+et+(Re.wrap<<Re.zoom))*(1<<a-Re.zoom),Dt=k[1]-.5-Ue,Pt=Re.tileID?Re.tileID:new s.aM(Je,Re.wrap,Re.zoom,et,Ue);t.calculateQuadrantVisibility&&(Pt.visibleQuadrants=_t),Le.push({tileID:Pt,distanceSq:kt*kt+Dt*Dt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,et=this.horizonLineFromTop();Le=Le.filter(Ue=>{const nt=[0,0,0,1],xt=[s.aj,s.aj,0,1],Je=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());s.aA(nt,nt,Je),s.aA(xt,xt,Je);const _t=s.cs([],nt,xt),kt=s.ct([],nt,xt),Dt=s.cM(_t,kt);if(Dt===0)return!0;let Pt=!1;const Ut=this._elevation;if(Ut&&Dt>Re&&et!==0){const qt=this.calculateProjMatrix(Ue.tileID.toUnwrapped());let Kt;t.isTerrainDEM||(Kt=Ut.getMinMaxForTile(Ue.tileID)),Kt||(Kt={min:be,max:Se});const pi=s.cu(this.rotation),Ai=[pi[0]*s.aj,pi[1]*s.aj,Kt.max];s.ad(Ai,Ai,qt),Pt=(1-Ai[1])*this.height*.5<et}return Dt<Re||Pt})}return Le.sort((Re,et)=>Re.distanceSq-et.distanceSq).map(Re=>Re.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=s.ay(t.lat,-85.051129,s.cv),d=this.projection.project(t.lng,a);return new s.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let d,g;const y=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;d=(a.x-y.x)/T,g=(a.y-y.y)/T}else{const T=this.pointCoordinate(a),C=this.pointCoordinate(y);d=T.x-C.x,g=T.y-C.y}const v=this.locationCoordinate(t);this.setLocation(new s.ac(v.x-d,v.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const d=a?s.c6(a,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new s.ac(g.x,g.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const d=a??this._centerAltitude,g=[t.x,t.y,0,1],y=[t.x,t.y,1,1];s.aA(g,g,this.pixelMatrixInverse),s.aA(y,y,this.pixelMatrixInverse);const v=y[3];s.cw(g,g,1/g[3]),s.cw(y,y,1/v);const T=g[2],C=y[2];return{p0:g,p1:y,t:T===C?0:(d-T)/(C-T)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return s.aA(a,a,this.pixelMatrixInverse),s.aA(d,d,this.pixelMatrixInverse),s.cw(a,a,1/a[3]),s.cw(d,d,1/d[3]),a[2]=s.c6(a[2],this._center.lat)*this.worldSize,d[2]=s.c6(d[2],this._center.lat)*this.worldSize,s.cw(a,a,1/this.worldSize),s.cw(d,d,1/this.worldSize),new s.av([a[0],a[1],a[2]],s.au([],s.at([],d,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:d,t:g}=t,y=s.c6(a[2],this._center.lat),v=s.c6(d[2],this._center.lat);return new s.ac(s.ai(a[0],d[0],g)/this.worldSize,s.ai(a[1],d[1],g)/this.worldSize,s.ai(y,v,g))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new s.ac(d[0],d[1],d[2]);let g=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,a);const v=.02*y,T=t.clone();for(let C=0;C<10&&y-g>v;C++){T.y=s.ai(g,y,.66);const R=this.projection.pointCoordinate3D(this,T.x,T.y);R?(y=T.y,d=R):g=T.y}return d?new s.ac(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cx)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return s.aA(g,g,this.pixelMatrix),g[3]>0?new s.P(g[0]/g[3],g[1]/g[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new s.P(a,t)),v=this.pointLocation3D(new s.P(g,t)),T=this.pointLocation3D(new s.P(g,d)),C=this.pointLocation3D(new s.P(a,d));let R=Math.min(y.lng,v.lng,T.lng,C.lng),k=Math.max(y.lng,v.lng,T.lng,C.lng),L=Math.min(y.lat,v.lat,T.lat,C.lat),j=Math.max(y.lat,v.lat,T.lat,C.lat);const F=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,$=(X,J,te,pe,ye)=>{const Se=(X+te)/2,be=(J+pe)/2,we=new s.P(Se,be),{lng:xe,lat:Te}=this.pointLocation3D(we),Ce=Math.max(0,R-xe,L-Te,xe-k,Te-j);R=Math.min(R,xe),k=Math.max(k,xe),L=Math.min(L,Te),j=Math.max(j,Te),(ye<Z||Ce>F)&&($(X,J,Se,be,ye+1),$(Se,be,te,pe,ye+1))};if($(a,t,g,t,1),$(g,t,g,d,1),$(g,d,a,d,1),$(a,d,a,t,1),this.projection.name==="globe"){const[X,J]=s.cy(this);X?(j=90,k=180,R=-180):J&&(L=-90,k=180,R=-180)}return new s.aG(new s.cd(R,L),new s.cd(k,j))}_getBoundsRectangular(t,a){const{top:d,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,T=new s.P(g,d),C=new s.P(v,d),R=new s.P(v,y),k=new s.P(g,y);let L=this.pointCoordinate(T,t),j=this.pointCoordinate(C,t);const F=this.pointCoordinate(R,a),Z=this.pointCoordinate(k,a),$=(X,J)=>(J.y-X.y)/(J.x-X.x);return L.y>1&&j.y>=0?L=new s.ac((1-Z.y)/$(Z,L)+Z.x,1):L.y<0&&j.y<=1&&(L=new s.ac(-Z.y/$(Z,L)+Z.x,0)),j.y>1&&L.y>=0?j=new s.ac((1-F.y)/$(F,j)+F.x,1):j.y<0&&L.y<=1&&(j=new s.ac(-F.y/$(F,j)+F.x,0)),new s.aG().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((d,g)=>{if(g.dem){const y=g.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=s.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aD(this.minLng)*this.tileSize,this.worldMaxX=s.aD(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,d=this._distanceTileDataCache;if(d[a])return d[a];const g=t.canonical,y=1/this.height,v=this.cameraWorldSize,T=v/this.zoomScale(g.z),C=(g.x+Math.pow(2,g.z)*t.wrap)*T,R=g.y*T,k=this.point;k.x*=v/this.worldSize,k.y*=v/this.worldSize;const L=this.angle,j=Math.sin(-L),F=-Math.cos(-L);return d[a]={bearing:[j,F],center:[(k.x-C)*y,(k.y-R)*y],scale:T/s.aj*y},d[a]}calculateFogTileMatrix(t){const a=t.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.az(g,this.worldToFogMatrix,g),d[a]=new Float32Array(g),d[a]}calculateProjMatrix(t,a=!1,d=!1){const g=t.key;let y;if(y=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];const v=this.calculatePosMatrix(t,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,s.az(v,T,v),y[g]=new Float32Array(v),y[g]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const g=s.cz(t,this);return d[a]=g,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=s.bn([],[t,t,t]);return s.az(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=s.c6(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),g=this._camera.forward(),y=s.c6(1,this._center.lat);d[2]/=y,g[2]/=y,s.au(g,g);const v=t.raycast(d,g,t.exaggeration());if(v){const T=s.bE([],d,g,v),C=new s.ac(T[0],T[1],s.c6(T[2],s.aY(T[1]))),R=(C.z+s.ae([C.x-d[0],C.y-d[1],C.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,d=s.c6(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),y=a.getAtPointOrZero(new s.ac(...g)),v=this.pixelsPerMeter/this.worldSize*y,T=this._minimumHeightOverTerrain(),C=g[2]-v;if(C<=T)if(C<0||t){const R=this.locationCoordinate(this._center,this._centerAltitude),k=[g[0],g[1],R.z-g[2]],L=s.ae(k);k[2]-=(T-C)/this._pixelsPerMercatorPixel;const j=s.ae(k);if(j===0)return;s.bY(k,k,L/j*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],R.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const j=this.center;return j.lat=s.ay(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(j.lng=s.ay(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:g}=this.point;let y=0,v=d,T=g;const C=this.width/2,R=this.height/2,k=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(g-R<k&&(T=k+R),g+R>L&&(T=L-R),L-k<this.height&&(y=Math.max(y,this.height/(L-k)),T=(L+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,Z=this.worldSize/2-(j+F)/2;v=(d+Z+this.worldSize)%this.worldSize-Z,v-C<j&&(v=j+C),v+C>F&&(v=F-C),F-j<this.width&&(y=Math.max(y,this.width/(F-j)),v=(F+j)/2)}v===d&&T===g||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(v,T))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.c6(1,this.center.lat)/s.c6(1,s.cP));const g=s.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,v=this._camera.getWorldToCamera(this.worldSize,y);let T;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=Te*this.aspect,Le=-Ce,Fe=-Te;Ce-=t.x,Le-=t.x,Te+=t.y,Fe+=t.y,T=this._camera.getCameraToClipOrthographic(Le,Ce,Fe,Te,this._nearZ,this._farZ),((Ke,Qe,at,je)=>{for(let qe=0;qe<16;qe++)Ke[qe]=s.ai(Qe[qe],at[qe],je)})(T,T,C,s.cN(this.pitch>=es?1:this.pitch/es))}else T=C;const R=s.cB([],C,v);let k=s.cB([],T,v);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Ce=s.bx([]);s.bo(Ce,Ce,[Te.x*this.worldSize,Te.y*this.worldSize,0]),s.az(Ce,Ce,s.cC(this)),s.bo(Ce,Ce,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),s.az(k,k,Ce),s.az(R,R,Ce),this.inverseAdjustmentMatrix=s.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cE([],k,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=k,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),a){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-t.x/this.width,Te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cB([],Te,v)}else this.expandedFarZProjMatrix=this.projMatrix;const L=s.bi([],T);this.frustumCorners=s.cF.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const j=new Float32Array(16);s.bx(j),s.cE(j,j,[1,-1,1]),s.cG(j,j,this._pitch),s.by(j,j,this.angle);const F=s.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(F);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-t.x/this.width,F[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=s.az(j,F,j);const $=this.point,X=$.x,J=$.y,te=this.width%2/2,pe=this.height%2/2,ye=Math.cos(this.angle),Se=Math.sin(this.angle),be=X-Math.round(X)+ye*te+Se*pe,we=J-Math.round(J)+ye*pe+Se*te,xe=new Float64Array(k);if(s.bo(xe,xe,[be>.5?be-1:be,we>.5?we-1:we,0]),this.alignedProjMatrix=xe,k=s.bz(),s.cE(k,k,[this.width/2,-this.height/2,1]),s.bo(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.bz(),s.cE(k,k,[1,-1,1]),s.bo(k,k,[-1,-1,0]),s.cE(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},k=s.bi(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cH(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(Te,Te,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,a];s.bY(y,y,g),s.bY(d,d,-1),s.cI(d,d,y);const v=s.bz();s.bo(v,v,d),s.cE(v,v,y),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,g)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*y,g.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((a-d)/g,1)),this._camera.position=s.bE([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),y=s.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),T=Math.max((t[2]-y)/Math.cos(d),v),C=this._zoomFromMercatorZ(T);s.bE(t,t,a,T),this._pitch=s.ay(d,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bX(g,-Math.PI,Math.PI),this._setZoom(s.ay(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,d=s.cx,g=0,y=1/0;for(;d-a>1e-6&&d>a;){const v=a+.5*(d-a),T=this.tileSize*Math.pow(2,v),C=this.getCameraToCenterDistance(this.projection,v,T),R=this.scaleZoom(C/(Math.max(0,t)*this.tileSize)),k=Math.abs(v-R);k<y&&(y=k,g=v),v<R?a=v:d=v}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const d=Math.min(t.x,a.x),g=Math.max(t.x,a.x),y=Math.min(t.y,a.y),v=Math.max(t.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.P(d,y),new s.P(g,v),new s.P(d,v),new s.P(g,y)],C=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const k of T){const L=this.pointRayIntersection(k);if(L.t<0)return!0;const j=this.rayIntersectionCoordinate(L);if(j.x<C||j.y<0||j.x>R||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,a){const d=s.ae(s.at([],this._camera.position,t)),g=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([a,d,g],y){const v=[a,d,g,1];s.aA(v,v,y);const T=v[3]=Math.max(v[3],1e-6);return v[0]/=T,v[1]/=T,v[2]/=T,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,d=this.worldSize){const g=s.cA(t,a,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,g);let v=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(v=s.ai(1,v,s.cN(this.pitch>=es?1:this.pitch/es))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(t,t,this.globeMatrix),t}getFrustum(t){return s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const va=(h,t)=>{if(t>0&&h.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),g=a.isLODDisabled(!1)?s.af(60,45,a.pitch):s.af(30,15,a.pitch),y=a._farZ-a._nearZ,v=t*a.height,T=((1-(C=g))*a.cameraToCenterDistance+C*(a._farZ+v))*d;var C;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(T-a._nearZ)/y,(T-v-a._nearZ)/y]}}},ws={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class qh{constructor(t,a){this.aabb=t,this.lastCascade=a}}class sw{add(t,a){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[t.key]=new qh(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,d){const g=s.cW.fromPoints(t.points);let y=0;for(const v in this.receivers){const T=this.receivers[v];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);const C=T.aabb.getCorners();for(let R=0;R<d.length;R++){let k=!0;for(const L of C){const j=[L[0]*a,L[1]*a,L[2]];if(s.ad(j,j,d[R].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){k=!1;break}}if(T.lastCascade=R,y=Math.max(y,R),k)break}}return y+1}}class ow{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new sw,this._depthMode=new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ws,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ws,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ws,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const g=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||g<=0||(this._shadowLayerCount=d.style.order.reduce((Z,$)=>{const X=d.style._mergedLayers[$];return Z+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=d.context,v=ws.shadowMapResolution,T=ws.shadowMapResolution;if(this._cascades.length===0||ws.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<ws.cascadeCount;++Z){const $=d._shadowMapDebug,X=y.gl,J=y.createFramebuffer(v,T,$,"texture"),te=new s.T(y,{width:v,height:T,data:null},X.DEPTH_COMPONENT16);if(J.depthAttachment.set(te.texture),$){const pe=new s.T(y,{width:v,height:T,data:null},X.RGBA8);J.colorAttachment.set(pe.texture)}this._cascades.push({framebuffer:J,texture:te,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cn,scale:0})}}this.shadowDirection=tu(a);let C=0;if(t.elevation){const Z=t.elevation,$=[1e4,-1e4];Z.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const J=X.dem.tree;$[0]=Math.min($[0],J.minimums[0]),$[1]=Math.max($[1],J.maximums[0])}),$[0]!==1e4&&(C=($[1]-$[0])*Z.exaggeration())}const R=1.5*t.cameraToCenterDistance,k=3*R,L=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const $=this._cascades[Z];let X=t.height/50,J=1;ws.cascadeCount===1?J=k:Z===0?J=R:(X=R,J=k);const[te,pe]=iu(t,this.shadowDirection,X,J,ws.shadowMapResolution,C);$.scale=t.scale,$.matrix=te,$.boundingSphereRadius=pe,s.bi(L,$.matrix),$.frustum=s.cn.fromInvProjectionMatrix(L,1,0,!0),$.far=J}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ws.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ws.shadowMapResolution,this._uniformValues.u_shadowmap_0=Rs.ShadowMap0,this._uniformValues.u_shadowmap_1=Rs.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const F=d.transform.elevation;for(const Z of this._groundShadowTiles){let $={min:0,max:0};if(F){const X=F.getMinMaxForTile(Z);X&&($=X)}this.addShadowReceiver(Z.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const d=this.painter,g=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),g.viewport.set([0,0,ws.shadowMapResolution,ws.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:s.am.white,depth:1});for(const v of t.order){const T=t._mergedLayers[v];if(!T.hasShadowPass()||T.isHidden(d.transform.zoom))continue;const C=t.getLayerSourceCache(T),R=C?a[C.id]:void 0;(T.type==="model"||R&&R.length)&&d.renderLayer(d,C,T,R)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,d=t.context,g=d.gl,y=a.directionalLight,v=a.ambientLight;if(!y||!v)return;const T=[],C=va(t,t.longestCutoffRange);C.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const R=dc(a,y,v),k=new Mt(g.LEQUAL,Mt.ReadOnly,t.depthRangeFor3D),L=new mi({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const j of this._groundShadowTiles){const F=j.toUnwrapped(),Z=t.isTileAffectedByFog(j),$=t.getOrCreateProgram("groundShadow",{defines:T,overrideFog:Z});this.setupShadows(F,$),t.uploadCommonUniforms(d,$,F,null,C);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:R};$.draw(t,g.TRIANGLES,k,L,zi.multiply,ri.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?zi.unblended:zi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,d=a.calculatePosMatrix(t,a.worldSize);return s.az(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return s.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,a,d,g=0){if(!this.enabled)return;const y=this.painter.transform,v=this.painter.context,T=v.gl,C=this._uniformValues,R=new Float64Array(16),k=y.calculatePosMatrix(t,y.worldSize);for(let L=0;L<this._cascades.length;L++)s.az(R,this._cascades[L].matrix,k),C[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),v.activeTexture.set(T.TEXTURE0+Rs.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const L=s.cU(t.canonical),j=2/y.tileSize*s.aj/ws.shadowMapResolution,F=j*this._cascades[0].boundingSphereRadius,Z=j*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(d==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));C.u_shadow_normal_offset=[L,F*$,Z*$],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(v,C)}setupShadowsFromMatrix(t,a,d=!1){if(!this.enabled)return;const g=this.painter.context,y=g.gl,v=this._uniformValues,T=new Float64Array(16);for(let C=0;C<ws.cascadeCount;C++)s.az(T,this._cascades[C].matrix,t),v[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(y.TEXTURE0+Rs.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=d,d){const C=ws.normalOffset;v.u_shadow_normal_offset=[1,C,C],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(g,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,d,g){if(g[2]>=0)return{};const y=function(C,R,k){const L=k/(1<<C.canonical.z);return new s.cW([C.canonical.x*L+C.wrap*k,C.canonical.y*L+C.wrap*k,0],[(C.canonical.x+1)*L+C.wrap*k,(C.canonical.y+1)*L+C.wrap*k,R])}(t,a,d).getCorners(),v=a/-g[2];g[0]<0?(s.cV(y[0],y[0],[g[0]*v,0,0]),s.cV(y[3],y[3],[g[0]*v,0,0])):g[0]>0&&(s.cV(y[1],y[1],[g[0]*v,0,0]),s.cV(y[2],y[2],[g[0]*v,0,0])),g[1]<0?(s.cV(y[0],y[0],[0,g[1]*v,0]),s.cV(y[1],y[1],[0,g[1]*v,0])):g[1]>0&&(s.cV(y[2],y[2],[0,g[1]*v,0]),s.cV(y[3],y[3],[0,g[1]*v,0]));const T={};return T.vertices=y,T.planes=[xl(y[1],y[0],y[4]),xl(y[2],y[1],y[5]),xl(y[3],y[2],y[6]),xl(y[0],y[3],y[7])],T}addShadowReceiver(t,a,d){this._receivers.add(t,s.cW.fromTileIdAndHeight(t,a,d))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function xl(h,t,a){const d=s.at([],a,t),g=s.at([],h,t),y=s.bF([],d,g),v=s.ae(y);return v===0?[0,0,1,0]:(s.bY(y,y,1/v),[y[0],y[1],y[2],-s.bG(y,t)])}function tu(h){const t=h.properties.get("direction"),a=s.cR(t.x,t.y,t.z);a[2]=s.ay(a[2],0,75);const d=s.cT([a[0],a[1],a[2]]);return s.cS(d.x,d.y,d.z)}function dc(h,t,a){const d=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),y=t.properties.get("intensity"),v=t.properties.get("direction"),T=[v.x,v.y,v.z],C=a.properties.get("color-use-theme")==="none",R=a.properties.get("color"),k=a.properties.get("intensity"),L=Math.max(s.bG([0,0,1],T),0),j=[0,0,0];s.bY(j,R.toPremultipliedRenderColor(C?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),k);const F=[0,0,0];return s.bY(F,g.toPremultipliedRenderColor(d?null:h.getLut(a.scope)).toArray01Linear().slice(0,3),L*y),s.cY([j[0]>0?j[0]/(j[0]+F[0]):0,j[1]>0?j[1]/(j[1]+F[1]):0,j[2]>0?j[2]/(j[2]+F[2]):0])}function iu(h,t,a,d,g,y){const v=h.zoom,T=h.scale,C=h.worldSize,R=1/C,k=h.aspect,L=Math.sqrt(1+k*k)*Math.tan(.5*h.fovX),j=L*L,F=d-a,Z=d+a;let $,X;j>F/Z?($=d,X=d*L):($=.5*Z*(1+j),X=.5*Math.sqrt(F*F+2*(d*d+a*a)*j+Z*Z*j*j));const J=h.projection.pixelsPerMeter(h.center.lat,C),te=h._camera.getCameraToWorldMercator(),pe=[0,0,-$*R];s.ad(pe,pe,te);let ye=X*R;const Se=h._edgeInsets;if(!(Se.left===0&&Se.top===0&&Se.right===0&&Se.bottom===0||Se.left===Se.right&&Se.top===Se.bottom)){const nt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?J:1),xt=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);xt[8]=2*-h.centerOffset.x/h.width,xt[9]=2*h.centerOffset.y/h.height;const Je=new Float64Array(16);s.cB(Je,xt,nt);const _t=new Float64Array(16);s.bi(_t,Je);const kt=s.cn.fromInvProjectionMatrix(_t,C,v,!0);for(const Dt of kt.points){const Pt=((be=Dt)[0]/=T,be[1]/=T,be[2]=s.c6(be[2],h._center.lat),be);ye=Math.max(ye,s.bZ(s.cX([],pe,Pt)))}}var be;ye*=g/(g-1);const we=Math.acos(t[2]),xe=Math.atan2(-t[0],-t[1]),Te=new Do;Te.position=pe,Te.setPitchBearing(we,xe);const Ce=Te.getWorldToCamera(C,J),Le=ye*C,Fe=Math.min(h._mercatorZfromZoom(17)*C*-2,-2*Le),Ke=Te.getCameraToClipOrthographic(-Le,Le,-Le,Le,Fe,(Le+y*J)/t[2]),Qe=new Float64Array(16);s.az(Qe,Ke,Ce);const at=s.cS(Math.floor(1e6*pe[0])/1e6*C,Math.floor(1e6*pe[1])/1e6*C,0),je=.5*g,qe=[0,0,0];s.ad(qe,at,Qe),s.bY(qe,qe,je);const Re=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],et=[0,0,0];s.at(et,qe,Re),s.bY(et,et,-1/je);const Ue=new Float64Array(16);return s.bx(Ue),s.bo(Ue,Ue,et),s.az(Qe,Ue,Qe),[Qe,Le]}class Fy extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return s.aS(this.requestManager.transformRequest(a,s.R.Model).url).then(d=>{if(!d)return;const g=s.aT(d),y=new s.aU(t,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${a}: ${d.message}`)))})}load(t,a,d={forceReload:!1}){this.models[a]||(this.models[a]={});const g=Object.keys(t),y=[],v=[];for(const T of g){const C=t[T];this.hasURLBeenRequested(C)&&!d.forceReload||(this.modelByURL[C]={modelId:T,scope:a},y.push(this.loadModel(T,C)),v.push(T)),this.models[a][T]||(this.models[a][T]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+v.length,Promise.allSettled(y).then(T=>{for(let C=0;C<T.length;C++){const{status:R}=T[C];if(R==="rejected")continue;const{value:k}=T[C];this.models[a][v[C]]||(this.models[a][v[C]]={model:null,numReferences:1}),this.models[a][v[C]].model=k}this.numModelsLoading[a]-=v.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(T=>{this.fire(new s.z(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===g)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:y,modelId:v}=this.modelByURL[g];this.models[y][v].numReferences++}else this.modelUris[d][t]=g,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d=this.modelUris[a];for(const g in t)d[g]=this.requestManager.normalizeModelURL(t[g])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d={};for(const g of t)this.hasModel(g,a,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[a][g].numReferences++:this.modelUris[a][g]&&!this.hasURLBeenRequested(g)?d[g]=this.modelUris[a][g]:!this.hasURLBeenRequested(g)&&s.cZ(g,!1)&&(this.modelUris[a][g]=this.requestManager.normalizeModelURL(g),d[g]=this.modelUris[a][g]);this.load(d,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,d=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0)){const g=this.modelUris[a][t];d||delete this.modelUris[a][t],delete this.modelByURL[g];const y=this.models[a][t].model;if(!y)return;delete this.models[a][t],y.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const d=this.models[t][a].model;delete this.models[t][a],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const d in this.models[a])this.models[a][d].model&&this.models[a][d].model.upload(t.context)}}const Ip=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),Hm={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ua(h){return h=h||{},Object.assign(h,Hm)}class aw extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},s.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=this._map.transform.width,g=this._map.transform.height,y=d*(2/3),v=g*(2/3),T=.5*(d-y),C=.5*(g-v),R=[new s.P(T,C),new s.P(T+y,C+v)],k=this._map.queryRenderedFeatures(R,a);k.length>0?this._selectedFloorplan&&k[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=k[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,a=t?this._indoorData.buildings.find(T=>T.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,d=this._floorplanStates[this._indoorData.id].selectedLevel,g=this._indoorData.levels.find(T=>T.id===d),y=this._indoorData.levels.find(T=>!(!a||!a.levels)&&Number(T.levelOrder)===0&&a.levels.includes(T.id)),v=g?g.id:y?y.id:void 0;this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),a&&this._buildingSelected(a,!1),v&&this._levelSelected(v)}_buildingSelected(t,a){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");a&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(g=>t.levels.includes(g.id));this.fire(new s.A("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){const a=this._indoorData.levels.find(d=>d.id===t);a?(this._updateLevels(a,!0),this.fire(new s.A("levelselected",{levelId:a.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,a){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function d(R){const k=R.indexOf("/floor/");if(k===-1)return R;const L=k+7,j=R.indexOf("/",L);return j===-1?R.slice(L):R.slice(L,j)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const g=[],y={},v={},T={},C={};for(const R of this._indoorData.levels){if(g.push(R.id),y[R.id]=R.levelOrder>=0?3*Math.abs(R.levelOrder+1):3*Math.abs(R.levelOrder),v[R.id]=R.levelOrder>=0?3*R.levelOrder:0,this.mergeFloors){const k=d(t.id),L=d(R.id);T[R.id]=L===k?"true":"false"}else T[R.id]=R.id===t.id?"true":"false";C[R.id]=R.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(d,a);if(g.length>0){for(const y of g)if(JSON.parse(y.properties["indoor-data"]).id===t){this._selectedFloorplan=y,this._floorplanSelected();break}}}selectBuilding(t){const a=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(a,!0)}selectLevel(t){this._levelSelected(t)}}function lw(h){if(!h.metadata||!h.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:a,top:d,width:g,height:y}=h.metadata.content_area,v=a*t,T=d*t;return[v,T,v+g*t,T+y*t]}function Oy(h){if(h)return h.map(([t,a])=>[t*s.q.devicePixelRatio,a*s.q.devicePixelRatio])}class By{constructor(t,a,d){this.id=t,this.scope=a,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof ml))return t;const g=a.map(v=>this.sourceCache.getTile(v)),y=d.getImages(g,Array.from(this.pendingRequests));for(const[v,T]of y)t.set(s.I.from({name:v,iconsetId:this.id}),T),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const pc=(h,t)=>ve(h,t&&t.filter(a=>a.identifier!=="source.canvas")),Wm=s.aF(Ji,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Vy=s.aF(Ji,["setCenter","setZoom","setBearing","setPitch"]),Ap=new Set(["background","sky","slot","custom"]),Zm={version:8,layers:[],sources:{}},Xm={duration:300,delay:0};class bs extends s.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=s.h({},Xm),this._buildingIndex=new Ny(this),this.crossTileSymbolIndex=new Us,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new dr,this.dispatcher=a.dispatcher?a.dispatcher:new s.D(s.c$(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new ns(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new s.d0(t._requestManager,a.localFontFamily?s.d1.all:a.localIdeographFontFamily?s.d1.ideographs:s.d1.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Fy(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",s.d2());const d=this;this._rtlTextPluginCallback=bs.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,v)=>{if(s.d3(y),v&&v.every(T=>T))for(const T in d._sourceCaches){const C=d._sourceCaches[T],R=C.getSource().type;R!=="vector"&&R!=="geojson"||C.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(const v in this._layers){const T=this._layers[v];T.source===y.id&&this._validateLayer(T)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.j(t))return t;const a=s.d4(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${s.d5(JSON.stringify(t))}`}_diffStyle(t,a,d){this.globalId=this._getGlobalId(t);const g=(y,v)=>{try{v(null,this.setState(y,d))}catch(T){v(T,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(y,s.R.Style);s.n(v,(T,C)=>{T?this.fire(new s.z(T)):C&&g(C,a)})}else typeof t=="object"&&g(t,a)}loadURL(t,a={}){this.fire(new s.A("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!s.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,d);const y=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(y,(v,T)=>{if(this._request=null,v)this.fire(new s.z(v));else if(T)return this.importsCache.set(t,T),this._load(T,d)})}loadJSON(t,a={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(Zm,!1)}_loadImports(t,a,d){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const y of t){const v=this._createFragmentStyle(y),T=new Promise(k=>{v.once("style.import.load",k),v.once("error",k)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(y.url)){v.loadEmpty();continue}const C=y.data||this.importsCache.get(y.url);C?(v.loadJSON(C,{validate:a}),this._isInternalStyle(C)&&(v.globalId=null)):y.url?v.loadURL(y.url,{validate:a}):v.loadEmpty();const R={style:v,id:y.id,config:y.config};if(d){const k=this.fragments.findIndex(({id:L})=>L===d);this.fragments=this.fragments.slice(0,k).concat(R).concat(this.fragments.slice(k))}else this.fragments.push(R)}return Promise.allSettled(g)}getImportGlobalIds(t=this,a=new Set){for(const d of t.fragments)d.style.globalId&&a.add(d.style.globalId),this.getImportGlobalIds(d.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?s.C(t.id,this.scope):t.id;let d;const g=this._initialConfig&&this._initialConfig[a];(t.config||g)&&(d=s.h({},t.config,g));const y=new bs(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){const d=t.indoor?Ua(t.schema):t.schema;if(this._isInternalStyle(t)){const v=s.h({},Zm,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,a)}if(this.updateConfig(this._config,d),a&&pc(this,bn(t)))return;this._loaded=!0,this.stylesheet=s.d6(t);const g=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=Nh(this.stylesheet.layers);if(this._order=v.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Oe(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Oe(this.stylesheet.light)),this._layers={};for(const R of v){const k=s.db(R,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const L=this.getOwnLayerSourceCache(k),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&k.canCastShadows()&&j&&(L.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new s.A(C?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.z(new Error("Failed to load imports",R))),this.fire(new s.A(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const v=this._evaluateColorThemeData(y);this._loadColorTheme(v).then(()=>{g()}).catch(T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,a,d,g,y,v,T,C,R,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(t=j.light),j.stylesheet.lights)for(const F of j.stylesheet.lights)F.type==="ambient"&&j.ambientLight!=null&&(a=j.ambientLight),F.type==="directional"&&j.directionalLight!=null&&(d=j.directionalLight);g=this._prioritizeTerrain(g,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(y=j.fog),j.stylesheet.snow&&j.snow!=null&&(v=j.snow),j.stylesheet.rain&&j.rain!=null&&(T=j.rain),j.stylesheet.camera!=null&&(k=j.stylesheet.camera),j.stylesheet.projection!=null&&(C=j.stylesheet.projection),j.stylesheet.transition!=null&&(R=j.stylesheet.transition),L[j.scope]=j._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=d,this.fog=y,this.snow=v,this.rain=T,this._styleColorThemeForScope=L,g===null?delete this.terrain:this.terrain=g,this.camera=k||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=s.h({},Xm,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const a=d=>{for(const g of d.fragments)a(g.style);t(d)};a(this)}_prioritizeTerrain(t,a,d){const g=t&&t.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:g?t:null:a!=null&&(!t||g||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},d={};this.forEachFragmentStyle(g=>{for(const y in g._sourceCaches){const v=s.C(y,g.scope);t[v]=g._sourceCaches[y]}for(const y in g._otherSourceCaches){const v=s.C(y,g.scope);a[v]=g._otherSourceCaches[y]}for(const y in g._symbolSourceCaches){const v=s.C(y,g.scope);d[v]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},a=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const v of y._order){const T=y._layers[v];if(T.type==="slot"){const C=s.d7(v);if(t[C])continue;t[C]=[]}T.slot&&t[T.slot]?t[T.slot].push(T):a.push(T)}}),this._mergedOrder=[];const g=(y=[])=>{for(const v of y)if(v.type==="slot"){const T=s.d7(v.id);t[T]&&g(t[T]),this._mergedSlots.push(T)}else{const T=s.C(v.id,v.scope);this._mergedOrder.push(T),d[T]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};g(a),this._mergedOrder.sort((y,v)=>{const T=d[y],C=d[v];return T.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:T.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,d,g,y){const v=s.h({},d);for(const C of Object.keys(s.a5.colorTheme))v[C]===void 0&&(v[C]=s.a5.colorTheme[C].default);const T=new s.a6(Ip,a,new Map(g));return T.setTransitionOrValue(v,g),T.untransitioned().possiblyEvaluate(new s.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,g)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let v=t;v.startsWith(y)||(v=y+v);const T=s.I.from("mapbox-reserved-lut"),C=new Image;C.src=v,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void d();this._styleColorTheme.lutLoading=!1;const{width:R,height:k,data:L}=s.q.getImageData(C);if(k>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==k*k)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(T)&&this.removeImage(T),this.addImage(T,{data:new s.r({width:R,height:k},L),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(T,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:t},d()):g(new Error("Missing LUT image."))}})}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,d,g){let y,v,T;const C=s.q.devicePixelRatio>1?"@2x":"";let R=s.n(d.transformRequest(d.normalizeSpriteURL(a,C,".json"),s.R.SpriteJSON),(j,F)=>{R=null,T||(T=j,y=F,L())}),k=s.o(d.transformRequest(d.normalizeSpriteURL(a,C,".png"),s.R.SpriteImage),(j,F)=>{k=null,T||(T=j,v=F,L())});function L(){if(T)g(T);else if(y&&v){const j=s.q.getImageData(v),F={};for(const Z in y){const{width:$,height:X,x:J,y:te,sdf:pe,pixelRatio:ye,stretchX:Se,stretchY:be,content:we}=y[Z],xe=new s.r({width:$,height:X});s.r.copy(j,xe,{x:J,y:te},{x:0,y:0},{width:$,height:X},null),F[Z]={data:xe,pixelRatio:ye,sdf:pe,stretchX:Se,stretchY:be,content:we,usvg:!1}}g(null,F)}}return{cancel(){R&&(R.cancel(),R=null),k&&(k.cancel(),k=null)}}}(t,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new s.z(a));else if(d){const g=new Map;for(const y in d)g.set(s.I.from(y),d[y]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const d=this.getOwnSourceCache(a.source);if(!d)return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const g=d.getSource();if(g.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const y=new By(t,this.scope,d);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var d,g;this._spriteRequest=(g=(y,v)=>{if(this._spriteRequest=null,y)a?this._loadSprite(t):this.fire(new s.z(y));else if(v){const T=new Map;for(const C in v)T.set(s.I.from(C),v[C]);this.addImages(T)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),s.R.Iconset),(y,v)=>{if(y)return void g(y);const T={},C=s.c_(new s.bq(v));for(const R of C.icons){const k={version:1,pixelRatio:s.q.devicePixelRatio,content:lw(R),stretchX:R.metadata?Oy(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?Oy(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};T[R.name]=k}g(null,T)}))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const d=t.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.z(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{const d=this.fragments[a];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const a=[];for(const d of t){const g=this._layers[d];g&&g.type!=="custom"&&a.push(g.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const d=this.map.painter;if(d)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const y=t.getProgramIds();if(y)for(const v of y){const T=t.getDefaultProgramParams(v,a.zoom,this._styleColorTheme.lut);T&&(d.style=this,this.fog&&(d._fogVisible=!0,T.overrideFog=!0,d.getOrCreateProgram(v,T)),d._fogVisible=!1,T.overrideFog=!1,d.getOrCreateProgram(v,T),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(T.overrideRtt=!0,d.getOrCreateProgram(v,T)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const C in T){const{updatedIds:R,removedIds:k}=T[C];(R||k)&&(this._updateWorkerLayers(C,R,k),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const T in this._mergedSourceCaches){const C=this._mergedSourceCaches[T];y[T]=C.used,C.used=!1,C.tileCoverLift=0}for(const T of this._mergedOrder){const C=this._mergedLayers[T];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const R=this.getLayerSourceCache(C);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,t)}):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const T of v)T.sourceCache.used=!0;for(const T in y){const C=this._mergedSourceCaches[T];y[T]!==C.used&&C.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const d=a.resolvePendingRequests(),g=this.getFragmentStyle(a.scope);g&&g.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const d=this._mergedSourceCaches[a].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,d){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:a?g._serializeLayers(a):[],scope:t,removedIds:d||[],options:g.options})}setState(t,a){if(this._checkLoaded(),pc(this,bn(t)))return!1;(t=s.d6(t)).layers=Nh(t.layers);const d=function(v,T){if(!v)return[{command:Ji.setStyle,args:[T]}];let C=[];try{if(!s.bv(v.version,T.version))return[{command:Ji.setStyle,args:[T]}];if(s.bv(v.center,T.center)||C.push({command:Ji.setCenter,args:[T.center]}),s.bv(v.zoom,T.zoom)||C.push({command:Ji.setZoom,args:[T.zoom]}),s.bv(v.bearing,T.bearing)||C.push({command:Ji.setBearing,args:[T.bearing]}),s.bv(v.pitch,T.pitch)||C.push({command:Ji.setPitch,args:[T.pitch]}),s.bv(v.sprite,T.sprite)||C.push({command:Ji.setSprite,args:[T.sprite]}),s.bv(v.glyphs,T.glyphs)||C.push({command:Ji.setGlyphs,args:[T.glyphs]}),s.bv(v.imports,T.imports)||function(F=[],Z=[],$){Z=Z||[];const X=(F=F||[]).map(sc),J=Z.map(sc),te=F.reduce(gl,{}),pe=Z.reduce(gl,{}),ye=X.slice();let Se,be,we,xe;for(Se=0,be=0;Se<X.length;Se++)we=X[Se],pe.hasOwnProperty(we)?be++:($.push({command:Ji.removeImport,args:[we]}),ye.splice(ye.indexOf(we,be),1));for(Se=0,be=0;Se<J.length;Se++)we=J[J.length-1-Se],ye[ye.length-1-Se]!==we&&(te.hasOwnProperty(we)?($.push({command:Ji.removeImport,args:[we]}),ye.splice(ye.lastIndexOf(we,ye.length-be),1)):be++,xe=ye[ye.length-Se],$.push({command:Ji.addImport,args:[pe[we],xe]}),ye.splice(ye.length-Se,0,we));for(const Te of Z){const Ce=te[Te.id];Ce&&(delete Ce.data,s.bv(Ce,Te)||$.push({command:Ji.updateImport,args:[Te.id,Te]}))}}(v.imports,T.imports,C),s.bv(v.transition,T.transition)||C.push({command:Ji.setTransition,args:[T.transition]}),s.bv(v.light,T.light)||C.push({command:Ji.setLight,args:[T.light]}),s.bv(v.fog,T.fog)||C.push({command:Ji.setFog,args:[T.fog]}),s.bv(v.snow,T.snow)||C.push({command:Ji.setSnow,args:[T.snow]}),s.bv(v.rain,T.rain)||C.push({command:Ji.setRain,args:[T.rain]}),s.bv(v.projection,T.projection)||C.push({command:Ji.setProjection,args:[T.projection]}),s.bv(v.lights,T.lights)||C.push({command:Ji.setLights,args:[T.lights]}),s.bv(v.camera,T.camera)||C.push({command:Ji.setCamera,args:[T.camera]}),s.bv(v.iconsets,T.iconsets)||function(F,Z,$){let X;for(X in Z=Z||{},F=F||{})F.hasOwnProperty(X)&&(Z.hasOwnProperty(X)||$.push({command:Ji.removeIconset,args:[X]}));for(X in Z){if(!Z.hasOwnProperty(X))continue;const J=Z[X];F.hasOwnProperty(X)?s.bv(F[X],J)||($.push({command:Ji.removeIconset,args:[X]}),$.push({command:Ji.addIconset,args:[X,J]})):$.push({command:Ji.addIconset,args:[X,J]})}}(v.iconsets,T.iconsets,C),!s.bv(v["color-theme"],T["color-theme"]))return[{command:Ji.setStyle,args:[T]}];const R={},k=[];(function(F,Z,$,X){let J;for(J in Z=Z||{},F=F||{})F.hasOwnProperty(J)&&(Z.hasOwnProperty(J)||Xc(J,$,X));for(J in Z){if(!Z.hasOwnProperty(J))continue;const te=Z[J];F.hasOwnProperty(J)?s.bv(F[J],te)||(F[J].type==="geojson"&&te.type==="geojson"&&iw(F,Z,J)?$.push({command:Ji.setGeoJSONSourceData,args:[J,te.data]}):jh(J,Z,$,X)):yp(J,Z,$)}})(v.sources,T.sources,k,R);const L=[];v.layers&&v.layers.forEach(F=>{F.source&&R[F.source]?C.push({command:Ji.removeLayer,args:[F.id]}):L.push(F)});let j=v.terrain;j&&R[j.source]&&(C.push({command:Ji.setTerrain,args:[void 0]}),j=void 0),C=C.concat(k),s.bv(j,T.terrain)||C.push({command:Ji.setTerrain,args:[T.terrain]}),function(F,Z,$){Z=Z||[];const X=(F=F||[]).map(sc),J=Z.map(sc),te=F.reduce(gl,{}),pe=Z.reduce(gl,{}),ye=X.slice(),Se=Object.create(null);let be,we,xe,Te,Ce,Le,Fe;for(be=0,we=0;be<X.length;be++)xe=X[be],pe.hasOwnProperty(xe)?we++:($.push({command:Ji.removeLayer,args:[xe]}),ye.splice(ye.indexOf(xe,we),1));for(be=0,we=0;be<J.length;be++)xe=J[J.length-1-be],ye[ye.length-1-be]!==xe&&(te.hasOwnProperty(xe)?($.push({command:Ji.removeLayer,args:[xe]}),ye.splice(ye.lastIndexOf(xe,ye.length-we),1)):we++,Le=ye[ye.length-be],$.push({command:Ji.addLayer,args:[pe[xe],Le]}),ye.splice(ye.length-be,0,xe),Se[xe]=!0);for(be=0;be<J.length;be++)if(xe=J[be],Te=te[xe],Ce=pe[xe],!Se[xe]&&!s.bv(Te,Ce))if(s.bv(Te.source,Ce.source)&&s.bv(Te["source-layer"],Ce["source-layer"])&&s.bv(Te.type,Ce.type)){for(Fe in zh(Te.layout,Ce.layout,$,xe,null,Ji.setLayoutProperty),zh(Te.paint,Ce.paint,$,xe,null,Ji.setPaintProperty),s.bv(Te.slot,Ce.slot)||$.push({command:Ji.setSlot,args:[xe,Ce.slot]}),s.bv(Te.filter,Ce.filter)||$.push({command:Ji.setFilter,args:[xe,Ce.filter]}),s.bv(Te.minzoom,Ce.minzoom)&&s.bv(Te.maxzoom,Ce.maxzoom)||$.push({command:Ji.setLayerZoomRange,args:[xe,Ce.minzoom,Ce.maxzoom]}),Te)Te.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?zh(Te[Fe],Ce[Fe],$,xe,Fe.slice(6),Ji.setPaintProperty):s.bv(Te[Fe],Ce[Fe])||$.push({command:Ji.setLayerProperty,args:[xe,Fe,Ce[Fe]]}));for(Fe in Ce)Ce.hasOwnProperty(Fe)&&!Te.hasOwnProperty(Fe)&&Fe!=="layout"&&Fe!=="paint"&&Fe!=="filter"&&Fe!=="metadata"&&Fe!=="minzoom"&&Fe!=="maxzoom"&&Fe!=="slot"&&(Fe.indexOf("paint.")===0?zh(Te[Fe],Ce[Fe],$,xe,Fe.slice(6),Ji.setPaintProperty):s.bv(Te[Fe],Ce[Fe])||$.push({command:Ji.setLayerProperty,args:[xe,Fe,Ce[Fe]]}))}else $.push({command:Ji.removeLayer,args:[xe]}),Le=ye[ye.lastIndexOf(xe)+1],$.push({command:Ji.addLayer,args:[Ce,Le]})}(L,T.layers,C)}catch(R){console.warn("Unable to compute style diff:",R),C=[{command:Ji.setStyle,args:[T]}]}return C}(this.serialize(),t).filter(v=>!(v.command in Vy));if(d.length===0)return!1;const g=d.filter(v=>!(v.command in Wm));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);const y=[];return d.forEach(v=>{y.push(this[v.command](...v.args))}),a&&Promise.all(y).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[a,d]of t.entries()){if(this.getImage(a))return this.fire(new s.z(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,d),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,a,d=!1){this.imageManager.updateImage(t,this.scope,a),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(t,a,d={}){return this._checkLoaded(),this._validate(me,`models.${t}`,a,null,d)||(this.modelManager.addModel(t,a,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(As,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=Ah(t,a,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const y=v=>{const T=(v?"symbol:":"other:")+g.id,C=s.C(T,this.scope),R=this._sourceCaches[T]=new Vs(C,g,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=R,R.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([y,v])=>v.type==="source"&&v.source===t);if(g)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${g[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const g of d){const y=s.d7(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const d=this.getOwnSourceCache(a);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const d=t[a]._tiles;for(const g in d){const y=d[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const y of t){if(this._validate(Yo,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(y),v.updateTransitions(a)}else this.ambientLight=new yr(y,Ei||(Ei=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(y),v.updateTransitions(a)}else this.directionalLight=new yr(y,Pr||(Pr=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(a,{worldview:this.map.getWorldview()}),g=new s.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const d=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),g=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),v=t.properties.get("direction"),T=1-s.cR(v.x,v.y,v.z)[2]/90,C=d(g)*y*T,R=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=a.properties.get("intensity"),L=d(R)*k;return Number(((C+L)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.d8(t)){const a=s.d9(t),d=this.fragments.find(({id:y})=>y===a);if(!d)return;const g=s.d7(t);return d.style.getFragmentStyle(g)}{const a=this.fragments.find(({id:d})=>d===t);return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},d=(g,y="")=>`${g}::${y}`;this._featuresetSelectors={};for(const g in t){const y=this._featuresetSelectors[g]=[];for(const v of t[g].selectors){if(v.featureNamespace){const C=this.getOwnLayer(v.layer);if(!C){s.w(`Layer is undefined for selector: ${v.layer}`);continue}const R=d(C.source,C.sourceLayer);if(R in a&&a[R]!==v.featureNamespace){s.w(`"featureNamespace ${v.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}a[R]=v.featureNamespace}let T;if(v.properties)for(const C in v.properties){const R=s.X(v.properties[C]);R.result==="success"&&(T=T||{},T[C]=R.value)}y.push({layerId:v.layer,namespace:v.featureNamespace,properties:T,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const d=[];for(const g in a.stylesheet.featuresets)d.push({featuresetId:g,importId:a.scope?a.scope:void 0});return d}getFeaturesetLayers(t,a){const d=this.getFragmentStyle(a),g=d.stylesheet.featuresets;if(!g||!g[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const v of g[t].selectors){const T=d.getOwnLayer(v.layer);T&&y.push(T)}return y}getConfigProperty(t,a){const d=this.getFragmentStyle(t);if(!d)return null;const g=s.C(a,d.scope),y=d.options.get(g),v=y?y.value||y.default:null;return v?v.serialize():null}setConfigProperty(t,a,d){const g=this.getFragmentStyle(t);if(!g)return;const y=g.stylesheet.indoor?Ua(g.stylesheet.schema):g.stylesheet.schema;if(!y||!y[a])return;const v=s.X(d);if(v.result!=="success")return void pc(this,v.value);const T=v.value.expression,C=s.C(a,g.scope),R=g.options.get(C);if(!R)return;let k;const{minValue:L,maxValue:j,stepValue:F,type:Z,values:$}=y[a],X=s.X(y[a].default);X.result==="success"&&(k=X.value.expression),k?(this.options.set(C,Object.assign({},R,{value:T,default:k,minValue:L,maxValue:j,stepValue:F,type:Z,values:$})),this.updateConfigDependencies(a)):this.fire(new s.z(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const d=a.stylesheet.schema;if(!d)return null;const g={};for(const y in d){const v=s.C(y,a.scope),T=a.options.get(v),C=T?T.value||T.default:null;g[y]=C?C.serialize():null}return g}setConfig(t,a){const d=this.getFragmentStyle(t);d&&(d.updateConfig(a,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=a,d.updateConfig(d._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const d in a){let g,y;const v=s.X(a[d].default);if(v.result==="success"&&(g=v.value.expression),t&&t[d]!==void 0){const j=s.X(t[d]);j.result==="success"&&(y=j.value.expression)}const{minValue:T,maxValue:C,stepValue:R,type:k,values:L}=a[d];if(g){const j=s.C(d,this.scope);this.options.set(j,{default:g,value:y,minValue:T,maxValue:C,stepValue:R,type:k,values:L})}else this.fire(new s.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const a of this._configDependentLayers){const d=this.getLayer(a);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const d=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(d){const g=a._evaluateColorThemeData(d);(!a._styleColorTheme.lut&&g!==""||a._styleColorTheme.lut&&g!==a._styleColorTheme.lut.data)&&a.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,a,d={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new s.z(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(t.type==="custom"){if(pc(this,s.da(t)))return;y=s.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=s.d6(t),t=s.h(t,{source:g})),this._validate(Qi,`layers.${g}`,t,{arrayIndex:-1},d))return;y=s.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let v=this._order.length;if(a){const k=this._order.indexOf(a);if(k===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));y.slot===this._layers[a].slot?v=k:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,g),this._layerOrderChanged=!0,this._layers[g]=y;const T=this.getOwnLayerSourceCache(y),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&y.canCastShadows()&&C&&(T.castsShadows=!0);const R=this._changes.getRemovedLayer(y);if(R&&y.source&&T&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const k=s.C(y.source,y.scope);R.type!==y.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),T.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===a)return;const g=this._order.indexOf(t);this._order.splice(g,1);let y=this._order.length;if(a){const v=this._order.indexOf(a);if(v===-1)return void this.fire(new s.z(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?y=v:s.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const g=this.getOwnLayerSourceCache(a);if(g&&g.castsShadows){let y=!1;for(const v in this._layers)if(this._layers[v].source===a.source&&this._layers[v].canCastShadows()){y=!0;break}g.castsShadows=y}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,d){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===a&&g.maxzoom===d||(a!=null&&(g.minzoom=a),d!=null&&(g.maxzoom=d),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(t,a,d={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!s.bv(g.filter,a))return a==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Ve,`layers.${g.id}.filter`,a,{layerType:g.type},d)||(g.filter=s.d6(a),this._updateLayer(g)))}getFilter(t){const a=this._checkLayer(t);if(a)return s.d6(a.filter)}setLayoutProperty(t,a,d,g={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!s.bv(y.getLayoutProperty(a),d)){if(d!=null&&(!g||g.validate!==!1)&&pc(y,ie.call(bn,{key:`layers.${t}.layout.${a}`,layerType:y.type,objectKey:a,value:d,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(a,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,a){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(a)}setPaintProperty(t,a,d,g={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||s.bv(y.getPaintProperty(a),d)||d!=null&&(!g||g.validate!==!1)&&pc(y,Q.call(bn,{key:`layers.${t}.paint.${a}`,layerType:y.type,objectKey:a,value:d,styleSpec:s.a5})))return;const v=y.setPaintProperty(a,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),v&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,a){const d=this._checkLayer(t);if(d)return d.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,k=this.getFragmentStyle(R),L=k.getFeaturesetLayers(C);for(const{source:j,sourceLayer:F}of L)k.setFeatureState({id:t.id,source:j,sourceLayer:F},a)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.setFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const d=t.source,g=t.sourceLayer,y=this._checkSource(d);if(!y)return;const v=y.type;if(v==="geojson"&&g)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!g)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(d);for(const C of T)C.setFeatureState(g,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:R}=t.target,k=this.getFragmentStyle(R),L=k.getFeaturesetLayers(C);for(const{source:j,sourceLayer:F}of L)k.removeFeatureState({id:t.id,source:j,sourceLayer:F},a)}else if("layerId"in t.target){const{layerId:C}=t.target,R=this.getLayer(C);this.removeFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},a)}return}const d=t.source,g=this._checkSource(d);if(!g)return;const y=g.type,v=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!v)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(d);for(const C of T)C.removeFeatureState(v,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:v,importId:T}=t.target,C=this.getFragmentStyle(T),R=C.getFeaturesetLayers(v);for(const{source:k,sourceLayer:L}of R){const j=C.getFeatureState({id:t.id,source:k,sourceLayer:L});if(j&&!y)y=j;else if(!s.bv(y,j))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,T=this.getLayer(v);y=this.getFeatureState({id:t.id,source:T.source,sourceLayer:T.sourceLayer})}return y}const a=t.source,d=t.sourceLayer,g=this._checkSource(a);if(g){if(g.type!=="vector"||d)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),d=s.C(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=T=>this._mergedLayers[T].is3D(!!this.terrain),d=this.order,g={},y=[];for(let T=d.length-1;T>=0;T--){const C=d[T];if(a(C)){g[C]=T;for(const R of t){const k=R[C];if(k)for(const L of k)y.push(L)}}}y.sort((T,C)=>C.intersectionZ-T.intersectionZ);const v=[];for(let T=d.length-1;T>=0;T--){const C=d[T];if(a(C))for(let R=y.length-1;R>=0;R--){const k=y[R].feature;if(k.layer&&g[k.layer.id]<T)break;v.push(k),y.pop()}else for(const R of t){const k=R[C];if(k)for(const L of k)v.push(L.feature)}}return v}queryRenderedFeatures(t,a,d){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(Ve,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const y={},v=k=>{if(Ap.has(k.type))return;const L=this.getOwnLayerSourceCache(k),j=y[L.id]=y[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[k.fqid]=j.layers[k.fqid]||{styleLayer:k,targets:[]},j.layers[k.fqid].targets.push({filter:g})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const k of a.layers){const L=this._layers[k];if(!L)return this.fire(new s.z(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];v(L)}}else for(const k in this._layers)v(this._layers[k]);const T=this._queryRenderedFeatures(t,y,d),C=this._flattenAndSortRenderedFeatures(T),R=[];for(const k of C)s.dd(k.layer.id)===this.scope&&R.push(k);return R}queryRenderedFeatureset(t,a,d){let g;a&&!Array.isArray(a)&&a.filter&&(this._validate(Ve,"queryRenderedFeatures.filter",a.filter,null,a),g=s.b3(a.filter));const y="mock",v=[];if(a&&a.target)v.push(Object.assign({},a,{targetId:y,filter:g}));else{const k=this.getFeaturesetDescriptors();for(const L of k)v.push({targetId:y,filter:g,target:L});for(const{style:L}of this.fragments){const j=L.getFeaturesetDescriptors();for(const F of j)v.push({targetId:y,filter:g,target:F})}}const T=this.queryRenderedTargets(t,v,d),C=[],R=new Set;for(const k of T)for(const L of k.variants[y])mp(L,k,R)||C.push(new s.de(k,L));return C}queryRenderedTargets(t,a,d){const g={},y=(T,C,R,k)=>{const L=g[C.id]=g[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(L.layers[T.fqid]=L.layers[T.fqid]||{styleLayer:T,targets:[]},T.is3D(!!this.terrain)&&(L.has3DLayers=!0),!k)return R.uniqueFeatureID=!1,void L.layers[T.fqid].targets.push(R);L.layers[T.fqid].targets.push(Object.assign({},R,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const T of a)if("featuresetId"in T.target){const{featuresetId:C,importId:R}=T.target,k=this.getFragmentStyle(R);if(!k||!k._featuresetSelectors)continue;const L=k._featuresetSelectors[C];if(!L){this.fire(new s.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of L){const F=k.getOwnLayer(j.layerId);F&&!Ap.has(F.type)&&y(F,k.getOwnLayerSourceCache(F),T,j)}}else if("layerId"in T.target){const{layerId:C}=T.target,R=this.getLayer(C);if(!R||Ap.has(R.type))continue;y(R,this.getLayerSourceCache(R),T)}const v=this._queryRenderedFeatures(t,g,d);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,a,d){const g=[],y=!!this.map._showQueryGeometry,v=sr.createFromScreenPoints(t,d);for(const T in a){const C=gp(v,a[T],this._availableImages,d,y);Object.keys(C).length&&g.push(C)}if(this.placement)for(const T in a){if(!a[T].sourceCache._onlySymbols)continue;const C=ic(v.screenGeometry,a[T],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&g.push(C)}return g}querySourceFeatures(t,a){const d=a&&a.filter;d&&this._validate(Ve,"querySourceFeatures.filter",d,null,a);let g=[];const y=this.getOwnSourceCaches(t);for(const v of y)g=g.concat(Mh(v,a));return g}addSourceType(t,a,d){return bs.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(bs.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,d={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const T in t)if(!s.bv(t[T],g[T])){y=!0;break}if(!y)return;const v=this._getTransitionParameters();this.light.setLight(t,a,d),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const g=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const T="terrain-dem-src";this.addSource(T,d.source),d=s.d6(d),d=s.h(d,{source:T})}const y=s.h({},d),v={};if(this.terrain&&g){y.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(v.style=T.serialize())}if(this._validate(wt,"terrain",y,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new s.A("data",{dataType:"style"}))}else{const y=this.terrain,v=y.get();for(const T of Object.keys(s.a5.terrain))!d.hasOwnProperty(T)&&s.a5.terrain[T].default&&(d[T]=s.a5.terrain[T].default);for(const T in t)if(!s.bv(t[T],v[T])){y.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});y.updateTransitions(C),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new ci(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createSnow(t){const a=this.snow=new Kr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createRain(t){const a=this.rain=new Qr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!s.bv(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(a);this._loadColorTheme(d).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(g=>{s.w(`Couldn't set color theme: ${g}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=a,d._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const d=this.terrain=new Me(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,d,g,y={}){if(y&&y.validate===!1)return!1;const v=s.h({},this.serialize());return pc(this,t.call(bn,s.h({key:a,style:v,value:d,styleSpec:s.a5},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const d of a)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const a=this.getSourceCaches(t);for(const d of a)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let a;this.directionalLight&&(a=tu(this.directionalLight));const d=new Set;for(const g in this._mergedLayers){const y=this._mergedLayers[g];y.hasElevation()&&!d.has(y.source)&&d.add(y.source)}for(const g in this._mergedSourceCaches){const y=this._mergedSourceCaches[g],v=d.has(y._source.id);y.update(t,void 0,void 0,a,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,d,g,y,v,T=!1){let C=!1,R=!1;const k={},L={};for(const j of this._mergedOrder){const F=this._mergedLayers[j];if(F.type!=="symbol")continue;const Z=s.C(F.source,F.scope);let $=k[Z];if(!$){const J=this.getLayerSourceCache(F);if(!J)continue;const te=J.getRenderableIds(!0).map(pe=>J.getTileByID(pe));L[Z]=te.slice(),$=k[Z]=te.sort((pe,ye)=>ye.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ye.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(F,$,a.center.lng,a.projection);C=C||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),T=T||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),a.zoom))&&(this.pauseablePlacement=new Ep(a,this._mergedOrder,T,d,g,y,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C){this._buildingIndex.onNewFrame(a.zoom);for(let j=0;j<this._mergedOrder.length;j++){const F=this._mergedLayers[this._mergedOrder[j]];if(F.type!=="symbol")continue;const Z=this.isLayerClipped(F);this.placement.updateLayerOpacities(F,k[s.C(F.source,F.scope)],j,Z?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return d.push(t),this._loadImports([t],!0);const g=d.findIndex(({id:y})=>y===a);return g===-1&&this.fire(new s.z(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,g).concat(t).concat(d.slice(g)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==d[g].url&&this.setImportUrl(t,a.url),s.bv(a.config,d[g].config)||this.setImportConfig(t,a.config,a.data.schema),s.bv(a.data,d[g].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let d=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const y=this.getImportIndex(a);if(y===-1)return this;const v=d[g],T=this.fragments[g];return d=d.filter(({id:C})=>C!==t),this.fragments=this.fragments.filter(({id:C})=>C!==t),this.stylesheet.imports=d.slice(0,y).concat(v).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(T).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;d[g].url=a;const y=this.fragments[g];return y.style=this._createFragmentStyle(d[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const d=this.getImportIndex(t),g=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete g[d].data,this.setImportUrl(t,g[d].url))}setImportConfig(t,a,d){this._checkLoaded();const g=this.getImportIndex(t),y=this.stylesheet.imports||[];if(g===-1)return this;a?y[g].config=a:delete y[g].config;const v=this.fragments[g];d&&v.style.stylesheet&&(v.style.stylesheet.schema=d);const T=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=a,v.style.updateConfig(a,T),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return a===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[a];d&&t.push(d.getSource())}return t}getSource(t,a){const d=this.getSourceCache(t,a);return d&&d.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const d=s.C(t,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const a=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const d=t[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const d of a){const g=this.getLayer(d);g&&g.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,a,d){this.imageManager.getImages(a.images,a.scope,d),this._updateTilesForChangedImages();const g=v=>{if(v){const T=a.images.map(C=>s.I.toString(C));v.setDependencies(a.tileID.key,a.type,T)}},y=s.C(a.source,a.scope);g(this._mergedOtherSourceCaches[y]),g(this._mergedSymbolSourceCaches[y])}rasterizeImages(t,a,d){this.imageManager.rasterizeImages(a,d)}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,a.scope,d)}getResource(t,a,d){return s.dg(a,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building",g=t.type==="building";if(t.is3D(!!this.terrain)){if(d||g||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}bs.getSourceType=function(h){return fp[h]},bs.setSourceType=function(h,t){fp[h]=t},bs.registerForPluginStateChange=s.dh;var Hh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ym=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Km=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ru="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Qm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,mo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Mp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,bt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Jm=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const su=[];No(Hh,su),No(Km,su),No(Ym,su);const ou={"_prelude_fog.vertex.glsl":Qm,"_prelude_terrain.vertex.glsl":nu,"_prelude_shadow.vertex.glsl":bt,"_prelude_fog.fragment.glsl":Pp,"_prelude_shadow.fragment.glsl":Jm,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":mo,"_prelude_raster_particle.glsl":Mp},Wh={};$i("",nu),$i(Pp,Qm),$i(Jm,bt),$i(mo,""),$i(Mp,"");const Zh=$i(Ym,Km),wa=Hh;var Rp={background:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:$i(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$i("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$i(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$i("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$i("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:$i(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:$i(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:$i(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:$i(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:$i(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:$i(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:$i("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:$i("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:$i(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:$i(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:$i("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:$i(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ru),skyboxGradient:$i(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ru),skyboxCapture:$i(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$i(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:$i(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:$i(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:$i(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:$i("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:$i("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:$i("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:$i("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function No(h,t){const a=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=d.split(" ");for(const y of g)t.includes(y)||t.push(y)}}function $i(h,t){const a=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(R=>{const k=R.split(" ");return k[k.length-1]}),g=[...new Set(g)]);const y={},v=[],T=[];if(h=h.replace(a,(R,k)=>(T.push(k),"")),(t=t.replace(a,(R,k)=>(v.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...su];No(h,C),No(t,C);for(const R of[...v,...T])ou[R]||console.error(`Undefined include: ${R}`),Wh[R]||(Wh[R]=[],No(ou[R],Wh[R])),C=[...C,...Wh[R]];return{fragmentSource:h=h.replace(d,(R,k,L,j,F)=>(y[F]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${L} ${j} ${F};
#else
uniform ${L} ${j} u_${F};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${L} ${j} ${F} = u_${F};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${L} ${j} ${F};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(R,k,L,j,F)=>{const Z=j==="float"?"vec2":j,$=F.match(/color/)?"color":Z;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${L} ${j} a_${F};
#endif
`:y[F]?k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${L} ${Z} a_${F};
out ${L} ${j} ${F};
#else
uniform ${L} ${j} u_${F};
#endif
`:k==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${L} ${j} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${L} ${j} ${F} = u_${F};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${L} ${j} a_${F};
    out ${L} ${j} ${F};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${L} ${Z} a_${F};
#else
uniform ${L} ${j} u_${F};
#endif
`:k==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${L} ${j} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${L} ${Z} a_${F};
#else
uniform ${L} ${j} u_${F};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${L} ${j} ${F} = a_${F};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${L} ${j} ${F} = a_${F};
#else
    ${L} ${j} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${L} ${j} ${F} = unpack_mix_${$}(a_${F}, u_${F}_t);
#else
    ${L} ${j} ${F} = u_${F};
#endif
`}),staticAttributes:g,usedDefines:C,vertexIncludes:v,fragmentIncludes:T}}class au{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,d,g,y,v,T,C){this.context=t;let R=this.boundPaintVertexBuffers.length!==g.length;for(let L=0;!R&&L<g.length;L++)this.boundPaintVertexBuffers[L]!==g[L]&&(R=!0);let k=this.boundDynamicVertexBuffers.length!==T.length;for(let L=0;!k&&L<T.length;L++)this.boundDynamicVertexBuffers[L]!==T[L]&&(k=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||R||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==v)this.freshBind(a,d,g,y,v,T,C);else{t.bindVertexArrayOES.set(this.vao);for(const L of T)L&&(L.bind(),C&&L.instanceCount&&L.setVertexAttribDivisor(t.gl,a,C));y&&y.dynamicDraw&&y.bind()}}freshBind(t,a,d,g,y,v,T){const C=t.numAttributes,R=this.context,k=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=v,a.enableAttributes(k,t),a.bind(),a.setVertexAttribPointers(k,t,y);for(const L of d)L.enableAttributes(k,t),L.bind(),L.setVertexAttribPointers(k,t,y);for(const L of v)L&&(L.enableAttributes(k,t),L.bind(),L.setVertexAttribPointers(k,t,y),T&&L.instanceCount&&L.setVertexAttribDivisor(k,t,T));g&&g.bind(),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function cw(h,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new s.ac(0,d/a).toLngLat().lat,new s.ac(0,(d+1)/a).toLngLat().lat]}function uw(h,t,a,d,g,y,v){const T=h.context,C=T.gl,R=a.hillshadeFBO;if(!R)return;h.prepareDrawTile();const k=h.isTileAffectedByFog(t),L=h.getOrCreateProgram("hillshade",{overrideFog:k});T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get());const j=((X,J,te,pe)=>{const ye=te.paint.get("hillshade-shadow-color"),Se=te.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=te.paint.get("hillshade-highlight-color"),we=te.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",xe=te.paint.get("hillshade-accent-color"),Te=te.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ce=te.paint.get("hillshade-emissive-strength");let Le=s.al(te.paint.get("hillshade-illumination-direction"));if(te.paint.get("hillshade-illumination-anchor")==="viewport")Le-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const Ke=X.style.directionalLight.properties.get("direction"),Qe=s.cR(Ke.x,Ke.y,Ke.z);Le=s.al(Qe[1])}const Fe=!X.options.moving;return{u_matrix:pe||X.transform.calculateProjMatrix(J.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:cw(0,J.tileID),u_light:[te.paint.get("hillshade-exaggeration"),Le],u_shadow:ye.toPremultipliedRenderColor(Se?null:te.lut),u_highlight:be.toPremultipliedRenderColor(we?null:te.lut),u_emissive_strength:Ce,u_accent:xe.toPremultipliedRenderColor(Te?null:te.lut)}})(h,a,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(T,L,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:Z,tileBoundsSegments:$}=h.getTileBoundsBuffers(a);L.draw(h,C.TRIANGLES,g,y,v,ri.disabled,j,d.id,F,Z,$)}function kp(h,t,a){if(!t.needsDEMTextureUpload)return;const d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(a.stride);const y=a.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new s.T(d,y,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function hw(h,t,a){const d=h.context,g=d.gl;if(!t.dem)return;const y=t.dem;if(d.activeTexture.set(g.TEXTURE1),kp(h,t,y),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const v=y.dim;d.activeTexture.set(g.TEXTURE0);let T=t.hillshadeFBO;if(!T){const j=new s.T(d,{width:v,height:v,data:null},g.RGBA8);j.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=t.hillshadeFBO=d.createFramebuffer(v,v,!0,"renderbuffer"),T.colorAttachment.set(j.texture)}d.bindFramebuffer.set(T.framebuffer),d.viewport.set([0,0,v,v]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:k}=h.getMercatorTileBoundsBuffers(),L=[];h.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(h,g.TRIANGLES,Mt.disabled,mi.disabled,zi.unblended,ri.disabled,((j,F)=>{const Z=F.stride,$=s.bz();return s.c5($,0,s.aj,-8192,0,0,1),s.bo($,$,[0,-8192,0]),{u_matrix:$,u_image:1,u_dimension:[Z,Z],u_zoom:j.overscaledZ}})(t.tileID,y),a.id,C,R,k),t.needsHillshadePrepare=!1}class on{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uy extends on{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class eg extends on{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class dw extends on{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class pw extends on{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fw extends on{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class mw extends on{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Gy extends on{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class gw extends on{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Dp extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class _w extends on{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class $y extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class tg extends on{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Np extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ig extends on{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fc extends on{getDefault(){return s.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class lu extends on{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class jp extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class zp extends on{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class cu extends on{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let qy=class extends on{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class rg extends on{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Hy extends on{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uu extends on{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Lp extends on{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fp extends on{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ng extends on{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Op extends on{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xh extends on{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Wy extends on{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Zy extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xy extends on{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class vl extends on{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Yy extends vl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ky extends vl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yw extends vl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xw extends Ky{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const sg=(h,t,a)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),Bp=(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_frustum_tl:v,u_frustum_tr:T,u_frustum_br:C,u_frustum_bl:R,u_globe_pos:k,u_globe_radius:L,u_viewport:j,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:Z});function Vp(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const wl=new class{constructor(){this.operations={}}newMorphing(h,t,a,d,g){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:g,from:t,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const a=this.operations[t];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},og={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ag(h,t,a){if(t===0)return 0;const d=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function vw(h,t){const a=1<<h.z;return!t&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const mc=h=>({u_matrix:h});function gc(h,t,a,d,g){if(g>0){const y=s.q.now(),v=(y-h.timeAdded)/g,T=t?(y-t.timeAdded)/g:-1,C=a.getSource(),R=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),L=k&&h.refreshedUponExpiration?1:s.ay(k?v:1-T,0,1);return h.refreshedUponExpiration&&v>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class Qy extends Vs{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new s.D(s.c$(),null),g=Ah("mock-dem",a,d,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class go extends Vs{constructor(t){const a=Ah("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.c$(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,d){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,v)=>{if(y[v.key]="",!this._tiles[v.key]){const T=new rc(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);T.state="loaded",this._tiles[v.key]=T}return y},{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Up extends s.aM{constructor(t,a,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class Yh extends s.dt{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,g,y]=function(C){const R=new s.ba,k=new s.a_,L=131;R.reserve(17161),k.reserve(33800);const j=s.aj/128,F=s.aj+j/2,Z=F+j;for(let X=-64;X<Z;X+=j)for(let J=-64;J<Z;J+=j){const te=J<0||J>F||X<0||X>F?24575:0,pe=s.ay(Math.round(J),0,s.aj),ye=s.ay(Math.round(X),0,s.aj);R.emplaceBack(pe+te,ye)}const $=(X,J)=>{const te=J*L+X;k.emplaceBack(te+1,te,te+L),k.emplaceBack(te+L,te+L+1,te+1)};for(let X=1;X<129;X++)for(let J=1;J<129;J++)$(J,X);return[0,129].forEach(X=>{for(let J=0;J<130;J++)$(J,X),$(X,J)}),[R,k,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(d,s.bc.members),this.gridIndexBuffer=v.createIndexBuffer(g),this.gridSegments=s.bd.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new go(a.map),this.orthoMatrix=s.bz(),s.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const T=v.gl;this._overlapStencilMode=new mi({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qy(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,y=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const T=t.terrain&&t.terrain.scope,C=g.get("source"),R=y?this._mockSourceCache:t.getSourceCache(C,T);if(!R)return void s.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=R,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(a):g.get("exaggeration"),!a.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const L=this.getScaledDemTileSize();this.sourceCache.update(a,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const g=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const y=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(y);let T=y-this._previousZoom;const C=this._previousUpdateTimestamp;let R=y;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(y-R)>.5&&(T=.5*(y-R+T)),T*g<0&&(R+=T)),this._evaluationZoom=R;const k=v.getExaggeration(R),L=k===v.getExaggeration(Math.max(0,R-.1));if(L&&Math.abs(k-this._exaggeration)<.01)return k;let j=Math.min(.1,.00375*(this._updateTimestamp-C));return(L||k<.1||Math.abs(T)<1e-4)&&(j=Math.min(.2,4*j)),s.ai(this._exaggeration,k,j)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(C=>{const R=a.getTileByID(C).tileID;return R.projMatrix=d.calculateProjMatrix(R.toUnwrapped()),R});(function(C,R){const k=R.transform.pointCoordinate(R.transform.getCameraPoint()),L=new s.P(k.x,k.y);C.sort((j,F)=>{if(F.overscaledZ-j.overscaledZ)return F.overscaledZ-j.overscaledZ;const Z=new s.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),$=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),X=L.mult(1<<j.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Z)-X.distSqr($)})})(g,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},g.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const C in v){const R=v[C];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,t[C],y),R.usedForTerrain))continue;const k=t[C];R.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[a.id]=g.map(C=>new Up(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const R=this.terrainTileForTile[C.key];if(!R)continue;const k=R.tileID.key;k in T||(this._visibleDemTiles.push(R),T[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const d in this.terrainTileForTile){const g=this.terrainTileForTile[d],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),kp(this.painter,g,y))}}_prepareDemTileUniforms(t,a,d,g){if(!a||a.demTexture==null)return!1;const y=t.tileID.canonical,v=Math.pow(2,a.tileID.canonical.z-y.z),T=g||"";return d[`u_dem_tl${T}`]=[y.x*v%1,y.y*v%1],d[`u_dem_scale${T}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;const y=g.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),g=new s.du({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new s.T(t,g,a.R32F,{premultiply:!1}),y}setupElevationDraw(t,a,d){const g=this.painter.context,y=g.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let T=null,C=null,R=1;if(d&&d.morphing&&this._useVertexMorphing){const F=d.morphing.srcDemTile,Z=d.morphing.dstDemTile;R=d.morphing.phase,F&&Z&&(this._prepareDemTileUniforms(t,F,v,"_prev")&&(C=F),this._prepareDemTileUniforms(t,Z,v)&&(T=Z))}const k=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let L=null;var j;if(this.enabled?C&&T?(L=T.demTexture,g.activeTexture.set(y.TEXTURE4),C.demTexture.bind(k(C),y.CLAMP_TO_EDGE),v.u_dem_lerp=R):(T=this.terrainTileForTile[t.tileID.key],L=this._prepareDemTileUniforms(t,T,v)?T.demTexture:this.emptyDEMTexture):L=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),L&&(v.u_dem_size=(j=L).size[0]===1?1:j.size[0]-2,L.bind(k(T),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,a,v),d&&d.useMeterToDem&&T){const F=(1<<T.tileID.canonical.z)*s.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=F}if(d&&d.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(g,v),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,F)}}globeUniformValues(t,a,d){const g=t.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,s.aj,0),u_tile_br_up:g.upVector(a,s.aj,s.aj),u_tile_bl_up:g.upVector(a,0,s.aj),u_tile_up_scale:d?s.dv(1):g.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,v,T,C){if(g.transform.projection.name==="globe")(function(R,k,L,j,F){const Z=R.context,$=Z.gl;let X,J;const te=R.transform,pe=s.dl(R,Z,te),ye=(Ke,Qe)=>{if(J===Qe)return;const at=[og[Qe],"PROJECTION_GLOBE_VIEW"];pe&&at.push("CUSTOM_ANTIALIASING");const je=R.isTileAffectedByFog(Ke);X=R.getOrCreateProgram("globeRaster",{defines:at,overrideFog:je}),J=Qe},Se=R.colorModeForRenderPass(),be=new Mt($.LEQUAL,Mt.ReadWrite,R.depthRangeFor3D);wl.update(F);const we=s.dm(te),xe=[s.aD(te.center.lng),s.aH(te.center.lat)],Te=R.globeSharedBuffers,Ce=[te.width*s.q.devicePixelRatio,te.height*s.q.devicePixelRatio],Le=Float32Array.from(te.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};{const Ke=R.transform,Qe=ag(Ke.zoom,k.exaggeration(),k.sourceCache._source.tileSize);J=-1;const at=$.TRIANGLES;for(const je of j){const qe=L.getTile(je),Re=mi.disabled,et=k.prevTerrainTileForTile[je.key],Ue=k.terrainTileForTile[je.key];Vp(et,Ue)&&wl.newMorphing(je.key,et,Ue,F,250),Z.activeTexture.set($.TEXTURE0),qe.texture&&qe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const nt=wl.getMorphValuesForProxy(je.key),xt=nt?1:0;nt&&s.L(Fe,{morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:s.dk(nt.phase)}});const Je=s.dn(je.canonical),_t=s.dp(Je.getCenter().lat),kt=s.dq(je.canonical,Je,_t,Ke.worldSize/Ke._pixelsPerMercatorPixel),Dt=s.bh(s.dr(je.canonical)),Pt=Bp(Ke.expandedFarZProjMatrix,Le,we,Dt,s.ah(Ke.zoom),xe,Ke.frustumCorners.TL,Ke.frustumCorners.TR,Ke.frustumCorners.BR,Ke.frustumCorners.BL,Ke.globeCenterInViewSpace,Ke.globeRadius,Ce,Qe,Ke._farZ,kt);if(ye(je,xt),X&&(k.setupElevationDraw(qe,X,Fe),R.uploadCommonUniforms(Z,X,je.toUnwrapped()),Te)){const[Ut,qt,Kt]=Te.getGridBuffers(_t,Qe!==0);X.draw(R,at,be,Re,Se,ri.backCCW,Pt,"globe_raster",Ut,qt,Kt)}}}if(Te&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Ke=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&Ke.push("CUSTOM_ANTIALIASING"),X=R.getOrCreateProgram("globeRaster",{defines:Ke});for(const Qe of j){const{x:at,y:je,z:qe}=Qe.canonical,Re=je===0,et=je===(1<<qe)-1,[Ue,nt,xt,Je]=Te.getPoleBuffers(qe,!1);if(Je&&(Re||et)){const _t=L.getTile(Qe);Z.activeTexture.set($.TEXTURE0),_t.texture&&_t.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let kt=s.ds(qe,at,te);const Dt=s.bh(s.dr(Qe.canonical)),Pt=(Ut,qt)=>Ut.draw(R,$.TRIANGLES,be,mi.disabled,Se,ri.disabled,Bp(te.expandedFarZProjMatrix,kt,kt,Dt,0,xe,te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.globeCenterInViewSpace,te.globeRadius,Ce,0,te._farZ),"globe_pole_raster",qt,xt,Je);k.setupElevationDraw(_t,X,Fe),R.uploadCommonUniforms(Z,X,Qe.toUnwrapped()),Re&&R.renderDefaultNorthPole&&Pt(X,Ue),et&&R.renderDefaultSouthPole&&(kt=s.cE(s.bz(),kt,[1,-1,1]),Pt(X,nt))}}}})(g,y,v,T,C);else{const R=g.context,k=R.gl;let L,j;const F=g.shadowRenderer,Z=va(g,g.longestCutoffRange),$=Se=>{if(j===Se)return;const be=[];be.push(og[Se]),Z.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),F&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&be.push("NORMAL_OFFSET")),L=g.getOrCreateProgram("terrainRaster",{defines:be}),j=Se},X=g.colorModeForRenderPass(),J=new Mt(k.LEQUAL,Mt.ReadWrite,g.depthRangeFor3D);wl.update(C);const te=g.transform,pe=ag(te.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ye=[0,0,0];if(F){const Se=g.style.directionalLight,be=g.style.ambientLight;Se&&be&&(ye=dc(g.style,Se,be))}{j=-1;const Se=k.TRIANGLES,[be,we]=[y.gridIndexBuffer,y.gridSegments];for(const xe of T){const Te=v.getTile(xe),Ce=mi.disabled,Le=y.prevTerrainTileForTile[xe.key],Fe=y.terrainTileForTile[xe.key];Vp(Le,Fe)&&wl.newMorphing(xe.key,Le,Fe,C,250),R.activeTexture.set(k.TEXTURE0),Te.texture&&Te.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Ke=wl.getMorphValuesForProxy(xe.key),Qe=Ke?1:0;let at;Ke&&(at={morphing:{srcDemTile:Ke.from,dstDemTile:Ke.to,phase:s.dk(Ke.phase)}});const je=sg(xe.projMatrix,vw(xe.canonical,te.renderWorldCopies)?pe/10:pe,ye);if($(Qe),!L)continue;y.setupElevationDraw(Te,L,at);const qe=xe.toUnwrapped();F&&F.setupShadows(qe,L),g.uploadCommonUniforms(R,L,qe,null,Z),L.draw(g,Se,J,Ce,X,ri.backCCW,je,"terrain_raster",y.gridBuffer,be,we)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],v=this._drapedRenderBatches.shift(),T=a.style.order,C=[];let R=0;for(const k of y){const L=g.getTileByID(k.proxyTileKey),j=g.proxyCachedFBO[k.key]?g.proxyCachedFBO[k.key][t]:void 0,F=j!==void 0?g.renderCache[j]:this.pool[R++],Z=j!==void 0;if(L.texture=F.tex,Z&&!F.dirty){C.push(L.tileID);continue}let $;d.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(d.clear({color:s.am.transparent,stencil:0}),F.dirty=!1);for(let X=v.start;X<=v.end;++X){const J=a.style._mergedLayers[T[X]];if(J.isHidden(a.transform.zoom))continue;const te=a.style.getLayerSourceCache(J),pe=te?this.proxyToSource[k.key][te.id]:[k];if(!pe)continue;const ye=pe;d.viewport.set([0,0,F.fb.width,F.fb.height]),$!==(te?te.id:null)&&(this._setupStencil(F,pe,J,te),$=te?te.id:null),a.renderLayer(a,te,J,ye)}if(this._drapedRenderBatches.length===0)for(const X of this._pendingGroundEffectLayers){const J=a.style._mergedLayers[T[X]];if(J.isHidden(a.transform.zoom))continue;const te=a.style.getLayerSourceCache(J),pe=te?this.proxyToSource[k.key][te.id]:[k];if(!pe)continue;const ye=pe;d.viewport.set([0,0,F.fb.width,F.fb.height]),$!==(te?te.id:null)&&(this._setupStencil(F,pe,J,te),$=te?te.id:null),a.renderLayer(a,te,J,ye)}this.renderedToTile?(F.dirty=!0,C.push(L.tileID)):Z||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let d=-1,g=a;for(let y=0;y<a;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):g=Math.min(g,y);return g>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,d){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const v=y.tileID,T=1<<v.overscaledZ,{x:C,y:R}=v.canonical,k=C/T,L=(C+1)/T,j=R/T,F=(R+1)/T;return{minx:k,miny:j,maxx:L,maxy:F,t:y.dem.tree.raycastRoot(k,j,L,F,t,a,d),tile:y}});g.sort((y,v)=>(y.t!==null?y.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const y of g){if(y.t==null)return null;const v=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,a,d);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,a=t.gl,d=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const g=new s.T(t,{width:d[0],height:d[1],data:null},a.RGBA8);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=t.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(g.texture),y.depthAttachment=new xw(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._mergedLayers[t],d=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Ih){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(y&&!a[y.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof s.ab){a[y.id]=!0;for(const v of this.proxyCoords){const T=this.proxyToSource[v.key][y.id];if(T)for(const C of T)this._clearRenderCacheForTile(y.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof os){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(!y||a[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const v=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][y.id];if(C)for(const R of C){const k=gc(y.getTile(R),y.findLoadedParent(R,0),y,this.painter.transform,v);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(y.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const d=[];this._pendingGroundEffectLayers=[];let g,y=0,v=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++y<a;)v=this._style._mergedLayers[t[y]];for(;y<a;++y){const T=this._style._mergedLayers[t[y]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=y):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(d.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&d.push({start:g,end:y-1}),d.length!==0){const T=d[d.length-1];this._pendingGroundEffectLayers.every(C=>C>T.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const v=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<v.length;++T){const C=Object.values(v[T]);a.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,g=this._tilesDirty;for(let v=d.length-1;v>=0;v--){const T=d[v];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const C=t[T.key],R=this.proxyToSource[T.key];let k=0;for(const L in R){const j=R[L],F=C[L];if(!F||F.length!==j.length||j.some((Z,$)=>Z!==F[$]||g[L]&&g[L].hasOwnProperty(Z.key))){k=-1;break}++k}for(const L in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][L]].dirty=k<0||k!==Object.values(C).length}}const y=[...this._drapedRenderBatches];y.sort((v,T)=>T.end-T.start-(v.end-v.start));for(const v of y)for(const T of d){if(a.proxyCachedFBO[T.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][v.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,v=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(d.isTileClipped())T=a.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):mi.disabled}_renderTileClippingMasks(t,a){const d=this.painter,g=this.painter.context,y=g.gl;d._tileClippingMaskIDs={},g.setColorMode(zi.disabled),g.setDepthMode(Mt.disabled);const v=d.getOrCreateProgram("clippingMask");for(const T of t){const C=d._tileClippingMaskIDs[T.key]=--a;v.draw(d,y.TRIANGLES,Mt.disabled,new mi({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),zi.disabled,ri.disabled,mc(T.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const d=[t.x,t.y,1,1];s.aA(d,d,a.pixelMatrixInverse),s.cw(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const g=a._camera.position,y=s.c6(1,a.center.lat),v=[g[0],g[1],g[2]/y,0],T=s.cX([],d.slice(0,3),v);s.au(T,T);const C=this.raycast(v,T,this._exaggeration);return C!==null&&C?(s.bE(v,v,T,C),v[3]=v[2],v[2]*=y,v):null}_setupProxiedCoordsForOrtho(t,a,d){if(t.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(t,a,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let C=0;C<y.length;C++){const R=y[C],k=this._findTileCoveringTileID(R,t);if(k){const L=this._createProxiedId(R,k,d[R.key]&&d[R.key][t.id]);g.push(L),this.proxyToSource[R.key][t.id]=[L]}}let v=!1;const T=new Set;for(let C=0;C<a.length;C++){const R=t.getTile(a[C]);if(!R||!R.hasData())continue;const k=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==R.tileID.canonical.z){const L=this.proxyToSource[k.tileID.key][t.id],j=this._createProxiedId(k.tileID,R,d[k.tileID.key]&&d[k.tileID.key][t.id]);L?L.splice(L.length-1,0,j):this.proxyToSource[k.tileID.key][t.id]=[j];const F=this.proxyToSource[k.tileID.key][t.id];T.has(F)||T.add(F),g.push(j),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const C of T)C.sort((R,k)=>k.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,d){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords,v=t.getSource(),T=v.tileID;if(!T)return;const C=new s.P(T.x,T.y)._div(1<<T.z),R=v.coordinates.map(s.ac.fromLngLat).reduce((L,j)=>(L.min.x=Math.min(L.min.x,j.x-C.x),L.min.y=Math.min(L.min.y,j.y-C.y),L.max.x=Math.max(L.max.x,j.x-C.x),L.max.y=Math.max(L.max.y,j.y-C.y),L),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(L,j)=>{const F=L.wrap+L.canonical.x/(1<<L.canonical.z),Z=L.canonical.y/(1<<L.canonical.z),$=s.aj/(1<<L.canonical.z),X=j.wrap+j.canonical.x/(1<<j.canonical.z),J=j.canonical.y/(1<<j.canonical.z);return F+$<X+R.min.x||F>X+R.max.x||Z+$<J+R.min.y||Z>J+R.max.y};for(let L=0;L<y.length;L++){const j=y[L];for(let F=0;F<a.length;F++){const Z=t.getTile(a[F]);if(!Z||!Z.hasData()||k(j,Z.tileID))continue;const $=this._createProxiedId(j,Z,d[j.key]&&d[j.key][t.id]),X=this.proxyToSource[j.key][t.id];X?X.push($):this.proxyToSource[j.key][t.id]=[$],g.push($)}}}_createProxiedId(t,a,d){let g=this.orthoMatrix;if(d){const y=d.find(v=>v.key===a.tileID.key);if(y)return y}if(a.tileID.key!==t.key){const y=t.canonical.z-a.tileID.canonical.z;let v,T,C;g=s.bz();const R=a.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(v=s.aj>>y,T=v*((a.tileID.canonical.x<<y)-t.canonical.x+R),C=v*((a.tileID.canonical.y<<y)-t.canonical.y)):(v=s.aj<<-y,T=s.aj*(a.tileID.canonical.x-(t.canonical.x+R<<-y)),C=s.aj*(a.tileID.canonical.y-(t.canonical.y<<-y))),s.c5(g,0,v,0,v,0,1),s.bo(g,g,[T,C,0])}return new Up(a.tileID,t.key,g)}_findTileCoveringTileID(t,a){let d=a.getTile(t);if(d&&d.hasData())return d;const g=this._findCoveringTileCache[a.id],y=g[t.key];if(d=y?a.getTileByID(y):null,d&&d.hasData()||y===null)return d;let v=d?d.tileID:t,T=v.overscaledZ;const C=a.getSource().minzoom,R=[];if(!y){const L=a.getSource().maxzoom;if(t.canonical.z>=L){const j=t.canonical.z-L;a.getSource().reparseOverscaled?(T=Math.max(t.canonical.z+2,a.transform.tileZoom),v=new s.aM(T,t.wrap,L,t.canonical.x>>j,t.canonical.y>>j)):j!==0&&(T=L,v=new s.aM(T,t.wrap,L,t.canonical.x>>j,t.canonical.y>>j))}v.key!==t.key&&(R.push(v.key),d=a.getTile(v))}const k=L=>{R.forEach(j=>{g[j]=L}),R.length=0};for(T-=1;T>=C&&(!d||!d.hasData());T--){d&&k(d.tileID.key);const L=v.calculateScaledKey(T);if(d=a.getTileByID(L),d&&d.hasData())break;const j=g[L];if(j===null)break;j===void 0?R.push(L):d=a.getTileByID(j)}return k(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[a.key]=!0}}function Gp(h,t,a){const d=function(T,C,R){const k=s.bG(C,T),L=s.bG(R,[.2126,.7152,.0722]),j=(Z,$,X)=>(1-X)*Z+X*$,F=j(1-.3*Math.min(L,1),1,Math.min(k+1,1));return j(.92,1,Math.asin(s.ay(C[2],-1,1))/Math.PI+.5)*F}(h,[0,0,1],t),g=[0,0,0];s.bY(g,a.slice(0,3),d);const y=[0,0,0];s.bY(y,t.slice(0,3),h[2]);const v=[0,0,0];return s.cV(v,g,y),s.cY(v)}const lg=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],cg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class $p{static cacheKey(t,a,d,g){let y=`${a}${g?g.cacheKey:""}`;for(const v of d)t.usedDefines.includes(v)&&(y+=`/${v}`);return y}constructor(t,a,d,g,y,v){const T=t.gl;this.program=T.createProgram(),this.configuration=g,this.name=a,this.fixedDefines=[...v];const C=g?g.getBinderAttributes():[],R=(d.staticAttributes||[]).concat(C);let k=g?g.defines():[];k=k.concat(v.map(X=>`#define ${X}`));const L=`#version 300 es
`;let j=L+k.concat("precision mediump float;",wa,Zh.fragmentSource).join(`
`);for(const X of d.fragmentIncludes)j+=`
${ou[X]}`;j+=`
${d.fragmentSource}`;let F=L+k.concat("precision highp float;",wa,Zh.vertexSource).join(`
`);for(const X of d.vertexIncludes)F+=`
${ou[X]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(Z,j),T.compileShader(Z),T.attachShader(this.program,Z);const $=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource($,F),T.compileShader($),T.attachShader(this.program,$),this.attributes={},this.numAttributes=R.length;for(let X=0;X<this.numAttributes;X++)if(R[X]){const J=R[X].startsWith("a_")?R[X]:`a_${R[X]}`;T.bindAttribLocation(this.program,X,J),this.attributes[J]=X}T.linkProgram(this.program),T.deleteShader($),T.deleteShader(Z),this.fixedUniforms=y(t),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new s.c8(X)}))(t)),(v.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new s.c8(X),u_dem_prev:new s.c8(X),u_dem_tl:new s.cb(X),u_dem_scale:new s.ca(X),u_dem_tl_prev:new s.cb(X),u_dem_scale_prev:new s.ca(X),u_dem_size:new s.ca(X),u_dem_lerp:new s.ca(X),u_exaggeration:new s.ca(X),u_depth:new s.c8(X),u_depth_size_inv:new s.cb(X),u_depth_range_unpack:new s.cb(X),u_occluder_half_size:new s.ca(X),u_occlusion_depth_offset:new s.ca(X),u_meter_to_dem:new s.ca(X),u_label_plane_matrix_inv:new s.cc(X)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new s.c9(X),u_tile_tr_up:new s.c9(X),u_tile_br_up:new s.c9(X),u_tile_bl_up:new s.c9(X),u_tile_up_scale:new s.ca(X)}))(t)),v.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new s.cc(X),u_fog_range:new s.cb(X),u_fog_color:new s.cQ(X),u_fog_horizon_blend:new s.ca(X),u_fog_vertical_limit:new s.cb(X),u_fog_temporal_offset:new s.ca(X),u_frustum_tl:new s.c9(X),u_frustum_tr:new s.c9(X),u_frustum_br:new s.c9(X),u_frustum_bl:new s.c9(X),u_globe_pos:new s.c9(X),u_globe_radius:new s.ca(X),u_globe_transition:new s.ca(X),u_is_globe:new s.c8(X),u_viewport:new s.cb(X)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new s.cQ(X)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new s.c9(X),u_lighting_directional_dir:new s.c9(X),u_lighting_directional_color:new s.c9(X),u_ground_radiance:new s.c9(X)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new s.cc(X),u_light_matrix_1:new s.cc(X),u_fade_range:new s.cb(X),u_shadow_normal_offset:new s.c9(X),u_shadow_intensity:new s.ca(X),u_shadow_texel_size:new s.ca(X),u_shadow_map_resolution:new s.ca(X),u_shadow_direction:new s.c9(X),u_shadow_bias:new s.c9(X),u_shadowmap_0:new s.c8(X),u_shadowmap_1:new s.c8(X)}))(t))}}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g]&&d[g].set(this.program,g,a[g])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g]&&d[g].set(this.program,g,a[g])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g].set(this.program,g,a[g])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g].set(this.program,g,a[g])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g].set(this.program,g,a[g])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const g in a)d[g].set(this.program,g,a[g])}_drawDebugWireframe(t,a,d,g,y,v,T,C,R,k){const L=t.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;const j=t.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||t._terrain&&t._terrain.renderingToTexture||!lg.includes(this.name))||!(!L.layers3D||!cg.includes(this.name))))return;const F=j.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,j);if(!Z)return;const $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");const X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:$});j.program.set(X.program);const J=(ye,Se,be)=>{if(Se[ye]&&be[ye])for(const we in Se[ye])be[ye][we]&&be[ye][we].set(be.program,we,Se[ye][we].current)};R&&R.setUniforms(X.program,j,X.binderUniforms,T,{zoom:C}),J("fixedUniforms",this,X),J("terrainUniforms",this,X),J("globeUniforms",this,X),J("fogUniforms",this,X),J("lightsUniforms",this,X),J("shadowUniforms",this,X),Z.bind(),j.setColorMode(new zi([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],s.am.transparent,[!0,!0,!0,!1])),j.setDepthMode(new Mt(a.func===F.LESS?F.LEQUAL:a.func,Mt.ReadOnly,a.range)),j.setStencilMode(mi.disabled);const te=3*v.primitiveLength*2,pe=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=k||1;for(let Se=0;Se<ye;++Se)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),F.drawElements(F.LINES,te,F.UNSIGNED_SHORT,pe)}else k&&k>1?F.drawElementsInstanced(F.LINES,te,F.UNSIGNED_SHORT,pe,k):F.drawElements(F.LINES,te,F.UNSIGNED_SHORT,pe);y.bind(),j.program.set(this.program),j.setDepthMode(a),j.setStencilMode(d),j.setColorMode(g)}checkUniforms(t,a,d){if(this.fixedDefines.includes(a)){for(const g of Object.keys(d))if(!d[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${a} being defined`)}}draw(t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X){const J=t.context,te=J.gl;if(this.failedToCreate)return;J.program.set(this.program),J.setDepthMode(d),J.setStencilMode(g),J.setColorMode(y),J.setCullFace(v);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,T[Se]);Z&&Z.setUniforms(this.program,J,this.binderUniforms,j,{zoom:F});const pe={[te.POINTS]:1,[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[a];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ye=X&&X>0?1:void 0;for(const Se of L.get()){const be=Se.vaos||(Se.vaos={});if((be[C]||(be[C]=new au)).bind(J,this,R,Z?Z.getPaintVertexBuffers():[],k,Se.vertexOffset,$||[],ye),this.forceManualRenderingForInstanceIDShaders){const we=X||1;for(let xe=0;xe<we;++xe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",xe),k?te.drawElements(a,Se.primitiveLength*pe,te.UNSIGNED_SHORT,Se.primitiveOffset*pe*2):te.drawArrays(a,Se.vertexOffset,Se.vertexLength)}else X&&X>1?te.drawElementsInstanced(a,Se.primitiveLength*pe,te.UNSIGNED_SHORT,Se.primitiveOffset*pe*2,X):k?te.drawElements(a,Se.primitiveLength*pe,te.UNSIGNED_SHORT,Se.primitiveOffset*pe*2):te.drawArrays(a,Se.vertexOffset,Se.vertexLength);a===te.TRIANGLES&&k&&this._drawDebugWireframe(t,d,g,y,k,Se,j,F,Z,X)}}}function Kh(h,t,a=0){const d=Math.pow(2,t.tileID.overscaledZ),g=t.tileSize*Math.pow(2,h.transform.tileZoom)/d,y=g*(t.tileID.canonical.x+t.tileID.wrap*d),v=g*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(t,1,h.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v],u_pattern_transition:a}}const hu={terrain:0,flat:1},ug=s.bz(),Qh=(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J)=>{const te=t.style.light,pe=te.properties.get("position"),ye=[pe.x,pe.y,pe.z],Se=s.dx();te.properties.get("anchor")==="viewport"&&(s.dy(Se,-t.transform.angle),s.dz(ye,ye,Se));const be=te.properties.get("color").toPremultipliedRenderColor(null),we=t.transform,xe={u_matrix:h,u_lightpos:ye,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ug,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:hu[R],u_base_type:hu[k],u_ao:g,u_edge_radius:y,u_width_scale:v,u_flood_light_color:Z,u_vertical_scale:$,u_flood_light_intensity:X,u_ground_shadow_factor:J};return we.projection.name==="globe"&&(xe.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],xe.u_zoom_transition=L,xe.u_inv_rot_matrix=F,xe.u_merc_center=j,xe.u_up_dir=we.projection.upVector(new s.cp(0,0,0),j[0]*s.aj,j[1]*s.aj),xe.u_height_lift=C),xe},Jy=(h,t,a,d,g,y)=>({u_matrix:h,u_edge_radius:t,u_width_scale:a,u_vertical_scale:d,u_height_type:hu[g],u_base_type:hu[y]}),ex=(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J)=>{const te=Qh(h,t,a,d,g,y,v,T,R,k,L,j,F,Z,$,X,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,T.overscaledZ)/C.tileSize/8};return s.h(te,Kh(t,C,J),pe)},_c=(h,t,a)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:a}),tx=(h,t,a,d,g,y=0)=>s.h(_c(h,t,g),Kh(a,d,y)),ww=(h,t,a,d)=>({u_matrix:h,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:d}),bw=(h,t,a,d,g,y,v=0)=>s.h(tx(h,t,a,d,y,v),{u_world:g}),Sw=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),qp=(h,t,a,d,g)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:d,u_reset_depth:g}),Tw=(h,t,a,d)=>{const g=s.aj/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},Hp=(h,t,a=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:a}),hg=s.bz(),ix=(h,t,a,d,g,y,v)=>{const T=h.transform,C=T.projection.name==="globe",R=C?s.dA(T.zoom,t.canonical)*T._pixelsPerMercatorPixel:s.aw(a,1,y),k={u_matrix:t.projMatrix,u_extrude_scale:R,u_intensity:v,u_inv_rot_matrix:hg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){k.u_inv_rot_matrix=d,k.u_merc_center=g,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=s.ah(T.zoom);const L=g[0]*s.aj,j=g[1]*s.aj;k.u_up_dir=T.projection.upVector(new s.cp(0,0,0),L,j)}return k};function yc(h,[t,a,d,g],[y,v]){if(y===v)return[0,0,0,0];const T=255*(h-1)/(h*(v-y));return[t*T,a*T,d*T,g*T]}function dg(h,t,[a,d]){return a===d?0:.5/h+(t-a)*(h-1)/(h*(d-a))}const pg=(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te,pe,ye)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:s.dC(L.paint.get("raster-saturation")),u_contrast_factor:s.dB(L.paint.get("raster-contrast")),u_spin_weights:rx(L.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:F,u_zoom_transition:v,u_merc_center:T,u_cutoff_params:C,u_colorization_mix:yc(s.dD,$,J),u_colorization_offset:dg(s.dD,X,J),u_color_ramp:Z,u_texture_offset:[pe/(te+2*pe),te/(te+2*pe)],u_texture_res:[te+2*pe,te+2*pe],u_emissive_strength:ye});function rx(h){h*=Math.PI/180;const t=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const bl=.05,xc=(h,t,a,d,g,y,v,T,C,R,k,L)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:v,u_merc_center:T,u_cutoff_params:C}),nx=(h,t,a,d,g,y,v,T,C,R)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:d,u_color_ramp:y,u_velocity_res:g,u_max_speed:v,u_uv_offset:T,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[bl,bl]}),Sl=(h,t,a,d,g,y,v,T,C,R)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:d,u_max_speed:g,u_speed_factor:y,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:[255*C[0],255*C[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[bl,bl]}),Wp=s.bz(),Jh=(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te,pe,ye,Se,be,we)=>{const xe=g.transform,Te={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(te),u_rotate_symbol:+a,u_aspect_ratio:xe.width/xe.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:v,u_coord_matrix:T,u_is_text:+R,u_elevation_from_sea:C?1:0,u_pitch_with_map:+d,u_texsize:k,u_texsize_icon:L,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Wp,u_up_vector:[0,-1,0],u_color_adj_mat:Se,u_icon_transition:be||0,u_gamma_scale:d?g.transform.getCameraToCenterDistance(te)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:we||1,u_ground_shadow_factor:pe,u_inv_matrix:s.bi(s.bz(),v),u_normal_scale:ye};return te.name==="globe"&&(Te.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],Te.u_zoom_transition=Z,Te.u_inv_rot_matrix=X,Te.u_merc_center=$,Te.u_camera_forward=xe._camera.forward(),Te.u_ecef_origin=s.dE(xe.globeMatrix,F.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(xe.globeMatrix),Te.u_up_vector=J),Te},fg=(h,t,a,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:a,u_color:d}),mg=(h,t,a,d,g,y,v,T,C)=>s.h(function(R,k,L,j,F,Z){const{width:$,height:X}=j.imageManager.getPixelSize(k),J=Math.pow(2,Z.tileID.overscaledZ),te=Z.tileSize*Math.pow(2,j.transform.tileZoom)/J,pe=te*(Z.tileID.canonical.x+Z.tileID.wrap*J),ye=te*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[$,X],u_pattern_size:L.displaySize,u_pattern_units_to_pixels:F?[j.transform.width,-1*j.transform.height]:[1/s.aw(Z,1,j.transform.tileZoom),1/s.aw(Z,1,j.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,ye>>16],u_pixel_coord_lower:[65535&pe,65535&ye]}}(0,y,v,d,T,C),{u_matrix:h,u_emissive_strength:t,u_opacity:a}),ed=new Float32Array(s.bx([])),td=(h,t,a,d,g,y,v,T,C,R,k,L,j,F=[0,0,0],Z)=>{const $=g.style.light,X=$.properties.get("position"),J=[-X.x,-X.y,X.z],te=s.dx();$.properties.get("anchor")==="viewport"&&(s.dy(te,-g.transform.angle),s.dz(J,J,te));const pe=k.alphaMode==="MASK",ye=$.properties.get("color").toNonPremultipliedRenderColor(null),Se=j.paint.get("model-ambient-occlusion-intensity"),be=j.paint.get("model-color").constantOr(s.am.white).toNonPremultipliedRenderColor(null);return be.a=j.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:d||ed,u_lightpos:J,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:F,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+pe,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:R,u_baseColorTexture:Rs.BaseColor,u_metallicRoughnessTexture:Rs.MetallicRoughness,u_normalTexture:Rs.Normal,u_occlusionTexture:Rs.Occlusion,u_emissionTexture:Rs.Emission,u_lutTexture:Rs.LUT,u_color_mix:be.toArray01(),u_aoIntensity:Se,u_emissive_strength:L,u_occlusionTextureTransform:Z||[0,0,0,0]}},sx=(h,t=ed,a=ed)=>({u_matrix:h,u_instance:t,u_node_matrix:a}),ox={fillExtrusion:h=>({u_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_vertical_gradient:new s.ca(h),u_opacity:new s.ca(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_ao:new s.cb(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_up_dir:new s.c9(h),u_height_lift:new s.ca(h),u_flood_light_color:new s.c9(h),u_vertical_scale:new s.ca(h),u_flood_light_intensity:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),fillExtrusionDepth:h=>({u_matrix:new s.cc(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_vertical_scale:new s.ca(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h)}),fillExtrusionPattern:h=>({u_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_vertical_gradient:new s.ca(h),u_height_factor:new s.ca(h),u_edge_radius:new s.ca(h),u_width_scale:new s.ca(h),u_ao:new s.cb(h),u_height_type:new s.c8(h),u_base_type:new s.c8(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_up_dir:new s.c9(h),u_height_lift:new s.ca(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_opacity:new s.ca(h),u_pattern_transition:new s.ca(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new s.cc(h),u_opacity:new s.ca(h),u_ao_pass:new s.ca(h),u_meter_to_tile:new s.ca(h),u_ao:new s.cb(h),u_flood_light_intensity:new s.ca(h),u_flood_light_color:new s.c9(h),u_attenuation:new s.ca(h),u_edge_radius:new s.ca(h),u_fb:new s.c8(h),u_fb_size:new s.ca(h),u_dynamic_offset:new s.ca(h)}),fill:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),fillPattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_pattern_transition:new s.ca(h)}),fillOutline:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_world:new s.cb(h),u_ground_shadow_factor:new s.c9(h)}),fillOutlinePattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_world:new s.cb(h),u_image:new s.c8(h),u_texsize:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_tile_units_to_pixels:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_pattern_transition:new s.ca(h)}),building:h=>({u_matrix:new s.cc(h),u_normal_matrix:new s.cc(h),u_opacity:new s.ca(h)}),buildingDepth:h=>({u_matrix:new s.cc(h)}),elevatedStructuresDepth:h=>({u_matrix:new s.cc(h),u_depth_bias:new s.ca(h)}),elevatedStructures:h=>({u_matrix:new s.cc(h),u_ground_shadow_factor:new s.c9(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new s.cc(h),u_camera_pos:new s.c9(h),u_depth_bias:new s.ca(h),u_height_scale:new s.ca(h),u_reset_depth:new s.ca(h)}),circle:s.dH,collisionBox:h=>({u_matrix:new s.cc(h),u_camera_to_center_distance:new s.ca(h),u_extrude_scale:new s.cb(h)}),collisionCircle:h=>({u_matrix:new s.cc(h),u_inv_matrix:new s.cc(h),u_camera_to_center_distance:new s.ca(h),u_viewport_size:new s.cb(h)}),debug:h=>({u_color:new s.di(h),u_matrix:new s.cc(h),u_overlay:new s.c8(h),u_overlay_scale:new s.ca(h)}),clippingMask:h=>({u_matrix:new s.cc(h)}),heatmap:h=>({u_extrude_scale:new s.ca(h),u_intensity:new s.ca(h),u_matrix:new s.cc(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_up_dir:new s.c9(h)}),heatmapTexture:h=>({u_image:new s.c8(h),u_color_ramp:new s.c8(h),u_opacity:new s.ca(h)}),hillshade:h=>({u_matrix:new s.cc(h),u_image:new s.c8(h),u_latrange:new s.cb(h),u_light:new s.cb(h),u_shadow:new s.di(h),u_highlight:new s.di(h),u_emissive_strength:new s.ca(h),u_accent:new s.di(h)}),hillshadePrepare:h=>({u_matrix:new s.cc(h),u_image:new s.c8(h),u_dimension:new s.cb(h),u_zoom:new s.ca(h)}),line:s.dG,linePattern:s.dF,raster:h=>({u_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_grid_matrix:new s.dj(h),u_tl_parent:new s.cb(h),u_scale_parent:new s.ca(h),u_fade_t:new s.ca(h),u_opacity:new s.ca(h),u_image0:new s.c8(h),u_image1:new s.c8(h),u_brightness_low:new s.ca(h),u_brightness_high:new s.ca(h),u_saturation_factor:new s.ca(h),u_contrast_factor:new s.ca(h),u_spin_weights:new s.c9(h),u_perspective_transform:new s.cb(h),u_raster_elevation:new s.ca(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_cutoff_params:new s.cQ(h),u_colorization_mix:new s.cQ(h),u_colorization_offset:new s.ca(h),u_color_ramp:new s.c8(h),u_texture_offset:new s.cb(h),u_texture_res:new s.cb(h),u_emissive_strength:new s.ca(h)}),rasterParticle:h=>({u_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_grid_matrix:new s.dj(h),u_tl_parent:new s.cb(h),u_scale_parent:new s.ca(h),u_fade_t:new s.ca(h),u_opacity:new s.ca(h),u_image0:new s.c8(h),u_image1:new s.c8(h),u_raster_elevation:new s.ca(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_cutoff_params:new s.cQ(h)}),rasterParticleTexture:h=>({u_texture:new s.c8(h),u_opacity:new s.ca(h)}),rasterParticleDraw:h=>({u_particle_texture:new s.c8(h),u_particle_texture_side_len:new s.ca(h),u_tile_offset:new s.cb(h),u_velocity:new s.c8(h),u_color_ramp:new s.c8(h),u_velocity_res:new s.cb(h),u_max_speed:new s.ca(h),u_uv_offset:new s.cb(h),u_data_scale:new s.cb(h),u_data_offset:new s.ca(h),u_particle_pos_scale:new s.ca(h),u_particle_pos_offset:new s.cb(h)}),rasterParticleUpdate:h=>({u_particle_texture:new s.c8(h),u_particle_texture_side_len:new s.ca(h),u_velocity:new s.c8(h),u_velocity_res:new s.cb(h),u_max_speed:new s.ca(h),u_speed_factor:new s.ca(h),u_reset_rate:new s.ca(h),u_rand_seed:new s.ca(h),u_uv_offset:new s.cb(h),u_data_scale:new s.cb(h),u_data_offset:new s.ca(h),u_particle_pos_scale:new s.ca(h),u_particle_pos_offset:new s.cb(h)}),symbol:h=>({u_is_size_zoom_constant:new s.c8(h),u_is_size_feature_constant:new s.c8(h),u_size_t:new s.ca(h),u_size:new s.ca(h),u_camera_to_center_distance:new s.ca(h),u_rotate_symbol:new s.c8(h),u_aspect_ratio:new s.ca(h),u_fade_change:new s.ca(h),u_matrix:new s.cc(h),u_label_plane_matrix:new s.cc(h),u_coord_matrix:new s.cc(h),u_is_text:new s.c8(h),u_elevation_from_sea:new s.c8(h),u_pitch_with_map:new s.c8(h),u_texsize:new s.cb(h),u_texsize_icon:new s.cb(h),u_texture:new s.c8(h),u_texture_icon:new s.c8(h),u_gamma_scale:new s.ca(h),u_device_pixel_ratio:new s.ca(h),u_tile_id:new s.c9(h),u_zoom_transition:new s.ca(h),u_inv_rot_matrix:new s.cc(h),u_merc_center:new s.cb(h),u_camera_forward:new s.c9(h),u_tile_matrix:new s.cc(h),u_up_vector:new s.c9(h),u_ecef_origin:new s.c9(h),u_is_halo:new s.c8(h),u_icon_transition:new s.ca(h),u_color_adj_mat:new s.cc(h),u_scale_factor:new s.ca(h),u_ground_shadow_factor:new s.c9(h),u_inv_matrix:new s.cc(h),u_normal_scale:new s.ca(h)}),background:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_opacity:new s.ca(h),u_color:new s.di(h)}),backgroundPattern:h=>({u_matrix:new s.cc(h),u_emissive_strength:new s.ca(h),u_opacity:new s.ca(h),u_image:new s.c8(h),u_pattern_tl:new s.cb(h),u_pattern_br:new s.cb(h),u_texsize:new s.cb(h),u_pattern_size:new s.cb(h),u_pixel_coord_upper:new s.cb(h),u_pixel_coord_lower:new s.cb(h),u_pattern_units_to_pixels:new s.cb(h)}),terrainRaster:h=>({u_matrix:new s.cc(h),u_image0:new s.c8(h),u_skirt_height:new s.ca(h),u_ground_shadow_factor:new s.c9(h)}),skybox:h=>({u_matrix:new s.cc(h),u_sun_direction:new s.c9(h),u_cubemap:new s.c8(h),u_opacity:new s.ca(h),u_temporal_offset:new s.ca(h)}),skyboxGradient:h=>({u_matrix:new s.cc(h),u_color_ramp:new s.c8(h),u_center_direction:new s.c9(h),u_radius:new s.ca(h),u_opacity:new s.ca(h),u_temporal_offset:new s.ca(h)}),skyboxCapture:h=>({u_matrix_3f:new s.dj(h),u_sun_direction:new s.c9(h),u_sun_intensity:new s.ca(h),u_color_tint_r:new s.cQ(h),u_color_tint_m:new s.cQ(h),u_luminance:new s.ca(h)}),globeRaster:h=>({u_proj_matrix:new s.cc(h),u_globe_matrix:new s.cc(h),u_normalize_matrix:new s.cc(h),u_merc_matrix:new s.cc(h),u_zoom_transition:new s.ca(h),u_merc_center:new s.cb(h),u_image0:new s.c8(h),u_grid_matrix:new s.dj(h),u_skirt_height:new s.ca(h),u_far_z_cutoff:new s.ca(h),u_frustum_tl:new s.c9(h),u_frustum_tr:new s.c9(h),u_frustum_br:new s.c9(h),u_frustum_bl:new s.c9(h),u_globe_pos:new s.c9(h),u_globe_radius:new s.ca(h),u_viewport:new s.cb(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.c9(h),u_frustum_tr:new s.c9(h),u_frustum_br:new s.c9(h),u_frustum_bl:new s.c9(h),u_horizon:new s.ca(h),u_transition:new s.ca(h),u_fadeout_range:new s.ca(h),u_color:new s.cQ(h),u_high_color:new s.cQ(h),u_space_color:new s.cQ(h),u_temporal_offset:new s.ca(h),u_horizon_angle:new s.ca(h)}),model:h=>({u_matrix:new s.cc(h),u_lighting_matrix:new s.cc(h),u_normal_matrix:new s.cc(h),u_node_matrix:new s.cc(h),u_lightpos:new s.c9(h),u_lightintensity:new s.ca(h),u_lightcolor:new s.c9(h),u_camera_pos:new s.c9(h),u_opacity:new s.ca(h),u_baseColorFactor:new s.cQ(h),u_emissiveFactor:new s.cQ(h),u_metallicFactor:new s.ca(h),u_roughnessFactor:new s.ca(h),u_baseTextureIsAlpha:new s.c8(h),u_alphaMask:new s.c8(h),u_alphaCutoff:new s.ca(h),u_baseColorTexture:new s.c8(h),u_metallicRoughnessTexture:new s.c8(h),u_normalTexture:new s.c8(h),u_occlusionTexture:new s.c8(h),u_emissionTexture:new s.c8(h),u_lutTexture:new s.c8(h),u_color_mix:new s.cQ(h),u_aoIntensity:new s.ca(h),u_emissive_strength:new s.ca(h),u_occlusionTextureTransform:new s.cQ(h)}),modelDepth:h=>({u_matrix:new s.cc(h),u_instance:new s.cc(h),u_node_matrix:new s.cc(h)}),groundShadow:h=>({u_matrix:new s.cc(h),u_ground_shadow_factor:new s.c9(h)}),stars:h=>({u_matrix:new s.cc(h),u_up:new s.c9(h),u_right:new s.c9(h),u_intensity_multiplier:new s.ca(h)}),snowParticle:h=>({u_modelview:new s.cc(h),u_projection:new s.cc(h),u_time:new s.ca(h),u_cam_pos:new s.c9(h),u_velocityConeAperture:new s.ca(h),u_velocity:new s.ca(h),u_horizontalOscillationRadius:new s.ca(h),u_horizontalOscillationRate:new s.ca(h),u_boxSize:new s.ca(h),u_billboardSize:new s.ca(h),u_simpleShapeParameters:new s.cb(h),u_screenSize:new s.cb(h),u_thinningCenterPos:new s.cb(h),u_thinningShape:new s.c9(h),u_thinningAffectedRatio:new s.ca(h),u_thinningParticleOffset:new s.ca(h),u_particleColor:new s.cQ(h),u_direction:new s.c9(h)}),rainParticle:h=>({u_modelview:new s.cc(h),u_projection:new s.cc(h),u_time:new s.ca(h),u_cam_pos:new s.c9(h),u_texScreen:new s.c8(h),u_velocityConeAperture:new s.ca(h),u_velocity:new s.ca(h),u_boxSize:new s.ca(h),u_rainDropletSize:new s.cb(h),u_distortionStrength:new s.ca(h),u_rainDirection:new s.c9(h),u_color:new s.cQ(h),u_screenSize:new s.cb(h),u_thinningCenterPos:new s.cb(h),u_thinningShape:new s.c9(h),u_thinningAffectedRatio:new s.ca(h),u_thinningParticleOffset:new s.ca(h),u_shapeDirectionalPower:new s.ca(h),u_shapeNormalPower:new s.ca(h),u_mode:new s.ca(h)}),vignette:h=>({u_vignetteShape:new s.c9(h),u_vignetteColor:new s.cQ(h)}),occlusion:h=>({u_matrix:new s.cc(h),u_anchorPos:new s.c9(h),u_screenSizePx:new s.cb(h),u_occluderSizePx:new s.cb(h),u_color:new s.cQ(h)})};class jo{constructor(t,a,d,g){this.id=jo.uniqueIdxCounter,jo.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||g||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=jo.uniqueIdxCounter,jo.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}jo.uniqueIdxCounter=0;const Ew={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cw{constructor(t,a,d,g,y,v){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.instanceCount=v,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),t.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const g=a.attributes[this.attributes[d].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,d){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],v=a.attributes[y.name];v!==void 0&&t.vertexAttribPointer(v,y.components,t[Ew[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,a,d){for(let g=0;g<this.attributes.length;g++){const y=a.attributes[this.attributes[g].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gg{constructor(t,a,d,g,y){this.context=t,this.width=a,this.height=d;const v=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Yy(t,v)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Ky(t,v):new yw(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class Iw{constructor(t,a){this.gl=t,this.clearColor=new Uy(this),this.clearDepth=new eg(this),this.clearStencil=new dw(this),this.colorMask=new pw(this),this.depthMask=new fw(this),this.stencilMask=new mw(this),this.stencilFunc=new Gy(this),this.stencilOp=new gw(this),this.stencilTest=new Dp(this),this.depthRange=new _w(this),this.depthTest=new $y(this),this.depthFunc=new tg(this),this.blend=new Np(this),this.blendFunc=new ig(this),this.blendColor=new fc(this),this.blendEquation=new lu(this),this.cullFace=new jp(this),this.cullFaceSide=new zp(this),this.frontFace=new cu(this),this.program=new qy(this),this.activeTexture=new rg(this),this.viewport=new Hy(this),this.bindFramebuffer=new uu(this),this.bindRenderbuffer=new Lp(this),this.bindTexture=new Fp(this),this.bindVertexBuffer=new ng(this),this.bindElementBuffer=new Op(this),this.bindVertexArrayOES=new Xh(this),this.pixelStoreUnpack=new Wy(this),this.pixelStoreUnpackPremultiplyAlpha=new Zy(this),this.pixelStoreUnpackFlipY=new Xy(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,d){return new jo(this,t,a,d)}createVertexBuffer(t,a,d,g,y){return new Cw(this,t,a,d,g,y)}createRenderbuffer(t,a,d){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,a,d,g){return new gg(this,t,a,d,g)}clear({color:t,depth:a,stencil:d,colorMask:g}){const y=this.gl;let v=0;t&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),a!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bv(t.blendFunction,zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let du;function Zp(h,t,a,d,g,y,v){const T=h.context,C=T.gl,R=h.transform,k=h.getOrCreateProgram("collisionBox"),L=[];let j=0,F=0;for(let ye=0;ye<d.length;ye++){const Se=d[ye],be=t.getTile(Se),we=be.getBucket(a);if(!we)continue;const xe=si(Se,we,R);let Te=xe;g[0]===0&&g[1]===0||(Te=h.translatePosMatrix(xe,be,g,y));const Ce=v?we.textCollisionBox:we.iconCollisionBox,Le=we.collisionCircleArray;if(Le.length>0){const Fe=s.bz(),Ke=Te;s.cB(Fe,we.placementInvProjMatrix,R.glCoordMatrix),s.cB(Fe,Fe,we.placementViewportMatrix),L.push({circleArray:Le,circleOffset:F,transform:Ke,invTransform:Fe,projection:we.getProjection()}),j+=Le.length/4,F=j}Ce&&(h.terrain&&h.terrain.setupElevationDraw(be,k),k.draw(h,C.LINES,Mt.disabled,mi.disabled,h.colorModeForRenderPass(),ri.disabled,Tw(Te,R,be,we.getProjection()),a.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,R.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!v||!L.length)return;const Z=h.getOrCreateProgram("collisionCircle"),$=new s.dI;$.resize(4*j),$._trim();let X=0;for(const ye of L)for(let Se=0;Se<ye.circleArray.length/4;Se++){const be=4*Se,we=ye.circleArray[be+0],xe=ye.circleArray[be+1],Te=ye.circleArray[be+2],Ce=ye.circleArray[be+3];$.emplace(X++,we,xe,Te,Ce,0),$.emplace(X++,we,xe,Te,Ce,1),$.emplace(X++,we,xe,Te,Ce,2),$.emplace(X++,we,xe,Te,Ce,3)}(!du||du.length<2*j)&&(du=function(ye){const Se=2*ye,be=new s.a_;be.resize(Se),be._trim();for(let we=0;we<Se;we++){const xe=6*we;be.uint16[xe+0]=4*we+0,be.uint16[xe+1]=4*we+1,be.uint16[xe+2]=4*we+2,be.uint16[xe+3]=4*we+2,be.uint16[xe+4]=4*we+3,be.uint16[xe+5]=4*we+0}return be}(j));const J=T.createIndexBuffer(du,!0),te=T.createVertexBuffer($,s.dJ.members,!0);for(const ye of L){const Se={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(pe=R).getCameraToCenterDistance(ye.projection),u_viewport_size:[pe.width,pe.height]};Z.draw(h,C.TRIANGLES,Mt.disabled,mi.disabled,h.colorModeForRenderPass(),ri.disabled,Se,a.id,te,J,s.bd.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,R.zoom)}var pe;te.destroy(),J.destroy()}const Ga=s.bz();function id(h){const t=h._camera.getWorldToCamera(h.worldSize,1),a=s.az([],t,h.globeMatrix);s.bi(a,a);const d=[0,0,0],g=[0,1,0,0];return s.aA(g,g,a),d[0]=g[0],d[1]=g[1],d[2]=g[2],s.au(d,d),d}function rd({width:h,height:t,anchor:a,textOffset:d,textScale:g},y){const{horizontalAlign:v,verticalAlign:T}=s.bT(a),C=-(v-.5)*h,R=-(T-.5)*t,k=s.bU(a,d);return new s.P((C/g+k[0])*y,(R/g+k[1])*y)}function ax(h,t,a,d,g,y,v,T,C,R){const k=h.text.placedSymbolArray,L=h.text.dynamicLayoutVertexArray,j=h.icon.dynamicLayoutVertexArray,F={},Z=h.getProjection(),$=Sp(v,Z,g),X=g.elevation,J=Z.upVectorScale(v.canonical,g.center.lat,g.worldSize).metersToTile;L.clear();for(let te=0;te<k.length;te++){const pe=k.get(te),{tileAnchorX:ye,tileAnchorY:Se,numGlyphs:be}=pe,we=pe.hidden||!pe.crossTileID||h.allowVerticalPlacement&&!pe.placedOrientation?null:d[pe.crossTileID];if(we){let xe=0,Te=0,Ce=0;if(X){const et=X?X.getAtTileOffset(v,ye,Se):0,[Ue,nt,xt]=Z.upVector(v.canonical,ye,Se);xe=et*Ue*J,Te=et*nt*J,Ce=et*xt*J}let[Le,Fe,Ke,Qe]=ea(pe.projectedAnchorX+xe,pe.projectedAnchorY+Te,pe.projectedAnchorZ+Ce,a?$:y);const at=Lh(g.getCameraToCenterDistance(Z),Qe);let je=s.bJ(h.textSizeData,C,pe)*at/s.bO;a&&(je*=h.tilePixelRatio/T);const qe=rd(we,je);a?({x:Le,y:Fe,z:Ke}=Z.projectTilePoint(ye+qe.x,Se+qe.y,v.canonical),[Le,Fe,Ke]=ea(Le+xe,Fe+Te,Ke+Ce,y)):(t&&qe._rotate(-g.angle),Le+=qe.x,Fe+=qe.y,Ke=0);const Re=h.allowVerticalPlacement&&pe.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let et=0;et<be;et++)s.bL(L,Le,Fe,Ke,Re);R&&pe.associatedIconIndex>=0&&(F[pe.associatedIconIndex]={x:Le,y:Fe,z:Ke,angle:Re})}else cc(be,L)}if(R){j.clear();const te=h.icon.placedSymbolArray;for(let pe=0;pe<te.length;pe++){const ye=te.get(pe),{numGlyphs:Se}=ye,be=F[pe];if(ye.hidden||!be)cc(Se,j);else{const{x:we,y:xe,z:Te,angle:Ce}=be;for(let Le=0;Le<Se;Le++)s.bL(j,we,xe,Te,Ce)}}h.icon.dynamicLayoutVertexBuffer.updateData(j)}h.text.dynamicLayoutVertexBuffer.updateData(L)}function pu(h,t,a,d,g,y,v={}){const T=a.paint.get("icon-translate"),C=a.paint.get("text-translate"),R=a.paint.get("icon-translate-anchor"),k=a.paint.get("text-translate-anchor"),L=a.layout.get("icon-rotation-alignment"),j=a.layout.get("text-rotation-alignment"),F=a.layout.get("icon-pitch-alignment"),Z=a.layout.get("text-pitch-alignment"),$=a.layout.get("icon-keep-upright"),X=a.layout.get("text-keep-upright"),J=a.paint.get("icon-color-saturation"),te=a.paint.get("icon-color-contrast"),pe=a.paint.get("icon-color-brightness-min"),ye=a.paint.get("icon-color-brightness-max"),Se=a.layout.get("symbol-elevation-reference")==="sea",be=h.context,we=be.gl,xe=h.transform,Te=L==="map",Ce=j==="map",Le=F==="map",Fe=Z==="map",Ke=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const at=h.depthModeForSublayer(0,Mt.ReadOnly),je=new Mt(h.context.gl.LEQUAL,Mt.ReadOnly,h.depthRangeFor3D),qe=[s.aD(xe.center.lng),s.aH(xe.center.lat)],Re=a.layout.get("text-variable-anchor"),et=xe.projection.name==="globe",Ue=[],nt=[0,-1,0];for(const xt of d){const Je=t.getTile(xt),_t=Je.getBucket(a);if(!_t||_t.projection.name==="mercator"&&et||_t.fullyClipped)continue;const kt=_t.projection.name==="globe",Dt=kt?s.ah(xe.zoom):0,Pt=Sp(xt,_t.getProjection(),xe),Ut=xe.calculatePixelsToTileUnitsMatrix(Je),qt=Re&&_t.hasTextData(),Kt=_t.hasIconTextFit()&&qt&&_t.hasIconData(),pi=_t.getProjection().createInversionMatrix(xe,xt.canonical),Ai=(1<<Je.tileID.canonical.z)*s.aj/h.transform.worldSize,mr=Lr=>{let or=[0,0,0];if(Lr){const dn=h.style.directionalLight,Xi=h.style.ambientLight;dn&&Xi&&(or=dc(h.style,dn,Xi))}return or},zr=Lr=>{xe.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||h.terrain)&&(Lr.push("DEPTH_D24"),Lr.push("DEPTH_OCCLUSION"))},xr=()=>{const Lr=Te&&a.layout.get("symbol-placement")!=="point",or=[];zr(or);const dn=Lr||Kt,Xi=_t.elevationType==="road"&&Le,Tn=h.shadowRenderer,$r=Xi&&!!Tn&&Tn.enabled,Mr=mr($r),qr=Xi?je:at,lr=a.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&Le&&or.push("PITCH_WITH_MAP_TERRAIN"),kt&&(or.push("PROJECTION_GLOBE_VIEW"),dn&&or.push("PROJECTED_POS_ON_VIEWPORT")),lr>0&&or.push("ICON_TRANSITION"),_t.icon.zOffsetVertexBuffer&&or.push("Z_OFFSET"),J===0&&te===0&&pe===0&&ye===1||or.push("COLOR_ADJUSTMENT"),_t.sdfIcons&&or.push("RENDER_SDF"),$r&&or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&_t.icon.orientationVertexBuffer&&or.push("ELEVATED_ROADS");const mn=_t.icon.programConfigurations.get(a.id),cs=h.getOrCreateProgram("symbol",{config:mn,defines:or}),en=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],rr=_t.iconSizeData,eo=s.bH(rr,xe.zoom),Gs=Le||!xe.isOrthographic,_o=Oa(Pt,Je.tileID.canonical,Le,Te,xe,_t.getProjection(),Ut),na=vp(Pt,Je.tileID.canonical,Le,Te,xe,_t.getProjection(),Ut),Lo=h.translatePosMatrix(na,Je,T,R,!0),$s=h.translatePosMatrix(Pt,Je,T,R),kl=dn?Ga:_o,sa=Te&&!Le&&!Lr;let Dl=nt;!et&&!xe.mercatorFromTransition||Te||(Dl=id(xe));const vd=kt?Dl:nt,Bg=a.getColorAdjustmentMatrix(J,te,pe,ye),Iu=Jh(rr.kind,eo,sa,Le,h,$s,kl,Lo,Se,!1,en,[0,0],0,xt,Dt,qe,pi,vd,_t.getProjection(),Mr,Ai,Bg,lr,null),Vg=Je.imageAtlasTexture?Je.imageAtlasTexture:null,wd=a.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,ff=_t.sdfIcons||h.options.rotating||h.options.zooming||wd||Gs?we.LINEAR:we.NEAREST,mf=_t.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Ea=h.terrain&&Le&&Lr?s.bi(s.bz(),_o):Ga;if(Lr&&_t.icon){const Au=xe.elevation,Ec=Au?Au.getAtTileOffsetFunc(xt,xe.center.lat,xe.worldSize,_t.getProjection()):null,Nl=xp(Pt,Je.tileID.canonical,Le,Te,xe,_t.getProjection(),Ut);wp(_t,Pt,h,!1,Nl,na,Le,$,Ec,xt)}return{program:cs,buffers:_t.icon,uniformValues:Iu,atlasTexture:Vg,atlasTextureIcon:null,atlasInterpolation:ff,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:mf,depthMode:qr,tile:Je,renderWithShadows:$r,labelPlaneMatrixInv:Ea}},Sr=()=>{const Lr=Ce&&a.layout.get("symbol-placement")!=="point",or=[],dn=Lr||Re||Kt,Xi=_t.elevationType==="road"&&Fe,Tn=h.shadowRenderer,$r=Xi&&!!Tn&&Tn.enabled,Mr=mr($r),qr=Xi?je:at;h.terrainRenderModeElevated()&&Fe&&or.push("PITCH_WITH_MAP_TERRAIN"),kt&&(or.push("PROJECTION_GLOBE_VIEW"),dn&&or.push("PROJECTED_POS_ON_VIEWPORT")),_t.text.zOffsetVertexBuffer&&or.push("Z_OFFSET"),_t.iconsInText&&or.push("RENDER_TEXT_AND_SYMBOL"),or.push("RENDER_SDF"),$r&&or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&_t.text.orientationVertexBuffer&&or.push("ELEVATED_ROADS"),zr(or);const lr=_t.text.programConfigurations.get(a.id),mn=h.getOrCreateProgram("symbol",{config:lr,defines:or});let cs,en=[0,0],rr=null;const eo=_t.textSizeData;_t.iconsInText&&(en=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],rr=Je.imageAtlasTexture?Je.imageAtlasTexture:null,cs=Fe||!xe.isOrthographic||h.options.rotating||h.options.zooming||eo.kind==="composite"||eo.kind==="camera"?we.LINEAR:we.NEAREST);const Gs=Je.glyphAtlasTexture?Je.glyphAtlasTexture.size:[0,0],_o=a.layout.get("text-size-scale-range"),na=s.ay(h.scaleFactor,_o[0],_o[1]),Lo=s.bH(eo,xe.zoom,na),$s=Oa(Pt,Je.tileID.canonical,Fe,Ce,xe,_t.getProjection(),Ut),kl=vp(Pt,Je.tileID.canonical,Fe,Ce,xe,_t.getProjection(),Ut),sa=h.translatePosMatrix(kl,Je,C,k,!0),Dl=h.translatePosMatrix(Pt,Je,C,k),vd=dn?Ga:$s,Bg=Ce&&!Fe&&!Lr;let Iu=nt;!et&&!xe.mercatorFromTransition||Ce||(Iu=id(xe));const Vg=Jh(eo.kind,Lo,Bg,Fe,h,Dl,vd,sa,Se,!0,Gs,en,0,xt,Dt,qe,pi,kt?Iu:nt,_t.getProjection(),Mr,Ai,null,null,na),wd=Je.glyphAtlasTexture?Je.glyphAtlasTexture:null,ff=we.LINEAR,mf=a.paint.get("text-halo-width").constantOr(1)!==0,Ea=h.terrain&&Fe&&Lr?s.bi(s.bz(),$s):Ga;if(Lr&&_t.text){const Au=xe.elevation,Ec=Au?Au.getAtTileOffsetFunc(xt,xe.center.lat,xe.worldSize,_t.getProjection()):null,Nl=xp(Pt,Je.tileID.canonical,Fe,Ce,xe,_t.getProjection(),Ut);wp(_t,Pt,h,!0,Nl,kl,Fe,X,Ec,xt)}return{program:mn,buffers:_t.text,uniformValues:Vg,atlasTexture:wd,atlasTextureIcon:rr,atlasInterpolation:ff,atlasInterpolationIcon:cs,isSDF:!0,hasHalo:mf,depthMode:qr,tile:Je,renderWithShadows:$r,labelPlaneMatrixInv:Ea}},xn=_t.icon.segments.get().length,wi=_t.text.segments.get().length,Ri=xn&&!v.onlyText?xr():null,Bi=wi&&!v.onlyIcons?Sr():null,Gr=a.paint.get("icon-opacity").constantOr(1),An=a.paint.get("text-opacity").constantOr(1);if(Ke&&_t.canOverlap){Qe=!0;const Lr=Gr&&!v.onlyText?_t.icon.segments.get():[],or=An&&!v.onlyIcons?_t.text.segments.get():[];for(const dn of Lr)Ue.push({segments:new s.bd([dn]),sortKey:dn.sortKey,state:Ri});for(const dn of or)Ue.push({segments:new s.bd([dn]),sortKey:dn.sortKey,state:Bi})}else v.onlyText||Ue.push({segments:Gr?_t.icon.segments:new s.bd([]),sortKey:0,state:Ri}),v.onlyIcons||Ue.push({segments:An?_t.text.segments:new s.bd([]),sortKey:0,state:Bi})}Qe&&Ue.sort((xt,Je)=>xt.sortKey-Je.sortKey);for(const xt of Ue){const Je=xt.state;if(Je)if(h.terrain?h.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:xe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}):h.setupDepthForOcclusion(xe.depthOcclusionForSymbolsAndCircles,Je.program),be.activeTexture.set(we.TEXTURE0),Je.atlasTexture&&Je.atlasTexture.bind(Je.atlasInterpolation,we.CLAMP_TO_EDGE,!0),Je.atlasTextureIcon&&(be.activeTexture.set(we.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,we.CLAMP_TO_EDGE,!0)),Je.renderWithShadows&&h.shadowRenderer.setupShadows(Je.tile.tileID.toUnwrapped(),Je.program,"vector-tile",Je.tile.tileID.overscaledZ),h.uploadCommonLightUniforms(h.context,Je.program),Je.hasHalo){const _t=Je.uniformValues;_t.u_is_halo=1,fu(Je.buffers,xt.segments,a,h,Je.program,Je.depthMode,g,y,_t,2),_t.u_is_halo=0}else{if(Je.isSDF){const _t=Je.uniformValues;Je.hasHalo&&(_t.u_is_halo=1,fu(Je.buffers,xt.segments,a,h,Je.program,Je.depthMode,g,y,_t,1)),_t.u_is_halo=0}fu(Je.buffers,xt.segments,a,h,Je.program,Je.depthMode,g,y,Je.uniformValues,1)}}}function fu(h,t,a,d,g,y,v,T,C,R){const k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];g.draw(d,d.context.gl.TRIANGLES,y,v,T,ri.disabled,C,a.id,h.layoutVertexBuffer,h.indexBuffer,t,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),k,R)}function Xp(h,t){const a=1<<h.canonical.z,d=(t.x*a-h.canonical.x-h.wrap*a)*s.aj,g=(t.y*a-h.canonical.y)*s.aj,y=s.dS(t.z,t.y);return s.cS(d,g,y)}function _g(h,t,a,d,g){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const y=h.context.gl,v=new Mt(h.context.gl.LEQUAL,Mt.ReadWrite,h.depthRangeFor3D),T=new Mt(h.context.gl.GREATER,Mt.ReadWrite,h.depthRangeFor3D),C=function(F){const Z=s.cJ(F.pitch);let $=.01;return F.isOrthographic&&($=s.ai(1e-4,$,s.cN(Z>=es?1:Z/es))),2*$}(h.transform),R=h.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",L=h.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),j=h.getOrCreateProgram(k);for(const F of d){const Z=t.getTile(F),$=Z.getBucket(a);if(!$)continue;const X=$.elevatedStructures;if(!X)continue;const J=$.elevationBufferData.heightRange,te=Xp(F.toUnwrapped(),R),pe=h.translatePosMatrix(F.projMatrix,Z,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ye,Se,be,we;if(g==="initialize"){if(!J||J.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;ye=qp(pe,te,C,1,0),Se=v,be=X.depthSegments,we=L}else if(g==="reset"){if(!J||J.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;ye=qp(pe,te,0,0,1),Se=T,be=X.maskSegments,we=L}else if(g==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;ye=qp(pe,te,C,1,0),Se=v,be=X.depthSegments,we=j}we.draw(h,y.TRIANGLES,Se,mi.disabled,zi.disabled,ri.disabled,ye,a.id,X.vertexBuffer,X.indexBuffer,be,a.paint,h.transform.zoom)}}function yg(h,t,a){const{painter:d,sourceCache:g,layer:y,coords:v,colorMode:T,elevationType:C,terrainEnabled:R,pass:k}=h,L=d.context.gl,j=y.paint.get("fill-pattern"),F=y.paint.get("fill-pattern-cross-fade"),Z=j.constantOr(null);let $=C;C!=="road"||t&&!R||($="none");const X=$==="road",J=h.painter.shadowRenderer,te=X&&!!J&&J.enabled,pe=new Mt(d.context.gl.LEQUAL,Mt.ReadOnly,d.depthRangeFor3D);let ye=[0,0,0];if(te){const we=d.style.directionalLight,xe=d.style.ambientLight;we&&xe&&(ye=dc(d.style,we,xe))}const Se=j&&j.constantOr(1),be=(we,xe)=>{let Te,Ce,Le,Fe,Ke;xe?(Te=Se&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Le=L.LINES):(Te=Se?"fillPattern":"fill",Le=L.TRIANGLES);for(const Qe of v){const at=g.getTile(Qe);if(Se&&!at.patternsLoaded())continue;const je=at.getBucket(y);if(!je)continue;const qe=t?je.elevationBufferData:je.bufferData;if(qe.isEmpty())continue;d.prepareDrawTile();const Re=qe.programConfigurations.get(y.id),et=d.isTileAffectedByFog(Qe),Ue=[],nt=[];X&&(Ue.push("ELEVATED_ROADS"),nt.push(qe.elevatedLayoutVertexBuffer)),te&&Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&(d.context.activeTexture.set(L.TEXTURE0),at.imageAtlasTexture&&at.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Re.updatePaintBuffers());let xt=!1;if(Z&&at.imageAtlas){const Pt=at.imageAtlas,Ut=s.dN.from(Z),qt=Ut.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Kt=Ut.getSecondary(),pi=Pt.patternPositions.get(qt),Ai=Kt?Pt.patternPositions.get(Kt.scaleSelf(s.q.devicePixelRatio).toString()):null;xt=!!pi&&!!Ai,pi&&Re.setConstantPatternPositions(pi,Ai)}F>0&&(xt||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ue.push("FILL_PATTERN_TRANSITION");const Je=d.getOrCreateProgram(Te,{config:Re,overrideFog:et,defines:Ue}),_t=d.translatePosMatrix(Qe.projMatrix,at,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));te&&J.setupShadows(at.tileID.toUnwrapped(),Je,"vector-tile",at.tileID.overscaledZ);const kt=y.paint.get("fill-emissive-strength");if(xe){Fe=qe.lineIndexBuffer,Ke=qe.lineSegments;const Pt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[L.drawingBufferWidth,L.drawingBufferHeight];Ce=Te==="fillOutlinePattern"&&Se?bw(_t,kt,d,at,Pt,ye,F):ww(_t,kt,Pt,ye)}else Fe=qe.indexBuffer,Ke=qe.triangleSegments,Ce=Se?tx(_t,kt,d,at,ye,F):_c(_t,kt,ye);d.uploadCommonUniforms(d.context,Je,Qe.toUnwrapped());let Dt=we;(C==="road"&&!R||C==="offset")&&(Dt=pe),Je.draw(d,Le,Dt,a||d.stencilModeForClipping(Qe),T,ri.disabled,Ce,y.id,qe.layoutVertexBuffer,Fe,Ke,y.paint,d.transform.zoom,Re,nt)}};d.renderPass===k&&be(d.depthModeForSublayer(1,d.renderPass==="opaque"?Mt.ReadWrite:Mt.ReadOnly),!1),$==="none"&&d.renderPass==="translucent"&&y.paint.get("fill-antialias")&&be(d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Mt.ReadOnly),!0)}function $a(h,t,a,d,g,y,v,T){a.resetLayerRenderingStats(h);const C=h.context,R=C.gl,k=h.transform,L=a.paint.get("fill-extrusion-pattern"),j=a.paint.get("fill-extrusion-pattern-cross-fade"),F=L.constantOr(null),Z=L.constantOr(1),$=a.paint.get("fill-extrusion-opacity"),X=h.style.enable3dLights(),J=a.paint.get(X&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],pe=a.layout.get("fill-extrusion-edge-radius"),ye=pe>0&&!a.paint.get("fill-extrusion-rounded-roof"),Se=ye?0:pe,be=k.projection.name==="globe"?s.dV():0,we=k.projection.name==="globe",xe=we?s.ah(k.zoom):0,Te=[s.aD(k.center.lng),s.aH(k.center.lat)],Ce=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Le=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:a.lut).toArray01().slice(0,3),Fe=a.paint.get("fill-extrusion-flood-light-intensity"),Ke=a.paint.get("fill-extrusion-vertical-scale"),Qe=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,at=a.paint.get("fill-extrusion-height-alignment"),je=a.paint.get("fill-extrusion-base-alignment"),qe=va(h,a.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let et;we&&Re.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Re.push("FAUX_AO"),ye&&Re.push("ZERO_ROOF_RADIUS"),T&&Re.push("HAS_CENTROID"),Fe>0&&Re.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Qe&&Re.push("RENDER_WALL_MODE");const Ue=h.renderPass==="shadow",nt=h.shadowRenderer,xt=Ue&&!!nt,Je=Ue?ri.disabled:ri.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let _t=[0,0,0];if(nt){const Pt=h.style.directionalLight,Ut=h.style.ambientLight;Pt&&Ut&&(_t=dc(h.style,Pt,Ut)),Ue||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),nt.useNormalOffset&&Re.push("NORMAL_OFFSET")),et=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const kt=xt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",Dt=a.getLayerRenderingStats();for(const Pt of d){const Ut=t.getTile(Pt),qt=Ut.getBucket(a);if(!qt||qt.projection.name!==k.projection.name)continue;let Kt=!1;nt&&(Kt=nt.getMaxCascadeForTile(Pt.toUnwrapped())===0);const pi=h.isTileAffectedByFog(Pt),Ai=qt.programConfigurations.get(a.id);let mr=!1;if(F&&Ut.imageAtlas){const Bi=Ut.imageAtlas,Gr=s.dN.from(F),An=Gr.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Lr=Gr.getSecondary(),or=Bi.patternPositions.get(An),dn=Lr?Bi.patternPositions.get(Lr.scaleSelf(s.q.devicePixelRatio).toString()):null;mr=!!or&&!!dn,or&&Ai.setConstantPatternPositions(or,dn)}j>0&&(mr||Ai.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const zr=h.getOrCreateProgram(kt,{config:Ai,defines:Kt?et:Re,overrideFog:pi});if(h.terrain&&h.terrain.setupElevationDraw(Ut,zr,{useMeterToDem:!0}),!qt.centroidVertexBuffer){const Bi=zr.attributes.a_centroid_pos;Bi!==void 0&&R.vertexAttrib2f(Bi,0,0)}!Ue&&nt&&nt.setupShadows(Ut.tileID.toUnwrapped(),zr,"vector-tile",Ut.tileID.overscaledZ),Z&&(h.context.activeTexture.set(R.TEXTURE0),Ut.imageAtlasTexture&&Ut.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ai.updatePaintBuffers());const xr=a.paint.get("fill-extrusion-vertical-gradient"),Sr=1/qt.tileToMeter;let xn;if(Ue&&nt){if(El(Ut.tileID,qt,h))continue;const Bi=nt.calculateShadowPassMatrixFromTile(Ut.tileID.toUnwrapped());xn=Jy(Bi,Se,Sr,Ke,at,je)}else{const Bi=h.translatePosMatrix(Pt.expandedProjMatrix,Ut,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Gr=k.projection.createInversionMatrix(k,Pt.canonical);xn=Z?ex(Bi,h,xr,$,te,Se,Sr,Pt,Ut,be,at,je,xe,Te,Gr,Le,Ke,j):Qh(Bi,h,xr,$,te,Se,Sr,Pt,be,at,je,xe,Te,Gr,Le,Ke,Fe,_t)}h.uploadCommonUniforms(C,zr,Pt.toUnwrapped(),null,qe);let wi=qt.segments;if(k.projection.name==="mercator"&&!Ue&&(wi=qt.getVisibleSegments(Ut.tileID,h.terrain,h.transform.getFrustum(0)),!wi.get().length))continue;if(Dt)if(Ue)for(const Bi of wi.get())Dt.numRenderedVerticesInShadowPass+=Bi.primitiveLength;else for(const Bi of wi.get())Dt.numRenderedVerticesInTransparentPass+=Bi.primitiveLength;const Ri=[];(h.terrain||T)&&Ri.push(qt.centroidVertexBuffer),we&&Ri.push(qt.layoutVertexExtBuffer),Qe&&Ri.push(qt.wallVertexBuffer),zr.draw(h,C.gl.TRIANGLES,g,y,v,Je,xn,a.id,qt.layoutVertexBuffer,qt.indexBuffer,wi,a.paint,h.transform.zoom,Ai,Ri)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function qa(h,t,a,d,g,y,v,T,C,R,k,L,j,F,Z,$,X,J,te){const pe=h.context,ye=pe.gl,Se=h.transform,be=h.transform.zoom,we=[],xe=va(h,a.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(we.push("CLEAR_SUBPASS"),te&&(we.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(ye.TEXTURE0),te.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):R==="sdf"&&we.push("SDF_SUBPASS"),X&&we.push("HAS_CENTROID"),xe.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const Te=a.layout.get("fill-extrusion-edge-radius"),Ce=(Le,Fe,Ke,Qe,at)=>{const je=Fe.programConfigurations.get(a.id),qe=h.isTileAffectedByFog(Le),Re=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:we,overrideFog:qe}),et=((nt,xt,Je,_t,kt,Dt,Pt,Ut,qt,Kt,pi)=>({u_matrix:xt,u_opacity:Je,u_ao_pass:_t?1:0,u_meter_to_tile:kt,u_ao:Dt,u_flood_light_intensity:Pt,u_flood_light_color:Ut,u_attenuation:qt,u_edge_radius:Kt,u_fb:0,u_fb_size:pi,u_dynamic_offset:1}))(0,Qe,k,C,at,[L,j*at],F,Z,$,be>=17?0:Te*at,te?te.size[0]:0),Ue=[];X&&Ue.push(Fe.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(pe,Re,Le.toUnwrapped(),null,xe),Re.draw(h,pe.gl.TRIANGLES,g,y,v,T,et,a.id,Fe.vertexBuffer,Fe.indexBuffer,Ke,a.paint,be,je,Ue)};for(const Le of d){const Fe=t.getTile(Le),Ke=Fe.getBucket(a);if(!Ke||Ke.projection.name!==Se.projection.name||!Ke.groundEffect||Ke.groundEffect&&!Ke.groundEffect.hasData())continue;const Qe=Ke.groundEffect,at=1/Ke.tileToMeter;{const je=h.translatePosMatrix(Le.projMatrix,Fe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),qe=Qe.getDefaultSegment();Ce(Le,Qe,qe,je,at)}if(J)for(let je=0;je<4;je++){const qe=s.dT[je](Le),Re=t.getTile(qe);if(!Re)continue;const et=Re.getBucket(a);if(!et||et.projection.name!==Se.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const Ue=et.groundEffect;let nt,xt;je===0?(nt=[-8192,0,0],xt=1):je===1?(nt=[s.aj,0,0],xt=0):je===2?(nt=[0,-8192,0],xt=3):(nt=[0,s.aj,0],xt=2);const Je=Ue.regionSegments[xt];if(!Je)continue;const _t=new Float32Array(16);s.bo(_t,Le.projMatrix,nt),Ce(Le,Ue,Je,h.translatePosMatrix(_t,Fe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),at)}}}function Rt(h,t,a,d,g,y,v){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const T=y?y.findDEMTileFor(a):null;if(!(T&&T.dem||v))return;y&&T&&T.dem&&d.selfDEMTileTimestamp!==T.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=T.dem._timestamp);const C=J=>new s.P(Math.ceil((J+s.dX)*s.dY),0),R=J=>{const te=t.getSource().minzoom,pe=Se=>{const be=t.getTileByID(Se);if(be&&be.hasData())return be.getBucket(g)},ye=[0,-1,1];for(const Se of ye){if(J.overscaledZ+Se<te)continue;const be=pe(J.calculateScaledKey(J.overscaledZ+Se));if(be)return be}},k=[0,0,0],L=(J,te)=>(k[0]=Math.min(J.min.y,te.min.y),k[1]=Math.max(J.max.y,te.max.y),k[2]=s.aj-te.min.x>J.max.x?te.min.x-s.aj:J.max.x,k),j=(J,te)=>(k[0]=Math.min(J.min.x,te.min.x),k[1]=Math.max(J.max.x,te.max.x),k[2]=s.aj-te.min.y>J.max.y?te.min.y-s.aj:J.max.y,k),F=[(J,te)=>L(J,te),(J,te)=>L(te,J),(J,te)=>j(J,te),(J,te)=>j(te,J)],Z=(J,te,pe,ye,Se,be,we)=>{if(!y)return 0;const xe=[[be?pe:J,be?J:pe,0],[be?pe:te,be?te:pe,0]],Te=we<0?s.aj+we:we,Ce=[be?Te:(J+te)/2,be?(J+te)/2:Te,0];return pe===0&&we<0||pe!==0&&we>0?y.getForTilePoints(Se,[Ce],!0,ye):xe.push(Ce),y.getForTilePoints(a,xe,!0,T),Math.max(xe[0][2],xe[1][2],Ce[2])/y.exaggeration()};for(let J=0;J<4;J++){const te=d.borderFeatureIndices[J];if(te.length===0)continue;const pe=s.dT[J](a),ye=R(pe);if(!(ye&&ye instanceof s.dU))continue;const Se=y?y.findDEMTileFor(pe):null;if(!(Se&&Se.dem||v)||(y&&Se&&Se.dem&&d.borderDEMTileTimestamp[J]!==Se.dem._timestamp&&(d.borderDoneWithNeighborZ[J]=-1,d.borderDEMTileTimestamp[J]=Se.dem._timestamp),d.borderDoneWithNeighborZ[J]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const be=(J<2?1:5)-J,we=ye.borderDoneWithNeighborZ[be]!==d.canonical.z,xe=ye.borderFeatureIndices[be];let Te=0;if(d.canonical.z!==ye.canonical.z){for(const Ce of te)d.showCentroid(d.featuresOnBorder[Ce]);if(we)for(const Ce of xe)ye.showCentroid(ye.featuresOnBorder[Ce]);d.borderDoneWithNeighborZ[J]=ye.canonical.z,ye.borderDoneWithNeighborZ[be]=d.canonical.z}for(const Ce of te){const Le=d.featuresOnBorder[Ce],Fe=d.centroidData[Le.centroidDataIndex],Ke=Le.borders[J];let Qe;for(;Te<xe.length;){Qe=ye.featuresOnBorder[xe[Te]];const at=Qe.borders[be];if(at[1]>Ke[0]+3||at[0]>Ke[0]-3)break;ye.showCentroid(Qe),Te++}if(Qe&&Te<xe.length){const at=Te;let je=0;for(;!(Qe.borders[be][0]>Ke[1]-3)&&(je++,++Te!==xe.length);)Qe=ye.featuresOnBorder[xe[Te]];Qe=ye.featuresOnBorder[xe[at]];let qe=!1;if(je>=1){const Ue=Qe.borders[be];Math.abs(Ke[0]-Ue[0])<3&&Math.abs(Ke[1]-Ue[1])<3&&(je=1,qe=!0,Te=at+1)}else if(je===0){d.showCentroid(Le);continue}const Re=ye.centroidData[Qe.centroidDataIndex];v&&qe&&((($=Fe).flags|(X=Re).flags)&s.dW?($.flags|=s.dW,X.flags|=s.dW):($.flags&=2147483647,X.flags&=2147483647));const et=Le.intersectsCount()>1||Qe.intersectsCount()>1;if(je>1)Te=at,Fe.centroidXY=Re.centroidXY=new s.P(0,0);else if(Se&&Se.dem&&!et){const Ue=F[J](Fe,Re),nt=J%2?s.aj-1:0,xt=Z(Ue[0],Math.min(s.aj-1,Ue[1]),nt,Se,pe,J<2,Ue[2]);Fe.centroidXY=Re.centroidXY=C(xt)}else et?Fe.centroidXY=Re.centroidXY=new s.P(0,0):(Fe.centroidXY=d.encodeBorderCentroid(Le),Re.centroidXY=ye.encodeBorderCentroid(Qe));d.writeCentroidToBuffer(Fe),ye.writeCentroidToBuffer(Re)}else d.showCentroid(Le)}d.borderDoneWithNeighborZ[J]=ye.canonical.z,ye.borderDoneWithNeighborZ[be]=d.canonical.z}var $,X;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const lx=[1,0,0],cx=[0,1,0],Tl=[0,0,1];function El(h,t,a){const d=a.transform,g=a.shadowRenderer;if(!g)return!0;const y=h.toUnwrapped(),v=d.tileSize*g._cascades[a.currentShadowCascade].scale;let T=t.maxHeight;if(d.elevation){const $=d.elevation.getMinMaxForTile(h);$&&(T+=$.max)}const C=[...g.shadowDirection];C[2]=-C[2];const R=g.computeSimplifiedTileShadowVolume(y,T,v,C);if(!R)return!1;const k=[lx,cx,Tl,C,[C[0],0,C[2]],[0,C[1],C[2]]],L=d.projection.name==="globe",j=d.scaleZoom(v),F=s.cn.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,j,!L),Z=g.getCurrentCascadeFrustum();return F.intersectsPrecise(R.vertices,R.planes,k)===0||Z.intersectsPrecise(R.vertices,R.planes,k)===0}function Jt(h){return[h[0]*s.dZ,h[1]*s.dZ,h[2]*s.dZ,0]}function nd(h,t,a,d,g,y,v,T,C){const R=d.getSource(),k=a.globeSharedBuffers;if(!k)return;let L,j,F;if(t&&(L=d.getTile(t)),R instanceof s.aP?(j=R.texture,F=s.ds(0,0,a.transform)):L&&t&&(j=L.texture,F=s.ds(t.canonical.z,t.canonical.x,a.transform)),!j||!F)return;h||(F=s.cE(s.bz(),F,[1,-1,1]));const Z=a.context,$=Z.gl,X=g.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,J=a.colorModeForDrapableLayerRenderPass(y),te=v.defines;te.push("GLOBE_POLES");const pe=new Mt($.LEQUAL,Mt.ReadWrite,a.depthRangeFor3D),ye=Float32Array.from(a.transform.expandedFarZProjMatrix),Se=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),Z.activeTexture.set($.TEXTURE0),j.bind(X,$.CLAMP_TO_EDGE),Z.activeTexture.set($.TEXTURE1),j.bind(X,$.CLAMP_TO_EDGE),"useMipmap"in j&&Z.extTextureFilterAnisotropic&&a.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[be,we,xe,Te]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Ce=g.paint.get("raster-elevation");let Le;h?(Le=be,a.renderDefaultNorthPole=Ce!==0):(Le=we,a.renderDefaultSouthPole=Ce!==0);const Fe=Jt(v.mix),Ke=((at,je,qe,Re,et,Ue,nt,xt,Je,_t,kt,Dt,Pt)=>pg(at,je,qe,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ue,[0,0],xt,2,_t,kt,Dt,1,0,Pt))(ye,Se,F,s.ah(a.transform.zoom),0,g,0,Ce,0,Fe,v.offset,v.range,y),Qe=a.getOrCreateProgram("raster",{defines:te});a.uploadCommonUniforms(Z,Qe,null),Qe.draw(a,$.TRIANGLES,pe,C,J,T,Ke,g.id,Le,xe,Te)}function Aw(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,g=.2*h.height,y=t+g;return[t,a,(y-g-t)/d,(y-t)/d]}function Pw(h,t,a,d){if(h)return t instanceof ml&&h instanceof Wc?t.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:Jt(d.mix),offset:d.offset,buffer:0,tileSize:1}}var xg=s.d_([{name:"a_index",type:"Int16",components:1}]);class ux{constructor(t,a,d,g){const y={width:d[0],height:d[1],data:null},v=t.gl;this.targetColorTexture=new s.T(t,y,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,y,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,g),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,g=a.width*a.height;this.particleTexture0=new s.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new s.d$;y.reserve(g);for(let v=0;v<g;v++)y.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(y,xg.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mw(h,t,a){if(!h)return null;const d=t.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:g,mix:y,offset:v,tileSize:T,buffer:C,format:R}=d;if(!g||!R)return null;let k=!1;return R==="uint32"&&(k=!0,y[3]=0,y=yc(s.e0,y,[0,a.paint.get("raster-particle-max-speed")]),v=dg(s.e0,v,[0,a.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[C/(T+2*C),T/(T+2*C)],tileSize:T,scalarData:k,scale:y,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function hx(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,g=.2*h.height,y=t+g;return[t,a,(y-g-t)/d,(y-t)/d]}const Rw=new s.am(1,0,0,1),kw=new s.am(0,1,0,1),Js=new s.am(0,0,1,1),vg=new s.am(1,0,1,1),ks=new s.am(0,1,1,1);function Ha(h,t,a,d,g,y){for(let v=0;v<a.length;v++)if(g){const R=new s.am(d.r*.8,d.g*.8,d.b*.8,1);vc(h,t,a[v],d,-1,-1,y),vc(h,t,a[v],d,-1,1,y),vc(h,t,a[v],d,1,1,y),vc(h,t,a[v],d,1,-1,y),vc(h,t,a[v],R,0,0,y)}else vc(h,t,a[v],d,0,0,y)}function vc(h,t,a,d,g,y,v){const T=h.context,C=h.transform,R=T.gl,k=C.projection.name==="globe",L=k?["PROJECTION_GLOBE_VIEW"]:[];let j=s.bw(a.projMatrix);if(k&&s.ah(C.zoom)>0){const Fe=s.bg(a.canonical,C),Ke=s.e1(Fe);j=s.az(new Float32Array(16),C.globeMatrix,Ke),s.az(j,C.projMatrix,j)}const F=s.bz();F[12]+=2*g/(s.q.devicePixelRatio*C.width),F[13]+=2*y/(s.q.devicePixelRatio*C.height),s.az(j,F,j);const Z=h.getOrCreateProgram("debug",{defines:L}),$=t.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw($,Z);const X=Mt.disabled,J=mi.disabled,te=h.colorModeForRenderPass(),pe="$debug";T.activeTexture.set(R.TEXTURE0),h.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),k?$._makeGlobeTileDebugBuffers(h.context,C):$._makeDebugTileBoundsBuffers(h.context,C.projection);const ye=$._tileDebugBuffer||h.debugBuffer,Se=$._tileDebugIndexBuffer||h.debugIndexBuffer,be=$._tileDebugSegments||h.debugSegments;if(Z.draw(h,R.LINE_STRIP,X,J,te,ri.disabled,Hp(j,d.toPremultipliedRenderColor(null)),pe,ye,Se,be,null,null,null,[$._globeTileDebugBorderBuffer]),v){const Fe=$.latestRawTileData,Ke=Math.floor((Fe&&Fe.byteLength||0)/1024);let Qe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Qe+=` => ${a.overscaledZ}`),Qe+=` ${$.state}`,Qe+=` ${Ke}kb`,function(at,je){at.initDebugOverlayCanvas();const qe=at.debugOverlayCanvas,Re=at.context.gl,et=at.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,qe.width,qe.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(je,5,5),et.strokeText(je,5,5),at.debugOverlayTexture.update(qe),at.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(h,Qe)}const we=t.getTile(a).tileSize,xe=512/Math.min(we,512)*(a.overscaledZ/C.zoom)*.5,Te=$._tileDebugTextBuffer||h.debugBuffer,Ce=$._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Le=$._tileDebugTextSegments||h.debugSegments;Z.draw(h,R.TRIANGLES,X,J,zi.alphaBlended,ri.disabled,Hp(j,s.am.transparent.toPremultipliedRenderColor(null),xe),pe,Te,Ce,Le,null,null,null,[$._globeTileDebugTextBuffer])}function Yp(h,t,a,d){mu(h,0,t+a/2,h.transform.width,a,d)}function Kp(h,t,a,d){mu(h,t-a/2,0,a,h.transform.height,d)}function mu(h,t,a,d,g,y){const v=h.context,T=v.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*s.q.devicePixelRatio,a*s.q.devicePixelRatio,d*s.q.devicePixelRatio,g*s.q.devicePixelRatio),v.clear({color:y}),T.disable(T.SCISSOR_TEST)}const dx=s.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Wa}=dx;function Cr(h,t,a,d){h.emplaceBack(t,a,d)}class sd{constructor(t){this.vertexArray=new s.e2,this.indices=new s.a_,Cr(this.vertexArray,-1,-1,1),Cr(this.vertexArray,1,-1,1),Cr(this.vertexArray,-1,1,1),Cr(this.vertexArray,1,1,1),Cr(this.vertexArray,-1,-1,-1),Cr(this.vertexArray,1,-1,-1),Cr(this.vertexArray,-1,1,-1),Cr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Wa),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function Cl(h,t,a,d,g,y){const v=h.context.gl,T=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),R=t.paint.get("sky-atmosphere-sun-intensity"),k=((L,j,F,Z,$)=>({u_matrix_3f:L,u_sun_direction:j,u_sun_intensity:F,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(s.e4(s.dx(),d),g,R,T.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),a.draw(h,v.TRIANGLES,Mt.disabled,mi.disabled,zi.unblended,ri.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const px=s.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fx{constructor(t){const a=new s.e5;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new s.a_;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,px.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const mx=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dw{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class gu{constructor(t){this.colorModeAlphaBlendedWriteRGB=new zi([1,hc,1,hc],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new zi([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new Dw,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new fx(a);const d=this.params.sizeRange,g=this.params.intensityRange,y=function(k){const L=s.e7(30),j=[];for(let F=0;F<k;++F){const Z=2*Math.PI*L(),$=Math.acos(1-2*L())-.5*Math.PI;j.push(s.cS(Math.cos($)*Math.cos(Z),Math.cos($)*Math.sin(Z),Math.sin($)))}return j}(this.params.starsCount),v=s.e7(300),T=new s.e6,C=new s.a_;let R=0;for(let k=0;k<y.length;++k){const L=s.bY([],y[k],200),j=Math.max(0,1+.01*d*(1*v()-.5)),F=Math.max(0,1+.01*g*(1*v()-.5));T.emplaceBack(L[0],L[1],L[2],-1,-1,j,F),T.emplaceBack(L[0],L[1],L[2],1,-1,j,F),T.emplaceBack(L[0],L[1],L[2],1,1,j,F),T.emplaceBack(L[0],L[1],L[2],-1,1,j,F),C.emplaceBack(R+0,R+1,R+2),C.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=a.createVertexBuffer(T,mx.members),this.starsIdx=a.createIndexBuffer(C),this.starsSegments=s.bd.simpleSegment(0,0,T.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const d=t.context,g=d.gl,y=t.transform,v=new Mt(g.LEQUAL,Mt.ReadOnly,[0,1]),T=s.ah(y.zoom),C=t.style.getLut(a.scope),R=a.properties.get("color-use-theme")==="none",k=a.properties.get("color").toNonPremultipliedRenderColor(R?null:C).toArray01(),L=a.properties.get("high-color-use-theme")==="none",j=a.properties.get("high-color").toNonPremultipliedRenderColor(L?null:C).toArray01(),F=a.properties.get("space-color-use-theme")==="none",Z=a.properties.get("space-color").toNonPremultipliedRenderColor(F?null:C).toArray01(),$=5e-4,X=s.e8(a.properties.get("horizon-blend"),0,1,$,.25),J=s.dl(t,d,y)&&X===$?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,te=t.frameCounter/1e3%1,pe=s.ae(y.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(pe,2)-Math.pow(J,2)),Se=Math.acos(ye/pe),be=we=>{const xe=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];we&&xe.push("ALPHA_PASS");const Te=t.getOrCreateProgram("globeAtmosphere",{defines:xe}),Ce=((Fe,Ke,Qe,at,je,qe,Re,et,Ue,nt,xt,Je)=>({u_frustum_tl:Fe,u_frustum_tr:Ke,u_frustum_br:Qe,u_frustum_bl:at,u_horizon:je,u_transition:qe,u_fadeout_range:Re,u_color:et,u_high_color:Ue,u_space_color:nt,u_temporal_offset:xt,u_horizon_angle:Je}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,T,X,k,j,Z,te,Se);t.uploadCommonUniforms(d,Te);const Le=this.atmosphereBuffer;Le&&Te.draw(t,g.TRIANGLES,v,mi.disabled,we?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ri.backCW,Ce,we?"atmosphere_glow_alpha":"atmosphere_glow",Le.vertexBuffer,Le.indexBuffer,Le.segments)};be(!1),be(!0)}drawStars(t,a){const d=s.ay(a.properties.get("star-intensity"),0,1);if(d===0)return;const g=t.context,y=g.gl,v=t.transform,T=t.getOrCreateProgram("stars"),C=s.b_([]);s.c0(C,C,-v._pitch),s.b$(C,C,-v.angle),s.c0(C,C,s.al(v._center.lat)),s.e9(C,C,-s.al(v._center.lng));const R=s.c3(new Float32Array(16),C),k=s.az([],v.starsProjMatrix,R),L=s.e4([],R),j=s.ea([],L),F=[0,1,0];s.dz(F,F,j),s.bY(F,F,this.params.sizeMultiplier);const Z=[1,0,0];s.dz(Z,Z,j),s.bY(Z,Z,this.params.sizeMultiplier);const $=(X=F,J=Z,te=d,{u_matrix:Float32Array.from(k),u_up:X,u_right:J,u_intensity_multiplier:te});var X,J,te;t.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(t,y.TRIANGLES,Mt.disabled,mi.disabled,this.colorModeAlphaBlendedWriteRGB,ri.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wc(h,t){const a=[...h],d=t.cameraWorldSizeForFog/t.worldSize,g=s.bx([]);return s.cE(g,g,[d,d,1]),s.az(a,g,a),s.az(a,t.worldToFogMatrix,a),a}function ft(h,t,a,d,g){const y=a.material,v=d.context,{baseColorTexture:T,metallicRoughnessTexture:C}=y.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:k,emissionTexture:L}=y;function j(Z,$,X){if(Z&&(h.push($),v.activeTexture.set(v.gl.TEXTURE0+X),Z.gfxTexture)){const{minFilter:J,magFilter:te,wrapS:pe,wrapT:ye}=Z.sampler;Z.gfxTexture.bindExtraParam(J,te,pe,ye)}}j(T,"HAS_TEXTURE_u_baseColorTexture",Rs.BaseColor),j(C,"HAS_TEXTURE_u_metallicRoughnessTexture",Rs.MetallicRoughness),j(R,"HAS_TEXTURE_u_normalTexture",Rs.Normal),j(k,"HAS_TEXTURE_u_occlusionTexture",Rs.Occlusion),j(L,"HAS_TEXTURE_u_emissionTexture",Rs.Emission),g&&(g.texture||(g.texture=new s.eh(d.context,g.image,[g.image.height,g.image.height,g.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+Rs.LUT),g.texture&&g.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||h.push("DIFFUSE_SHADED");const F=d.shadowRenderer;F&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&h.push("NORMAL_OFFSET"))}function At(h,t,a,d,g,y){const v=a.paint.get("model-opacity").constantOr(1),T=t.context,C=new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D),R=t.transform,k=h.mesh,L=k.material,j=L.pbrMetallicRoughness,F=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:s.az([],d.zScaleMatrix,h.nodeModelMatrix),s.az(Z,d.negCameraPosMatrix,Z);const $=s.bi([],Z);s.ee($,$);const X=a.paint.get("model-color-use-theme").constantOr("default")==="none",J=a.paint.get("model-emissive-strength").constantOr(0),te=td(new Float32Array(h.worldViewProjection),new Float32Array(Z),new Float32Array($),null,t,v,j.baseColorFactor,L.emissiveFactor,j.metallicFactor,j.roughnessFactor,L,J,a),pe={defines:[]},ye=[],Se=t.shadowRenderer;Se&&(Se.useNormalOffset=!1),ft(pe.defines,ye,k,t,X?null:a.lut);let be=null;if(F){const Te=wc(h.nodeModelMatrix,t.transform);if(be=new Float32Array(Te),R.projection.name!=="globe"){const Ce=k.aabb.min,Le=k.aabb.max,[Fe,Ke]=F.getOpacityForBounds(Te,Ce[0],Ce[1],Le[0],Le[1]);pe.overrideFog=Fe>=ce||Ke>=ce}}const we=va(t,a.paint.get("model-cutoff-fade-range"));we.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const xe=t.getOrCreateProgram("model",pe);t.uploadCommonUniforms(T,xe,null,be,we),t.renderPass!=="shadow"&&Se&&Se.setupShadowsFromMatrix(h.nodeModelMatrix,xe),xe.draw(t,T.gl.TRIANGLES,C,g,y,k.material.doubleSided?ri.disabled:ri.backCCW,te,a.id,k.vertexBuffer,k.indexBuffer,k.segments,a.paint,t.transform.zoom,void 0,ye)}function bc(h,t,a,d,g,y,v){let T;T=h.projection.name==="globe"?s.ed(a,h):[...a],s.az(T,T,t.matrix);const C=s.az([],d,T);if(t.meshes)for(const R of t.meshes){if(R.material.alphaMode!=="BLEND"){v.push({mesh:R,depth:0,modelIndex:g,worldViewProjection:C,nodeModelMatrix:T});continue}const k=s.ad([],R.centroid,C);!h.isOrthographic&&k[2]<=0||y.push({mesh:R,depth:k[2],modelIndex:g,worldViewProjection:C,nodeModelMatrix:T})}if(t.children)for(const R of t.children)bc(h,R,a,d,g,y,v)}function hn(h,t,a,d){const g=a.shadowRenderer;if(!g)return;const y=g.getShadowPassDepthMode(),v=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(t),C=sx(T);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,y,mi.disabled,v,ri.backCCW,C,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function ze(h,t,a){const d=t.updateZoomBasedPaintProperties(),g=function(y,v,T){let C,R,k,L=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&L>0){const j=y.terrain,F=j.findDEMTileFor(T);F&&F.dem?C=s.ei.create(j,T,F):L=0}if(L===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),L===v.validForExaggeration&&(L===0||C&&C._demTile&&C._demTile.tileID===v.validForDEMTile.id&&C._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const j in v.instancesPerModel){const F=v.instancesPerModel[j];for(let Z=0;Z<F.instancedDataArray.length;++Z){const $=(C?L*C.getElevationAt(0|F.instancedDataArray.float32[16*Z],0|F.instancedDataArray.float32[16*Z+1],!0,!0):0)+F.instancesEvaluatedElevation[Z];F.instancedDataArray.float32[16*Z+6]=$,R=R?Math.min(v.terrainElevationMin,$):$,k=k?Math.max(v.terrainElevationMax,$):$}}return v.terrainElevationMin=R||0,v.terrainElevationMax=k||0,v.validForExaggeration=L,v.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,a);(d||g)&&(t.uploaded=!1,t.upload(h.context))}const ia={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cW([0,0,0],[s.aj,s.aj,0])};function Qp(h,t){const a=1<<h.canonical.z,d=t.getFreeCameraOptions().position,g=t.elevation,y=h.canonical.x/a,v=(h.canonical.x+1)/a,T=h.canonical.y/a,C=(h.canonical.y+1)/a;let R=t._centerAltitude;if(g){const F=g.getMinMaxForTile(h);F&&F.max>R&&(R=F.max)}const k=s.ay(d.x,y,v)-d.x,L=s.ay(d.y,T,C)-d.y,j=s.c6(R,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+L*L+j*j))}function Jp(h,t,a,d,g,y,v){const T=h.context,C=h.renderPass==="shadow",R=h.shadowRenderer,k=C&&R?R.getShadowPassDepthMode():new Mt(T.gl.LEQUAL,Mt.ReadWrite,h.depthRangeFor3D),L=h.isTileAffectedByFog(y);if(a.meshes)for(const j of a.meshes){const F=["MODEL_POSITION_ON_GPU"],Z=[];let $,X,J;d.instancedDataArray.length>20&&F.push("INSTANCED_ARRAYS");const te=va(h,t.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),C&&R)$=h.getOrCreateProgram("modelDepth",{defines:F}),X=sx(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(a.matrix)),J=R.getShadowPassColorMode();else{ft(F,Z,j,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),$=h.getOrCreateProgram("model",{defines:F,overrideFog:L});const ye=j.material,Se=ye.pbrMetallicRoughness,be=t.paint.get("model-opacity").constantOr(1),we=t.paint.get("model-emissive-strength").constantOr(0);X=td(y.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,h,be,Se.baseColorFactor,ye.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,ye,we,t,g),R&&(v.shadowUniformsInitialized?$.setShadowUniformValues(T,R.getShadowUniformValues()):(R.setupShadows(y.toUnwrapped(),$,"model-tile",y.overscaledZ),v.shadowUniformsInitialized=!0)),J=te.shouldRenderCutoff||be<1||ye.alphaMode!=="OPAQUE"?zi.alphaBlended:zi.unblended}h.uploadCommonUniforms(T,$,y.toUnwrapped(),null,te);const pe=j.material.doubleSided?ri.disabled:ri.backCCW;if(d.instancedDataArray.length>20)Z.push(d.instancedDataBuffer),$.draw(h,T.gl.TRIANGLES,k,mi.disabled,J,pe,X,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Z,d.instancedDataArray.length);else{const ye=C?"u_instance":"u_normal_matrix";for(let Se=0;Se<d.instancedDataArray.length;++Se)X[ye]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Se,16),$.draw(h,T.gl.TRIANGLES,k,mi.disabled,J,pe,X,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,h.transform.zoom,void 0,Z)}}if(a.children)for(const j of a.children)Jp(h,t,j,d,g,y,v)}const wg=[1,-1,1];function gx(h,t,a,d){if(!a.modelManager)return!0;const g=a.modelManager;if(!a.shadowRenderer)return!0;const y=a.shadowRenderer,v=t.aabb;let T=!0,C=h.maxHeight;if(C===0){let k=0;for(const L in h.instancesPerModel){const j=g.getModel(L,d);j?k=Math.max(k,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):T=!1}C=h.maxScale*k*1.41+h.maxVerticalOffset,T&&(h.maxHeight=C)}v.max[2]=C,v.min[2]+=h.terrainElevationMin,v.max[2]+=h.terrainElevationMax,s.ad(v.min,v.min,t.tileMatrix),s.ad(v.max,v.max,t.tileMatrix);const R=v.intersects(y.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=R===2),R===0}function _x(h,t){const a=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],y=h.uniformValues.u_cutoff_params[3];return d===a||y===g?1:s.ay(((t-a)/(d-a)-g)/(y-g),0,1)}function _u(h,t,a,d){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();s.az(g,g,h);const y=s.ej(a.min[0],a.min[1],a.min[2],1);let v=s.aA(s.ek(),y,g),T=v,C=v;y[1]=a.max[1],v=s.aA(s.ek(),y,g),T=v[1]<T[1]?v:T,C=v[1]>C[1]?v:C,y[0]=a.max[0],v=s.aA(s.ek(),y,g),T=v[1]<T[1]?v:T,C=v[1]>C[1]?v:C,y[1]=a.min[1],v=s.aA(s.ek(),y,g),T=v[1]<T[1]?v:T,C=v[1]>C[1]?v:C;const R=s.ay(d[0],0,1),k=100*t.pixelsPerMeter*s.ay(d[1],0,1),L=s.ay(d[2],0,1),j=s.el(s.ek(),T,C,R),F=Math.tan(.5*t.fovX),Z=-j[2]*F;if(k===0)return j[1]<-Math.abs(Z)?L:1;const $=(-Math.abs(Z)-j[1])/k,X=(te,pe,ye)=>(1-ye)*te+ye*pe,J=s.ay(X(1,L,$),L,1);return X(1,J,s.ay((t.pitch-20)/20,0,1))}class Nw{}class jw{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,d){{const L=this._storage.get(a.id);if(L)return L.lastUsedFrameIdx=t,L.buf}const g=d.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),v=new ArrayBuffer(y),T=new Int16Array(v);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const C=new s.en;for(let L=0;L<y/2;L+=3){const j=T[L],F=T[L+1],Z=T[L+2];C.emplaceBack(j,F),C.emplaceBack(F,Z),C.emplaceBack(Z,j)}const R=d.bindVertexArrayOES.current,k=new Nw;return k.buf=new jo(d,C),k.lastUsedFrameIdx=t,this._storage.set(a.id,k),d.bindVertexArrayOES.set(R),k.buf}update(t){for(const[a,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class yx{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ef=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class bg{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Sg{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const xx=s.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class tf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new s.eo,T=new s.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),T.emplaceBack(0,1,2),T.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,xx.members),this.vignetteIdx=t.context.createIndexBuffer(T)}const g=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const v={u_vignetteShape:(y={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Mt.disabled,mi.disabled,zi.alphaBlended,ri.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,g)}var y}}class od{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const d=t.getFreeCameraOptions().position,g=d.toAltitude(),y=d.toLngLat(),v=s.al(y.lng),T=s.al(y.lat),C=t.pixelsPerMeter/a,R=v*s.eq,k=s.eq*Math.log(Math.tan(Math.PI/4+T/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const L=-this._offsetYPrev+k,j=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*C,this._accumulatedOffsetY+=L*C,this._accumulatedElevation+=j*C,this._offsetXPrev=R,this._offsetYPrev=k,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Sc(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function Tg(h){const t=s.e7(1323123451230),a=[];for(let d=0;d<h;++d){const g=2*t()-1,y=2*t()-1,v=2*t()-1;a.push(s.cS(g,y,v))}return a}function Il(h,t,a,d,g){const y=s.ay((g-a)/(d-a),0,1);return(1-y)*h+y*t}class Ss{constructor(t){this._movement=new od,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new tf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const g=d.starsProjMatrix,y=s.b_([]);s.c0(y,y,s.al(90)-d._pitch),s.b$(y,y,-d.angle);const v=s.c3(new Float32Array(16),y),T=s.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=s.ee([],T),R=s.az([],C,v),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*a,this._prevTime=k,{projectionMatrix:g,modelviewMatrix:R}}}class zw extends Ss{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Sg(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=Tg(this.particlesCount),g=new s.er,y=new s.a_;let v=0;const T=s.e7(1323123451230);for(let C=0;C<d.length;++C){const R=d[C],k=[2*T()-1,T(),T(),T()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...k),g.emplaceBack(R[0],R[1],R[2],1,-1,...k),g.emplaceBack(R[0],R[1],R[2],1,1,...k),g.emplaceBack(R[0],R[1],R[2],-1,1,...k),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=a.createVertexBuffer(g,ef.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(a.revealStart>d)return;const g=Il(0,1,a.revealStart,a.revealStart+a.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let v=[-y.direction.x,y.direction.y,-100];s.au(v,v);const T=structuredClone(this._vignetteParams);T.strength*=g,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,T.strength=1,T.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,y.timeFactor),R=t.context,k=R.gl,L=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(R,{width:t.width,height:t.height,data:null},k.RGBA8)),y.distortionStrength>0&&(R.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const j=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(R,j),R.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const F=[y.color.r,y.color.g,y.color.b,y.color.a],Z=($,X)=>{const J=Sc(this._movement.getPosition(),$),te=y.dropletSizeX,pe=y.dropletSizeX*y.dropletSizeYScale,ye=t.width/2,Se=t.height/2,be=Il(0,y.screenThinning.start,0,1,y.screenThinning.intensity),we=Il(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),xe=Il(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),Te=(Ce={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:$,rainDropletSize:[te,pe],distortionStrength:y.distortionStrength,rainDirection:v,color:F,screenSize:[L.width,L.height],thinningCenterPos:[ye,Se],thinningShape:[be,we,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:xe,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const Le=Math.round(y.intensity*this.particlesCount),Fe=s.bd.simpleSegment(0,0,4*Le,2*Le);j.draw(t,k.TRIANGLES,Mt.disabled,mi.disabled,zi.alphaBlended,ri.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Fe)};y.distortionStrength>0&&Z(y.boxSize,!0),Z(y.boxSize,!1),this._vignette.draw(t,T)}}const ad=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Jr extends Ss{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Sg(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=Tg(this.particlesCount),g=new s.es,y=new s.a_;let v=0;const T=s.e7(1323123451230);for(let C=0;C<d.length;++C){const R=d[C],k=T(),L=T(),j=T(),F=[C/d.length,k,L,j],Z=[T(),T()];g.emplaceBack(R[0],R[1],R[2],-1,-1,...F,...Z),g.emplaceBack(R[0],R[1],R[2],1,-1,...F,...Z),g.emplaceBack(R[0],R[1],R[2],1,1,...F,...Z),g.emplaceBack(R[0],R[1],R[2],-1,1,...F,...Z),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=a.createVertexBuffer(g,ad.members),this.particlesIdx=a.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let d=[-a.direction.x,a.direction.y,-100];s.au(d,d);const g=structuredClone(this._vignetteParams),y=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(y.revealStart>v)return;const T=Il(0,1,y.revealStart,y.revealStart+y.revealRange,v);g.strength*=T,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=t.context,k=R.gl,L=t.transform,j=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(R,j),((F,Z,$)=>{const X=Sc(this._movement.getPosition(),F),J=L.width/2,te=L.height/2,pe=Il(0,$.screenThinning.start,0,1,$.screenThinning.intensity),ye=Il(.001,$.screenThinning.range,0,1,$.screenThinning.intensity),Se=Il(0,$.screenThinning.particleOffset,0,1,$.screenThinning.intensity),be=(we={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:$.velocityConeAperture,velocity:$.velocity,horizontalOscillationRadius:$.horizontalOscillationRadius,horizontalOscillationRate:$.horizontalOscillationRate,boxSize:F,billboardSize:1*$.billboardSize,simpleShapeParameters:[$.shapeFadeStart,$.shapeFadePower],screenSize:[L.width,L.height],thinningCenterPos:[J,te],thinningShape:[pe,ye,Math.pow(10,$.screenThinning.fadePower)],thinningAffectedRatio:$.screenThinning.affectedRatio,thinningParticleOffset:Se,color:[$.color.r,$.color.g,$.color.b,$.color.a],direction:d},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_horizontalOscillationRadius:we.horizontalOscillationRadius,u_horizontalOscillationRate:we.horizontalOscillationRate,u_boxSize:we.boxSize,u_billboardSize:we.billboardSize,u_simpleShapeParameters:we.simpleShapeParameters,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_particleColor:we.color,u_direction:we.direction});var we;const xe=Math.round($.intensity*this.particlesCount),Te=s.bd.simpleSegment(0,0,4*xe,2*xe);this.particlesVx&&this.particlesIdx&&j.draw(t,k.TRIANGLES,Mt.disabled,mi.disabled,zi.alphaBlended,ri.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(a.boxSize,0,a),this._vignette.draw(t,g)}}const er={symbol:function(h,t,a,d,g){if(h.renderPass!=="translucent")return;const y=mi.disabled,v=h.colorModeForRenderPass(),T=a.layout.get("text-variable-anchor"),C=a.layout.get("text-size-scale-range"),R=s.ay(h.scaleFactor,C[0],C[1]);T&&function(j,F,Z,$,X,J,te,pe){const ye=F.transform,Se=X==="map",be=J==="map";for(const we of j){const xe=$.getTile(we),Te=xe.getBucket(Z);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const Ce=s.bH(Te.textSizeData,ye.zoom,pe),Le=Sp(we,Te.getProjection(),ye),Fe=ye.calculatePixelsToTileUnitsMatrix(xe),Ke=Oa(Le,xe.tileID.canonical,be,Se,ye,Te.getProjection(),Fe),Qe=Te.hasIconTextFit()&&Te.hasIconData();Ce&&ax(Te,Se,be,te,ye,Ke,we,Math.pow(2,ye.zoom-xe.tileID.overscaledZ),Ce,Qe)}}(d,h,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g,R);const k=a.paint.get("icon-opacity").constantOr(1)!==0,L=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||L)?pu(h,t,a,d,y,v):(k&&pu(h,t,a,d,y,v,{onlyIcons:!0}),L&&pu(h,t,a,d,y,v,{onlyText:!0})),t.map.showCollisionBoxes&&(Zp(h,t,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Zp(h,t,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,a,d){if(h.renderPass!=="translucent")return;const g=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),v=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0,C=a.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||v.constantOr(1)===0))return;const R=h.context,k=R.gl,L=h.transform,j=!(!h.terrain||!h.terrain.enabled),F=a.layout.get("circle-elevation-reference"),Z=h.depthModeForSublayer(0,Mt.ReadOnly),$=new Mt(h.context.gl.LEQUAL,Mt.ReadOnly,h.depthRangeFor3D),X=F==="none"||j?Z:$,J=mi.disabled,te=h.colorModeForDrapableLayerRenderPass(C),pe=L.projection.name==="globe",ye=[s.aD(L.center.lng),s.aH(L.center.lat)],Se=[];for(let we=0;we<d.length;we++){const xe=d[we],Te=t.getTile(xe),Ce=Te.getBucket(a);if(!Ce||Ce.projection.name!==L.projection.name)continue;const Le=Ce.programConfigurations.get(a.id),Fe=Ce.layoutVertexBuffer,Ke=Ce.globeExtVertexBuffer,Qe=Ce.indexBuffer,at=s.dK(a),je=[Ke],qe=h.isTileAffectedByFog(xe);pe&&at.push("PROJECTION_GLOBE_VIEW"),at.push("DEPTH_D24"),h.terrain&&L.depthOcclusionForSymbolsAndCircles&&at.push("DEPTH_OCCLUSION"),Ce.hasElevation&&(at.push("ELEVATED_ROADS"),je.push(Ce.elevatedLayoutVertexBuffer));const Re=h.getOrCreateProgram("circle",{config:Le,defines:at,overrideFog:qe}),et=L.projection.createInversionMatrix(L,xe.canonical),Ue={programConfiguration:Le,program:Re,layoutVertexBuffer:Fe,dynamicBuffers:je,indexBuffer:Qe,uniformValues:s.dL(h,xe,Te,et,ye,a),tile:Te};if(T){const nt=Ce.segments.get();for(const xt of nt)Se.push({segments:new s.bd([xt]),sortKey:xt.sortKey,state:Ue})}else Se.push({segments:Ce.segments,sortKey:0,state:Ue})}T&&Se.sort((we,xe)=>we.sortKey-xe.sortKey);const be={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(const we of Se){const{programConfiguration:xe,program:Te,layoutVertexBuffer:Ce,dynamicBuffers:Le,indexBuffer:Fe,uniformValues:Ke,tile:Qe}=we.state,at=we.segments;h.terrain&&h.terrain.setupElevationDraw(Qe,Te,be),h.uploadCommonUniforms(R,Te,Qe.tileID.toUnwrapped()),Te.draw(h,k.TRIANGLES,X,J,te,ri.disabled,Ke,a.id,Ce,Fe,at,a.paint,L.zoom,xe,Le)}},heatmap:function(h,t,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,y=g.gl,v=mi.disabled,T=new zi([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(F,Z,$,X){const J=F.gl,te=Z.width*X,pe=Z.height*X;F.activeTexture.set(J.TEXTURE1),F.viewport.set([0,0,te,pe]);let ye=$.heatmapFbo;if(!ye||ye&&(ye.width!==te||ye.height!==pe)){ye&&ye.destroy();const Se=J.createTexture();J.bindTexture(J.TEXTURE_2D,Se),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),ye=$.heatmapFbo=F.createFramebuffer(te,pe,!0,null),function(be,we,xe,Te,Ce,Le){const Fe=be.gl;Fe.texImage2D(Fe.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Fe.RGBA16F:Fe.RGBA,Ce,Le,0,Fe.RGBA,be.extRenderToTextureHalfFloat?Fe.HALF_FLOAT:Fe.UNSIGNED_BYTE,null),Te.colorAttachment.set(xe)}(F,0,Se,ye,te,pe)}else J.bindTexture(J.TEXTURE_2D,ye.colorAttachment.get()),F.bindFramebuffer.set(ye.framebuffer)})(g,h,a,h.transform.projection.name==="globe"?.5:.25),g.clear({color:s.am.transparent});const C=h.transform,R=C.projection.name==="globe",k=R?["PROJECTION_GLOBE_VIEW"]:[],L=R?ri.frontCCW:ri.disabled,j=[s.aD(C.center.lng),s.aH(C.center.lat)];for(let F=0;F<d.length;F++){const Z=d[F];if(t.hasRenderableParent(Z))continue;const $=t.getTile(Z),X=$.getBucket(a);if(!X||X.projection.name!==C.projection.name)continue;const J=h.isTileAffectedByFog(Z),te=X.programConfigurations.get(a.id),pe=h.getOrCreateProgram("heatmap",{config:te,defines:k,overrideFog:J}),{zoom:ye}=h.transform;h.terrain&&h.terrain.setupElevationDraw($,pe),h.uploadCommonUniforms(g,pe,Z.toUnwrapped());const Se=C.projection.createInversionMatrix(C,Z.canonical);pe.draw(h,y.TRIANGLES,Mt.disabled,v,T,L,ix(h,Z,$,Se,j,ye,a.paint.get("heatmap-intensity")),a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,h.transform.zoom,te,R?[X.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,y){const v=g.context,T=v.gl,C=y.heatmapFbo;if(!C)return;v.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),v.activeTexture.set(T.TEXTURE1);let R=y.colorRampTexture;R||(R=y.colorRampTexture=new s.T(v,y.colorRamp,T.RGBA8)),R.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,Mt.disabled,mi.disabled,g.colorModeForRenderPass(),ri.disabled,((k,L,j,F)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(h,a))},line:function(h,t,a,d){if(h.renderPass!=="translucent")return;const g=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const v=a.paint.get("line-emissive-strength"),T=a.paint.get("line-occlusion-opacity"),C=a.layout.get("line-elevation-reference"),R=a.layout.get("line-width-unit")==="meters",k=C==="sea",L=!(!h.terrain||!h.terrain.enabled),j=h.context,F=j.gl;if(a.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const Z=a.layout.get("line-cross-slope"),$=Z!==void 0,X=Z<1,J=h.colorModeForDrapableLayerRenderPass(v),te=h.terrain&&h.terrain.renderingToTexture,pe=te?1:s.q.devicePixelRatio,ye=a.paint.get("line-dasharray"),Se=ye.constantOr(1),be=a.layout.get("line-cap"),we=ye.constantOr(null),xe=be.constantOr(null),Te=a.paint.get("line-pattern"),Ce=Te.constantOr(1),Le=a.paint.get("line-pattern-cross-fade"),Fe=Te.constantOr(null),Ke=a.paint.get("line-opacity").constantOr(1);let Qe=!Ce&&Ke!==1||h.depthOcclusion&&T>0&&T<1;const at=a.paint.get("line-gradient"),je=Ce?"linePattern":"line",qe=s.dM(a);let Re;if(te&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Qe=!1),T!==0&&h.depthOcclusion){const xt=a.paint._values["line-opacity"];xt&&xt.value&&xt.value.kind==="constant"?Re=xt.value:s.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const et=(xt,Je,_t,kt,Dt,Pt)=>{for(const Ut of xt){const qt=t.getTile(Ut);if(Ce&&!qt.patternsLoaded())continue;const Kt=qt.getBucket(a);if(!Kt||Kt.elevationType!=="none"&&!Dt||Kt.elevationType==="none"&&Dt)continue;h.prepareDrawTile();const pi=[...Je],Ai=h.shadowRenderer,mr=Kt.elevationType==="road"&&!!Ai&&Ai.enabled;let zr=[0,0,0];if(mr){const Xi=h.style.directionalLight,Tn=h.style.ambientLight;Xi&&Tn&&(zr=dc(h.style,Xi,Tn)),pi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const xr=Kt.programConfigurations.get(a.id);let Sr=!1;if(Fe&&qt.imageAtlas){const Xi=s.dN.from(Fe),Tn=Xi.getPrimary().scaleSelf(pe).toString(),$r=qt.imageAtlas.patternPositions.get(Tn),Mr=Xi.getSecondary(),qr=Mr?qt.imageAtlas.patternPositions.get(Mr.scaleSelf(pe).toString()):null;Sr=!!$r&&!!qr,$r&&xr.setConstantPatternPositions($r,qr)}Le>0&&(Sr||xr.getPatternTransitionVertexBuffer("line-pattern"))&&pi.push("LINE_PATTERN_TRANSITION");const xn=h.isTileAffectedByFog(Ut),wi=h.getOrCreateProgram(je,{config:xr,defines:pi,overrideFog:xn,overrideRtt:!Dt&&void 0});if(!Ce&&we&&xe&&qt.lineAtlas){const Xi=qt.lineAtlas.getDash(we,xe);Xi&&xr.setConstantPatternPositions(Xi)}mr&&Ai.setupShadows(qt.tileID.toUnwrapped(),wi,"vector-tile",qt.tileID.overscaledZ);let[Ri,Bi]=a.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&Ri!==Bi&&(Ri===0&&(Ri-=1),Bi===1&&(Bi+=1));const Gr=te?Ut.projMatrix:null,An=R?1/Kt.tileToMeter/s.aw(qt,1,h.transform.zoom):1,Lr=R?1/Kt.tileToMeter/s.aw(qt,1,Math.floor(h.transform.zoom)):1,or=Ce?s.dO(h,qt,a,Gr,pe,An,Lr,[Ri,Bi],zr,Le):s.dP(h,qt,a,Gr,Kt.lineClipsArray.length,pe,An,Lr,[Ri,Bi],zr);if(at){const Xi=Kt.gradients[a.id];let Tn=Xi.texture;if(a.gradientVersion!==Xi.version){let $r=256;if(a.stepInterpolant){const Mr=t.getSource().maxzoom,qr=Ut.canonical.z===Mr?Math.ceil(1<<h.transform.maxZoom-Ut.canonical.z):1;$r=s.ay(s.dQ(Kt.maxLineLength/s.aj*1024*qr),256,j.maxTextureSize)}Xi.gradient=s.dR({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:$r,image:Xi.gradient||void 0,clips:Kt.lineClipsArray}),Xi.texture?Xi.texture.update(Xi.gradient):Xi.texture=new s.T(j,Xi.gradient,F.RGBA8),Xi.version=a.gradientVersion,Tn=Xi.texture}j.activeTexture.set(F.TEXTURE1),Tn.bind(a.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}Se&&(j.activeTexture.set(F.TEXTURE0),qt.lineAtlasTexture&&qt.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),xr.updatePaintBuffers()),Ce&&(j.activeTexture.set(F.TEXTURE0),qt.imageAtlasTexture&&qt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),xr.updatePaintBuffers()),Dt&&!k&&h.terrain.setupElevationDraw(qt,wi),h.uploadCommonUniforms(j,wi,Ut.toUnwrapped());const dn=Xi=>{Re!=null&&(Re.value=Ke*T),wi.draw(h,F.TRIANGLES,_t,Xi,J,ri.disabled,or,a.id,Kt.layoutVertexBuffer,Kt.indexBuffer,Kt.segments,a.paint,h.transform.zoom,xr,[Kt.layoutVertexBuffer2,Kt.patternVertexBuffer,Kt.zOffsetVertexBuffer]),Re!=null&&(Re.value=Ke)};if(Qe&&!Dt){const Xi=h.stencilModeForClipping(Ut).ref;Xi===0&&te&&j.clear({stencil:0});const Tn={func:F.EQUAL,mask:255};or.u_alpha_discard_threshold=.8,dn(new mi(Tn,Xi,255,F.KEEP,F.KEEP,F.INVERT)),or.u_alpha_discard_threshold=0,dn(new mi(Tn,Xi,255,F.KEEP,F.KEEP,F.KEEP))}else or.u_alpha_discard_threshold=Qe&&Dt&&Pt?.8:0,dn(Dt?kt:h.stencilModeForClipping(Ut))}};let Ue=h.depthModeForSublayer(0,Mt.ReadOnly);const nt=new Mt(h.depthOcclusion?F.GREATER:F.LEQUAL,Mt.ReadOnly,h.depthRangeFor3D);if(a.hasNonElevatedBuckets){const xt=!te&&h.terrain;T!==0&&xt?s.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):xt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):et(d,qe,Ue,mi.disabled,!1,!0)}if(a.hasElevatedBuckets){C==="hd-road-markup"?L||(Ue=nt,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Ue=nt,$&&qe.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&qe.push("ELEVATION_REFERENCE_SEA"));const xt=Qe?h.stencilModeFor3D():mi.disabled;h.forceTerrainMode=!0,et(d,qe,Ue,xt,!0,!0),Qe&&et(d,qe,Ue,xt,!0,!1),h.forceTerrainMode=!1}Qe&&(h.resetStencilClippingMasks(),te&&j.clear({stencil:0})),T===0||h.depthOcclusion||te||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,a,d){const g=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const v=a.paint.get("fill-emissive-strength"),T=h.colorModeForDrapableLayerRenderPass(v),C=a.paint.get("fill-pattern"),R=h.opaquePassEnabledForLayer()&&!C.constantOr(1)&&g.constantOr(s.am.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let k="none";a.layout.get("fill-elevation-reference")!=="none"?k="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const L=!(!h.terrain||!h.terrain.enabled),j={painter:h,sourceCache:t,layer:a,coords:d,colorMode:T,elevationType:k,terrainEnabled:L,pass:R};if(h.renderPass!=="shadow")if(k!=="offset"){if(yg(j,!1),k==="road"){const F=!L&&h.renderPass==="translucent";F&&_g(h,t,a,d,"geometry"),yg(j,!0,mi.disabled),F&&function(Z){const{painter:$,sourceCache:X,layer:J,coords:te,colorMode:pe}=Z,ye=$.context.gl,Se=Z.painter.shadowRenderer,be=!!Se&&Se.enabled,we=new Mt($.context.gl.LEQUAL,Mt.ReadOnly,$.depthRangeFor3D);let xe=[0,0,0];if(be){const Ce=$.style.directionalLight,Le=$.style.ambientLight;Ce&&Le&&(xe=dc($.style,Ce,Le))}const Te=Ce=>{for(const Le of te){const Fe=X.getTile(Le),Ke=Fe.getBucket(J);if(!Ke)continue;const Qe=Ke.elevatedStructures;if(!Qe)continue;let at,je;if(Ce?(at=Qe.renderableBridgeSegments,je=Qe.bridgeProgramConfigurations.get(J.id)):(at=Qe.renderableTunnelSegments,je=Qe.tunnelProgramConfigurations.get(J.id)),!at||at.segments[0].primitiveLength===0)continue;je.updatePaintBuffers(),$.prepareDrawTile();const qe=$.isTileAffectedByFog(Le),Re=[];be&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const et=$.getOrCreateProgram("elevatedStructures",{config:je,overrideFog:qe,defines:Re}),Ue=$.translatePosMatrix(Le.projMatrix,Fe,J.paint.get("fill-translate"),J.paint.get("fill-translate-anchor"));be&&Se.setupShadows(Fe.tileID.toUnwrapped(),et,"vector-tile",Fe.tileID.overscaledZ);const nt=Sw(Ue,xe);$.uploadCommonUniforms($.context,et,Le.toUnwrapped()),et.draw($,ye.TRIANGLES,we,mi.disabled,pe,ri.backCCW,nt,J.id,Qe.vertexBuffer,Qe.indexBuffer,at,J.paint,$.transform.zoom,je,[Qe.vertexBufferNormal])}};Te(!0),Te(!1)}(j)}}else yg(j,!1,h.stencilModeFor3D());else h.shadowRenderer&&k==="road"&&!L&&function(F){const{painter:Z,sourceCache:$,layer:X,coords:J}=F,te=Z.context.gl,pe=F.painter.shadowRenderer;for(const ye of J){const Se=$.getTile(ye),be=Se.getBucket(X);if(!be)continue;const we=be.elevatedStructures;if(!we||!we.shadowCasterSegments||we.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const xe=be.bufferData.programConfigurations.get(X.id),Te=Z.isTileAffectedByFog(ye),Ce=Z.getOrCreateProgram("elevatedStructuresDepth",{config:xe,overrideFog:Te}),Le=pe.calculateShadowPassMatrixFromTile(Se.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,Ce,ye.toUnwrapped());const Fe={u_matrix:Le,u_depth_bias:.001};Ce.draw(Z,te.TRIANGLES,pe.getShadowPassDepthMode(),mi.disabled,pe.getShadowPassColorMode(),ri.disabled,Fe,X.id,we.vertexBuffer,we.indexBuffer,we.shadowCasterSegments,X.paint,Z.transform.zoom,xe)}}(j)},"fill-extrusion":function(h,t,a,d){const g=a.paint.get("fill-extrusion-opacity"),y=h.context,v=y.gl,T=h.terrain,C=T&&T.renderingToTexture;if(g===0)return;const R=h.conflationActive&&h.style.isLayerClipped(a,t.getSource()),k=h.style.order.indexOf(a.fqid);if(R&&function(L,j,F,Z,$){for(const X of Z){const J=j.getTile(X).getBucket(F);J&&(J.updateReplacement(X,L.replacementSource,$),J.uploadCentroid(L.context))}}(h,t,a,d,k),T||R)for(const L of d){const j=t.getTile(L).getBucket(a);j&&Rt(h.context,t,L,j,a,T,R)}if(h.renderPass==="shadow"&&h.shadowRenderer){const L=h.shadowRenderer;if(T&&g<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const j=L.getShadowPassDepthMode(),F=L.getShadowPassColorMode();$a(h,t,a,d,j,mi.disabled,F,R)}else if(h.renderPass==="translucent"){const L=!a.paint.get("fill-extrusion-pattern").constantOr(1),j=a.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!C&&j.a!==0){const F=new Mt(h.context.gl.LEQUAL,Mt.ReadWrite,h.depthRangeFor3D);g===1&&L?$a(h,t,a,d,F,mi.disabled,zi.unblended,R):($a(h,t,a,d,F,mi.disabled,zi.disabled,R),$a(h,t,a,d,F,h.stencilModeFor3D(),h.colorModeForRenderPass(),R),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&L&&(!T&&h.transform.projection.name!=="globe"||C)){const F=a.paint.get("fill-extrusion-opacity"),Z=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=a.paint.get("fill-extrusion-flood-light-intensity"),J=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",te=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(J?null:a.lut).toArray01().slice(0,3),pe=Z>0&&$>0,ye=X>0,Se=(we,xe,Te)=>(1-Te)*we+Te*xe,be=we=>{const xe=h.depthModeForSublayer(1,Mt.ReadOnly,v.LEQUAL,!0),Te=a.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ce=Se(.1,3,Te),Le=h._showOverdrawInspector;if(!Le){const Fe=new mi({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Ke=new zi([v.ONE,v.ONE,v.ONE,v.ONE],s.am.transparent,[!1,!1,!1,!0],v.MIN);qa(h,t,a,d,xe,Fe,Ke,ri.disabled,we,"sdf",F,Z,$,X,te,Ce,R,!1)}{const Fe=Le?mi.disabled:new mi({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Ke=Le?h.colorModeForRenderPass():new zi([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],s.am.transparent,[!0,!0,!0,!0]);qa(h,t,a,d,xe,Fe,Ke,ri.disabled,we,"color",F,Z,$,X,te,Ce,R,!1)}};if(C){const we=(xe,Te,Ce)=>{const Le=h.depthModeForSublayer(1,Mt.ReadOnly,v.LEQUAL,!1),Fe=a.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ke=Se(.1,3,Fe);{const Qe=new zi([v.ONE,v.ONE,v.ONE,v.ONE],s.am.transparent,[!1,!1,!1,!0]);qa(h,t,a,d,Le,mi.disabled,Qe,ri.disabled,xe,"clear",F,Z,$,X,te,Ke,R,Te)}{const Qe=new mi({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),at=new zi([v.ONE,v.ONE,v.ONE,v.ONE],s.am.transparent,[!1,!1,!1,!0],v.MIN);qa(h,t,a,d,Le,Qe,at,ri.disabled,xe,"sdf",F,Z,$,X,te,Ke,R,Te)}{const Qe=xe?v.ZERO:v.ONE_MINUS_DST_ALPHA,at=new mi({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),je=new zi([Qe,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],s.am.transparent,[!0,!0,!0,!0]);qa(h,t,a,d,Le,at,je,ri.disabled,xe,"color",F,Z,$,X,te,Ke,R,Te)}{const Qe=new zi([v.ONE,v.ONE,v.ONE,xe?v.ZERO:v.ONE],s.am.transparent,[!1,!1,!1,!0],xe?v.FUNC_ADD:v.MAX);qa(h,t,a,d,Le,mi.disabled,Qe,ri.disabled,xe,"clear",F,Z,$,X,te,Ke,R,Te,Ce)}};if(pe||ye){let xe;if(h.prepareDrawTile(),T){const Te=T.drapeBufferSize[0],Ce=T.drapeBufferSize[1];xe=T.framebufferCopyTexture,xe&&(!xe||xe.size[0]===Te&&xe.size[1]===Ce)||(xe&&xe.destroy(),xe=T.framebufferCopyTexture=new s.T(y,new s.r({width:Te,height:Ce}),v.RGBA8)),xe.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,Te,Ce)}pe&&we(!0,!1,xe),ye&&we(!1,!0,xe)}}else pe&&be(!0),ye&&be(!1),(pe||ye)&&h.resetStencilClippingMasks()}}},building:function(h,t,a,d){},hillshade:function(h,t,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const g=h.context,y=h.terrain&&h.terrain.renderingToTexture,[v,T]=h.renderPass!=="translucent"||y?[{},d]:h.stencilConfigForOverlap(d);for(const C of T){const R=t.getTile(C);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")hw(h,R,a);else if(h.renderPass==="translucent"){const k=h.depthModeForSublayer(0,Mt.ReadOnly),L=a.paint.get("hillshade-emissive-strength"),j=h.colorModeForDrapableLayerRenderPass(L),F=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(C):v[C.overscaledZ];uw(h,C,R,a,k,F,j)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,a,d,g,y){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const v=h.transform.projection.name==="globe",T=a.paint.get("raster-elevation")!==0,C=T&&v;if(h.renderElevatedRasterBackface&&!C)return;const R=h.context,k=R.gl,L=t.getSource(),j=function(be,we,xe,Te){const Ce=we.paint.get("raster-color"),Le=be.type==="raster-array",Fe=[],Ke=we.paint.get("raster-resampling"),Qe=we.paint.get("raster-color-mix");let at=we.paint.get("raster-color-range");const je=[Qe[0],Qe[1],Qe[2],0],qe=Qe[3];let Re=Ke==="nearest"?Te.NEAREST:Te.LINEAR;if(Le&&(Fe.push("RASTER_ARRAY"),Ce||Fe.push("RASTER_COLOR"),Ke==="linear"&&Fe.push("RASTER_ARRAY_LINEAR"),Re=Te.NEAREST,!at&&be.rasterLayers)){const et=be.rasterLayers.find(({id:Ue})=>Ue===we.sourceLayer);et&&et.fields&&et.fields.range&&(at=et.fields.range)}if(at=at||[0,1],Ce){Fe.push("RASTER_COLOR"),xe.activeTexture.set(Te.TEXTURE2),we.updateColorRamp(at);let et=we.colorRampTexture;et||(et=we.colorRampTexture=new s.T(xe,we.colorRamp,Te.RGBA8)),et.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:je,range:at,offset:qe,defines:Fe,resampling:Re}}(L,a,R,k);if(L instanceof s.aP&&!d.length&&!v)return;const F=a.paint.get("raster-emissive-strength"),Z=h.colorModeForDrapableLayerRenderPass(F),$=h.terrain&&h.terrain.renderingToTexture,X=!h.options.moving,J=a.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(L instanceof s.aP&&!d.length&&(L.onNorthPole||L.onSouthPole)){const be=T?h.stencilModeFor3D():mi.disabled;return void nd(!!L.onNorthPole,null,h,t,a,F,j,ri.disabled,be)}if(!d.length)return;const[te,pe]=L instanceof s.aP||$?[{},d]:h.stencilConfigForOverlap(d),ye=pe[pe.length-1].overscaledZ;C&&j.defines.push("PROJECTION_GLOBE_VIEW"),T&&j.defines.push("RENDER_CUTOFF");const Se=(be,we,xe)=>{for(const Te of be){const Ce=Te.toUnwrapped(),Le=t.getTile(Te);if($&&(!Le||!Le.hasData()))continue;R.activeTexture.set(k.TEXTURE0);const Fe=Pw(Le,L,a,j);if(!Fe||!Fe.texture)continue;const{texture:Ke,mix:Qe,offset:at,tileSize:je,buffer:qe}=Fe;let Re,et;$?(Re=Mt.disabled,et=Te.projMatrix):T?(Re=new Mt(k.LEQUAL,Mt.ReadWrite,h.depthRangeFor3D),et=v?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Ce,X)):(Re=h.depthModeForSublayer(Te.overscaledZ-ye,a.paint.get("raster-opacity")===1?Mt.ReadWrite:Mt.ReadOnly,k.LESS),et=h.transform.calculateProjMatrix(Ce,X));const Ue=h.terrain&&$?h.terrain.stencilModeForRTTOverlap(Te):te[Te.overscaledZ],nt=y?0:a.paint.get("raster-fade-duration");Le.registerFadeDuration(nt);const xt=t.findLoadedParent(Te,0),Je=gc(Le,xt,t,h.transform,nt);let _t,kt;h.terrain&&h.terrain.prepareDrawTile(),R.activeTexture.set(k.TEXTURE0),Ke.bind(J,k.CLAMP_TO_EDGE),R.activeTexture.set(k.TEXTURE1),xt?(xt.texture&&xt.texture.bind(J,k.CLAMP_TO_EDGE),_t=Math.pow(2,xt.tileID.overscaledZ-Le.tileID.overscaledZ),kt=[Le.tileID.canonical.x*_t%1,Le.tileID.canonical.y*_t%1]):Ke.bind(J,k.CLAMP_TO_EDGE),"useMipmap"in Ke&&R.extTextureFilterAnisotropic&&h.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Dt=h.transform;let Pt;const Ut=T?Aw(Dt):[0,0,0,0];let qt,Kt,pi,Ai,mr,zr=0;if(C&&L instanceof s.aP&&L.coordinates.length>3)qt=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0)))),Kt=Float32Array.from(Dt.globeMatrix),pi=Float32Array.from(s.dm(Dt)),Ai=[s.aD(Dt.center.lng),s.aH(Dt.center.lat)],Pt=L.elevatedGlobePerspectiveTransform,mr=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const wi=s.dn(Te.canonical);zr=s.dp(wi.getCenter().lat),qt=Float32Array.from(s.bh(s.dr(Te.canonical))),Kt=Float32Array.from(Dt.globeMatrix),pi=Float32Array.from(s.dm(Dt)),Ai=[s.aD(Dt.center.lng),s.aH(Dt.center.lat)],Pt=[0,0],mr=Float32Array.from(s.dq(Te.canonical,wi,zr,Dt.worldSize/Dt._pixelsPerMercatorPixel))}else Pt=L instanceof s.aP?L.perspectiveTransform:[0,0],qt=new Float32Array(16),Kt=new Float32Array(9),pi=new Float32Array(16),Ai=[0,0],mr=new Float32Array(9);const xr=pg(et,qt,Kt,pi,mr,kt||[0,0],s.ah(h.transform.zoom),Ai,Ut,_t||1,Je,a,Pt,T?a.paint.get("raster-elevation"):0,2,Qe,at,j.range,je,qe,F),Sr=h.isTileAffectedByFog(Te),xn=h.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Sr});if(h.uploadCommonUniforms(R,xn,Ce),L instanceof s.aP){const wi=L.elevatedGlobeVertexBuffer,Ri=L.elevatedGlobeIndexBuffer;if($||!v)L.boundsBuffer&&L.boundsSegments&&xn.draw(h,k.TRIANGLES,Re,mi.disabled,Z,ri.disabled,xr,a.id,L.boundsBuffer,h.quadTriangleIndexBuffer,L.boundsSegments);else if(wi&&Ri){const Bi=Dt.zoom<=s.cL?L.elevatedGlobeSegments:L.getSegmentsForLongitude(Dt.center.lng);Bi&&xn.draw(h,k.TRIANGLES,Re,mi.disabled,Z,we,xr,a.id,wi,Ri,Bi)}}else if(C){Re=new Mt(k.LEQUAL,Mt.ReadOnly,h.depthRangeFor3D);const wi=h.globeSharedBuffers;if(wi){const[Ri,Bi,Gr]=wi.getGridBuffers(zr,!1);xn.draw(h,k.TRIANGLES,Re,xe||Ue,h.colorModeForRenderPass(),we,xr,a.id,Ri,Bi,Gr)}}else{const{tileBoundsBuffer:wi,tileBoundsIndexBuffer:Ri,tileBoundsSegments:Bi}=h.getTileBoundsBuffers(Le);xn.draw(h,k.TRIANGLES,Re,Ue,Z,ri.disabled,xr,a.id,wi,Ri,Bi)}}if(!(L instanceof s.aP)&&C)for(const Te of be){const Ce=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&nd(!0,Te,h,t,a,F,j,we,xe||mi.disabled),Ce&&nd(!1,Te,h,t,a,F,j,we===ri.frontCW?ri.backCW:ri.frontCW,xe||mi.disabled)}};C?Se(pe,h.renderElevatedRasterBackface?ri.backCW:ri.frontCW,h.stencilModeFor3D()):Se(pe,ri.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,a,d,g,y){h.renderPass==="offscreen"&&function(v,T,C,R){if(!R.length)return;const k=v.context,L=k.gl,j=T.getSource();if(!(j instanceof ml))return;const F=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let Z=C.particlePositionRGBAImage;if(!Z||Z.width!==F){const pe=function(ye){const Se=ye*ye,be=new Uint8Array(4*Se),we=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},xe=1/1.1;for(let Te=0;Te<Se;Te++){const Ce=xe*(we(2*Te+0)+bl),Le=xe*(we(2*Te+1)+bl),Fe=255*Ce%1,Ke=255*Le%1,Qe=Fe,at=Le-Ke/255,je=Ke;be[4*Te+0]=255*(Ce-Fe/255),be[4*Te+1]=255*Qe,be[4*Te+2]=255*at,be[4*Te+3]=255*je}return be}(F);Z=C.particlePositionRGBAImage=new s.r({width:F,height:F},pe)}let $=C.particleFramebuffer;$?$.width!==F&&($.destroy(),$=C.particleFramebuffer=k.createFramebuffer(F,F,!0,null)):$=C.particleFramebuffer=k.createFramebuffer(F,F,!0,null);const X=[];for(const pe of R){const ye=T.getTile(pe);if(!(ye instanceof Wc))continue;const Se=Mw(ye,j,C);if(!Se)continue;const be=[ye.tileSize,ye.tileSize];let we=C.tileFramebuffer;we||(we=C.tileFramebuffer=k.createFramebuffer(be[0],be[1],!0,null));let xe=ye.rasterParticleState;xe||(xe=ye.rasterParticleState=new ux(k,pe,be,Z));const Te=xe.update(C.lastInvalidatedAt);xe.particleTextureDimension!==F&&xe.updateParticleTexture(pe,Z);const Ce=xe.targetColorTexture;xe.targetColorTexture=xe.backgroundColorTexture,xe.backgroundColorTexture=Ce;const Le=xe.particleTexture0;xe.particleTexture0=xe.particleTexture1,xe.particleTexture1=Le,X.push([pe,Se,xe,Te])}if(X.length===0)return;const J=s.q.now(),te=C.previousDrawTimestamp?.001*(J-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=J,C.hasColorMap()){k.activeTexture.set(L.TEXTURE0+2);let pe=C.colorRampTexture;pe||(pe=C.colorRampTexture=new s.T(k,C.colorRamp,L.RGBA8)),pe.bind(L.LINEAR,L.CLAMP_TO_EDGE)}k.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(pe,ye,Se){const be=pe.context,we=be.gl,xe=ye.tileFramebuffer;be.activeTexture.set(we.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Le=ye.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},Ce=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const Fe of Se){const[,,Ke,Qe]=Fe;xe.colorAttachment.set(Ke.targetColorTexture.texture),be.viewport.set([0,0,xe.width,xe.height]),be.clear({color:s.am.transparent}),Qe&&(Ke.backgroundColorTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE),Ce.draw(pe,we.TRIANGLES,Mt.disabled,mi.disabled,zi.alphaBlended,ri.disabled,Te,ye.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(v,C,X),function(pe,ye,Se,be){const we=pe.context,xe=we.gl,Te=Se.tileFramebuffer,Ce=pe.transform.projection.name==="globe",Le=Se.paint.get("raster-particle-max-speed");for(const Fe of be){const[Ke,Qe,at]=Fe;we.activeTexture.set(xe.TEXTURE0+0),Qe.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Te.colorAttachment.set(at.targetColorTexture.texture);const je=pe.getOrCreateProgram("rasterParticleDraw",{defines:Qe.defines,overrideFog:!1});we.activeTexture.set(xe.TEXTURE0+1);const qe=Qe.scalarData?[]:[0,1,2,3].map(Ue=>s.dT[Ue](Ke));qe.push(Ke);const Re=Ke.canonical.x,et=Ke.canonical.y;for(const Ue of qe){const nt=ye.getTile(Ce?Ue.wrapped():Ue);if(!nt)continue;const xt=nt.rasterParticleState;if(!xt)continue;const Je=Ue.canonical.x+(1<<Ue.canonical.z)*(Ue.wrap-Ke.wrap),_t=Ue.canonical.y;xt.particleTexture0.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const kt=nx(1,xt.particleTexture0.size[0],[Je-Re,_t-et],0,Qe.texture.size,2,Le,Qe.textureOffset,Qe.scale,Qe.offset);je.draw(pe,xe.POINTS,Mt.disabled,mi.disabled,zi.alphaBlended,ri.disabled,kt,Se.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}}(v,T,C,X),k.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(pe,ye,Se,be){const we=pe.context,xe=we.gl,Te=ye.paint.get("raster-particle-max-speed"),Ce=be*ye.paint.get("raster-particle-speed-factor")*.15,Le=function(Ke){return Math.pow(Ke,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Fe=ye.particleFramebuffer;we.viewport.set([0,0,Fe.width,Fe.height]);for(const Ke of Se){const[,Qe,at]=Ke;we.activeTexture.set(xe.TEXTURE0+0),Qe.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),we.activeTexture.set(xe.TEXTURE0+1);const je=at.particleTexture0;je.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const qe=Sl(1,je.size[0],0,Qe.texture.size,Te,Ce,Le,Qe.textureOffset,Qe.scale,Qe.offset);Fe.colorAttachment.set(at.particleTexture1.texture),we.clear({color:s.am.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:Qe.defines}).draw(pe,xe.TRIANGLES,Mt.disabled,mi.disabled,zi.unblended,ri.disabled,qe,ye.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(v,C,X,te)}(h,t,a,d),h.renderPass==="translucent"&&(function(v,T,C,R,k){const L=v.context,j=L.gl,F=T.getSource().tileSize,Z=5*(1-s.af(s.cx,s.cx+1,v.transform.zoom))*F+C.paint.get("raster-particle-elevation"),$=!v.options.moving,X=v.transform.projection.name==="globe";if(!R.length)return;const[J,te]=v.stencilConfigForOverlap(R),pe=[];X&&pe.push("PROJECTION_GLOBE_VIEW");const ye=v.stencilModeFor3D();for(const Se of te){const be=Se.toUnwrapped(),we=T.getTile(Se);if(!we.rasterParticleState)continue;const xe=we.rasterParticleState,Te=100;we.registerFadeDuration(Te);const Ce=T.findLoadedParent(Se,0),Le=gc(we,Ce,T,v.transform,Te);let Fe,Ke;v.terrain&&v.terrain.prepareDrawTile(),L.activeTexture.set(j.TEXTURE0),xe.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),L.activeTexture.set(j.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Fe=Math.pow(2,Ce.tileID.overscaledZ-we.tileID.overscaledZ),Ke=[we.tileID.canonical.x*Fe%1,we.tileID.canonical.y*Fe%1]):xe.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Qe=X?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(be,$),at=v.transform,je=hx(at),qe=s.dn(Se.canonical),Re=s.dp(qe.getCenter().lat);let et,Ue,nt,xt,Je;X?(et=Float32Array.from(s.bh(s.dr(Se.canonical))),Ue=Float32Array.from(at.globeMatrix),nt=Float32Array.from(s.dm(at)),xt=[s.aD(at.center.lng),s.aH(at.center.lat)],Je=Float32Array.from(s.dq(Se.canonical,qe,Re,at.worldSize/at._pixelsPerMercatorPixel))):(et=new Float32Array(16),Ue=new Float32Array(9),nt=new Float32Array(16),xt=[0,0],Je=new Float32Array(9));const _t=xc(Qe,et,Ue,nt,Je,Ke||[0,0],s.ah(v.transform.zoom),xt,je,Fe||1,Le,Z),kt=v.isTileAffectedByFog(Se),Dt=v.getOrCreateProgram("rasterParticle",{defines:pe,overrideFog:kt});if(v.uploadCommonUniforms(L,Dt,be),X){const Pt=new Mt(j.LEQUAL,Mt.ReadOnly,v.depthRangeFor3D),Ut=0,qt=v.globeSharedBuffers;if(qt){const[Kt,pi,Ai]=qt.getGridBuffers(Re,Ut!==0);Dt.draw(v,j.TRIANGLES,Pt,ye,zi.alphaBlended,v.renderElevatedRasterBackface?ri.frontCCW:ri.backCCW,_t,C.id,Kt,pi,Ai)}}else{const Pt=v.depthModeForSublayer(0,Mt.ReadOnly),Ut=J[Se.overscaledZ],{tileBoundsBuffer:qt,tileBoundsIndexBuffer:Kt,tileBoundsSegments:pi}=v.getTileBoundsBuffers(we);Dt.draw(v,j.TRIANGLES,Pt,Ut,zi.alphaBlended,ri.disabled,_t,C.id,qt,Kt,pi)}}v.resetStencilClippingMasks()}(h,t,a,d),h.style.map.triggerRepaint())},background:function(h,t,a,d){const g=a.paint.get("background-color"),y=a.paint.get("background-color-use-theme").constantOr("default")==="none",v=a.paint.get("background-opacity"),T=a.paint.get("background-emissive-strength"),C=a.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const R=h.context,k=R.gl,L=h.transform,j=L.tileSize,F=a.paint.get("background-pattern");let Z;if(F!==void 0&&(F===null||(Z=h.imageManager.getPattern(s.I.from(F.toString()),a.scope,h.style.getLut(a.scope)),!Z)))return;const $=!F&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==$)return;const X=mi.disabled,J=h.depthModeForSublayer(0,$==="opaque"?Mt.ReadWrite:Mt.ReadOnly),te=h.colorModeForDrapableLayerRenderPass(T),pe=F?"backgroundPattern":"background";let ye,Se=d;if(Se||(ye=h.getBackgroundTiles(),Se=Object.values(ye).map(be=>be.tileID)),F&&(R.activeTexture.set(k.TEXTURE0),h.imageManager.bind(h.context,a.scope)),C){const be=h.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0}),we=new Float32Array(s.bx([])),xe=new s.aM(0,0,0,0,0),Te=F?mg(we,T,v,h,0,a.scope,Z,C,{tileID:xe,tileSize:j}):fg(we,T,v,g.toPremultipliedRenderColor(y?null:a.lut));be.draw(h,k.TRIANGLES,J,X,te,ri.disabled,Te,a.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const be of Se){const we=h.isTileAffectedByFog(be),xe=h.getOrCreateProgram(pe,{overrideFog:we}),Te=be.toUnwrapped(),Ce=d?be.projMatrix:h.transform.calculateProjMatrix(Te);h.prepareDrawTile();const Le=t?t.getTile(be):ye?ye[be.key]:new rc(be,j,L.zoom,h),Fe=F?mg(Ce,T,v,h,0,a.scope,Z,C,{tileID:be,tileSize:j}):fg(Ce,T,v,g.toPremultipliedRenderColor(y?null:a.lut));h.uploadCommonUniforms(R,xe,Te);const{tileBoundsBuffer:Ke,tileBoundsIndexBuffer:Qe,tileBoundsSegments:at}=h.getTileBoundsBuffers(Le);xe.draw(h,k.TRIANGLES,J,X,te,ri.disabled,Fe,a.id,Ke,Qe,at)}},sky:function(h,t,a){const d=h._atmosphere?s.ah(h.transform.zoom):1,g=a.paint.get("sky-opacity")*d;if(g===0)return;const y=h.context,v=a.paint.get("sky-type"),T=new Mt(y.gl.LEQUAL,Mt.ReadOnly,[0,1]),C=h.frameCounter/1e3%1;v==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(R,k,L,j){const F=R.context,Z=F.gl;let $=k.skyboxFbo;if(!$){$=k.skyboxFbo=F.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new sd(F),k.skyboxTexture=F.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,k.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let pe=0;pe<6;++pe)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}F.bindFramebuffer.set($.framebuffer),F.viewport.set([0,0,32,32]);const X=k.getCenter(R,!0),J=R.getOrCreateProgram("skyboxCapture"),te=new Float64Array(16);s.bx(te),s.e3(te,te,.5*-Math.PI),Cl(R,k,J,te,X,0),s.bx(te),s.e3(te,te,.5*Math.PI),Cl(R,k,J,te,X,1),s.bx(te),s.cG(te,te,.5*-Math.PI),Cl(R,k,J,te,X,2),s.bx(te),s.cG(te,te,.5*Math.PI),Cl(R,k,J,te,X,3),s.bx(te),Cl(R,k,J,te,X,4),s.bx(te),s.e3(te,te,Math.PI),Cl(R,k,J,te,X,5),F.viewport.set([0,0,R.width,R.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(R,k,L,j,F){const Z=R.context,$=Z.gl,X=R.transform,J=R.getOrCreateProgram("skybox");Z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,k.skyboxTexture);const te=((pe,ye,Se,be,we)=>({u_matrix:pe,u_sun_direction:ye,u_cubemap:0,u_opacity:be,u_temporal_offset:we}))(X.skyboxMatrix,k.getCenter(R,!1),0,j,F);R.uploadCommonUniforms(Z,J),J.draw(R,$.TRIANGLES,L,mi.disabled,R.colorModeForRenderPass(),ri.backCW,te,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,a,T,g,C):v==="gradient"&&h.renderPass==="sky"&&function(R,k,L,j,F){const Z=R.context,$=Z.gl,X=R.transform,J=R.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new sd(Z)),Z.activeTexture.set($.TEXTURE0);let te=k.colorRampTexture;te||(te=k.colorRampTexture=new s.T(Z,k.colorRamp,$.RGBA8)),te.bind($.LINEAR,$.CLAMP_TO_EDGE);const pe=((ye,Se,be,we,xe)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Se,u_radius:s.al(be),u_opacity:we,u_temporal_offset:xe}))(X.skyboxMatrix,k.getCenter(R,!1),k.paint.get("sky-gradient-radius"),j,F);R.uploadCommonUniforms(Z,J),J.draw(R,$.TRIANGLES,L,mi.disabled,R.colorModeForRenderPass(),ri.backCW,pe,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,a,T,g,C)},custom:function(h,t,a,d){const g=h.context,y=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isDraped(t)){if(h.renderPass==="offscreen"){const v=y.prerender;if(v){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;v.call(y,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ah(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else v.call(y,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const T=y.renderToTile;if(T){const C=d[0].canonical,R={x:C.x+d[0].wrap*(y.wrapTileId?0:1<<C.z),y:C.y,z:C.z};g.setDepthMode(Mt.disabled),g.setStencilMode(mi.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),T.call(y,g.gl,R),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(mi.disabled);const v=y.renderingMode==="3d"?new Mt(h.context.gl.LEQUAL,Mt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Mt.ReadOnly);if(g.setDepthMode(v),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;y.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ah(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else y.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,a,d){if(h.renderPass==="opaque")return;const g=a.paint.get("model-opacity").constantOr(1);if(g===0)return;const y=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!y||h.terrain&&g<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const v=h.shadowRenderer,T=a.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,T||(v.enabled=!1));const C=()=>{v&&(v.useNormalOffset=!0,T||(v.enabled=!0))},R=t.getSource();if(h.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(J,te,pe,ye,Se){const be=J.transform;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const we=be.getFreeCameraOptions().position;if(!J.modelManager)return;const xe=J.modelManager;pe.modelManager=xe;const Te=J.shadowRenderer;if(!pe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ce=pe._unevaluatedLayout._values["model-id"],Le=Object.assign({},pe.layout.get("model-id").parameters),Fe=J.style.order.indexOf(pe.fqid);for(const Ke of ye){const Qe=te.getTile(Ke).getBucket(pe);if(!Qe||Qe.projection.name!==be.projection.name)continue;const at=Qe.getModelUris();at&&!Qe.modelsRequested&&(xe.addModelsFromBucket(at,Se),Qe.modelsRequested=!0);const je=Qp(Ke,be);Le.zoom=je;const qe=Ce.possiblyEvaluate(Le);if(ze(J,Qe,Ke),ia.shadowUniformsInitialized=!1,ia.useSingleShadowCascade=!!Te&&Te.getMaxCascadeForTile(Ke.toUnwrapped())===0,J.renderPass==="shadow"&&Te){if(J.currentShadowCascade===1&&Qe.isInsideFirstShadowMapFrustum)continue;const Ue=be.calculatePosMatrix(Ke.toUnwrapped(),be.worldSize);if(ia.tileMatrix.set(Ue),ia.shadowTileMatrix=Float32Array.from(Te.calculateShadowPassMatrixFromMatrix(Ue)),ia.aabb.min.fill(0),ia.aabb.max[0]=ia.aabb.max[1]=s.aj,ia.aabb.max[2]=0,gx(Qe,ia,J,pe.scope))continue}const Re=1<<Ke.canonical.z,et=[((we.x-Ke.wrap)*Re-Ke.canonical.x)*s.aj,(we.y*Re-Ke.canonical.y)*s.aj,we.z*Re*s.aj];J.conflationActive&&Object.keys(Qe.instancesPerModel).length>0&&J.style.isLayerClipped(pe,te.getSource())&&Qe.updateReplacement(Ke,J.replacementSource,Fe,Se)&&(Qe.uploaded=!1,Qe.upload(J.context));for(let Ue in Qe.instancesPerModel){const nt=Qe.instancesPerModel[Ue];nt.features.length>0&&(Ue=qe.evaluate(nt.features[0].feature,{}));const xt=xe.getModel(Ue,Se);if(xt||xe.hasURLBeenRequested(Ue)||Qe.modelUris.includes(Ue)||(Qe.modelUris.push(Ue),Qe.modelsRequested=!1),xt&&xt.uploaded)for(const Je of xt.nodes)Jp(J,pe,Je,nt,et,Ke,ia)}}}(h,t,a,d,R.type==="vector"?a.scope:""),void C();if(!R.loaded())return;if(R.type==="batched-model")return function(J,te,pe,ye){pe.resetLayerRenderingStats(J);const Se=J.context,be=J.transform,we=J.style.fog,xe=J.shadowRenderer;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const Te=J.transform.getFreeCameraOptions().position,Ce=s.bY([],[Te.x,Te.y,Te.z],J.transform.worldSize),Le=s.eb([],Ce),Fe=s.bx([]),Ke=s.ec(be.center.lat,be.zoom),Qe=s.bn([],[1,1,1/Ke]);s.bo(Fe,Fe,Le);const at=pe.paint.get("model-opacity").constantOr(1),je=new Mt(Se.gl.LEQUAL,Mt.ReadWrite,J.depthRangeFor3D),qe=new Mt(Se.gl.LEQUAL,Mt.ReadOnly,J.depthRangeFor3D),Re=new s.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),et=J.renderPass==="shadow",Ue=et&&xe?xe.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),nt=pe.paint.get("model-front-cutoff"),xt=nt[2]<1,Je=va(J,pe.paint.get("model-cutoff-fade-range")),_t=pe.getLayerRenderingStats();(function(kt,Dt,Pt,Ut){const qt=kt.terrain?kt.terrain.exaggeration():0,Kt=kt.transform.zoom;for(const pi of Ut){const Ai=Dt.getTile(pi).getBucket(Pt);Ai&&(Ai.setFilter(Pt.filter),kt.conflationActive&&Ai.updateReplacement(pi,kt.replacementSource),Ai.evaluateTransform(kt,Pt),kt.terrain&&qt>0&&Ai.elevationUpdate(kt.terrain,qt,pi,Pt.source),Ai.needsReEvaluation(kt,Kt,Pt)&&Ai.evaluate(Pt))}})(J,te,pe,ye),function(){let kt,Dt,Pt;xt?(kt=ye.length-1,Dt=-1,Pt=-1):(kt=0,Dt=ye.length,Pt=1);const Ut=new Float64Array(16),qt=s.ef(),Kt=new s.P(0,0);for(let pi=kt;pi!==Dt;pi+=Pt){const Ai=ye[pi],mr=te.getTile(Ai).getBucket(pe);if(!mr||!mr.uploaded)continue;let zr=!1;xe&&(zr=xe.getMaxCascadeForTile(Ai.toUnwrapped())===0);const xr=be.calculatePosMatrix(Ai.toUnwrapped(),be.worldSize),Sr=mr.modelTraits;!et&&xt&&(s.bi(Ut,xr),s.ad(qt,Ce,Ut),Kt.x=qt[0],Kt.y=qt[1]);const xn=[];mr.setFilter(pe.filter);for(const wi of mr.getNodesInfo()){if(wi.hiddenByReplacement||!wi.node.meshes)continue;const Ri=wi.node;let Bi=0;J.terrain&&Ri.elevation&&(Bi=Ri.elevation*J.terrain.exaggeration());const Gr=(()=>{const mn=wi.aabb;return Re.min=[...mn.min],Re.max=[...mn.max],Re.min[2]+=Bi,Re.max[2]+=Bi,s.ad(Re.min,Re.min,xr),s.ad(Re.max,Re.max,xr),Re})(),An=wi.evaluatedScale;if(An[0]<=1&&An[1]<=1&&An[2]<=1&&Gr.intersects(Ue)===0)continue;if(!et&&xt){const mn=.16666666666666666;wi.cameraCollisionOpacity=Ce[0]>Gr.min[0]&&Ce[0]<Gr.max[0]&&Ce[1]>Gr.min[1]&&Ce[1]<Gr.max[1]&&Ce[2]*Ke<Gr.max[2]&&Ri.footprint&&s.bS(Kt,Ri.footprint)?Math.max(wi.cameraCollisionOpacity-mn,0):Math.min(1,wi.cameraCollisionOpacity+mn)}const Lr=[...xr],or=1/s.cU(Ai.canonical),dn=Ri.anchor?Ri.anchor[0]:0,Xi=Ri.anchor?Ri.anchor[1]:0;s.bo(Lr,Lr,[dn*(An[0]-1)+wi.evaluatedTranslation[0]*or,Xi*(An[1]-1)+wi.evaluatedTranslation[1]*or,Bi+wi.evaluatedTranslation[2]]),s.ci(An,s.eg)||s.cE(Lr,Lr,An);const Tn=s.az([],Lr,Ri.matrix),$r=s.az([],be.expandedFarZProjMatrix,Tn),Mr=s.az([],be.expandedFarZProjMatrix,Lr),qr=s.aA([],[dn,Xi,Bi,1],$r)[2];Ri.hidden=!1;let lr=at;et||(xt&&(lr*=wi.cameraCollisionOpacity,lr*=_u(Lr,be,wi.aabb,nt)),lr*=_x(Je,qr)),lr!==0?xn.push({nodeInfo:wi,depth:qr,opacity:lr,wvpForNode:$r,wvpForTile:Mr,nodeModelMatrix:Tn,tileModelMatrix:Lr}):Ri.hidden=!0}et||xn.sort((wi,Ri)=>!xt||wi.opacity===1&&Ri.opacity===1?wi.depth<Ri.depth?-1:1:wi.opacity===1?-1:Ri.opacity===1?1:wi.depth>Ri.depth?-1:1);for(const wi of xn){const Ri=wi.nodeInfo,Bi=Ri.node;let Gr=s.az([],Qe,wi.tileModelMatrix);s.az(Gr,Fe,Gr);const An=s.bi([],Gr);s.ee(An,An),s.cE(An,An,wg),Gr=s.az(Gr,Gr,Bi.matrix);const Lr=J.renderPass==="light-beam",or=pe.paint.get("model-color-use-theme").constantOr("default")==="none",dn=Sr&s.em.HasMapboxMeshFeatures,Xi=dn?0:Ri.evaluatedRMEA[0][2];for(let Tn=0;Tn<Bi.meshes.length;++Tn){const $r=Bi.meshes[Tn],Mr=Tn===Bi.lightMeshIndex;let qr=wi.wvpForNode;if(Mr){if(!Lr&&!J.terrain&&J.shadowRenderer){J.currentLayer<J.firstLightBeamLayer&&(J.firstLightBeamLayer=J.currentLayer);continue}qr=wi.wvpForTile}else if(Lr)continue;const lr={defines:[]},mn=[];if(!et&&xe&&(xe.useNormalOffset=!!$r.normalBuffer),ft(lr.defines,mn,$r,J,or?null:pe.lut),dn||lr.defines.push("DIFFUSE_SHADED"),zr&&lr.defines.push("SHADOWS_SINGLE_CASCADE"),_t&&(et?_t.numRenderedVerticesInShadowPass+=$r.vertexArray.length:_t.numRenderedVerticesInTransparentPass+=$r.vertexArray.length),et){hn($r,wi.nodeModelMatrix,J,pe);continue}let cs=null;if(we){const na=wc(wi.nodeModelMatrix,J.transform);if(cs=new Float32Array(na),be.projection.name!=="globe"){const Lo=$r.aabb.min,$s=$r.aabb.max,[kl,sa]=we.getOpacityForBounds(na,Lo[0],Lo[1],$s[0],$s[1]);lr.overrideFog=kl>=ce||sa>=ce}}const en=$r.material;let rr;en.occlusionTexture&&en.occlusionTexture.offsetScale&&(rr=en.occlusionTexture.offsetScale,lr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const eo=J.getOrCreateProgram("model",lr);!et&&xe&&xe.setupShadowsFromMatrix(wi.tileModelMatrix,eo,xe.useNormalOffset),J.uploadCommonUniforms(Se,eo,null,cs);const Gs=en.pbrMetallicRoughness;Gs.metallicFactor=.9,Gs.roughnessFactor=.5;const _o=td(new Float32Array(qr),new Float32Array(Gr),new Float32Array(An),new Float32Array(Bi.matrix),J,wi.opacity,Gs.baseColorFactor,en.emissiveFactor,Gs.metallicFactor,Gs.roughnessFactor,en,Xi,pe,[0,0,0],rr);!Mr&&(Ri.hasTranslucentParts||wi.opacity<1)&&eo.draw(J,Se.gl.TRIANGLES,je,mi.disabled,zi.disabled,ri.backCCW,_o,pe.id,$r.vertexBuffer,$r.indexBuffer,$r.segments,pe.paint,J.transform.zoom,void 0,mn),eo.draw(J,Se.gl.TRIANGLES,Mr?qe:je,mi.disabled,Mr||wi.opacity<1||Ri.hasTranslucentParts?zi.alphaBlended:zi.unblended,ri.backCCW,_o,pe.id,$r.vertexBuffer,$r.indexBuffer,$r.segments,pe.paint,J.transform.zoom,void 0,mn)}}}}()}(h,t,a,d),void C();if(R.type!=="model")return;const k=R.getModels(),L=[],j=h.transform.getFreeCameraOptions().position,F=s.bY([],[j.x,j.y,j.z],h.transform.worldSize);s.eb(F,F);const Z=[],$=[];let X=0;for(const J of k){const te=a.paint.get("model-rotation").constantOr(null),pe=a.paint.get("model-scale").constantOr(null),ye=a.paint.get("model-translation").constantOr(null);J.computeModelMatrix(h,te,pe,ye,!0,!0,!1);const Se=s.bx([]),be=s.ec(J.position.lat,h.transform.zoom),we=s.bn([],[1,1,1/be]);s.bo(Se,Se,F),L.push({zScaleMatrix:we,negCameraPosMatrix:Se});for(const xe of J.nodes)bc(h.transform,xe,J.matrix,h.transform.expandedFarZProjMatrix,X,Z,$);X++}if(Z.sort((J,te)=>te.depth-J.depth),h.renderPass!=="shadow"){if(g===1)for(const J of $)At(J,h,a,L[J.modelIndex],mi.disabled,h.colorModeForRenderPass());else{for(const J of $)At(J,h,a,L[J.modelIndex],mi.disabled,zi.disabled);for(const J of $)At(J,h,a,L[J.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const J of Z)At(J,h,a,L[J.modelIndex],mi.disabled,h.colorModeForRenderPass());C()}else{for(const J of $)hn(J.mesh,J.nodeModelMatrix,h,a);for(const J of Z)hn(J.mesh,J.nodeModelMatrix,h,a);C()}}},Eg={line:function(h,t,a){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const g of d){const y=t.getTile(g).getBucket(h);if(y&&(y.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,a){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,d.type==="vector"?h.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const g=d.getModels();for(const y of g)y.upload(a.context)},raster:function(h,t,a){const d=t.getSource();if(!(d instanceof ml&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-array-band")||d.getInitialBand(g);if(y==null)return;const v=t.getIds().map(T=>t.getTileByID(T));for(const T of v)T.updateNeeded(g,y)&&d.prepareTile(T,g,y)},"raster-particle":function(h,t,a){const d=t.getSource();if(!(d instanceof ml&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-particle-array-band")||d.getInitialBand(g);if(y==null)return;const v=t.getIds().map(T=>t.getTileByID(T));for(const T of v)T.updateNeeded(g,y)&&d.prepareTile(T,g,y)}},Za={fill:_g},ld={fill:function(h,t,a,d){if(!a.layout||a.layout.get("fill-elevation-reference")==="none")return;const g=h.context.gl,y=new Mt(g.LEQUAL,Mt.ReadOnly,h.depthRangeFor3D),v=new mi({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),T=h.transform.getFreeCameraOptions().position,C=h.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const R of d){const k=t.getTile(R),L=k.getBucket(a);if(!L)continue;const j=L.elevatedStructures;if(!j||j.maskSegments.segments[0].primitiveLength===0)continue;const F=Xp(R.toUnwrapped(),T),Z=h.translatePosMatrix(R.projMatrix,k,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),$=qp(Z,F,0,0,0);C.draw(h,g.TRIANGLES,y,v,zi.disabled,ri.disabled,$,a.id,j.vertexBuffer,j.indexBuffer,j.maskSegments,a.paint,h.transform.zoom)}}};class yu{constructor(t,a,d,g,y,v){this.context=new Iw(t,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of T)this._debugParams.enabledLayers[R]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of T)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new yx(y),this.setup(),this.numSublayers=Vs.maxUnderzooming+Vs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ow(this),this._wireframeDebugCache=new jw,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=v}updateTerrain(t,a){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Yh(this,t));const g=this._terrain;this.transform.elevation=d?g:null,g.update(t,this.transform,a),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,g]=a.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);const y=d+.78*(g-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Yh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*s.q.devicePixelRatio,this.height=a*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,a=new s.ba;a.emplaceBack(0,0),a.emplaceBack(s.aj,0),a.emplaceBack(0,s.aj),a.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=t.createVertexBuffer(a,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const d=new s.ba;d.emplaceBack(0,0),d.emplaceBack(s.aj,0),d.emplaceBack(0,s.aj),d.emplaceBack(s.aj,s.aj),this.debugBuffer=t.createVertexBuffer(d,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const g=new s.ba;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const y=new s.aZ;y.emplaceBack(0,0,0,0),y.emplaceBack(s.aj,0,s.aj,0),y.emplaceBack(0,s.aj,0,s.aj),y.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(y,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const v=new s.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const T=new s.bb;for(const R of[0,1,3,2,0])T.emplaceBack(R);this.debugIndexBuffer=t.createIndexBuffer(T),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bz();const C=this.context.gl;this.stencilClearMode=new mi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Mt.disabled,this.stencilClearMode,zi.disabled,ri.disabled,mc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,d){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const g=this.context,y=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(zi.disabled),g.setDepthMode(Mt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of d){const C=a.getTile(T),R=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:j}=this.getTileBoundsBuffers(C);v.draw(this,y.TRIANGLES,Mt.disabled,new mi({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),zi.disabled,ri.disabled,mc(T.projMatrix),"$clipping",k,L,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new mi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new mi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort((v,T)=>T.overscaledZ-v.overscaledZ),g=d[d.length-1].overscaledZ,y=d[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const v={};for(let T=0;T<y;T++)v[T+g]=new mi({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[v,d]}return[{[g]:mi.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new zi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zi.unblended:zi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new zi([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,d,g=!1){if(this.depthOcclusion)return new Mt(this.context.gl.GREATER,Mt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Mt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Mt(d||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),d=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&d!==0&&(this.depthFBO=new gg(this.context,a,d,!1,"texture"),this.depthTexture=new s.T(this.context,{width:a,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,d,0,0,a,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){const d=s.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const g=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(y).filter(je=>{const qe=g[je];return!(qe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[qe.type]});let T=v(),C=!1,R=!1;for(const je of T){const qe=g[je];qe.type==="circle"&&(C=!0),qe.type==="symbol"&&(qe.hasInitialOcclusionOpacityProperties?R=!0:C=!0)}let k=T.map(je=>g[je]);const L=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let j=0,F=!1;for(const je in L){const qe=L[je];qe.used&&(qe.prepare(this.context),qe.getSource().usedInConflation&&++j)}let Z=!1;for(const je of k)je.isHidden(this.transform.zoom)||(je.type==="clip"&&(Z=!0),this.prepareLayer(je));const $={},X={},J={},te={},pe={};for(const je in L){const qe=L[je];$[je]=qe.getVisibleCoordinates(),X[je]=$[je].slice().reverse(),J[je]=qe.getVisibleCoordinates(!0).reverse(),te[je]=qe.getShadowCasterCoordinates(),pe[je]=qe.sortCoordinatesByDistance($[je])}const ye=je=>{const qe=this.style.getLayerSourceCache(je);return qe&&qe.used?qe.getSource():null};if(j||Z||this._clippingActiveLastFrame){const je=[],qe=[];let Re=0;for(const et of k)this.isSourceForClippingOrConflation(et,ye(et))&&(je.push(et),qe.push(Re)),Re++;if(je&&(Z||je.length>1)||this._clippingActiveLastFrame){Z=!1;const et=[];for(let Ue=0;Ue<je.length;Ue++){const nt=je[Ue],xt=qe[Ue],Je=this.style.getLayerSourceCache(nt);if(!Je||!Je.used||!Je.getSource().usedInConflation&&nt.type!=="clip")continue;let _t=s.eu,kt=s.bQ.None;const Dt=[];let Pt=!0;if(nt.type==="clip"){_t=xt;for(const Ut of nt.layout.get("clip-layer-types"))kt|=Ut==="model"?s.bQ.Model:Ut==="symbol"?s.bQ.Symbol:s.bQ.FillExtrusion;for(const Ut of nt.layout.get("clip-layer-scope"))Dt.push(Ut);nt.isHidden(this.transform.zoom)?Pt=!1:Z=!0}Pt&&et.push({layer:nt.fqid,cache:Je,order:_t,clipMask:kt,clipScope:Dt})}this.replacementSource.setSources(et),F=!0}}this._clippingActiveLastFrame=Z,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let je=0;je<k.length;je++){const qe=k[je],Re=qe.cutoffRange();if(this.longestCutoffRange=Math.max(Re,this.longestCutoffRange),Re>0){const et=ye(qe);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),qe.minzoom&&(this.minCutoffZoom=Math.max(qe.minzoom,this.minCutoffZoom))}qe.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=je),this._lastOcclusionLayer=je)}const Se=this.style&&this.style.fog;Se?(this._fogVisible=Se.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Se.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(J),this.opaquePassCutoff=0,T=v(),k=T.map(je=>g[je]));const be=this._shadowRenderer;if(be){be.updateShadowParameters(this.transform,this.style.directionalLight);for(const je in L)for(const qe of $[je]){let Re={min:0,max:0};this.terrain&&(Re=this.terrain.getMinMaxForTile(qe)||Re),be.addShadowReceiver(qe.toUnwrapped(),Re.min,Re.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new gu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new Jr(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),xe&&!this._rain&&(this._rain=new zw(this)),!xe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!wr.has(this.context.gl))return;this.renderPass="offscreen";for(const je of k){const qe=t.getLayerSourceCache(je);if(!je.hasOffscreenPass()||je.isHidden(this.transform.zoom))continue;const Re=qe?X[qe.id]:void 0;(je.type==="custom"||je.type==="raster"||je.type==="raster-particle"||je.isSky()||Re&&Re.length)&&this.renderLayer(this,qe,je,Re)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,te)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ce=(()=>{if(a.showOverdrawInspector)return s.am.black;const je=this.style.fog;if(je&&this.transform.projection.supportsFog){const qe=this.style.getLut(je.scope);if(!Te){const Re=je.properties.get("color-use-theme")==="none",et=je.properties.get("color").toNonPremultipliedRenderColor(Re?null:qe).toArray01();return new s.am(...et)}if(Te){const Re=je.properties.get("space-color-use-theme")==="none",et=je.properties.get("space-color").toNonPremultipliedRenderColor(Re?null:qe).toArray01();return new s.am(...et)}}return s.am.transparent})();if(this.context.clear({color:Ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const je=k[this.currentLayer],qe=t.getLayerSourceCache(je);if(je.isSky())continue;const Re=qe?(je.is3D(y)?pe:X)[qe.id]:void 0;this._renderTileClippingMasks(je,qe,Re),this.renderLayer(this,qe,je,Re)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const je=k[this.currentLayer],qe=t.getLayerSourceCache(je);je.isSky()&&this.renderLayer(this,qe,je,qe?X[qe.id]:void 0)}function Le(je,qe){let Re;return qe&&(Re=(je.type==="symbol"?J:je.is3D(y)?pe:X)[qe.id]),Re}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const je=k[this.currentLayer];if(je.type==="raster"||je.type==="raster-particle"){const qe=t.getLayerSourceCache(je);this.renderLayer(this,qe,je,Le(je,qe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Fe=0;be&&(Fe=be.getShadowCastingLayerCount());let Ke=!1,Qe=-1;for(let je=0;je<T.length;++je){const qe=k[je];qe.isHidden(this.transform.zoom)||qe.is3D(y)&&(Qe=je)}R&&Qe===-1&&(C=!0);let at=!1;for(;this.currentLayer<T.length;){const je=k[this.currentLayer],qe=t.getLayerSourceCache(je);if(je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(je)){if(je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!at&&je.is3D(y)&&!y){const Re=this.currentLayer,et=Ue=>{for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const nt=k[this.currentLayer];if(Za[nt.type]){const xt=this.style.getLayerSourceCache(nt);Za[nt.type](this,xt,nt,Le(nt,xt),Ue)}}};et("initialize"),et("reset"),this.currentLayer=Re,at=!0}if(C&&!Ke&&this.terrain&&!this.transform.isOrthographic&&(Ke=!0,this.blitDepth()),R&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(je,qe,qe?$[qe.id]:void 0),this.renderLayer(this,qe,je,Le(je,qe)),!this.terrain&&be&&Fe>0&&je.hasShadowPass()&&--Fe==0){{this.clearStencil();const Re=this.currentLayer;for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const et=k[this.currentLayer];if(ld[et.type]){const Ue=this.style.getLayerSourceCache(et);ld[et.type](this,Ue,et,Le(et,Ue))}}this.currentLayer=Re}if(be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Re=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Re;this.currentLayer++){const et=k[this.currentLayer];if(!et.hasLightBeamPass())continue;const Ue=t.getLayerSourceCache(et);this.renderLayer(this,Ue,et,Ue?X[Ue.id]:void 0)}this.currentLayer=Re,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Re=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const Ue=k[this.currentLayer],nt=t.getLayerSourceCache(Ue),xt=nt?X[nt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ue,nt,nt?$[nt.id]:void 0),this.renderLayer(this,nt,Ue,xt)}this.depthOcclusion=!1,this.currentLayer=Re,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let je=null;k.forEach(qe=>{const Re=t.getLayerSourceCache(qe);Re&&!qe.isHidden(this.transform.zoom)&&Re.getVisibleCoordinates().length&&(!je||je.getSource().maxzoom<Re.getSource().maxzoom)&&(je=Re)}),je&&this.options.showTileBoundaries&&Ha(this,je,je.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ha(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(je){const qe=je.transform.padding;Yp(je,je.transform.height-(qe.top||0),3,Rw),Yp(je,qe.bottom||0,3,kw),Kp(je,qe.left||0,3,Js),Kp(je,je.transform.width-(qe.right||0),3,vg);const Re=je.transform.centerPoint;(function(et,Ue,nt,xt){mu(et,Ue-1,nt-10,2,20,xt),mu(et,Ue-10,nt-1,20,2,xt)})(je,Re.x,je.transform.height-Re.y,ks)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(t.type);if(Eg[t.type]&&(d||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);Eg[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,a,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||er[d.type](t,a,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,d=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),g.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const d in t){const g=t[d],y=this.context.extTimerQuery,v=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),a[d]=v}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let d=0;for(const g of t)d+=a.getQueryParameter(g,a.QUERY_RESULT)/1e6,a.deleteQuery(g);return d}translatePosMatrix(t,a,d,g,y){if(!d[0]&&!d[1])return t;const v=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(v){const R=Math.sin(v),k=Math.cos(v);d=[d[0]*k-d[1]*R,d[0]*R+d[1]*k]}const T=[y?d[0]:s.aw(a,d[0],this.transform.zoom),y?d[1]:s.aw(a,d[1],this.transform.zoom),0],C=new Float32Array(16);return s.bo(C,t,T),C}saveTileTexture(t){const a=t.size[0],d=this._tileTextures[a];d?d.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,d){const g=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||a!==void 0&&!a||y.push("FOG","FOG_DITHERING"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,a){this.cache=this.cache||{};const d=a&&a.defines||[],g=a&&a.config,y=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(d),v=$p.cacheKey(Rp[t],t,y,g);return this.cache[v]||(this.cache[v]=new $p(this.context,t,Rp[t],g,ox[t],y)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const d=this.style.directionalLight,g=this.style.ambientLight;if(d&&g){const y=((v,T,C)=>{const R=v.properties.get("direction"),k=v.properties.get("color-use-theme")==="none",L=v.properties.get("color").toNonPremultipliedRenderColor(k?null:C.getLut(v.scope)).toArray01(),j=v.properties.get("intensity"),F=T.properties.get("color-use-theme")==="none",Z=T.properties.get("color").toNonPremultipliedRenderColor(F?null:C.getLut(T.scope)).toArray01(),$=T.properties.get("intensity"),X=[R.x,R.y,R.z],J=s.dw(Z,$),te=s.dw(L,j);return{u_lighting_ambient_color:J,u_lighting_directional_dir:X,u_lighting_directional_color:te,u_ground_radiance:Gp(X,te,J)}})(d,g,this.style);a.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,a,d,g,y){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const T=v.getOpacity(this.transform.pitch),C=((R,k,L,j,F,Z,$,X,J,te,pe,ye)=>{const Se=R.transform,be=k.properties.get("color-use-theme")==="none",we=k.properties.get("color").toNonPremultipliedRenderColor(be?null:R.style.getLut(k.scope)).toArray01();we[3]=j;const xe=R.frameCounter/1e3%1,[Te,Ce]=k.properties.get("vertical-range");return{u_fog_matrix:L?Se.calculateFogTileMatrix(L):ye||R.identityMat,u_fog_range:k.getFovAdjustedRange(Se._fov),u_fog_color:we,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Ce),Ce],u_fog_temporal_offset:xe,u_frustum_tl:F,u_frustum_tr:Z,u_frustum_br:$,u_frustum_bl:X,u_globe_pos:J,u_globe_radius:te,u_viewport:pe,u_globe_transition:s.ah(Se.zoom),u_is_globe:+(Se.projection.name==="globe")}})(this,v,d,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],g);a.setFogUniformValues(t,C)}y&&a.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const g of d)a[g.key]=t[g.key]||new rc(g,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=ce||a[1]>=ce}setupDepthForOcclusion(t,a,d){const g=this.context,y=g.gl,v=!!d;var T;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((T=this.depthRangeFor3D)[1]-T[0]),-1-2*T[0]/(T[1]-T[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),v||a.setTerrainUniformValues(g,d)}}function Al(h,t){let a=!1,d=null;const g=()=>{d=null,a&&(h(),d=setTimeout(g,t),a=!1)};return()=>(a=!0,d||g(),d)}class Cg{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Al(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=rf(t);if(this._hashName){const d=this._hashName;let g=!1;const y=location.hash.slice(1).split("&").map(v=>{const T=v.split("=")[0];return T===d?(g=!0,`${T}=${a}`):v}).filter(v=>v);return g||y.push(`${d}=${a}`),`#${y.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(Number(d)))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function rf(h,t){const a=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),v=Math.round(a.lng*y)/y,T=Math.round(a.lat*y)/y,C=h.getBearing(),R=h.getPitch();let k=t?`/${v}/${T}/${d}`:`${d}/${T}/${v}`;return(C||R)&&(k+="/"+Math.round(10*C)/10),R&&(k+=`/${Math.round(R)}`),k}const xu={linearity:.3,easing:s.ew(0,0,.3,1)},Ig=s.h({deceleration:2500,maxSpeed:1400},xu),ba=s.h({deceleration:20,maxSpeed:1400},xu),Pl=s.h({deceleration:1e3,maxSpeed:360},xu),cd=s.h({deceleration:1e3,maxSpeed:90},xu);class nf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=s.q.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const y=wu(a.pan.mag(),d,s.h({},Ig,t||{}));g.offset=a.pan.mult(y.amount/a.pan.mag()),g.center=this._map.transform.center,vu(g,y)}if(a.zoom){const y=wu(a.zoom,d,ba);g.zoom=this._map.transform.zoom+y.amount,vu(g,y)}if(a.bearing){const y=wu(a.bearing,d,Pl);g.bearing=this._map.transform.bearing+s.ay(y.amount,-179,179),vu(g,y)}if(a.pitch){const y=wu(a.pitch,d,cd);g.pitch=this._map.transform.pitch+y.amount,vu(g,y)}if(g.zoom||g.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function vu(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function wu(h,t,a){const{maxSpeed:d,linearity:g,deceleration:y}=a,v=s.ay(h*g/(t/1e3),-d,d),T=Math.abs(v)/(y*g);return{easing:a.easing,duration:1e3*T,amount:v*(T/2)}}class as extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,g={}){const y=dt(a.getCanvasContainer(),d),v=a.unproject(y);super(t,s.h({point:y,lngLat:v,originalEvent:d},g)),this._defaultPrevented=!1,this.target=a}}class bu extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const g=t==="touchend"?d.changedTouches:d.touches,y=Bt(a.getCanvasContainer(),g),v=y.map(C=>a.unproject(C)),T=y.reduce((C,R,k,L)=>C.add(R.div(L.length)),new s.P(0,0));super(t,{points:y,point:T,lngLats:v,lngLat:a.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class Ml extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Ag{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ml(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new as(t.type,this._map,t))}mouseup(t){this._map.fire(new as(t.type,this._map,t))}preclick(t){const a=s.h({},t);a.type="preclick",this._map.fire(new as(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new as(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new as(t.type,this._map,t))}mouseover(t){this._map.fire(new as(t.type,this._map,t))}mouseout(t){this._map.fire(new as(t.type,this._map,t))}touchstart(t){return this._firePreventable(new bu(t.type,this._map,t))}touchmove(t){this._map.fire(new bu(t.type,this._map,t))}touchend(t){this._map.fire(new bu(t.type,this._map,t))}touchcancel(t){this._map.fire(new bu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new as(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new as("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new as(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pg{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ne(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(g.x,d.x),T=Math.max(g.x,d.x),C=Math.min(g.y,d.y),R=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${C}px)`,this._box.style.width=T-v+"px",this._box.style.height=R-C+"px")})}mouseupWindow(t,a){if(!this._active)return;const d=this._startPos,g=a;if(d&&t.button===0){if(this.reset(),ot(),d.x!==g.x||d.y!==g.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ge(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new s.A(t,{originalEvent:a}))}}function ud(h,t){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=t[d];return a}class ls{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const y=new s.P(0,0);for(const v of g)y._add(v);return y.div(g.length)}(a),this.touches=ud(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const g=ud(d,a);for(const y in this.touches){const v=g[y];(!v||v.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class hd{constructor(t){this.singleTap=new ls(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const g=this.singleTap.touchend(t,a,d);if(g){const y=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(g)<30;if(y&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Mg{constructor(){this._zoomIn=new hd({numTouches:1,numTaps:2}),this._zoomOut=new hd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const g=this._zoomIn.touchend(t,a,d),y=this._zoomOut.touchend(t,a,d);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(g)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Rg={0:1,2:2},Rl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class dd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const d=Wt(t);this._correctButton(t,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(t,a){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(g,y){const v=Rg[y];return g.buttons===void 0||(g.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(t){this._lastPoint&&Wt(t)===this._eventButton&&(this._moved&&ot(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kg extends dd{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class of extends dd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Rl[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=.8*(a.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Tc extends dd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Rl[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=-.5*(a.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Dg{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!s.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,d)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const g=ud(d,a),y=new s.P(0,0),v=new s.P(0,0);let T=0;for(const R in g){const k=g[R],L=this._touches[R];L&&(y._add(k),v._add(k.sub(L)),T++,g[R]=k)}if(this._touches=g,T<this._minTouches||!v.mag())return;const C=v.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class pd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,d){return{}}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[y,v]=g,T=Su(d,a,y),C=Su(d,a,v);if(!T||!C)return;const R=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],R,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,v=Su(d,a,g),T=Su(d,a,y);v&&T||(this._active&&ot(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Su(h,t,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return t[d]}function fd(h,t){return Math.log(h/t)/Math.LN2}class Ng extends pd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fd(this._distance,d),pinchAround:a}}}function af(h,t){return 180*h.angleWith(t)/Math.PI}class vx extends pd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:af(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const g=af(t,d);return Math.abs(g)<a}}function lf(h){return Math.abs(h.y)>Math.abs(h.x)}class wx extends pd{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,lf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){const g=this._lastPoints;if(!g)return;const y=t[0].sub(g[0]),v=t[1].sub(g[1]);return this._map._cooperativeGestures&&!s.ex()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,v,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5})}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,y=a.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return lf(t)&&lf(a)&&v}}const bx={panStep:100,bearingStep:15,pitchStep:10};class Sx{constructor(){const t=bx;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,g=0,y=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Tx,zoom:a?Math.round(C)+a*(t.shiftKey?2:1):C,bearing:T.getBearing()+d*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-v*this._panStep],center:T.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tx(h){return h*(2-h)}const jg=4.000244140625,Ex=1/450;class Cx{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ex,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=s.q.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%jg==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=dt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>jg?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&k!==0&&(k=1/k);const L=a(),j=Math.pow(2,L),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*k))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),g=this._startZoom,y=this._easing;let v,T=!1;if(this._type==="wheel"&&g&&y){const R=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),k=y(R);v=s.ai(g,d,k),R<1?this._frameId||(this._frameId=!0):T=!0}else v=d,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=v-a();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=s.ey;if(this._prevEase){const d=this._prevEase,g=(s.q.now()-d.start)/d.duration,y=d.easing(g+.01)-d.easing(g),v=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-v*v);a=s.ew(v,T,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ix{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ax{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Px{constructor(){this._tap=new hd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,a,d))}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=a[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,a,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mx{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Lw{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fw{constructor(t,a,d,g){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cf=h=>h.zoom||h.drag||h.pitch||h.rotate;class fn extends s.A{}class Rx{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const d=s.at([],a,t);this.radius=s.ae(d[2]<0?s.eA([],d,this.constants):[d[0],d[1],0])}projectRay(t){s.eA(t,t,this.constants),s.au(t,t),s.eB(t,t,this.constants);const a=s.bY([],t,this.radius);if(a[2]>0){const d=s.bY([],[0,0,1],s.bG(a,[0,0,1])),g=s.bY([],s.au([],[a[0],a[1],0]),this.radius),y=s.cV([],a,s.bY([],s.at([],s.cV([],g,d),a),2));a[0]=y[0],a[1]=y[1]}return a}}function uf(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class zg{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nf(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rx,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.aV(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,v]of this._listeners){const T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,T,v)}}destroy(){for(const[t,a,d]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,g,d)}}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Ag(a,t));const g=a.boxZoom=new Pg(a,t);this._add("boxZoom",g);const y=new Mg,v=new Ax;a.doubleClickZoom=new Ix(v,y),this._add("tapZoom",y),this._add("clickZoom",v);const T=new Px;this._add("tapDragZoom",T);const C=a.touchPitch=new wx(a);this._add("touchPitch",C);const R=new of(t),k=new Tc(t);a.dragRotate=new Lw(t,R,k),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const L=new kg(t),j=new Dg(a,t);a.dragPan=new Mx(d,L,j),this._add("mousePan",L),this._add("touchPan",j,["touchZoom","touchRotate"]);const F=new vx,Z=new Ng;a.touchZoomRotate=new Fw(d,Z,F,T),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new sf(a));const $=a.scrollZoom=new Cx(a,this);this._add("scrollZoom",$,["mousePan"]);const X=a.keyboard=new Sx;this._add("keyboard",X);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[J]&&a[J].enable(t[J])}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,d){for(const g in t)if(g!==d&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}handleEvent(t,a){this._updatingCamera=!0;const d=t.type==="renderFrame",g=d?void 0:t,y={needsRenderFrame:!1},v={},T={},C=t.touches?this._getMapTouches(t.touches):void 0,R=C?Bt(this._el,C):d?void 0:dt(this._el,t);for(const{handlerName:j,handler:F,allowed:Z}of this._handlers){if(!F.isEnabled())continue;let $;this._blockedByActive(T,Z,j)?F.reset():F[a||t.type]&&($=F[a||t.type](t,R,C),this.mergeHandlerResult(y,v,$,j,g),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||F.isActive())&&(T[j]=F)}const k={};for(const j in this._previousActiveHandlers)T[j]||(k[j]=g);this._previousActiveHandlers=T,(Object.keys(k).length||uf(y))&&(this._changes.push([y,v,k]),this._triggerRenderFrame()),(Object.keys(T).length||uf(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=y;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,a,d,g,y){if(!d)return;s.h(t,d);const v={handlerName:g,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(a.zoom=v),d.panDelta!==void 0&&(a.drag=v),d.pitchDelta!==void 0&&(a.pitch=v),d.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},d={};for(const[g,y,v]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),s.h(a,y),s.h(d,v);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const g=this._map,y=g.transform,v=te=>[te.x,te.y,te.z];if((te=>{const pe=this._eventsInProgress.drag;return pe&&!this._handlersById[pe.handlerName].isActive()})()&&!uf(t)){const te=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),te!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!uf(t))return void this._fireEvents(a,d,!0);let{panDelta:T,zoomDelta:C,bearingDelta:R,pitchDelta:k,around:L,aroundCoord:j,pinchAround:F}=t;y._isCameraConstrained&&(C>0&&(C=0),y._isCameraConstrained=!1),F!==void 0&&(L=F),(C||(te=>a[te]&&!this._eventsInProgress[te])("drag"))&&L&&(this._dragOrigin=v(y.pointCoordinate3D(L)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),L=L||g.transform.centerPoint,R&&(y.bearing+=R),k&&(y.pitch+=k),y._updateCameraState();const Z=[0,0,0];if(T)if(y.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L).dir),pe=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(L.sub(T)).dir);Z[0]=pe[0]-te[0],Z[1]=pe[1]-te[1]}else{const te=y.pointCoordinate(L);if(y.projection.name==="globe"){T=T.rotate(-y.angle);const pe=y._pixelsPerMercatorPixel/y.worldSize;Z[0]=-T.x*s.ez(s.aY(te.y))*pe,Z[1]=-T.y*s.ez(y.center.lat)*pe}else{const pe=y.pointCoordinate(L.sub(T));te&&pe&&(Z[0]=pe.x-te.x,Z[1]=pe.y-te.y)}}const $=y.zoom,X=[0,0,0];if(C){const te=v(j||y.pointCoordinate3D(L)),pe={dir:s.au([],s.at([],te,y._camera.position))};if(pe.dir[2]<0){const ye=y.zoomDeltaToMovement(te,C);s.bY(X,pe.dir,ye)}}const J=s.cV(Z,Z,X);y._translateCameraConstrained(J),C&&Math.abs(y.zoom-$)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const g=cf(this._eventsInProgress),y=cf(t),v={};for(const k in t){const{originalEvent:L}=t[k];this._eventsInProgress[k]||(v[`${k}start`]=L),this._eventsInProgress[k]=t[k]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const k in v)this._fireEvent(k,v[k]);y&&this._fireEvent("move",y.originalEvent);for(const k in t){const{originalEvent:L}=t[k];this._fireEvent(k,L)}const T={};let C;for(const k in this._eventsInProgress){const{handlerName:L,originalEvent:j}=this._eventsInProgress[k];this._handlersById[L].isActive()||(delete this._eventsInProgress[k],C=a[L]||j,T[`${k}end`]=C)}for(const k in T)this._fireEvent(k,T[k]);const R=cf(this._eventsInProgress);if(d&&(g||y)&&!R){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;k?(L(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:C})):(this._map.fire(new s.A("moveend",{originalEvent:C})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new s.A(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new fn("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const kx="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class md extends s.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.h({offset:t},a),d)}panTo(t,a,d){return this.easeTo(s.h({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(s.h({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(s.h({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,s.h({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(s.h({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=s.aG.convert(t);const d=a&&a.bearing||0,g=a&&a.pitch||0,y=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,y,v,d,g,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?s.h({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.h({},a,t)}_extendCameraOptions(t){return(t=s.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const d=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return d/g>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,d,g,y,v){const T=t.clone(),C=this._extendCameraOptions(v);T.bearing=g,T.pitch=y;const R=s.cd.convert(a),k=s.cd.convert(d),L=.5*(R.lat+k.lat),j=.5*(R.lng+k.lng),F=s.eC(L,j),Z=s.au([],F),$=s.au([],s.bF([],Z,[0,1,0])),X=s.bF([],$,Z),J=[$[0],$[1],$[2],0,X[0],X[1],X[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],te=[F,s.eC(R.lat,R.lng),s.eC(k.lat,R.lng),s.eC(k.lat,k.lng),s.eC(R.lat,k.lng),s.eC(L,R.lng),s.eC(L,k.lng),s.eC(R.lat,j),s.eC(k.lat,j)];let pe=s.cW.fromPoints(te.map(Ue=>[s.bG($,Ue),s.bG(X,Ue),s.bG(Z,Ue)]));const ye=s.ad([],pe.center,J);s.eD(ye)===0&&s.eE(ye,0,0,1),s.au(ye,ye),s.bY(ye,ye,s.aB),T.center=s.eF(ye);const Se=T.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),Se);pe=s.cW.applyTransform(pe,s.az([],Se,J));const we=this._extendAABB(pe,T,C,g);if(!we)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=we,s.ad(ye,ye,Se);const xe=.5*(pe.max[2]-pe.min[2]),Te=this._minimumAABBFrustumDistance(T,pe),Ce=s.bY([],[0,0,1],xe),Le=s.cV(Ce,ye,Ce),Fe=Te+(T.pitch===0?0:s.bD(ye,Le)),Ke=T.globeCenterInViewSpace,Qe=s.at([],ye,[Ke[0],Ke[1],Ke[2]]);s.au(Qe,Qe),s.bY(Qe,Qe,Fe);const at=s.cV([],ye,Qe);s.ad(at,at,be);const je=s.eq/s.aB,qe=s.ae(at),Re=s.c6(Math.max(qe*je-s.eq,Number.EPSILON),0),et=Math.min(T.zoomFromMercatorZAdjusted(Re),C.maxZoom);return et>.5*(s.cL+s.cx)?(T.setProjection({name:"mercator"}),T.zoom=et,this._cameraForBounds(T,a,d,g,y,v)):{center:T.center,zoom:et,bearing:g,pitch:y}}_extendAABB(t,a,d,g){const y=.5*((d.padding.left||0)+(d.padding.right||0)),v=.5*((d.padding.top||0)+(d.padding.bottom||0)),T=v,C=y,R=y,k=v,L=a.width-(C+R),j=a.height-(T+k),F=s.at([],t.max,t.min),Z=Math.min(L/F[0],j/F[1]),$=Math.min(a.scaleZoom(a.scale*Z),d.maxZoom);if(isNaN($))return null;const X=a.scale/a.zoomScale($),J=new s.cW([t.min[0]-C*X,t.min[1]-k*X,t.min[2]],[t.max[0]+R*X,t.max[1]+T*X,t.max[2]]),te=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new s.P(d.offset.x,d.offset.y):s.P.convert(d.offset)).rotate(-s.al(g));return J.center[0]-=te.x*X,J.center[1]+=te.y*X,J}queryTerrainElevation(t,a){const d=this.transform.elevation;return d?(a=s.h({},{exaggerated:!0},a),d.getAtPoint(s.ac.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,d,g,y,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,d,g,y,v);const T=t.clone(),C=this._extendCameraOptions(v);T.bearing=g,T.pitch=y;const R=s.cd.convert(a),k=s.cd.convert(d),L=new s.cd(R.lng,k.lat),j=new s.cd(k.lng,R.lat),F=T.project(R),Z=T.project(k),$=this.queryTerrainElevation(R),X=this.queryTerrainElevation(k),J=this.queryTerrainElevation(L),te=this.queryTerrainElevation(j),pe=[[F.x,F.y,Math.min($||0,X||0,J||0,te||0)],[Z.x,Z.y,Math.max($||0,X||0,J||0,te||0)]];let ye=s.cW.fromPoints(pe);const Se=T.getWorldToCameraMatrix(),be=s.bi(new Float64Array(16),Se);ye=s.cW.applyTransform(ye,Se);const we=this._extendAABB(ye,T,C,g);if(!we)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=we;const xe=.5*s.at([],ye.max,ye.min)[2],Te=this._minimumAABBFrustumDistance(T,ye),Ce=[0,0,1,0];s.aA(Ce,Ce,Se),s.eG(Ce,Ce);const Le=s.bY([],Ce,Te+xe),Fe=s.cV([],ye.center,Le);s.ad(ye.center,ye.center,be),s.ad(Fe,Fe,be);const Ke=T.unproject(new s.P(ye.center[0],ye.center[1])),Qe=s.eH(T.projection,Ke),at=Math.pow(2,Qe),je=Math.min(T._zoomFromMercatorZ(Fe[2]*T.pixelsPerMeter*at/T.worldSize),C.maxZoom);return T.mercatorFromTransition&&je<.5*(s.cL+s.cx)?(T.setProjection({name:"globe"}),T.zoom=je,this._cameraForBounds(T,a,d,g,y,v)):{center:Ke,zoom:je,bearing:g,pitch:y}}fitBounds(t,a,d){const g=this.cameraForBounds(t,a);return this._fitInternal(g,a,d)}fitScreenCoordinates(t,a,d,g,y){const v=s.P.convert(t),T=s.P.convert(a),C=new s.P(Math.min(v.x,T.x),Math.min(v.y,T.y)),R=new s.P(Math.max(v.x,T.x),Math.max(v.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,T))return this;const k=this.transform.pointLocation3D(C),L=this.transform.pointLocation3D(R),j=this.transform.pointLocation3D(new s.P(C.x,R.y)),F=this.transform.pointLocation3D(new s.P(R.x,C.y)),Z=[Math.min(k.lng,L.lng,j.lng,F.lng),Math.min(k.lat,L.lat,j.lat,F.lat)],$=[Math.max(k.lng,L.lng,j.lng,F.lng),Math.max(k.lat,L.lat,j.lat,F.lat)],X=g&&g.pitch?g.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,Z,$,d,X,g);return this._fitInternal(J,g,y)}_fitInternal(t,a,d){return t?(a=s.h(t,a)).linear?this.easeTo(a,d):this.flyTo(a,d):this}jumpTo(t,a){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,v=!1;"zoom"in t&&d.zoom!==+t.zoom&&(g=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=s.cd.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(v=!0,d.pitch=+t.pitch);const T=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(T))if(t.retainPadding===!1){const C=d.clone();C.padding=T,d.setLocationAtPoint(d.center,C.centerPoint)}else d.padding=T;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),g&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),y&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),v&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(kx),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.w(kx),this;this.stop();const g=d.zoom,y=d.pitch,v=d.bearing;d.setFreeCameraOptions(t);const T=g!==d.zoom,C=y!==d.pitch,R=v!==d.bearing;return this.fire(new s.A("movestart",a)).fire(new s.A("move",a)),T&&this.fire(new s.A("zoomstart",a)).fire(new s.A("zoom",a)).fire(new s.A("zoomend",a)),R&&this.fire(new s.A("rotatestart",a)).fire(new s.A("rotate",a)).fire(new s.A("rotateend",a)),C&&this.fire(new s.A("pitchstart",a)).fire(new s.A("pitch",a)).fire(new s.A("pitchend",a)),this.fire(new s.A("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=s.h({offset:[0,0],duration:500,easing:s.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,g=this.getZoom(),y=this.getBearing(),v=this.getPitch(),T=this.getPadding(),C="zoom"in t?+t.zoom:g,R="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:v,L=this._extendPadding(t.padding),j=s.P.convert(t.offset);let F,Z,$;if(d.projection.name==="globe"){const Ce=s.ac.fromLngLat(d.center),Le=j.rotate(-d.angle);Ce.x+=Le.x/d.worldSize,Ce.y+=Le.y/d.worldSize;const Fe=Ce.toLngLat(),Ke=s.cd.convert(t.center||Fe);this._normalizeCenter(Ke),F=d.centerPoint.add(Le),Z=new s.P(Ce.x,Ce.y).mult(d.worldSize),$=new s.P(s.aD(Ke.lng),s.aH(Ke.lat)).mult(d.worldSize).sub(Z)}else{F=d.centerPoint.add(j);const Ce=d.pointLocation(F),Le=s.cd.convert(t.center||Ce);this._normalizeCenter(Le),Z=d.project(Ce),$=d.project(Le).sub(Z)}const X=d.zoomScale(C-g);let J,te;t.around&&(J=s.cd.convert(t.around),te=d.locationPoint(J));const pe=this._zooming||C!==g,ye=this._rotating||y!==R,Se=this._pitching||k!==v,be=!d.isPaddingEqual(L),we=t.retainPadding===!1?d.clone():d,xe=Ce=>Le=>{if(pe&&(Ce.zoom=s.ai(g,C,Le)),ye&&(Ce.bearing=s.ai(y,R,Le)),Se&&(Ce.pitch=s.ai(v,k,Le)),be&&(we.interpolatePadding(T,L,Le),F=we.centerPoint.add(j)),J)Ce.setLocationAtPoint(J,te);else{const Fe=Ce.zoomScale(Ce.zoom-g),Ke=C>g?Math.min(2,X):Math.max(.5,X),Qe=Math.pow(Ke,1-Le),at=Ce.unproject(Z.add($.mult(Le*Qe)).mult(Fe));Ce.setLocationAtPoint(Ce.renderWorldCopies?at.wrap():at,F)}return t.preloadOnly||this._fireMoveEvents(a),Ce};if(t.preloadOnly){const Ce=this._emulate(xe,t.duration,d);return this._preloadTiles(Ce),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=ye,this._pitching=Se,this._padding=be,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Te),this._ease(xe(d),Ce=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,Ce)},t),this}_prepareEase(t,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new s.A("movestart",t)),this._zooming&&!d.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.A("zoomend",t)),g&&this.fire(new s.A("rotateend",t)),y&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Ue=s.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ue,a)}this.stop(),t=s.h({offset:[0,0],speed:1.2,curve:1.42,easing:s.ey},t);const d=this.transform,g=this.getZoom(),y=this.getBearing(),v=this.getPitch(),T=this.getPadding(),C="zoom"in t?s.ay(+t.zoom,d.minZoom,d.maxZoom):g,R="bearing"in t?this._normalizeBearing(t.bearing,y):y,k="pitch"in t?+t.pitch:v,L=this._extendPadding(t.padding),j=d.zoomScale(C-g),F=s.P.convert(t.offset);let Z=d.centerPoint.add(F);const $=d.pointLocation(Z),X=s.cd.convert(t.center||$);this._normalizeCenter(X);const J=d.project($),te=d.project(X).sub(J);let pe=t.curve;const ye=Math.max(d.width,d.height),Se=ye/j,be=te.mag();if("minZoom"in t){const Ue=s.ay(Math.min(t.minZoom,g,C),d.minZoom,d.maxZoom),nt=ye/d.zoomScale(Ue-g);pe=Math.sqrt(nt/be*2)}const we=pe*pe;function xe(Ue){const nt=(Se*Se-ye*ye+(Ue?-1:1)*we*we*be*be)/(2*(Ue?Se:ye)*we*be);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Te(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Ce(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Le=xe(0);let Fe=function(Ue){return Ce(Le)/Ce(Le+pe*Ue)},Ke=function(Ue){return ye*((Ce(Le)*(Te(nt=Le+pe*Ue)/Ce(nt))-Te(Le))/we)/be;var nt},Qe=(xe(1)-Le)/pe;if(Math.abs(be)<1e-6||!isFinite(Qe)){if(Math.abs(ye-Se)<1e-6)return this.easeTo(t,a);const Ue=Se<ye?-1:1;Qe=Math.abs(Math.log(Se/ye))/pe,Ke=function(){return 0},Fe=function(nt){return Math.exp(Ue*pe*nt)}}t.duration="duration"in t?+t.duration:1e3*Qe/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const at=y!==R,je=k!==v,qe=!d.isPaddingEqual(L),Re=t.retainPadding===!1?d.clone():d,et=Ue=>nt=>{const xt=nt*Qe,Je=1/Fe(xt);Ue.zoom=nt===1?C:g+Ue.scaleZoom(Je),at&&(Ue.bearing=s.ai(y,R,nt)),je&&(Ue.pitch=s.ai(v,k,nt)),qe&&(Re.interpolatePadding(T,L,nt),Z=Re.centerPoint.add(F));const _t=nt===1?X:Ue.unproject(J.add(te.mult(Ke(xt))).mult(Je));return Ue.setLocationAtPoint(Ue.renderWorldCopies?_t.wrap():_t,Z),Ue._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Ue};if(t.preloadOnly){const Ue=this._emulate(et,t.duration,d);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=at,this._pitching=je,this._padding=qe,this._prepareEase(a,!1),this._ease(et(d),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=s.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=s.bX(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,d){const g=Math.ceil(15*a/1e3),y=[],v=t(d.clone());for(let T=0;T<=g;T++){const C=v(T/g);y.push(C.clone())}return y}_preloadTiles(t,a){}}class Lg{constructor(t={}){this.options=t,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const g=Y("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",d),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const d=a.reduce((g,y,v)=>(y.value&&(g+=`${y.key}=${y.value}${v<a.length-1?"&":""}`),g),"?");t.href=`${s.e.FEEDBACK_URL}/${d}#${rf(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._mergedSourceCaches;for(const g in a){const y=a[g];if(y.used){const v=y.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((g,y)=>g.length-y.length),t=t.filter((g,y)=>{for(let v=y+1;v<t.length;v++)if(t[v].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class hf{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Y("div","mapboxgl-ctrl");const a=Y("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const d=t[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class gd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const g of d)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Xa{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=s.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,d){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+d}}const df={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Sn extends s.A{constructor(t,a,d,g){const{point:y,lngLat:v,originalEvent:T,target:C}=t;super(t.type,{point:y,lngLat:v,originalEvent:T,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=d,this.feature=g}}class Sa{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=a.filter;let g=a.type;d&&this.filters.set(t,s.b3(d)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const y=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):y.size===0&&this.map.on(g,this.handleType),y.size===0&&this.interactionsByType.set(g,y),y.set(t,a),this.typeById.set(t,g)}get(t){const a=this.typeById.get(t);if(!a)return;const d=this.interactionsByType.get(a);return d?d.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(a);d&&(d.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const d=[];for(const[g,y]of a)y.target&&d.push({targetId:g,target:y.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const d=new Map;for(const[g,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||d.set(y.id,y);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!a;a=a||this.queryTargets(t.point,g);let v=!1;const T=new Set;for(const C of a){for(const[R,k]of g){if(!k.target)continue;const L=C.variants?C.variants[R]:null;if(L){for(const j of L){if(mp(j,C,T,R))continue;const F=new s.de(C,j),Z=Ph(j,C,R);y&&(F.state=this.map.getFeatureState(F));const $=d?this.prevHoveredFeatures.get(Z):null,X=new Sn(t,R,k,F),J=$?$.stop:k.handler(X);if(d&&this.hoveredFeatures.set(Z,{feature:C,stop:J}),J!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[C,R]of g){const{handler:k,target:L}=R;if(!L&&k(new Sn(t,C,R,null))!==!1)break}}}function _d(h,t){if(Array.isArray(h)&&Array.isArray(t)){const a=new Set(h),d=new Set(t);return a.size===d.size&&h.every(g=>d.has(g))}return s.bv(h,t)}const pf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Dx={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ow{constructor(t,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new of({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Tc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),Ne()}move(t,a){const d=this.map,g=this.mouseRotate.mousemoveWindow(t,a),y=g&&g.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,a),T=v&&v.pitchDelta;T&&d.setPitch(d.getPitch()+T)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ge(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),dt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,dt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Bt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Bt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Tu(h,t,a){if(h=new s.cd(h.lng,h.lat),t){const d=new s.cd(h.lng-360,h.lat),g=new s.cd(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),v=a.locationPoint3D(h).distSqr(t),T=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(d).distSqr(t)<v&&(T||Math.abs(d.lng-a.center.lng)<y)?h=d:a.locationPoint3D(g).distSqr(t)<v&&(T||Math.abs(g.lng-a.center.lng)<y)&&(h=g)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const Fg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ta={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class yd extends s.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=s.h({element:t},a)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:g="#3FB1CE",scale:y=1,draggable:v=!1,clickTolerance:T=0,rotation:C=Ta.rotation,rotationAlignment:R=Ta.rotationAlignment,pitchAlignment:k=Ta.pitchAlignment,occludedOpacity:L=Ta.occludedOpacity,altitude:j=Ta.altitude}=t||{};this._anchor=d,this._color=g,this._scale=y,this._draggable=v,this._clickTolerance=T,this._rotation=C,this._rotationAlignment=R,this._pitchAlignment=k,this._occludedOpacity=L,this._altitude=j,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",$=>{$.preventDefault()}),this._element.addEventListener("mousedown",$=>{$.preventDefault()});const F=this._element.classList;for(const $ in Fg)F.remove(`mapboxgl-marker-anchor-${$}`);F.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=t&&t.className?t.className.trim().split(/\s+/):[];F.add(...Z),this._popup=null}_createDefaultMarker(){const t=Y("div"),a=le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=le("radialGradient",{id:"shadowGradient"},le("defs",{},a));le("stop",{offset:"10%","stop-opacity":.4},d),le("stop",{offset:"100%","stop-opacity":.05},d),le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ta.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,d=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const d=t.unproject(a,this._altitude),g=t.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(a,this._altitude);let g;t._showingGlobe()&&s.eK(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Fg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!t||d!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const g=s.cJ(s.eL(a.transform,this._lngLat)),y=t.sub(s.eM(a.transform)),v=Math.abs(y.x)+Math.abs(y.y);if(v===0)return"";const T=g/v;return`rotateX(${-y.y*T}deg) rotateY(${y.x*T}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let d=0;const g=this.getRotationAlignment();if(g==="map")if(a._showingGlobe()){const y=a.project(new s.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=a.project(new s.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);d=s.cJ(Math.atan2(v.y,v.x))-90}else d=-a.getBearing();else if(g==="horizon"){const y=s.af(4,6,a.getZoom()),v=s.eM(a.transform);v.y+=y*a.transform.height;const T=t.sub(v),C=s.cJ(Math.atan2(T.y,T.x));d=(C>90?C-270:C+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Tu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){const y=this._clickTolerance||a._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,d=this._pos;a&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ta.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ta.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ta.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ta.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Og={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xd={maxWidth:100,unit:"metric"},Eu={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ya={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ra=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zo(h=new s.P(0,0),t="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new s.P(0,h);case"top-left":return new s.P(a,a);case"top-right":return new s.P(-a,a);case"bottom":return new s.P(0,-h);case"bottom-left":return new s.P(a,-a);case"bottom-right":return new s.P(-a,-a);case"left":return new s.P(h,0);case"right":return new s.P(-h,0)}return new s.P(0,0)}return h instanceof s.P||Array.isArray(h)?s.P.convert(h):s.P.convert(h[t]||[0,0])}return{version:D,supported:de.supported,setRTLTextPlugin:s.eQ,getRTLTextPluginStatus:s.eP,Map:class extends md{constructor(h){H.mark(O.create);const t=h;if((h=s.h({},pf,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.eI(window)&&(h.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qm(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new gd,this._domRenderTaskQueue=new gd,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.h({},df,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Xa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new It(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new bg),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new zg(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||s.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new aw(this),h.hash&&(this._hash=new Cg(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,s.h({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Lg({customAttribution:h.customAttribution})),this._logoControl=new hf,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.A(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.A(`${a.dataType}dataloading`,a))}),this._interactions=new Sa(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",h)).fire(new s.A("move",h)),this.fire(new s.A("resize",h)),t&&this.fire(new s.A("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.aG.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let a;t==="globe"&&h.zoom>=s.cx?(h.setMercatorFromTransition(),a=!0):t==="mercator"&&h.zoom<s.cx&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=s.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(s.cd.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(s.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,a){const d=g=>{let y=[];if(Array.isArray(t)){const v=t.filter(T=>this.getLayer(T));y=v.length?this.queryRenderedFeatures(g,{layers:v}):[]}else y=this.queryRenderedFeatures(g,{target:t});return y};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:v=>{const T=d(v.point);T.length?g||(g=!0,a.call(this,new as(h,this,v.originalEvent,{features:T}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:a,targets:t,delegates:{mousemove:T=>{d(T.point).length?g=!0:g&&(g=!1,a.call(this,new as(h,this,T.originalEvent)))},mouseout:T=>{g&&(g=!1,a.call(this,new as(h,this,T.originalEvent)))}}}}{const g=y=>{const v=d(y.point);v.length&&(y.features=v,a.call(this,y),delete y.features)};return{listener:a,targets:t,delegates:{[h]:g}}}}on(h,t,a){if(typeof t=="function"||a===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,t,a){if(typeof t=="function"||a===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,t,a){if(typeof t=="function"||a===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(g=>{for(let y=0;y<g.length;y++){const v=g[y];if(v.listener===a&&_d(v.targets,t)){for(const T in v.delegates)this.off(T,v.delegates[T]);return g.splice(y,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof s.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(h,void 0,this.transform),v=this.style.queryRenderedFeatureset(h,void 0,this.transform);return y.concat(v)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let g=[];return d&&(g=g.concat(this.style.queryRenderedFeatures(h,t,this.transform))),a&&(g=g.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),g}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=s.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(a,d)=>{if(a){const g=typeof a=="string"?a:a instanceof Error?a.message:a.error;s.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const a=s.h({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new bs(this,a).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new bs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.d8(h)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:a=1,sdf:d=!1,stretchX:g,stretchY:y,content:v}={}){this._lazyInitEmptyStyle();const T=s.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:R,data:k}=s.q.getImageData(t);this.style.addImage(T,{data:new s.r({width:C,height:R},k),pixelRatio:a,stretchX:g,stretchY:y,content:v,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:R}=t,k=t;this.style.addImage(T,{data:new s.r({width:C,height:R},new Uint8Array(k.data)),pixelRatio:a,stretchX:g,stretchY:y,content:v,sdf:d,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const a=s.I.from(h),d=this.style.getImage(a);if(!d)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:y,height:v,data:T}=g;if(y===void 0||v===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||v!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let R=!1;d.usvg?(d.data=new s.r({width:y,height:v},new Uint8Array(T)),d.usvg=!1,d.icon=void 0,R=!0):d.data.replace(T,C),this.style.updateImage(a,d,R)}hasImage(h){return h?!!this.style&&!!this.style.getImage(s.I.from(h)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(s.I.from(h))}loadImage(h,t){s.o(this._requestManager.transformRequest(h,s.R.Image),(a,d)=>{t(a,d instanceof HTMLImageElement?s.q.getImageData(d):d)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch(a=>this.fire(new s.z(new Error("Failed to add import",a)))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,a),this._update(!0)):this}setFilter(h,t,a={}){return this._isValidId(h)?(this.style.setFilter(h,t,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,a,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,a,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,a){return this.style.setConfigProperty(h,t,a),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.cd.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,d,g,y=this._container;for(;y&&(!d||!g);){const v=window.getComputedStyle(y).transform;v&&v!=="none"&&(a=v.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(g=a[3])),y=y.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Y("div","mapboxgl-canvas-container",h);this._canvas=Y("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=Y("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{d[g]=Y("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const a=s.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=s.h({},de.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(nr(t,!0),this.painter=new yu(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.l.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new s.A("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,d=s.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,k=this.transform.pitch,L=s.q.now(),j=new s.aa(R,{now:L,fadeDuration:y,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d);const T=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),T&&(this._placementDirty=T.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,H.mark(O.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const R=s.q.now()-d;g.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const k=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:R,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(R);this.fire(new s.A("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(R);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:k}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(C||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,H.mark(O.fullLoad),this._performanceMetricsCollection&&_i(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const a=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const v=Math.abs(g-y);if(v>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,h,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){Er(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===xi||h.status===401)){const t=this.painter.context.gl;nr(t,!1),this._logoControl instanceof hf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Zi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ii(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function g(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const v=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,v),v}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(h,t,a){let d=a[1]-a[0];const g=h.length/4;for(let y=0;y<t.length;y++){const v=t[y];let T=0;for(let C=0;C<v.length;C+=4)v[C]===h[C]&&v[C+1]===h[C+1]&&v[C+2]===h[C+2]&&v[C+3]===h[C+3]&&(T+=1);d+=(a[y+2]-a[y+1])*(1-T/g)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),wr.delete(this.painter.context.gl),ji.remove(),Ki.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return s.bt(t,(a,d)=>a._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){s.eJ(h,t)}get version(){return D}},NavigationControl:class{constructor(h={}){this.options=s.h({},Dx,h),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),a=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ow(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const a=Y("button",h,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(h,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.E{constructor(h={}){super();const t=navigator.geolocation;this.options=s.h({geolocation:t},Og,h),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Al(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),a=h.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",h)),this._finish()}}_updateCamera(h){const t=new s.cd(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),g=s.h({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),g,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new s.cd(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=s.c6(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new yd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lg,ScaleControl:class{constructor(h={}){this.options=s.h({},xd,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,d=t._containerWidth/2-h/2,g=t.unproject([d,a]),y=t.unproject([d+h,a]),v=g.distanceTo(y);if(this.options.unit==="imperial"){const T=3.2808*v;T>5280?this._setScale(h,T/5280,"mile"):this._setScale(h,T,"foot")}else this.options.unit==="nautical"?this._setScale(h,v/1852,"nautical-mile"):v>=1e3?this._setScale(h,v/1e3,"kilometer"):this._setScale(h,v,"meter")}_setScale(h,t,a){this._map._requestDomTask(()=>{const d=function(y){const v=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/v;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(C){const R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(T),v*T}(t),g=d/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${Eu[a]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(h){super(),this.options=s.h(Object.create(Ya),h),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.cd.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const a=this._closeButton=Y("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,d=this._pos;if(!t||!a||!d)return"bottom";const g=a.offsetWidth,y=a.offsetHeight,v=d.x<g/2,T=d.x>t.transform.width-g/2;if(d.y+h<y)return v?"top-left":T?"top-right":"top";if(d.y>t.transform.height-y){if(v)return"bottom-left";if(T)return"bottom-right"}return v?"left":T?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=Y("div","mapboxgl-popup",t.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tu(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h instanceof s.P?h:t.project(this._lngLat,this._altitude),y=zo(this.options.offset),v=this._anchor=this._getAnchor(y.y),T=zo(this.options.offset,v),C=g.add(T).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Fg[v]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=s.eK(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(ra);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:yd,Style:bs,LngLat:s.cd,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:Ly,Evented:s.E,config:s.e,prewarm:s.eO,clearPrewarmedResources:s.eN,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(h){s.e.ACCESS_TOKEN=h},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(h){s.e.API_URL=h},get workerCount(){return s.eX.workerCount},set workerCount(h){s.eX.workerCount=h},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.eW(h)},get workerUrl(){return s.eV.workerUrl},set workerUrl(h){s.eV.workerUrl=h},get workerClass(){return s.eV.workerClass},set workerClass(h){s.eV.workerClass=h},get workerParams(){return s.eV.workerParams},set workerParams(h){s.eV.workerParams=h},get dracoUrl(){return s.eU()},set dracoUrl(h){s.eT(h)},get meshoptUrl(){return s.eS()},set meshoptUrl(h){s.eR(h)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var P=w;return P})})(AL);var jq=AL.exports;const kd=vT(jq),zq=()=>{const i=W.useRef(null),o=W.useRef(null),[u,m]=W.useState("");W.useState("");const[w,E]=W.useState(!1),P=[{name:"Saudi Arabia",coordinates:[45.0792,23.8859]},{name:"UAE",coordinates:[54.3773,24.4539]},{name:"Jordan",coordinates:[36.2384,30.5852]},{name:"Egypt",coordinates:[30.8025,26.8206]},{name:"Tunisia",coordinates:[9.5375,33.8869]},{name:"Morocco",coordinates:[-7.0926,31.7917]},{name:"Algeria",coordinates:[1.6596,28.0339]},{name:"Pakistan",coordinates:[69.3451,30.3753]}],s=[{name:"Nigeria",coordinates:[8.6753,9.082]},{name:"Cameroon",coordinates:[12.3547,7.3697]}],D=()=>{!i.current||!u||(kd.accessToken=u,o.current=new kd.Map({container:i.current,style:"mapbox://styles/mapbox/dark-v11",center:[25,25],zoom:2.5,pitch:0}),o.current.addControl(new kd.NavigationControl({visualizePitch:!0}),"top-right"),o.current.on("load",()=>{P.forEach(O=>{const H=document.createElement("div");H.className="primary-marker",H.style.cssText=`
          background-color: #3b82f6;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
          cursor: pointer;
        `,new kd.Marker(H).setLngLat(O.coordinates).setPopup(new kd.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${O.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Primary Focus</p>
                </div>
              `)).addTo(o.current)}),s.forEach(O=>{const H=document.createElement("div");H.className="secondary-marker",H.style.cssText=`
          background-color: #10b981;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          border: 2px solid white;
          box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
          cursor: pointer;
        `,new kd.Marker(H).setLngLat(O.coordinates).setPopup(new kd.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${O.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Secondary Focus</p>
                </div>
              `)).addTo(o.current)}),o.current.addSource("africa-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-20,40],[55,40],[55,-35],[-20,-35],[-20,40]]]},properties:{}}]}}),o.current.addLayer({id:"africa-highlight",type:"fill",source:"africa-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}}),o.current.addSource("middle-east-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[25,45],[75,45],[75,10],[25,10],[25,45]]]},properties:{}}]}}),o.current.addLayer({id:"middle-east-highlight",type:"fill",source:"middle-east-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}})}),E(!0))};return W.useEffect(()=>{u&&!w&&D()},[u,w]),W.useEffect(()=>()=>{o.current&&o.current.remove()},[]),u?_.jsx("div",{className:"py-20 bg-gray-900 text-white",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),_.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Strategic investment regions across Africa and the Middle East"})]}),_.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[_.jsx("div",{className:"lg:col-span-3",children:_.jsx("div",{className:"relative rounded-lg overflow-hidden shadow-2xl",children:_.jsx("div",{ref:i,className:"w-full h-96 lg:h-[500px]"})})}),_.jsxs("div",{className:"space-y-6",children:[_.jsxs(Wi,{className:"bg-gray-800 border-gray-700",children:[_.jsxs(cr,{children:[_.jsx(ur,{className:"text-white text-lg",children:"Primary Focus"}),_.jsx(Rn,{className:"text-gray-300",children:"Core investment markets"})]}),_.jsx(hr,{children:_.jsx("div",{className:"space-y-2",children:P.map((O,H)=>_.jsxs("div",{className:"flex items-center space-x-3",children:[_.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),_.jsx("span",{className:"text-gray-300 text-sm",children:O.name})]},H))})})]}),_.jsxs(Wi,{className:"bg-gray-800 border-gray-700",children:[_.jsxs(cr,{children:[_.jsx(ur,{className:"text-white text-lg",children:"Secondary Focus"}),_.jsx(Rn,{className:"text-gray-300",children:"Selective opportunities"})]}),_.jsx(hr,{children:_.jsx("div",{className:"space-y-2",children:s.map((O,H)=>_.jsxs("div",{className:"flex items-center space-x-3",children:[_.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),_.jsx("span",{className:"text-gray-300 text-sm",children:O.name})]},H))})})]}),_.jsxs(Wi,{className:"bg-gray-800 border-gray-700",children:[_.jsxs(cr,{children:[_.jsx(ur,{className:"text-white text-lg",children:"Opportunistic"}),_.jsx(Rn,{className:"text-gray-300",children:"Broader regional approach"})]}),_.jsx(hr,{children:_.jsxs("div",{className:"space-y-2",children:[_.jsxs("div",{className:"flex items-center space-x-3",children:[_.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),_.jsx("span",{className:"text-gray-300 text-sm",children:"African Markets"})]}),_.jsxs("div",{className:"flex items-center space-x-3",children:[_.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),_.jsx("span",{className:"text-gray-300 text-sm",children:"Middle East"})]})]})})]})]})]})]})}):_.jsx("div",{className:"py-20 bg-gray-900 text-white",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),_.jsx("p",{className:"text-xl text-gray-300",children:"Strategic investment regions across Africa and the Middle East"})]}),_.jsx("div",{className:"max-w-3xl mx-auto px-4",children:_.jsx(Wi,{className:"bg-gray-800 border-gray-700 overflow-hidden rounded-xl",children:_.jsx("img",{src:"/lovable-uploads/map.jpg",alt:"Map",className:"w-full h-auto object-contain"})})})]})})},Lq=()=>{const i=[{name:"Agritech and Food Security",icon:sR,description:"Supporting innovative solutions for sustainable agriculture, precision farming, and food security across Africa"},{name:"Waste Management",icon:iV,description:"Investing in circular economy solutions, waste-to-energy technologies, and sustainable waste processing systems"},{name:"E-Mobility",icon:GS,description:"Accelerating electric vehicle adoption, charging infrastructure, and sustainable transportation solutions"},{name:"RE Optimization",icon:Z6,description:"Enhancing renewable energy efficiency through smart grid technologies and energy storage solutions"},{name:"Clean Industries",icon:Zd,description:"Transforming industrial processes through clean technologies and sustainable manufacturing practices"},{name:"Sustainable Supply Chain",icon:aV,description:"Building transparent, efficient, and environmentally responsible supply chain solutions"}],o=[{title:"$40M Fund Size",description:"Targeting sustainability and climate tech startups from ideation to series A",icon:YN},{title:"Regional Focus",description:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan",icon:J6},{title:"Beyond Capital",description:"Venture building, expert guidance, and global network access",icon:Zd}];return _.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:["Powering the Future of Sustainability",_.jsx("span",{className:"block",children:"and Climate Tech"}),_.jsxs("span",{className:"block",children:["Across  ",_.jsx("span",{className:"gradient-text",children:"MENA+"})]})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-4",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges."}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]})})}),_.jsx("section",{className:"py-20",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Fund Highlights"}),_.jsx("p",{className:"text-xl text-gray-600",children:"Strategic investment focused on maximum impact"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:o.map((u,m)=>{const w=u.icon;return _.jsx(Wi,{className:"text-center hover:shadow-lg transition-shadow",children:_.jsxs(cr,{children:[_.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(w,{className:"h-8 w-8 text-primary"})}),_.jsx(ur,{className:"text-xl",children:u.title}),_.jsx(Rn,{className:"text-base",children:u.description})]})},m)})})]})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Investment Focus"}),_.jsx("p",{className:"text-xl text-gray-600",children:"Six key sectors driving climate innovation across Africa"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map((u,m)=>{const w=u.icon;return _.jsx(Wi,{className:"text-center hover:shadow-lg transition-shadow",children:_.jsxs(cr,{children:[_.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(w,{className:"h-8 w-8 text-primary"})}),_.jsx(ur,{className:"text-lg",children:u.name}),_.jsx(Rn,{className:"text-sm text-gray-600 mt-2",children:u.description})]})},m)})})]})}),_.jsx(zq,{}),_.jsx("section",{className:"py-20 bg-white",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Impact and Sustainability"}),_.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our commitment to responsible investing drives positive environmental and social outcomes"})]}),_.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto",children:[_.jsxs(Wi,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[_.jsxs(cr,{children:[_.jsx("div",{className:"w-16 h-16  bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(sR,{className:"h-8 w-8 text-primary"})}),_.jsx(ur,{className:"text-xl text-center",children:"ESG Considerations"})]}),_.jsx(hr,{children:_.jsxs(Rn,{className:"text-base text-gray-600 space-y-4",children:[_.jsx("p",{children:"Investing with Purpose and Responsibility At Betaventures, ESG (Environmental, Social, and Governance) principles are embedded into every investment decision we make."}),_.jsxs("ul",{className:"space-y-2",children:[_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"Rigorous impact assessments for every portfolio company"})]}),_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"Tailored ESG action plans to improve performance over time"})]}),_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"Clear reporting on local and regional impact"})]}),_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:" Active advocacy for responsible innovation and sustainable growth"})]})]})]})})]}),_.jsxs(Wi,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[_.jsxs(cr,{children:[_.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(Zd,{className:"h-8 w-8 text-primary"})}),_.jsx(ur,{className:"text-xl text-center",children:"Gender Lens Investing"})]}),_.jsx(hr,{children:_.jsxs(Rn,{className:"text-base text-gray-600 space-y-4",children:[_.jsx("p",{children:"We are committed to building a more inclusive and equitable startup ecosystem. Betaventures aims for at least 40% of its portfolio to be made up of startups founded or co-founded by women."}),_.jsxs("ul",{className:"space-y-2",children:[_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"To further support this mission, we are committing 1% of the fund’s carry to programs that empower girls and women in tech across the MENA+ region."})]}),_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"Promoting workplace diversity and inclusion"})]}),_.jsxs("li",{className:"flex items-start",children:[_.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{children:"Creating products and services that benefit women"})]})]})]})})]})]})]})}),_.jsx("section",{className:"py-20 bg-gradient-to-r from-blue-600 via-primary to-cyan-500 text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Ready to Transform Climate Tech?"}),_.jsx("p",{className:"text-xl mb-12 opacity-90 max-w-2xl mx-auto",children:"Join us in building the future of climate technology across Africa"}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[_.jsxs(Wi,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[_.jsxs(cr,{className:"text-center pb-4",children:[_.jsx(ur,{className:"text-white text-xl mb-2",children:"For Startups"}),_.jsx(Rn,{className:"text-white/80",children:"Apply for funding and join our ecosystem"})]}),_.jsx(hr,{className:"text-center",children:_.jsx(Yt,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:_.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})})]}),_.jsxs(Wi,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[_.jsxs(cr,{className:"text-center pb-4",children:[_.jsx(ur,{className:"text-white text-xl mb-2",children:"For Investors"}),_.jsx(Rn,{className:"text-white/80",children:"Partner with us to drive climate impact"})]}),_.jsx(hr,{className:"text-center",children:_.jsx(Yt,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:_.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})})]})]})]})})]})},Fq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState(!0),[w,E]=W.useState("all");W.useEffect(()=>{(async()=>{try{const O=await ao.getCaseStudies();o(O)}catch(O){console.error("Error fetching case studies:",O)}finally{m(!1)}})()},[]);const P=["all",...Array.from(new Set(i.map(D=>D.industry)))],s=w==="all"?i:i.filter(D=>D.industry===w);return u?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:[_.jsx("span",{className:"gradient-text",children:"Our"})," Portfolio"]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Discover how we've helped startups overcome challenges, secure funding, and achieve remarkable growth. These are the stories of innovation, perseverance, and success."})]})})}),_.jsx("section",{className:"py-8 border-b",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:P.map(D=>_.jsx("button",{onClick:()=>E(D),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${w===D?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:D==="all"?"All Industries":D},D))})})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"grid grid-cols-1 gap-12",children:s.map((D,O)=>{var H,G,U;return _.jsx(Wi,{className:`overflow-hidden  hover:shadow-xl transition-all duration-300 ${O%2===1?"lg:flex-row-reverse":""}`,children:_.jsxs("div",{className:"lg:flex",children:[_.jsx("div",{className:"lg:w-1/2",children:_.jsx("div",{className:"aspect-video lg:aspect-square",children:_.jsx("img",{src:D.image,alt:D.companyName,className:"w-full h-full object-cover"})})}),_.jsxs("div",{className:"lg:w-1/2 p-8",children:[_.jsxs(cr,{className:"p-0 mb-6",children:[_.jsxs("div",{className:"flex items-center justify-between mb-4",children:[_.jsx(ur,{className:"text-2xl",children:D.companyName}),_.jsx(Ls,{variant:"secondary",children:D.industry})]}),_.jsx(Rn,{className:"text-base",children:D.description})]}),_.jsxs(hr,{className:"p-0 space-y-6",children:[_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"The Challenge"}),_.jsx("p",{className:"text-gray-600 text-sm",children:D.challenge})]}),_.jsxs("div",{children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Our Solution"}),_.jsx("p",{className:"text-gray-600 text-sm",children:D.solution})]})]}),_.jsxs("div",{children:[_.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Results"}),_.jsx("ul",{className:"space-y-2",children:D.results.map((he,de)=>_.jsxs("li",{className:"flex items-start text-sm",children:[_.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),_.jsx("span",{className:"text-gray-600",children:he})]},de))})]}),((G=(H=D.testimonial)==null?void 0:H.quote)==null?void 0:G.trim())&&_.jsxs("div",{className:"bg-primary/5 p-6 rounded-lg",children:[_.jsxs("blockquote",{className:"text-gray-700 italic mb-4",children:['"',D.testimonial.quote,'"']}),_.jsxs("div",{className:"flex items-center",children:[_.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-4",children:_.jsx("span",{className:"text-primary font-semibold text-lg",children:((U=D.testimonial.author)==null?void 0:U.charAt(0))||""})}),_.jsxs("div",{children:[_.jsx("div",{className:"font-semibold text-gray-900",children:D.testimonial.author}),_.jsx("div",{className:"text-sm text-gray-600",children:D.testimonial.position})]})]})]}),_.jsx("div",{className:"flex flex-wrap gap-2",children:D.tags.map((he,de)=>_.jsx(Ls,{variant:"outline",className:"text-xs",children:he},de))})]})]})]})},D.id)})})})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-12",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Impact"}),_.jsx("p",{className:"text-xl text-gray-600",children:"Numbers that showcase our commitment to startup success"})]}),_.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-8",children:[{value:"250+",label:"Startups Supported"},{value:"10+",label:"Innovation Programs"},{value:"12",label:"Startups from scratch"}].map((D,O)=>_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"text-3xl md:text-4xl font-bold text-primary mb-2",children:D.value}),_.jsx("div",{className:"text-gray-600 text-sm",children:D.label})]},O))})]})})]})},Oq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState(!0),[w,E]=W.useState("all"),[P,s]=W.useState(""),[D,O]=W.useState(!1),[H,G]=W.useState(!1);W.useEffect(()=>{(async()=>{try{const re=await ao.getBlogPosts();o(re)}catch(re){console.error("Error fetching blog posts:",re)}finally{m(!1)}})()},[]);const U=["all",...Array.from(new Set(i.map(le=>le.category)))],he=w==="all"?i:i.filter(le=>le.category===w),de=le=>new Date(le).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),Y=async le=>{if(le.preventDefault(),!!P){O(!0);try{(await fetch("http://localhost:3000/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:P,subject:"Newsletter",message:"",status:"unread"})})).ok&&(G(!0),s(""),setTimeout(()=>G(!1),3e3))}catch(re){console.error("Newsletter subscription error:",re)}finally{O(!1)}}};return u?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[_.jsx(Yt,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:_.jsxs(Nr,{to:"/",className:"flex items-center space-x-2",children:[_.jsx(Yl,{size:16}),_.jsx("span",{children:"Back to Home"})]})}),_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",_.jsx("span",{className:"gradient-text",children:"Insights"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Stay updated with the latest trends, tips, and insights from the startup world. Our experts share knowledge to help you navigate your entrepreneurial journey."})]})})}),_.jsx("section",{className:"py-8 border-b",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:U.map(le=>_.jsx("button",{onClick:()=>E(le),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${w===le?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:le==="all"?"All Categories":le},le))})})}),he.length>0&&_.jsx("section",{className:"py-16",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"mb-8",children:[_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Featured Article"}),_.jsx("p",{className:"text-gray-600",children:"Our latest insights on startup growth and innovation"})]}),_.jsx(Wi,{className:"overflow-hidden hover:shadow-xl transition-shadow",children:_.jsxs("div",{className:"md:flex",children:[_.jsx("div",{className:"md:w-1/2",children:_.jsx("img",{src:he[0].image,alt:he[0].title,className:"w-full h-64 md:h-full object-cover"})}),_.jsxs("div",{className:"md:w-1/2 p-8",children:[_.jsxs(cr,{className:"p-0 mb-4",children:[_.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[_.jsx(Ls,{children:he[0].category}),_.jsx("span",{className:"text-sm text-gray-500",children:de(he[0].publishDate)})]}),_.jsx(ur,{className:"text-2xl md:text-3xl mb-4",children:he[0].title}),_.jsx(Rn,{className:"text-base",children:he[0].excerpt})]}),_.jsx(hr,{className:"p-0",children:_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center",children:[_.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:_.jsx("span",{className:"text-primary font-semibold",children:he[0].author.charAt(0)})}),_.jsxs("div",{children:[_.jsx("div",{className:"font-medium text-gray-900",children:he[0].author}),_.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),_.jsx(Nr,{to:`/blog/${he[0].id}`,className:"text-primary hover:text-primary/80 font-medium text-sm",children:"Read More →"})]})})]})]})})]})}),_.jsx("section",{className:"py-16",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:he.slice(1).map(le=>_.jsxs(Wi,{className:"overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[_.jsx("div",{className:"aspect-video",children:_.jsx("img",{src:le.image,alt:le.title,className:"w-full h-full object-cover"})}),_.jsxs(cr,{className:"pb-4",children:[_.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[_.jsx(Ls,{variant:"secondary",className:"text-xs",children:le.category}),_.jsx("span",{className:"text-xs text-gray-500",children:de(le.publishDate)})]}),_.jsx(ur,{className:"text-lg leading-tight mb-2",children:le.title}),_.jsx(Rn,{className:"text-sm line-clamp-3",children:le.excerpt})]}),_.jsxs(hr,{className:"pt-0",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center",children:[_.jsx("div",{className:"w-8 h-8 bg-primary/20 rounded-full flex items-center justify-center mr-2",children:_.jsx("span",{className:"text-primary font-semibold text-sm",children:le.author.charAt(0)})}),_.jsx("span",{className:"text-sm text-gray-600",children:le.author})]}),_.jsx(Nr,{to:`/blog/${le.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read →"})]}),_.jsx("div",{className:"flex flex-wrap gap-1 mt-4",children:le.tags.slice(0,3).map((re,oe)=>_.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:re},oe))})]})]},le.id))})})}),_.jsx("section",{className:"py-20 bg-primary text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Stay Updated"}),_.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[_.jsxs("form",{onSubmit:Y,className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[_.jsx("input",{type:"email",placeholder:"Enter your email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:P,onChange:le=>s(le.target.value),required:!0}),_.jsx("button",{type:"submit",disabled:D,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:D?"Subscribing...":"Subscribe"})]}),H&&_.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]})})]})},Bq=()=>{const{id:i}=e$(),[o,u]=W.useState(null),[m,w]=W.useState(!0),[E,P]=W.useState([]);W.useEffect(()=>{(async()=>{try{const H=await ao.getBlogPosts(),G=H.find(U=>U.id===i);if(u(G||null),G){const U=H.filter(he=>he.category===G.category&&he.id!==G.id).slice(0,3);P(U)}}catch(H){console.error("Error fetching blog post:",H)}finally{w(!1)}})()},[i]);const s=O=>new Date(O).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),D=O=>{const G=O.split(" ").length;return`${Math.ceil(G/200)} min read`};return m?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):o?_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto",children:[_.jsxs(Nr,{to:"/blog",className:"inline-flex items-center text-primary hover:text-primary/80 mb-6",children:[_.jsx(Yl,{className:"mr-2 h-4 w-4"}),"Back to Blog"]}),_.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[_.jsx(Ls,{children:o.category}),_.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[_.jsxs("div",{className:"flex items-center gap-1",children:[_.jsx(US,{className:"h-4 w-4"}),s(o.publishDate)]}),_.jsxs("div",{className:"flex items-center gap-1",children:[_.jsx(cV,{className:"h-4 w-4"}),o.author]}),_.jsxs("div",{className:"flex items-center gap-1",children:[_.jsx(W6,{className:"h-4 w-4"}),D(o.content)]})]})]}),_.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:o.title}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-8",children:o.excerpt}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsxs("div",{className:"flex items-center",children:[_.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:_.jsx("span",{className:"text-primary font-semibold text-lg",children:o.author.charAt(0)})}),_.jsxs("div",{children:[_.jsx("div",{className:"font-medium text-gray-900",children:o.author}),_.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),_.jsxs(Yt,{variant:"outline",size:"sm",className:"ml-auto",children:[_.jsx(rV,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})}),_.jsx("section",{className:"py-8",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"max-w-4xl mx-auto",children:_.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:_.jsx("img",{src:o.image,alt:o.title,className:"w-full h-full object-cover"})})})})}),_.jsx("section",{className:"py-8",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto",children:[_.jsx("div",{className:"prose prose-lg max-w-none",children:_.jsx("div",{className:"text-gray-700 leading-relaxed space-y-6",children:_.jsx("p",{children:o.content})})}),_.jsx("div",{className:"flex flex-wrap gap-2 mt-12 pt-8 border-t",children:o.tags.map((O,H)=>_.jsx(Ls,{variant:"secondary",className:"text-sm",children:O},H))})]})})}),E.length>0&&_.jsx("section",{className:"py-16 bg-gray-50",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"max-w-4xl mx-auto",children:[_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-8",children:"Related Articles"}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:E.map(O=>_.jsxs(Wi,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[_.jsx("div",{className:"aspect-video",children:_.jsx("img",{src:O.image,alt:O.title,className:"w-full h-full object-cover"})}),_.jsxs(hr,{className:"p-6",children:[_.jsx(Ls,{variant:"secondary",className:"mb-3 text-xs",children:O.category}),_.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:O.title}),_.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:O.excerpt}),_.jsx(Nr,{to:`/blog/${O.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read More →"})]})]},O.id))})]})})})]}):_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsxs("div",{className:"text-center",children:[_.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Blog Post Not Found"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"The blog post you're looking for doesn't exist."}),_.jsx(Nr,{to:"/blog",children:_.jsxs(Yt,{children:[_.jsx(Yl,{className:"mr-2 h-4 w-4"}),"Back to Blog"]})})]})})},Vq=()=>{const[i,o]=W.useState([]),[u,m]=W.useState(!0),[w,E]=W.useState("all");W.useEffect(()=>{(async()=>{try{const G=await ao.getEvents();o(G)}catch(G){console.error("Error fetching events:",G)}finally{m(!1)}})()},[]);const P=["all","workshop","webinar","networking","pitch"],s=w==="all"?i:i.filter(H=>H.type===w),D=H=>new Date(H).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),O=H=>({workshop:"bg-blue-100 text-blue-800",webinar:"bg-green-100 text-green-800",networking:"bg-purple-100 text-purple-800",pitch:"bg-orange-100 text-orange-800"})[H]||"bg-gray-100 text-gray-800";return u?_.jsx("div",{className:"min-h-screen flex items-center justify-center",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Upcoming ",_.jsx("span",{className:"gradient-text",children:"Events"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Join our community events, workshops, and networking sessions designed to accelerate your startup journey. Connect with fellow entrepreneurs, investors, and industry experts."})]})})}),_.jsx("section",{className:"py-8 border-b",children:_.jsx("div",{className:"container-width section-padding",children:_.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:P.map(H=>_.jsx("button",{onClick:()=>E(H),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors capitalize ${w===H?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:H==="all"?"All Events":H},H))})})}),_.jsx("section",{className:"py-20",children:_.jsx("div",{className:"container-width section-padding",children:s.length===0?_.jsxs("div",{className:"text-center py-20",children:[_.jsx(US,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),_.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No events found"}),_.jsx("p",{className:"text-gray-600",children:"Check back soon for upcoming events!"})]}):_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map((H,G)=>_.jsx(Wi,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 ${G===0?"md:col-span-2 lg:col-span-2":""}`,children:_.jsxs("div",{className:`${G===0?"md:flex":""}`,children:[_.jsx("div",{className:`${G===0?"md:w-1/2":""} aspect-video`,children:_.jsx("img",{src:H.image,alt:H.title,className:"w-full h-full object-cover"})}),_.jsxs("div",{className:`${G===0?"md:w-1/2":""} p-6`,children:[_.jsxs(cr,{className:"p-0 mb-4",children:[_.jsxs("div",{className:"flex items-center justify-between mb-3",children:[_.jsx(Ls,{className:`capitalize ${O(H.type)}`,children:H.type}),_.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[_.jsx(US,{className:"h-4 w-4 mr-1"}),H.time]})]}),_.jsx(ur,{className:`${G===0?"text-2xl":"text-lg"} mb-2`,children:H.title}),_.jsx(Rn,{className:"text-sm",children:H.description})]}),_.jsxs(hr,{className:"p-0 space-y-4",children:[_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex items-start",children:[_.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Date:"}),_.jsx("span",{className:"text-gray-600",children:D(H.date)})]}),_.jsxs("div",{className:"flex items-start",children:[_.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Location:"}),_.jsx("span",{className:"text-gray-600",children:H.location})]})]}),_.jsx(Yt,{className:"w-full",size:G===0?"lg":"default",children:_.jsx("a",{href:H.registrationUrl,target:"_blank",rel:"noopener noreferrer",children:_.jsx(Yt,{className:"w-full",size:G===0?"lg":"default",children:"Register Now"})})})]})]})]})},H.id))})})}),_.jsx("section",{className:"py-20 bg-gray-50",children:_.jsxs("div",{className:"container-width section-padding",children:[_.jsxs("div",{className:"text-center mb-16",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Types of Events"}),_.jsx("p",{className:"text-xl text-gray-600",children:"We host various types of events to support your entrepreneurial journey"})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{type:"Workshops",description:"Hands-on learning sessions covering essential startup skills and technologies",icon:"🛠️"},{type:"Webinars",description:"Online sessions with industry experts sharing insights and best practices",icon:"💻"},{type:"Networking",description:"Connect with fellow entrepreneurs, mentors, and potential partners",icon:"🤝"},{type:"Pitch Events",description:"Opportunities to present your startup to investors and get feedback",icon:"🚀"}].map((H,G)=>_.jsxs(Wi,{className:"text-center p-6",children:[_.jsx("div",{className:"text-4xl mb-4",children:H.icon}),_.jsx("h3",{className:"text-lg font-semibold mb-2",children:H.type}),_.jsx("p",{className:"text-gray-600 text-sm",children:H.description})]},G))})]})}),_.jsx("section",{className:"py-20 bg-primary text-white",children:_.jsxs("div",{className:"container-width section-padding text-center",children:[_.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Want to Host an Event?"}),_.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Partner with us to organize workshops, networking events, or speaking sessions for our startup community."}),_.jsx(Yt,{size:"lg",variant:"secondary",children:"Partner With Us"})]})})]})},Uq=()=>{const[i,o]=W.useState({name:"",email:"",company:"",program:"",message:""}),[u,m]=W.useState(!1),{toast:w}=Iy(),E=s=>{const{name:D,value:O}=s.target;o(H=>({...H,[D]:O}))},P=async s=>{s.preventDefault(),m(!0);try{if(!(await fetch("http://localhost:3000/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name,email:i.email,subject:i.program||i.company||"General Inquiry",message:i.message,timestamp:new Date,status:"unread"})})).ok)throw new Error("Failed to send message");w({title:"Message sent successfully!",description:"We'll get back to you within 24 hours."}),o({name:"",email:"",company:"",program:"",message:""})}catch(D){console.error("Submission error:",D),w({title:"Submission failed",description:"There was a problem sending your message.",variant:"destructive"})}finally{m(!1)}};return _.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[_.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Get In ",_.jsx("span",{className:"gradient-text",children:"Touch"})]}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Ready to transform your startup idea into reality? Let's discuss how Betawaves can support your entrepreneurial journey."})]})})}),_.jsx("section",{className:"py-20",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16",children:[_.jsx("div",{className:"space-y-8",children:_.jsxs("div",{className:"space-y-6",children:[_.jsxs(Wi,{className:"p-6",children:[_.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Office Locations"}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx("h4",{className:"font-medium",children:"Level 1 Gate Avenue"}),_.jsxs("p",{className:"text-gray-600 text-sm",children:["South Zone, Dubai International Financial Centre",_.jsx("br",{}),"United Arab Emirates",_.jsx("br",{}),"+971 58 829 0773"]})]}),_.jsx("div",{})]})]}),_.jsxs(Wi,{className:"p-6",children:[_.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Contact"}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{children:[_.jsx("span",{className:"font-medium",children:"General Inquiries:"}),_.jsx("br",{}),_.jsx("a",{href:"mailto:hello@betawaves.com",className:"text-primary hover:underline",children:"hello@betawaves.com"})]}),_.jsxs("div",{children:[_.jsx("span",{className:"font-medium",children:"Program Applications:"}),_.jsx("br",{}),_.jsx("a",{href:"mailto:apply@betawaves.com",className:"text-primary hover:underline",children:"apply@betawaves.com"})]}),_.jsxs("div",{children:[_.jsx("span",{className:"font-medium",children:"Partnership Opportunities:"}),_.jsx("br",{}),_.jsx("a",{href:"mailto:partners@betawaves.com",className:"text-primary hover:underline",children:"partners@betawaves.com"})]})]})]})]})}),_.jsx("div",{children:_.jsxs(Wi,{children:[_.jsxs(cr,{children:[_.jsx(ur,{className:"text-2xl",children:"Send us a message"}),_.jsx(Rn,{children:"Fill out the form below and we'll get back to you within 24 hours."})]}),_.jsx(hr,{children:_.jsxs("form",{onSubmit:P,className:"space-y-6",children:[_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"name",children:"Full Name *"}),_.jsx(Si,{id:"name",name:"name",value:i.name,onChange:E,required:!0,className:"mt-1"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"email",children:"Email Address *"}),_.jsx(Si,{id:"email",name:"email",type:"email",value:i.email,onChange:E,required:!0,className:"mt-1"})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"company",children:"Company/Startup Name"}),_.jsx(Si,{id:"company",name:"company",value:i.company,onChange:E,className:"mt-1"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"program",children:"Interest"}),_.jsxs("select",{id:"program",name:"program",value:i.program,onChange:E,className:"mt-1 w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[_.jsx("option",{value:"",children:"Select a program"}),_.jsx("option",{value:"incubation",children:"Products"}),_.jsx("option",{value:"acceleration",children:"Consulting"}),_.jsx("option",{value:"bootcamp",children:"Investment"}),_.jsx("option",{value:"cxo-academy",children:"Programs"})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"message",children:"Message *"}),_.jsx(Xn,{id:"message",name:"message",value:i.message,onChange:E,required:!0,rows:5,className:"mt-1",placeholder:"Tell us about your startup, your goals, and how we can help..."})]}),_.jsx(Yt,{type:"submit",className:"w-full",size:"lg",disabled:u,children:u?"Sending...":"Send Message"})]})})]})})]})})})]})};function Gq(i,o=[]){let u=[];function m(E,P){const s=W.createContext(P),D=u.length;u=[...u,P];function O(G){const{scope:U,children:he,...de}=G,Y=(U==null?void 0:U[i][D])||s,le=W.useMemo(()=>de,Object.values(de));return _.jsx(Y.Provider,{value:le,children:he})}function H(G,U){const he=(U==null?void 0:U[i][D])||s,de=W.useContext(he);if(de)return de;if(P!==void 0)return P;throw new Error(`\`${G}\` must be used within \`${E}\``)}return O.displayName=E+"Provider",[O,H]}const w=()=>{const E=u.map(P=>W.createContext(P));return function(s){const D=(s==null?void 0:s[i])||E;return W.useMemo(()=>({[`__scope${i}`]:{...s,[i]:D}}),[s,D])}};return w.scopeName=i,[m,$q(w,...o)]}function $q(...i){const o=i[0];if(i.length===1)return o;const u=()=>{const m=i.map(w=>({useScope:w(),scopeName:w.scopeName}));return function(E){const P=m.reduce((s,{useScope:D,scopeName:O})=>{const G=D(E)[`__scope${O}`];return{...s,...G}},{});return W.useMemo(()=>({[`__scope${o.scopeName}`]:P}),[P])}};return u.scopeName=o.scopeName,u}var $2="rovingFocusGroup.onEntryFocus",qq={bubbles:!1,cancelable:!0},tw="RovingFocusGroup",[xT,ML,Hq]=mE(tw),[Wq,RL]=Gq(tw,[Hq]),[Zq,Xq]=Wq(tw),kL=W.forwardRef((i,o)=>_.jsx(xT.Provider,{scope:i.__scopeRovingFocusGroup,children:_.jsx(xT.Slot,{scope:i.__scopeRovingFocusGroup,children:_.jsx(Yq,{...i,ref:o})})}));kL.displayName=tw;var Yq=W.forwardRef((i,o)=>{const{__scopeRovingFocusGroup:u,orientation:m,loop:w=!1,dir:E,currentTabStopId:P,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:D,onEntryFocus:O,preventScrollOnEntryFocus:H=!1,...G}=i,U=W.useRef(null),he=kn(o,U),de=HE(E),[Y=null,le]=tp({prop:P,defaultProp:s,onChange:D}),[re,oe]=W.useState(!1),_e=Ho(O),Ne=ML(u),Ge=W.useRef(!1),[pt,ot]=W.useState(0);return W.useEffect(()=>{const dt=U.current;if(dt)return dt.addEventListener($2,_e),()=>dt.removeEventListener($2,_e)},[_e]),_.jsx(Zq,{scope:u,orientation:m,dir:de,loop:w,currentTabStopId:Y,onItemFocus:W.useCallback(dt=>le(dt),[le]),onItemShiftTab:W.useCallback(()=>oe(!0),[]),onFocusableItemAdd:W.useCallback(()=>ot(dt=>dt+1),[]),onFocusableItemRemove:W.useCallback(()=>ot(dt=>dt-1),[]),children:_.jsx(jr.div,{tabIndex:re||pt===0?-1:0,"data-orientation":m,...G,ref:he,style:{outline:"none",...i.style},onMouseDown:ir(i.onMouseDown,()=>{Ge.current=!0}),onFocus:ir(i.onFocus,dt=>{const Bt=!Ge.current;if(dt.target===dt.currentTarget&&Bt&&!re){const Wt=new CustomEvent($2,qq);if(dt.currentTarget.dispatchEvent(Wt),!Wt.defaultPrevented){const Ht=Ne().filter(Zt=>Zt.focusable),ei=Ht.find(Zt=>Zt.active),xi=Ht.find(Zt=>Zt.id===Y),ui=[ei,xi,...Ht].filter(Boolean).map(Zt=>Zt.ref.current);jL(ui,H)}}Ge.current=!1}),onBlur:ir(i.onBlur,()=>oe(!1))})})}),DL="RovingFocusGroupItem",NL=W.forwardRef((i,o)=>{const{__scopeRovingFocusGroup:u,focusable:m=!0,active:w=!1,tabStopId:E,...P}=i,s=dh(),D=E||s,O=Xq(DL,u),H=O.currentTabStopId===D,G=ML(u),{onFocusableItemAdd:U,onFocusableItemRemove:he}=O;return W.useEffect(()=>{if(m)return U(),()=>he()},[m,U,he]),_.jsx(xT.ItemSlot,{scope:u,id:D,focusable:m,active:w,children:_.jsx(jr.span,{tabIndex:H?0:-1,"data-orientation":O.orientation,...P,ref:o,onMouseDown:ir(i.onMouseDown,de=>{m?O.onItemFocus(D):de.preventDefault()}),onFocus:ir(i.onFocus,()=>O.onItemFocus(D)),onKeyDown:ir(i.onKeyDown,de=>{if(de.key==="Tab"&&de.shiftKey){O.onItemShiftTab();return}if(de.target!==de.currentTarget)return;const Y=Jq(de,O.orientation,O.dir);if(Y!==void 0){if(de.metaKey||de.ctrlKey||de.altKey||de.shiftKey)return;de.preventDefault();let re=G().filter(oe=>oe.focusable).map(oe=>oe.ref.current);if(Y==="last")re.reverse();else if(Y==="prev"||Y==="next"){Y==="prev"&&re.reverse();const oe=re.indexOf(de.currentTarget);re=O.loop?eH(re,oe+1):re.slice(oe+1)}setTimeout(()=>jL(re))}})})})});NL.displayName=DL;var Kq={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Qq(i,o){return o!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function Jq(i,o,u){const m=Qq(i.key,u);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(m))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(m)))return Kq[m]}function jL(i,o=!1){const u=document.activeElement;for(const m of i)if(m===u||(m.focus({preventScroll:o}),document.activeElement!==u))return}function eH(i,o){return i.map((u,m)=>i[(o+m)%i.length])}var tH=kL,iH=NL,ZE="Tabs",[rH,ZH]=Rm(ZE,[RL]),zL=RL(),[nH,XE]=rH(ZE),LL=W.forwardRef((i,o)=>{const{__scopeTabs:u,value:m,onValueChange:w,defaultValue:E,orientation:P="horizontal",dir:s,activationMode:D="automatic",...O}=i,H=HE(s),[G,U]=tp({prop:m,onChange:w,defaultProp:E});return _.jsx(nH,{scope:u,baseId:dh(),value:G,onValueChange:U,orientation:P,dir:H,activationMode:D,children:_.jsx(jr.div,{dir:H,"data-orientation":P,...O,ref:o})})});LL.displayName=ZE;var FL="TabsList",OL=W.forwardRef((i,o)=>{const{__scopeTabs:u,loop:m=!0,...w}=i,E=XE(FL,u),P=zL(u);return _.jsx(tH,{asChild:!0,...P,orientation:E.orientation,dir:E.dir,loop:m,children:_.jsx(jr.div,{role:"tablist","aria-orientation":E.orientation,...w,ref:o})})});OL.displayName=FL;var BL="TabsTrigger",VL=W.forwardRef((i,o)=>{const{__scopeTabs:u,value:m,disabled:w=!1,...E}=i,P=XE(BL,u),s=zL(u),D=$L(P.baseId,m),O=qL(P.baseId,m),H=m===P.value;return _.jsx(iH,{asChild:!0,...s,focusable:!w,active:H,children:_.jsx(jr.button,{type:"button",role:"tab","aria-selected":H,"aria-controls":O,"data-state":H?"active":"inactive","data-disabled":w?"":void 0,disabled:w,id:D,...E,ref:o,onMouseDown:ir(i.onMouseDown,G=>{!w&&G.button===0&&G.ctrlKey===!1?P.onValueChange(m):G.preventDefault()}),onKeyDown:ir(i.onKeyDown,G=>{[" ","Enter"].includes(G.key)&&P.onValueChange(m)}),onFocus:ir(i.onFocus,()=>{const G=P.activationMode!=="manual";!H&&!w&&G&&P.onValueChange(m)})})})});VL.displayName=BL;var UL="TabsContent",GL=W.forwardRef((i,o)=>{const{__scopeTabs:u,value:m,forceMount:w,children:E,...P}=i,s=XE(UL,u),D=$L(s.baseId,m),O=qL(s.baseId,m),H=m===s.value,G=W.useRef(H);return W.useEffect(()=>{const U=requestAnimationFrame(()=>G.current=!1);return()=>cancelAnimationFrame(U)},[]),_.jsx(up,{present:w||H,children:({present:U})=>_.jsx(jr.div,{"data-state":H?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":D,hidden:!U,id:O,tabIndex:0,...P,ref:o,style:{...i.style,animationDuration:G.current?"0s":void 0},children:U&&E})})});GL.displayName=UL;function $L(i,o){return`${i}-trigger-${o}`}function qL(i,o){return`${i}-content-${o}`}var sH=LL,HL=OL,WL=VL,ZL=GL;const oH=sH,XL=W.forwardRef(({className:i,...o},u)=>_.jsx(HL,{ref:u,className:Zr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",i),...o}));XL.displayName=HL.displayName;const Bl=W.forwardRef(({className:i,...o},u)=>_.jsx(WL,{ref:u,className:Zr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",i),...o}));Bl.displayName=WL.displayName;const Aa=W.forwardRef(({className:i,...o},u)=>_.jsx(ZL,{ref:u,className:Zr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",i),...o}));Aa.displayName=ZL.displayName;const aH=({onLogout:i,onStyleSettingsOpen:o,onPopupManagementOpen:u})=>_.jsx("div",{className:"bg-white shadow-sm border-b",children:_.jsx("div",{className:"container-width section-padding",children:_.jsxs("div",{className:"py-6 flex justify-between items-center",children:[_.jsxs("div",{children:[_.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Content Management Dashboard"}),_.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your website content from this dashboard"})]}),_.jsxs("div",{className:"flex gap-2",children:[_.jsxs(Yt,{variant:"outline",onClick:u,className:"flex items-center gap-2",children:[_.jsx(eV,{size:16}),"Popup"]}),_.jsxs(Yt,{variant:"outline",onClick:o,className:"flex items-center gap-2",children:[_.jsx(tV,{size:16}),"Style Settings"]}),_.jsxs(Yt,{variant:"outline",onClick:i,className:"flex items-center gap-2",children:[_.jsx(Q6,{size:16}),"Logout"]})]})]})})}),lH=({services:i,teamMembers:o,products:u,funds:m,messages:w,caseStudies:E,blogPosts:P,consulting:s})=>_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-7 gap-6 mb-7",children:[_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Programs"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:i.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Active programs"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Consultings"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Active Consultings"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Team"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:o.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Team members"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Products"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:u.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Active products"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Funds"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Investment funds"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Messages"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:w.filter(D=>D.status==="unread").length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Unread messages"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Case Studies"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:E.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Published studies"})]})]}),_.jsxs(Wi,{children:[_.jsx(cr,{className:"pb-2",children:_.jsx(ur,{className:"text-sm text-gray-600",children:"Blog Posts"})}),_.jsxs(hr,{children:[_.jsx("div",{className:"text-2xl font-bold text-primary",children:P.length}),_.jsx("p",{className:"text-sm text-gray-600",children:"Published posts"})]})]})]}),cH=({isOpen:i,onClose:o,onSubmit:u,service:m})=>{const[w,E]=W.useState({title:(m==null?void 0:m.title)||"",description:(m==null?void 0:m.description)||"",duration:(m==null?void 0:m.duration)||"",eligibility:(m==null?void 0:m.eligibility)||"",features:(m==null?void 0:m.features.join(`
`))||"",icon:(m==null?void 0:m.icon)||"home",category:(m==null?void 0:m.category)||"incubation",presentationUrl:(m==null?void 0:m.presentationUrl)||""});W.useEffect(()=>{E(m?{title:m.title||"",description:m.description||"",duration:m.duration||"",eligibility:m.eligibility||"",features:Array.isArray(m.features)?m.features.join(`
`):"",icon:m.icon||"home",category:m.category||"incubation",presentationUrl:m.presentationUrl||""}:{title:"",description:"",duration:"",eligibility:"",features:"",icon:"home",category:"incubation",presentationUrl:""})},[m,i]);const P=s=>{s.preventDefault(),u({...w,features:w.features.split(`
`).filter(D=>D.trim()!=="")}),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Program":"Add New Program"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"title",children:"Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:s=>E(D=>({...D,title:s.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"category",children:"Category"}),_.jsxs("select",{id:"category",value:w.category,onChange:s=>E(D=>({...D,category:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[_.jsx("option",{value:"incubation",children:"Incubation"}),_.jsx("option",{value:"acceleration",children:"Acceleration"}),_.jsx("option",{value:"mentorship",children:"Mentorship"}),_.jsx("option",{value:"funding",children:"Funding"})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:s=>E(D=>({...D,description:s.target.value})),required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"duration",children:"Duration"}),_.jsx(Si,{id:"duration",value:w.duration,onChange:s=>E(D=>({...D,duration:s.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"eligibility",children:"Eligibility"}),_.jsx(Si,{id:"eligibility",value:w.eligibility,onChange:s=>E(D=>({...D,eligibility:s.target.value})),required:!0})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"presentationUrl",children:"Link Redirection URL"}),_.jsx(Si,{id:"presentationUrl",value:w.presentationUrl,onChange:s=>E(D=>({...D,presentationUrl:s.target.value})),placeholder:"https://www.hubspot.fr"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"features",children:"Features (one per line)"}),_.jsx(Xn,{id:"features",value:w.features,onChange:s=>E(D=>({...D,features:s.target.value})),placeholder:"Enter each feature on a new line",rows:4})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"icon",children:"Icon"}),_.jsxs("select",{id:"icon",value:w.icon,onChange:s=>E(D=>({...D,icon:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[_.jsx("option",{value:"home",children:"Home"}),_.jsx("option",{value:"arrow-up",children:"Arrow Up"}),_.jsx("option",{value:"book",children:"Book"}),_.jsx("option",{value:"users",children:"Users"})]})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:m?"Update Program":"Add Program"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},uH=({isOpen:i,onClose:o,onSubmit:u,consulting:m})=>{const[w,E]=W.useState({title:(m==null?void 0:m.title)||"",description:(m==null?void 0:m.description)||"",eligibility:(m==null?void 0:m.eligibility)||"",features:(m==null?void 0:m.features.join(`
`))||"",icon:(m==null?void 0:m.icon)||"home",category:(m==null?void 0:m.category)||"strategy",directUrl:(m==null?void 0:m.directUrl)||""});W.useEffect(()=>{E(m?{title:m.title,description:m.description,eligibility:m.eligibility,features:m.features.join(`
`),icon:m.icon,category:m.category,directUrl:m.directUrl||""}:{title:"",description:"",eligibility:"",features:"",icon:"home",category:"strategy",directUrl:""})},[m,i]);const P=s=>{s.preventDefault(),u({...w,features:w.features.split(`
`).filter(D=>D.trim()!=="")}),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Consulting":"Add New Consulting"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"title",children:"Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:s=>E(D=>({...D,title:s.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"category",children:"Category"}),_.jsxs("select",{id:"category",value:w.category,onChange:s=>E(D=>({...D,category:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[_.jsx("option",{value:"strategy",children:"Strategy"}),_.jsx("option",{value:"product",children:"Product"}),_.jsx("option",{value:"marketing",children:"Marketing"}),_.jsx("option",{value:"funding",children:"Funding"})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:s=>E(D=>({...D,description:s.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"eligibility",children:"Duration"}),_.jsx(Si,{id:"eligibility",value:w.eligibility,onChange:s=>E(D=>({...D,eligibility:s.target.value}))})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"directUrl",children:"Link Redirection URL"}),_.jsx(Si,{id:"directUrl",value:w.directUrl,onChange:s=>E(D=>({...D,directUrl:s.target.value})),placeholder:"https://yourconsultinglink.com"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"features",children:"Features (one per line)"}),_.jsx(Xn,{id:"features",value:w.features,onChange:s=>E(D=>({...D,features:s.target.value})),rows:4})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"icon",children:"Icon"}),_.jsxs("select",{id:"icon",value:w.icon,onChange:s=>E(D=>({...D,icon:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[_.jsx("option",{value:"home",children:"Home"}),_.jsx("option",{value:"target",children:"Target"}),_.jsx("option",{value:"lightbulb",children:"Lightbulb"}),_.jsx("option",{value:"users",children:"Users"})]})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:m?"Update Consulting":"Add Consulting"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},hH=({isOpen:i,onClose:o,onSubmit:u,product:m})=>{var s;const[w,E]=W.useState({name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",category:(m==null?void 0:m.category)||"",price:(m==null?void 0:m.price)||"",features:((s=m==null?void 0:m.features)==null?void 0:s.join(`
`))||"",image:(m==null?void 0:m.image)||"",status:(m==null?void 0:m.status)||"active"});W.useEffect(()=>{var D;E(m?{name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",category:(m==null?void 0:m.category)||"",price:(m==null?void 0:m.price)||"",features:((D=m==null?void 0:m.features)==null?void 0:D.join(`
`))||"",image:(m==null?void 0:m.image)||"",status:(m==null?void 0:m.status)||"active"}:{name:"",description:"",category:"",price:"",features:"",image:"",status:"active"})},[m,i]);const P=D=>{D.preventDefault(),u({...w,features:w.features.split(`
`).filter(O=>O.trim())}),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Product":"Add New Product"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"name",children:"Product Name"}),_.jsx(Si,{id:"name",value:w.name,onChange:D=>E(O=>({...O,name:D.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"category",children:"Category"}),_.jsx(Si,{id:"category",value:w.category,onChange:D=>E(O=>({...O,category:D.target.value})),required:!0})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"price",children:"Price"}),_.jsx(Si,{id:"price",value:w.price,onChange:D=>E(O=>({...O,price:D.target.value})),placeholder:"$99/month"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"status",children:"Status"}),_.jsxs($c,{value:w.status,onValueChange:D=>E(O=>({...O,status:D})),children:[_.jsx(Ql,{children:_.jsx(qc,{})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"active",children:"Active"}),_.jsx(Cn,{value:"inactive",children:"Inactive"}),_.jsx(Cn,{value:"coming-soon",children:"Coming Soon"})]})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:D=>E(O=>({...O,description:D.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"features",children:"Features (one per line)"}),_.jsx(Xn,{id:"features",value:w.features,onChange:D=>E(O=>({...O,features:D.target.value})),placeholder:`Feature 1
Feature 2
Feature 3`,required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"image",children:"Link Redirection URL"}),_.jsx(Si,{id:"image",type:"url",value:w.image,onChange:D=>E(O=>({...O,image:D.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:m?"Update Product":"Add Product"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},dH=({isOpen:i,onClose:o,onSubmit:u,fund:m})=>{var s;const[w,E]=W.useState({name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",totalSize:(m==null?void 0:m.totalSize)||"",currentRaise:(m==null?void 0:m.currentRaise)||"",targetCompanies:(m==null?void 0:m.targetCompanies)||"",stage:(m==null?void 0:m.stage)||"",sectors:((s=m==null?void 0:m.sectors)==null?void 0:s.join(", "))||"",status:(m==null?void 0:m.status)||"fundraising"});W.useEffect(()=>{var D;E(m?{name:(m==null?void 0:m.name)||"",description:(m==null?void 0:m.description)||"",totalSize:(m==null?void 0:m.totalSize)||"",currentRaise:(m==null?void 0:m.currentRaise)||"",targetCompanies:(m==null?void 0:m.targetCompanies)||"",stage:(m==null?void 0:m.stage)||"",sectors:((D=m==null?void 0:m.sectors)==null?void 0:D.join(", "))||"",status:(m==null?void 0:m.status)||"fundraising"}:{name:"",description:"",totalSize:"",currentRaise:"",targetCompanies:"",stage:"",sectors:"",status:"fundraising"})},[m,i]);const P=D=>{D.preventDefault(),u({...w,sectors:w.sectors.split(",").map(O=>O.trim()).filter(O=>O)}),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Fund":"Add New Fund"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"name",children:"Fund Name"}),_.jsx(Si,{id:"name",value:w.name,onChange:D=>E(O=>({...O,name:D.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:D=>E(O=>({...O,description:D.target.value})),required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"totalSize",children:"Total Fund Size"}),_.jsx(Si,{id:"totalSize",value:w.totalSize,onChange:D=>E(O=>({...O,totalSize:D.target.value})),placeholder:"$50M",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"currentRaise",children:"Current Raise"}),_.jsx(Si,{id:"currentRaise",value:w.currentRaise,onChange:D=>E(O=>({...O,currentRaise:D.target.value})),placeholder:"$35M",required:!0})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"targetCompanies",children:"Target Companies"}),_.jsx(Si,{id:"targetCompanies",value:w.targetCompanies,onChange:D=>E(O=>({...O,targetCompanies:D.target.value})),placeholder:"25-30",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"stage",children:"Investment Stage"}),_.jsx(Si,{id:"stage",value:w.stage,onChange:D=>E(O=>({...O,stage:D.target.value})),placeholder:"Pre-seed to Seed",required:!0})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"sectors",children:"Sectors (comma-separated)"}),_.jsx(Si,{id:"sectors",value:w.sectors,onChange:D=>E(O=>({...O,sectors:D.target.value})),placeholder:"FinTech, HealthTech, AI/ML, SaaS",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"status",children:"Status"}),_.jsxs($c,{value:w.status,onValueChange:D=>E(O=>({...O,status:D})),children:[_.jsx(Ql,{children:_.jsx(qc,{})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"fundraising",children:"Fundraising"}),_.jsx(Cn,{value:"deployed",children:"Deployed"}),_.jsx(Cn,{value:"closed",children:"Closed"})]})]})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:m?"Update Fund":"Add Fund"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},pH=({isOpen:i,onClose:o,onSubmit:u,caseStudy:m})=>{const[w,E]=W.useState({companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}});W.useEffect(()=>{E(m?{companyName:m.companyName,industry:m.industry,description:m.description,challenge:m.challenge,solution:m.solution,results:m.results.join(`
`),tags:m.tags.join(", "),image:m.image,testimonial:m.testimonial}:{companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}})},[m,i]);const P=async G=>{G.preventDefault();let U=w.image;if(s){const Y=new FormData;Y.append("image",s);try{const le=await fetch("http://localhost:3000/api/uploads/case-study-image",{method:"POST",body:Y});if(!le.ok){const oe=await le.text();throw new Error(`Upload failed: ${oe}`)}U=(await le.json()).url}catch(le){console.error("Image upload failed:",le);return}}const he=w.results.split(`
`).map(Y=>Y.trim()).filter(Y=>Y),de=w.tags.split(",").map(Y=>Y.trim()).filter(Y=>Y);u({...w,image:U,results:he,tags:de}),o()},[s,D]=W.useState(null),[O,H]=W.useState(w.image);return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Case Study":"Add New Case Study"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"companyName",children:"Company Name"}),_.jsx(Si,{id:"companyName",value:w.companyName,onChange:G=>E(U=>({...U,companyName:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"industry",children:"Industry"}),_.jsx(Si,{id:"industry",value:w.industry,onChange:G=>E(U=>({...U,industry:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:G=>E(U=>({...U,description:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"challenge",children:"Challenge"}),_.jsx(Xn,{id:"challenge",value:w.challenge,onChange:G=>E(U=>({...U,challenge:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"solution",children:"Solution"}),_.jsx(Xn,{id:"solution",value:w.solution,onChange:G=>E(U=>({...U,solution:G.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"results",children:"Results (one per line)"}),_.jsx(Xn,{id:"results",value:w.results,onChange:G=>E(U=>({...U,results:G.target.value})),placeholder:"Enter each result on a new line",rows:4,required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"tags",children:"Tags (comma-separated)"}),_.jsx(Si,{id:"tags",value:w.tags,onChange:G=>E(U=>({...U,tags:G.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"image",children:"Upload Image"}),_.jsx(Si,{id:"image",type:"file",accept:"image/*",onChange:G=>{var he;const U=(he=G.target.files)==null?void 0:he[0];U&&(D(U),H(URL.createObjectURL(U)))},required:!m}),O&&_.jsx("img",{src:O,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{children:"Testimonial"}),_.jsxs("div",{className:"space-y-2 border p-4 rounded",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"testimonialQuote",children:"Quote"}),_.jsx(Xn,{id:"testimonialQuote",value:w.testimonial.quote,onChange:G=>E(U=>({...U,testimonial:{...U.testimonial,quote:G.target.value}})),placeholder:"Enter testimonial quote"})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"testimonialAuthor",children:"Author"}),_.jsx(Si,{id:"testimonialAuthor",value:w.testimonial.author,onChange:G=>E(U=>({...U,testimonial:{...U.testimonial,author:G.target.value}})),placeholder:"Author name"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"testimonialPosition",children:"Position"}),_.jsx(Si,{id:"testimonialPosition",value:w.testimonial.position,onChange:G=>E(U=>({...U,testimonial:{...U.testimonial,position:G.target.value}})),placeholder:"Author position"})]})]})]})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsxs(Yt,{type:"submit",children:[m?"Update":"Add"," Case Study"]}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},fH=({isOpen:i,onClose:o,onSubmit:u,blogPost:m})=>{const[w,E]=W.useState({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""});W.useEffect(()=>{m?(E({title:m.title,excerpt:m.excerpt,content:m.content,author:m.author,category:m.category,publishDate:m.publishDate,tags:m.tags.join(", "),image:m.image}),H(m.image)):E({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""})},[m,i]);const P=async G=>{G.preventDefault();let U=w.image;if(s){const de=new FormData;de.append("image",s);try{const Y=await fetch("http://localhost:3000/api/uploads/blog-image",{method:"POST",body:de});if(!Y.ok){const re=await Y.text();throw new Error(`Upload failed: ${re}`)}U=(await Y.json()).url}catch(Y){console.error("Image upload failed:",Y);return}}const he=w.tags.split(",").map(de=>de.trim()).filter(de=>de);u({title:w.title,excerpt:w.excerpt,content:w.content,author:w.author,category:w.category,publishDate:w.publishDate,tags:he,image:U}),o()},[s,D]=W.useState(null),[O,H]=W.useState("");return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Blog Post":"Add New Blog Post"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"title",children:"Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:G=>E(U=>({...U,title:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"excerpt",children:"Excerpt"}),_.jsx(Xn,{id:"excerpt",value:w.excerpt,onChange:G=>E(U=>({...U,excerpt:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"content",children:"Content"}),_.jsx(Xn,{id:"content",value:w.content,onChange:G=>E(U=>({...U,content:G.target.value})),rows:10,required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"author",children:"Author"}),_.jsx(Si,{id:"author",value:w.author,onChange:G=>E(U=>({...U,author:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"category",children:"Category"}),_.jsx(Si,{id:"category",value:w.category,onChange:G=>E(U=>({...U,category:G.target.value})),required:!0})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"publishDate",children:"Publish Date"}),_.jsx(Si,{id:"publishDate",type:"date",value:w.publishDate,onChange:G=>E(U=>({...U,publishDate:G.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"tags",children:"Tags (comma-separated)"}),_.jsx(Si,{id:"tags",value:w.tags,onChange:G=>E(U=>({...U,tags:G.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"image",children:"Upload Image"}),_.jsx(Si,{id:"image",type:"file",accept:"image/*",onChange:G=>{var he;const U=(he=G.target.files)==null?void 0:he[0];U&&(D(U),H(URL.createObjectURL(U)))},required:!m}),O&&_.jsx("img",{src:O,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsxs(Yt,{type:"submit",children:[m?"Update":"Add"," Blog Post"]}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},mH=({isOpen:i,onClose:o,onSubmit:u,event:m})=>{const[w,E]=W.useState({title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""});W.useEffect(()=>{E(m?{title:m.title,description:m.description,date:m.date,time:m.time,location:m.location,type:m.type,image:m.image,registrationUrl:m.registrationUrl}:{title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""})},[m,i]);const P=s=>{s.preventDefault(),u(w),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Event":"Add New Event"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"title",children:"Event Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:s=>E(D=>({...D,title:s.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:s=>E(D=>({...D,description:s.target.value})),required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"date",children:"Date"}),_.jsx(Si,{id:"date",type:"date",value:w.date,onChange:s=>E(D=>({...D,date:s.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"time",children:"Time"}),_.jsx(Si,{id:"time",type:"time",value:w.time,onChange:s=>E(D=>({...D,time:s.target.value})),required:!0})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"location",children:"Location"}),_.jsx(Si,{id:"location",value:w.location,onChange:s=>E(D=>({...D,location:s.target.value})),placeholder:"Physical address or virtual link",required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"type",children:"Event Type"}),_.jsxs($c,{value:w.type,onValueChange:s=>E(D=>({...D,type:s})),children:[_.jsx(Ql,{children:_.jsx(qc,{})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"workshop",children:"Workshop"}),_.jsx(Cn,{value:"webinar",children:"Webinar"}),_.jsx(Cn,{value:"networking",children:"Networking"}),_.jsx(Cn,{value:"pitch",children:"Pitch Event"})]})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"image",children:"Image URL"}),_.jsx(Si,{id:"image",value:w.image,onChange:s=>E(D=>({...D,image:s.target.value})),placeholder:"https://example.com/image.jpg"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"registrationUrl",children:"Registration URL"}),_.jsx(Si,{id:"registrationUrl",value:w.registrationUrl,onChange:s=>E(D=>({...D,registrationUrl:s.target.value})),placeholder:"https://eventbrite.com/your-event",required:!0})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsxs(Yt,{type:"submit",children:[m?"Update":"Add"," Event"]}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},gH=({isOpen:i,onClose:o,onSubmit:u,resource:m})=>{const[w,E]=W.useState({title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""});W.useEffect(()=>{E(m?{title:m.title,description:m.description,type:m.type,category:m.category,downloadUrl:m.downloadUrl,image:m.image,tags:m.tags.join(", ")}:{title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""})},[m,i]);const P=s=>{s.preventDefault();const D=w.tags.split(",").map(O=>O.trim()).filter(O=>O);u({title:w.title,description:w.description,type:w.type,category:w.category,downloadUrl:w.downloadUrl,image:w.image,tags:D}),o()};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Resource":"Add New Resource"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"title",children:"Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:s=>E(D=>({...D,title:s.target.value})),required:!0})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"category",children:"Category"}),_.jsx(Si,{id:"category",value:w.category,onChange:s=>E(D=>({...D,category:s.target.value})),required:!0})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:s=>E(D=>({...D,description:s.target.value})),required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"type",children:"Type"}),_.jsxs($c,{value:w.type,onValueChange:s=>E(D=>({...D,type:s})),children:[_.jsx(Ql,{children:_.jsx(qc,{})}),_.jsxs(Jl,{children:[_.jsx(Cn,{value:"pitch-deck",children:"Pitch Deck"}),_.jsx(Cn,{value:"financial-model",children:"Financial Model"}),_.jsx(Cn,{value:"presentation",children:"Presentation"}),_.jsx(Cn,{value:"guide",children:"Guide"})]})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"downloadUrl",children:"Link Redirection URL"}),_.jsx(Si,{id:"downloadUrl",value:w.downloadUrl,onChange:s=>E(D=>({...D,downloadUrl:s.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"image",children:"Image URL"}),_.jsx(Si,{id:"image",value:w.image,onChange:s=>E(D=>({...D,image:s.target.value})),placeholder:"https://example.com/image.jpg"})]}),_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"tags",children:"Tags (comma-separated)"}),_.jsx(Si,{id:"tags",value:w.tags,onChange:s=>E(D=>({...D,tags:s.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsxs(Yt,{type:"submit",children:[m?"Update":"Add"," Resource"]}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},_H=({isOpen:i,onClose:o,onSubmit:u,member:m})=>{const[w,E]=W.useState({name:(m==null?void 0:m.name)||"",position:(m==null?void 0:m.position)||"",bio:(m==null?void 0:m.bio)||"",image:(m==null?void 0:m.image)||"",linkedin_url:(m==null?void 0:m.linkedin_url)||""});W.useEffect(()=>{m?(E({name:m.name||"",position:m.position||"",bio:m.bio||"",image:m.image||"",linkedin_url:m.linkedin_url||""}),H(m.image||"")):(E({name:"",position:"",bio:"",image:"",linkedin_url:""}),H(""))},[m,i]),W.useEffect(()=>{H(w.image)},[w.image]);const P=async G=>{G.preventDefault();let U=w.image;if(s){const he=new FormData;he.append("image",s);try{const de=await fetch("http://localhost:3000/api/uploads/team-image",{method:"POST",body:he});if(!de.ok){const le=await de.text();throw new Error(`Upload failed: ${le}`)}U=(await de.json()).url}catch(de){console.error("Image upload failed:",de);return}}u({name:w.name,position:w.position,bio:w.bio,image:U,linkedin_url:w.linkedin_url||null}),o()},[s,D]=W.useState(null),[O,H]=W.useState(w.image);return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:m?"Edit Team Member":"Add New Team Member"})}),_.jsxs("form",{onSubmit:P,className:"space-y-4",children:[_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"name",children:"Name"}),_.jsx(Si,{id:"name",value:w.name,onChange:G=>E(U=>({...U,name:G.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"position",children:"Position"}),_.jsx(Si,{id:"position",value:w.position,onChange:G=>E(U=>({...U,position:G.target.value}))})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"bio",children:"Bio"}),_.jsx(Xn,{id:"bio",value:w.bio,onChange:G=>E(U=>({...U,bio:G.target.value}))})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"image",children:"Upload Profile Image"}),_.jsx(Si,{id:"image",type:"file",accept:"image/*",onChange:G=>{var he;const U=(he=G.target.files)==null?void 0:he[0];U&&(D(U),H(URL.createObjectURL(U)))},required:!m}),O&&_.jsx("img",{src:O,alt:"Preview",className:"w-24 h-24 object-cover rounded-full border mt-2"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"linkedIn",children:"LinkedIn URL (optional)"}),_.jsx(Si,{id:"linkedIn",type:"url",value:w.linkedin_url,onChange:G=>E(U=>({...U,linkedin_url:G.target.value})),placeholder:"https://linkedin.com/in/username"})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:m?"Update Member":"Add Member"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})},yH=({isOpen:i,onClose:o,onSubmit:u,currentSettings:m})=>{const[w,E]=W.useState({heroType:m.heroType??"image",heroImage:m.heroImage??"",heroVideoUrl:m.heroVideoUrl??"",companiesText:m.runningTextCompanies.join(`
`),collaborators:[]});W.useEffect(()=>{i&&(fetch("http://localhost:3000/api/collaborators").then(de=>de.json()).then(de=>{E(Y=>({...Y,collaborators:de}))}).catch(de=>{console.error("Failed to load collaborators:",de)}),fetch("http://localhost:3000/api/running-text").then(de=>de.json()).then(de=>{E(Y=>({...Y,companiesText:de.join(`
`)}))}),fetch("http://localhost:3000/api/style-settings").then(de=>de.json()).then(de=>{E(Y=>({...Y,heroType:de.hero_type,heroImage:de.hero_image,heroVideoUrl:de.hero_video_url,imagePreview:de.hero_image})),H(de.hero_image)}))},[i]);const P=async de=>{de.preventDefault();let Y=w.heroImage;if(s){const le=new FormData;le.append("image",s);try{const re=await fetch("http://localhost:3000/api/uploads/style-hero-image",{method:"POST",body:le});if(!re.ok){const _e=await re.text();throw new Error(`Upload failed: ${_e}`)}Y=(await re.json()).url}catch(re){console.error("Hero image upload failed:",re);return}}try{await fetch("http://localhost:3000/api/style-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({heroType:w.heroType,heroImage:Y,heroVideoUrl:w.heroVideoUrl})})}catch(le){console.error("Failed to update hero section settings:",le)}try{await fetch("http://localhost:3000/api/running-text",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({companies:w.companiesText.split(`
`).map(le=>le.trim()).filter(le=>le!=="")})})}catch(le){console.error("Failed to update running text companies:",le)}for(const le of w.collaborators)try{const re=`http://localhost:3000/api/collaborators${le.id?`/${le.id}`:""}`,oe=le.id?"PUT":"POST";if(!(await fetch(re,{method:oe,headers:{"Content-Type":"application/json"},body:JSON.stringify(le)})).ok)throw new Error(`Failed to ${oe==="POST"?"create":"update"} collaborator`)}catch(re){console.error("Collaborator save error:",re)}u({heroType:w.heroType,heroImage:Y,heroVideoUrl:w.heroVideoUrl,runningTextCompanies:w.companiesText.split(`
`).map(le=>le.trim()).filter(le=>le!==""),collaborators:w.collaborators}),o()},[s,D]=W.useState(null),[O,H]=W.useState(m.heroImage),G=(de,Y,le)=>{E(re=>{const oe=[...re.collaborators];return oe[de]={...oe[de],[Y]:le},{...re,collaborators:oe}})},U=()=>{E(de=>({...de,collaborators:[...de.collaborators,{name:"",logo:"",website:""}]}))},he=async de=>{const Y=w.collaborators[de];if(Y.id)try{await fetch(`http://localhost:3000/api/collaborators/${Y.id}`,{method:"DELETE"})}catch(le){console.error("Failed to delete collaborator:",le)}E(le=>{const re=[...le.collaborators];return re.splice(de,1),{...le,collaborators:re}})};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:"Style Management"})}),_.jsxs("form",{onSubmit:P,className:"space-y-6",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsxs("div",{children:[_.jsx(Ft,{children:"Hero Section Type"}),_.jsxs("select",{value:w.heroType,onChange:de=>E(Y=>({...Y,heroType:de.target.value})),className:"w-full mt-1 border border-input rounded px-3 py-2",children:[_.jsx("option",{value:"image",children:"Image"}),_.jsx("option",{value:"video",children:"YouTube Video"})]})]}),w.heroType==="image"&&_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"heroImage",children:"Upload Hero Section Image"}),_.jsx(Si,{id:"heroImage",type:"file",accept:"image/*",onChange:de=>{var le;const Y=(le=de.target.files)==null?void 0:le[0];Y&&(D(Y),H(URL.createObjectURL(Y)))}}),O&&_.jsx("img",{src:O,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border mt-2"})]}),w.heroType==="video"&&_.jsxs("div",{children:[_.jsx(Ft,{htmlFor:"heroVideoUrl",children:"YouTube Video URL"}),_.jsx(Si,{id:"heroVideoUrl",type:"url",value:w.heroVideoUrl,onChange:de=>E(Y=>({...Y,heroVideoUrl:de.target.value})),placeholder:"https://www.youtube.com/watch?v=...",required:!0})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"companies",children:"Running Text Companies (one per line)"}),_.jsx(Xn,{id:"companies",value:w.companiesText,onChange:de=>E(Y=>({...Y,companiesText:de.target.value})),placeholder:`Company Name 1
Company Name 2
Company Name 3`,rows:4,required:!0}),_.jsx("p",{className:"text-sm text-gray-500",children:"Enter each company/investor name on a new line. These will appear in the running text above the mission section."})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{children:"Collaborators"}),w.collaborators.map((de,Y)=>_.jsxs("div",{className:"flex flex-col md:flex-row gap-2 mb-4 border p-3 rounded-md",children:[_.jsx(Si,{placeholder:"Name",value:de.name,onChange:le=>G(Y,"name",le.target.value)}),_.jsx(Si,{placeholder:"Logo URL",value:de.logo,onChange:le=>G(Y,"logo",le.target.value)}),_.jsx(Si,{placeholder:"Website URL",value:de.website,onChange:le=>G(Y,"website",le.target.value)}),_.jsx(Yt,{type:"button",variant:"destructive",onClick:()=>he(Y),children:"Remove"})]},Y)),_.jsx(Yt,{type:"button",variant:"outline",onClick:U,children:"Add Collaborator"})]}),_.jsxs("div",{className:"flex gap-2 pt-4",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:"Update Style Settings"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:o,children:"Cancel"})]})]})]})})};var YE="Switch",[xH,XH]=Rm(YE),[vH,wH]=xH(YE),YL=W.forwardRef((i,o)=>{const{__scopeSwitch:u,name:m,checked:w,defaultChecked:E,required:P,disabled:s,value:D="on",onCheckedChange:O,form:H,...G}=i,[U,he]=W.useState(null),de=kn(o,_e=>he(_e)),Y=W.useRef(!1),le=U?H||!!U.closest("form"):!0,[re=!1,oe]=tp({prop:w,defaultProp:E,onChange:O});return _.jsxs(vH,{scope:u,checked:re,disabled:s,children:[_.jsx(jr.button,{type:"button",role:"switch","aria-checked":re,"aria-required":P,"data-state":JL(re),"data-disabled":s?"":void 0,disabled:s,value:D,...G,ref:de,onClick:ir(i.onClick,_e=>{oe(Ne=>!Ne),le&&(Y.current=_e.isPropagationStopped(),Y.current||_e.stopPropagation())})}),le&&_.jsx(bH,{control:U,bubbles:!Y.current,name:m,value:D,checked:re,required:P,disabled:s,form:H,style:{transform:"translateX(-100%)"}})]})});YL.displayName=YE;var KL="SwitchThumb",QL=W.forwardRef((i,o)=>{const{__scopeSwitch:u,...m}=i,w=wH(KL,u);return _.jsx(jr.span,{"data-state":JL(w.checked),"data-disabled":w.disabled?"":void 0,...m,ref:o})});QL.displayName=KL;var bH=i=>{const{control:o,checked:u,bubbles:m=!0,...w}=i,E=W.useRef(null),P=$z(u),s=yj(o);return W.useEffect(()=>{const D=E.current,O=window.HTMLInputElement.prototype,G=Object.getOwnPropertyDescriptor(O,"checked").set;if(P!==u&&G){const U=new Event("click",{bubbles:m});G.call(D,u),D.dispatchEvent(U)}},[P,u,m]),_.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:u,...w,tabIndex:-1,ref:E,style:{...i.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function JL(i){return i?"checked":"unchecked"}var e3=YL,SH=QL;const sm=W.forwardRef(({className:i,...o},u)=>_.jsx(e3,{className:Zr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...o,ref:u,children:_.jsx(SH,{className:Zr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));sm.displayName=e3.displayName;const TH=({open:i,onOpenChange:o})=>{const[u,m]=W.useState(null),[w,E]=W.useState({title:"",subject:"",description:"",image:"",link:"",isActive:!0}),[P,s]=W.useState(!1);W.useEffect(()=>{i&&D()},[i]);const D=async()=>{try{const G=await ao.getPopup();G&&(m(G),E({title:G.title,subject:G.subject,description:G.description,image:G.image,link:G.link,isActive:G.isActive}))}catch(G){console.error("Error fetching popup:",G)}},O=async G=>{G.preventDefault(),s(!0);try{const U=new FormData;U.append("title",w.title||""),U.append("subject",w.subject||""),U.append("description",w.description||""),U.append("link",w.link||""),U.append("isActive",String(w.isActive)),w.image instanceof File?U.append("image",w.image):typeof w.image=="string"&&U.append("existingImage",w.image),await fetch("http://localhost:3000/api/popup/update",{method:"POST",body:U}),o(!1)}catch(U){console.error("Popup update failed",U)}finally{s(!1)}},H=(G,U)=>{E(he=>({...he,[G]:U}))};return _.jsx(uo,{open:i,onOpenChange:o,children:_.jsxs(Zs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:"Manage Welcome Popup"})}),_.jsxs("form",{onSubmit:O,className:"space-y-6",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"title",children:"Title"}),_.jsx(Si,{id:"title",value:w.title,onChange:G=>H("title",G.target.value),placeholder:"Enter popup title",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"subject",children:"Subject"}),_.jsx(Si,{id:"subject",value:w.subject,onChange:G=>H("subject",G.target.value),placeholder:"Enter popup subject",required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"description",children:"Description"}),_.jsx(Xn,{id:"description",value:w.description,onChange:G=>H("description",G.target.value),placeholder:"Enter popup description",rows:4,required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"image",children:"Image"}),_.jsx(Si,{id:"image",type:"file",accept:"image/*",onChange:G=>{var U;return H("image",((U=G.target.files)==null?void 0:U[0])||"")}}),typeof w.image=="string"&&w.image&&_.jsx("img",{src:w.image,alt:"Popup preview",className:"w-full h-40 object-cover rounded-md"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"link",children:"Link (Get Started Button)"}),_.jsx(Si,{id:"link",value:w.link,onChange:G=>H("link",G.target.value),placeholder:"Enter destination URL",required:!0})]}),_.jsxs("div",{className:"flex items-center space-x-2",children:[_.jsx(sm,{id:"isActive",checked:w.isActive,onCheckedChange:G=>H("isActive",G)}),_.jsx(Ft,{htmlFor:"isActive",children:"Active"})]}),_.jsxs("div",{className:"flex gap-4 pt-4",children:[_.jsx(Yt,{type:"submit",disabled:P,className:"flex-1",children:P?"Saving...":"Save Popup"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"})]})]})]})})},EH=()=>{const{admins:i,currentAdmin:o,createAdmin:u,deleteAdmin:m}=Y1(),[w,E]=W.useState(!1),[P,s]=W.useState({username:"",email:"",password:"",confirmPassword:""}),[D,O]=W.useState(""),H=U=>{if(U.preventDefault(),O(""),P.password!==P.confirmPassword){O("Passwords do not match");return}if(P.password.length<6){O("Password must be at least 6 characters");return}u(P.username,P.email,P.password)?(s({username:"",email:"",password:"",confirmPassword:""}),E(!1)):O("Username already exists")},G=U=>{window.confirm("Are you sure you want to delete this admin account?")&&(m(U)||alert("Cannot delete currently logged in admin"))};return _.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Admin Accounts"}),_.jsxs(uo,{open:w,onOpenChange:E,children:[_.jsx($E,{asChild:!0,children:_.jsxs(Yt,{children:[_.jsx(lV,{className:"mr-2 h-4 w-4"}),"Create Admin"]})}),_.jsxs(Zs,{children:[_.jsx(Xs,{children:_.jsx(Ys,{children:"Create New Admin Account"})}),_.jsxs("form",{onSubmit:H,className:"space-y-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"username",children:"Username"}),_.jsx(Si,{id:"username",value:P.username,onChange:U=>s(he=>({...he,username:U.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"email",children:"Email"}),_.jsx(Si,{id:"email",type:"email",value:P.email,onChange:U=>s(he=>({...he,email:U.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"password",children:"Password"}),_.jsx(Si,{id:"password",type:"password",value:P.password,onChange:U=>s(he=>({...he,password:U.target.value})),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"confirmPassword",children:"Confirm Password"}),_.jsx(Si,{id:"confirmPassword",type:"password",value:P.confirmPassword,onChange:U=>s(he=>({...he,confirmPassword:U.target.value})),required:!0})]}),D&&_.jsx("p",{className:"text-red-500 text-sm",children:D}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx(Yt,{type:"submit",className:"flex-1",children:"Create Admin"}),_.jsx(Yt,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancel"})]})]})]})]})]})}),_.jsx(hr,{children:_.jsx("div",{className:"space-y-4",children:i.map(U=>_.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[_.jsx("div",{className:"flex items-center gap-4",children:_.jsxs("div",{children:[_.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[U.username,(o==null?void 0:o.id)===U.id&&_.jsx(Ls,{variant:"default",children:"Current User"})]}),_.jsx("p",{className:"text-sm text-gray-600",children:U.email}),_.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",new Date(U.createdAt).toLocaleDateString()]})]})}),(o==null?void 0:o.id)!==U.id&&_.jsx(Yt,{variant:"destructive",size:"sm",onClick:()=>G(U.id),children:_.jsx(QN,{className:"h-4 w-4"})})]},U.id))})})]})},CH=()=>{const[i,o]=W.useState(!1),[u,m]=W.useState(!1),[w,E]=W.useState(!1),[P,s]=W.useState(!1),[D,O]=W.useState(!1),[H,G]=W.useState(!1),[U,he]=W.useState(!1),[de,Y]=W.useState(!1),[le,re]=W.useState(!1);W.useState(!1);const[oe,_e]=W.useState(!1),[Ne,Ge]=W.useState(!1),[pt,ot]=W.useState(),[dt,Bt]=W.useState(),[Wt,Ht]=W.useState(),[ei,xi]=W.useState(),[It,ui]=W.useState(),[Zt,Ni]=W.useState(),[ct,Vt]=W.useState(),[Gt,ti]=W.useState(),[vi,Ki]=W.useState(),{isAdminLoggedIn:Zi,logout:Hi,loading:Ii}=Y1(),hi=LE(),_i=DE(),{data:ji=[]}=il({queryKey:["services"],queryFn:async()=>(await ai.get("/services")).map(vv),enabled:Zi}),{data:Er=[]}=il({queryKey:["consulting"],queryFn:async()=>(await ai.get("/consulting")).map(F_),enabled:Zi}),{data:wr=[]}=il({queryKey:["products"],queryFn:async()=>(await ai.get("/products")).map(wv),enabled:Zi}),{data:nr=[]}=il({queryKey:["funds"],queryFn:async()=>(await ai.get("/funds")).map(bv),enabled:Zi}),{data:dr=[]}=il({queryKey:["case-studies"],queryFn:async()=>(await ai.get("/case-studies")).map(Sv),enabled:Zi}),{data:Ln=[]}=il({queryKey:["blog-posts"],queryFn:async()=>(await ai.get("/blog-posts")).map(Tv),enabled:Zi}),{data:ns=[]}=il({queryKey:["events"],queryFn:async()=>(await ai.get("/events")).map(Cv),enabled:Zi}),{data:pn=[]}=il({queryKey:["program-applications"],queryFn:async()=>await ai.get("/program-applications"),enabled:Zi}),{data:ys=[]}=il({queryKey:["resources"],queryFn:async()=>(await ai.get("/resources")).map(Ev),enabled:Zi}),{data:Eo=[]}=il({queryKey:["team-members"],queryFn:async()=>(await ai.get("/team-members")).map(Av),enabled:Zi}),{data:Ur=[]}=il({queryKey:["contact-messages"],queryFn:async()=>(await ai.get("/contact-messages")).map(Iv),enabled:Zi}),Fn=Mn({mutationFn:ce=>ai.post("/services",d1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["services"]}),qi({title:"Service created successfully"})},onError:()=>{qi({title:"Failed to create service",variant:"destructive"})}}),Co=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/services/${ce}`,d1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["services"]}),qi({title:"Service updated successfully"})},onError:()=>{qi({title:"Failed to update service",variant:"destructive"})}}),Io=Mn({mutationFn:ce=>ai.delete(`/services/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["services"]}),qi({title:"Service deleted successfully"})},onError:()=>{qi({title:"Failed to delete service",variant:"destructive"})}}),Os=Mn({mutationFn:ce=>ai.post("/consulting",h1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["consulting"]}),qi({title:"Consulting created successfully"})},onError:()=>{qi({title:"Failed to create consulting",variant:"destructive"})}}),Qn=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/consulting/${ce}`,h1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["consulting"]}),qi({title:"Consulting updated successfully"})},onError:()=>{qi({title:"Failed to update consulting",variant:"destructive"})}}),Wo=Mn({mutationFn:ce=>ai.delete(`/consulting/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["consulting"]}),qi({title:"Consulting deleted successfully"})},onError:()=>{qi({title:"Failed to delete consulting",variant:"destructive"})}}),Ao=Mn({mutationFn:ce=>ai.post("/products",p1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["products"]}),qi({title:"Product created successfully"})},onError:()=>{qi({title:"Failed to create product",variant:"destructive"})}}),On=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/products/${ce}`,p1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["products"]}),qi({title:"Product updated successfully"})},onError:()=>{qi({title:"Failed to update product",variant:"destructive"})}}),_a=Mn({mutationFn:ce=>ai.delete(`/products/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["products"]}),qi({title:"Product deleted successfully"})},onError:()=>{qi({title:"Failed to delete product",variant:"destructive"})}}),ds=Mn({mutationFn:ce=>ai.post("/funds",f1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["funds"]}),qi({title:"Fund created successfully"})},onError:()=>{qi({title:"Failed to create fund",variant:"destructive"})}}),Zo=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/funds/${ce}`,f1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["funds"]}),qi({title:"Fund updated successfully"})},onError:()=>{qi({title:"Failed to update fund",variant:"destructive"})}}),Hn=Mn({mutationFn:ce=>ai.delete(`/funds/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["funds"]}),qi({title:"Fund deleted successfully"})},onError:()=>{qi({title:"Failed to delete fund",variant:"destructive"})}}),xs=Mn({mutationFn:ce=>ai.post("/case-studies",m1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["case-studies"]}),qi({title:"Case study created successfully"})},onError:()=>{qi({title:"Failed to create case study",variant:"destructive"})}}),Po=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/case-studies/${ce}`,m1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["case-studies"]}),qi({title:"Case study updated successfully"})},onError:()=>{qi({title:"Failed to update case study",variant:"destructive"})}}),Mo=Mn({mutationFn:ce=>ai.delete(`/case-studies/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["case-studies"]}),qi({title:"Case study deleted successfully"})},onError:()=>{qi({title:"Failed to delete case study",variant:"destructive"})}}),ho=Mn({mutationFn:ce=>ai.post("/blog-posts",g1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["blog-posts"]}),qi({title:"Blog post created successfully"})},onError:()=>{qi({title:"Failed to create blog post",variant:"destructive"})}}),ss=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/blog-posts/${ce}`,g1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["blog-posts"]}),qi({title:"Blog post updated successfully"})},onError:()=>{qi({title:"Failed to update blog post",variant:"destructive"})}}),ya=Mn({mutationFn:ce=>ai.delete(`/blog-posts/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["blog-posts"]}),qi({title:"Blog post deleted successfully"})},onError:()=>{qi({title:"Failed to delete blog post",variant:"destructive"})}}),di=Mn({mutationFn:ce=>ai.post("/events",y1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["events"]}),qi({title:"Event created successfully"})},onError:()=>{qi({title:"Failed to create event",variant:"destructive"})}}),Yr=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/events/${ce}`,y1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["events"]}),qi({title:"Event updated successfully"})},onError:()=>{qi({title:"Failed to update event",variant:"destructive"})}}),rn=Mn({mutationFn:ce=>ai.delete(`/events/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["events"]}),qi({title:"Event deleted successfully"})},onError:()=>{qi({title:"Failed to delete event",variant:"destructive"})}}),bn=Mn({mutationFn:ce=>ai.post("/resources",_1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["resources"]}),qi({title:"Resource created successfully"})},onError:()=>{qi({title:"Failed to create resource",variant:"destructive"})}}),As=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/resources/${ce}`,_1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["resources"]}),qi({title:"Resource updated successfully"})},onError:()=>{qi({title:"Failed to update resource",variant:"destructive"})}}),Xo=Mn({mutationFn:ce=>ai.delete(`/resources/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["resources"]}),qi({title:"Resource deleted successfully"})},onError:()=>{qi({title:"Failed to delete resource",variant:"destructive"})}}),Yo=Mn({mutationFn:ce=>ai.post("/team-members",x1(ce)),onSuccess:()=>{_i.invalidateQueries({queryKey:["team-members"]}),qi({title:"Team member created successfully"})},onError:()=>{qi({title:"Failed to create team member",variant:"destructive"})}}),wt=Mn({mutationFn:({id:ce,data:rt})=>ai.put(`/team-members/${ce}`,x1(rt)),onSuccess:()=>{_i.invalidateQueries({queryKey:["team-members"]}),qi({title:"Team member updated successfully"})},onError:()=>{qi({title:"Failed to update team member",variant:"destructive"})}}),Ko=Mn({mutationFn:ce=>ai.delete(`/team-members/${ce}`),onSuccess:()=>{_i.invalidateQueries({queryKey:["team-members"]}),qi({title:"Team member deleted successfully"})},onError:()=>{qi({title:"Failed to delete team member",variant:"destructive"})}}),Ch=ce=>{pt?(Co.mutate({id:pt.id,data:ce}),ot(void 0)):Fn.mutate(ce)},tc=ce=>{Wt?(On.mutate({id:Wt.id,data:ce}),Ht(void 0)):Ao.mutate(ce)},Qi=ce=>{ei?(Zo.mutate({id:ei.id,data:ce}),xi(void 0)):ds.mutate(ce)},Ve=ce=>{It?(Po.mutate({id:It.id,data:ce}),ui(void 0)):xs.mutate(ce)},Q=ce=>{Zt?(ss.mutate({id:Zt.id,data:ce}),Ni(void 0)):ho.mutate(ce)},ie=ce=>{ct?(Yr.mutate({id:ct.id,data:ce}),Vt(void 0)):di.mutate(ce)},me=ce=>{Gt?(As.mutate({id:Gt.id,data:ce}),ti(void 0)):bn.mutate(ce)},Ie=ce=>{const rt={...ce};vi?(wt.mutate({id:vi.id,data:rt}),Ki(void 0)):Yo.mutate(rt)},ve=ce=>{dt?(Qn.mutate({id:dt.id,data:ce}),Bt(void 0)):Os.mutate(ce)},ke=()=>{re(!0)},Oe=()=>{Ge(!0)},Me=(ce,rt,Ct,Ot="title",li)=>_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ce.map(ci=>_.jsxs(Wi,{className:"h-fit",children:[_.jsx(cr,{children:_.jsx(ur,{className:"text-lg",children:String(ci[Ot])})}),_.jsxs(hr,{className:"space-y-4",children:[li&&li(ci),_.jsxs("div",{className:"flex gap-2 pt-2",children:[_.jsxs(Yt,{variant:"outline",size:"sm",onClick:()=>rt(ci),children:[_.jsx(sV,{className:"w-4 h-4 mr-1"}),"Edit"]}),_.jsxs(Yt,{variant:"outline",size:"sm",onClick:()=>Ct(ci.id),className:"text-red-600 hover:text-red-700",children:[_.jsx(QN,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},ci.id))}),Be=()=>_.jsx("div",{className:"grid grid-cols-1 gap-4",children:Ur.map(ce=>_.jsxs(Wi,{children:[_.jsxs(cr,{children:[_.jsx(ur,{className:"text-lg",children:ce.subject}),_.jsxs("p",{className:"text-sm text-gray-600",children:["From: ",ce.name," (",ce.email,")"]})]}),_.jsxs(hr,{children:[_.jsx("p",{className:"text-sm text-gray-700 mb-2",children:ce.message}),_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.status==="unread"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:ce.status}),_.jsx("span",{className:"text-xs text-gray-500",children:new Date(ce.timestamp).toLocaleDateString()})]})]})]},ce.id))});if(W.useEffect(()=>{!Ii&&!Zi&&hi("/admin")},[Ii,Zi,hi]),Ii)return _.jsx("div",{className:"p-10 text-center text-gray-400",children:"Checking admin session..."});if(!Zi)return null;const tt=()=>{Hi(),hi("/admin")};return _.jsxs("div",{className:"min-h-screen bg-gray-50",children:[_.jsx(aH,{onLogout:tt,onStyleSettingsOpen:ke,onPopupManagementOpen:Oe}),_.jsxs("div",{className:"container mx-auto px-4 py-8",children:[_.jsx(lH,{services:ji,consulting:Er,teamMembers:Eo,products:wr,funds:nr,messages:Ur,caseStudies:dr,blogPosts:Ln,programsApplications:pn}),_.jsxs(oH,{defaultValue:"services",className:"mt-9",children:[_.jsxs(XL,{className:"grid w-full grid-cols-5 lg:grid-cols-9",children:[_.jsx(Bl,{value:"services",children:"Programs"}),_.jsx(Bl,{value:"consulting",children:"Consultings"}),_.jsx(Bl,{value:"products",children:"Products"}),_.jsx(Bl,{value:"case-studies",children:"Portfolio"}),_.jsx(Bl,{value:"blog-posts",children:"Blog Posts"}),_.jsx(Bl,{value:"resources",children:"Resources"}),_.jsx(Bl,{value:"team",children:"Team"}),_.jsx(Bl,{value:"messages",children:"Messages"}),_.jsx(Bl,{value:"admins",children:"Admins"})]}),_.jsx(Aa,{value:"services",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Programs Management"}),_.jsxs(Yt,{onClick:()=>o(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Program"]})]})}),_.jsx(hr,{children:Me(ji,ce=>{ot(ce),o(!0)},ce=>Io.mutate(ce),"title",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:ce.category}),_.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:ce.duration})]}),_.jsxs("div",{className:"text-xs text-gray-600",children:[_.jsx("strong",{children:"Eligibility:"})," ",ce.eligibility]}),ce.features.length>0&&_.jsxs("div",{className:"text-xs",children:[_.jsx("strong",{children:"Features:"}),_.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ce.features.slice(0,3).map((rt,Ct)=>_.jsx("li",{children:rt},Ct)),ce.features.length>3&&_.jsxs("li",{children:["... and ",ce.features.length-3," more"]})]})]})]}))})]})}),_.jsx(Aa,{value:"consulting",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Consultings Management"}),_.jsxs(Yt,{onClick:()=>_e(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add a Consult"]})]})}),_.jsx(hr,{children:Me(Er,ce=>{Bt(ce),_e(!0)},ce=>Wo.mutate(ce),"title",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsx("div",{className:"flex gap-2 flex-wrap",children:_.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:ce.category})}),_.jsxs("div",{className:"text-xs text-gray-600",children:[_.jsx("strong",{children:"Eligibility:"})," ",ce.eligibility]}),ce.features.length>0&&_.jsxs("div",{className:"text-xs",children:[_.jsx("strong",{children:"Features:"}),_.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ce.features.slice(0,3).map((rt,Ct)=>_.jsx("li",{children:rt},Ct)),ce.features.length>3&&_.jsxs("li",{children:["... and ",ce.features.length-3," more"]})]})]})]}))})]})}),_.jsx(Aa,{value:"products",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Products Management"}),_.jsxs(Yt,{onClick:()=>m(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})}),_.jsx(hr,{children:Me(wr,ce=>{Ht(ce),m(!0)},ce=>_a.mutate(ce),"name",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:ce.category}),_.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs",children:ce.price}),_.jsx("span",{className:`px-2 py-1 rounded text-xs ${ce.status==="active"?"bg-green-100 text-green-800":ce.status==="inactive"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:ce.status})]}),ce.features.length>0&&_.jsxs("div",{className:"text-xs",children:[_.jsx("strong",{children:"Features:"}),_.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ce.features.slice(0,2).map((rt,Ct)=>_.jsx("li",{children:rt},Ct)),ce.features.length>2&&_.jsxs("li",{children:["... and ",ce.features.length-2," more"]})]})]})]}))})]})}),_.jsx(Aa,{value:"funds",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Funds Management"}),_.jsxs(Yt,{onClick:()=>E(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Fund"]})]})}),_.jsx(hr,{children:Me(nr,ce=>{xi(ce),E(!0)},ce=>Hn.mutate(ce),"name",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[_.jsxs("div",{children:[_.jsx("strong",{children:"Size:"})," ",ce.totalSize]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Raised:"})," ",ce.currentRaise]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Stage:"})," ",ce.stage]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Companies:"})," ",ce.targetCompanies]})]}),_.jsxs("div",{className:"flex gap-1 flex-wrap",children:[ce.sectors.slice(0,3).map((rt,Ct)=>_.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs",children:rt},Ct)),ce.sectors.length>3&&_.jsxs("span",{className:"text-xs text-gray-500",children:["+",ce.sectors.length-3," more"]})]}),_.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${ce.status==="fundraising"?"bg-blue-100 text-blue-800":ce.status==="deployed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:ce.status})]}))})]})}),_.jsx(Aa,{value:"case-studies",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Portfolio Management"}),_.jsxs(Yt,{onClick:()=>s(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Portfolio"]})]})}),_.jsx(hr,{children:Me(dr,ce=>{ui(ce),s(!0)},ce=>Mo.mutate(ce),"companyName",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsx("span",{className:"bg-teal-100 text-teal-800 px-2 py-1 rounded text-xs",children:ce.industry}),_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsxs("div",{className:"text-xs",children:[_.jsxs("div",{className:"mb-1",children:[_.jsx("strong",{children:"Challenge:"})," ",ce.challenge.substring(0,100),"..."]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Solution:"})," ",ce.solution.substring(0,100),"..."]})]}),ce.results.length>0&&_.jsxs("div",{className:"text-xs",children:[_.jsx("strong",{children:"Results:"}),_.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ce.results.slice(0,2).map((rt,Ct)=>_.jsx("li",{children:rt},Ct)),ce.results.length>2&&_.jsxs("li",{children:["... and ",ce.results.length-2," more"]})]})]}),_.jsx("div",{className:"flex gap-1 flex-wrap",children:ce.tags.slice(0,3).map((rt,Ct)=>_.jsx("span",{className:"bg-pink-100 text-pink-800 px-2 py-1 rounded text-xs",children:rt},Ct))})]}))})]})}),_.jsx(Aa,{value:"blog-posts",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Blog Posts Management"}),_.jsxs(Yt,{onClick:()=>O(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Blog Post"]})]})}),_.jsx(hr,{children:Me(Ln,ce=>{Ni(ce),O(!0)},ce=>ya.mutate(ce),"title",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("span",{className:"bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs",children:ce.category}),_.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs",children:["By ",ce.author]})]}),_.jsx("p",{className:"text-gray-700",children:ce.excerpt}),_.jsxs("div",{className:"text-xs text-gray-600",children:["Published: ",new Date(ce.publishDate).toLocaleDateString()]}),_.jsx("div",{className:"flex gap-1 flex-wrap",children:ce.tags.slice(0,3).map((rt,Ct)=>_.jsx("span",{className:"bg-emerald-100 text-emerald-800 px-2 py-1 rounded text-xs",children:rt},Ct))})]}))})]})}),_.jsx(Aa,{value:"events",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Events Management"}),_.jsxs(Yt,{onClick:()=>G(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Event"]})]})}),_.jsx(hr,{children:Me(ns,ce=>{Vt(ce),G(!0)},ce=>rn.mutate(ce),"title",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("span",{className:"bg-violet-100 text-violet-800 px-2 py-1 rounded text-xs",children:ce.type}),_.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs",children:new Date(ce.date).toLocaleDateString()})]}),_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsxs("div",{className:"text-xs",children:[_.jsxs("div",{children:[_.jsx("strong",{children:"Time:"})," ",ce.time]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Location:"})," ",ce.location]})]})]}))})]})}),_.jsx(Aa,{value:"resources",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Resources Management"}),_.jsxs(Yt,{onClick:()=>he(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Resource"]})]})}),_.jsx(hr,{children:Me(ys,ce=>{ti(ce),he(!0)},ce=>Xo.mutate(ce),"title",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex gap-2 flex-wrap",children:[_.jsx("span",{className:"bg-rose-100 text-rose-800 px-2 py-1 rounded text-xs",children:ce.type}),_.jsx("span",{className:"bg-slate-100 text-slate-800 px-2 py-1 rounded text-xs",children:ce.category})]}),_.jsx("p",{className:"text-gray-700",children:ce.description}),_.jsx("div",{className:"flex gap-1 flex-wrap",children:ce.tags.slice(0,3).map((rt,Ct)=>_.jsx("span",{className:"bg-lime-100 text-lime-800 px-2 py-1 rounded text-xs",children:rt},Ct))})]}))})]})}),_.jsx(Aa,{value:"team",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsx(ur,{children:"Team Members Management"}),_.jsxs(Yt,{onClick:()=>Y(!0),children:[_.jsx(Ac,{className:"w-4 h-4 mr-2"}),"Add Team Member"]})]})}),_.jsx(hr,{children:Me(Eo,ce=>{Ki(ce),Y(!0)},ce=>Ko.mutate(ce),"name",ce=>_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("img",{src:ce.image,alt:ce.name,className:"w-12 h-12 rounded-full object-cover"}),_.jsxs("div",{children:[_.jsx("div",{className:"font-medium",children:ce.position}),ce.linkedin_url&&_.jsx("a",{href:ce.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-xs hover:underline",children:"LinkedIn Profile"})]})]}),_.jsx("p",{className:"text-gray-700",children:ce.bio})]}))})]})}),_.jsx(Aa,{value:"messages",className:"mt-6",children:_.jsxs(Wi,{children:[_.jsx(cr,{children:_.jsx(ur,{children:"Contact Messages"})}),_.jsx(hr,{children:Be()})]})}),_.jsx(Aa,{value:"admins",children:_.jsx(EH,{})})]})]}),_.jsx(cH,{isOpen:i,onClose:()=>{o(!1),ot(void 0)},onSubmit:Ch,service:pt}),_.jsx(uH,{isOpen:oe,onClose:()=>{_e(!1),Bt(void 0)},onSubmit:ve,consulting:dt}),_.jsx(hH,{isOpen:u,onClose:()=>{m(!1),Ht(void 0)},onSubmit:tc,product:Wt}),_.jsx(dH,{isOpen:w,onClose:()=>{E(!1),xi(void 0)},onSubmit:Qi,fund:ei}),_.jsx(pH,{isOpen:P,onClose:()=>{s(!1),ui(void 0)},onSubmit:Ve,caseStudy:It}),_.jsx(fH,{isOpen:D,onClose:()=>{O(!1),Ni(void 0)},onSubmit:Q,blogPost:Zt}),_.jsx(mH,{isOpen:H,onClose:()=>{G(!1),Vt(void 0)},onSubmit:ie,event:ct}),_.jsx(gH,{isOpen:U,onClose:()=>{he(!1),ti(void 0)},onSubmit:me,resource:Gt}),_.jsx(_H,{isOpen:de,onClose:()=>{Y(!1),Ki(void 0)},onSubmit:Ie,member:vi}),_.jsx(yH,{isOpen:le,onClose:()=>re(!1),onSubmit:ce=>{localStorage.setItem("styleSettings",JSON.stringify(ce)),qi({title:"Style updated!",description:"The site style settings were successfully updated."})},currentSettings:JSON.parse(localStorage.getItem("styleSettings")||JSON.stringify({heroImage:"",runningTextCompanies:[],collaborators:[]}))}),_.jsx(TH,{open:Ne,onOpenChange:Ge})]})},IH=()=>{const i=pp();return W.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),_.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:_.jsxs("div",{className:"text-center",children:[_.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),_.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),_.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},AH=()=>{const[i,o]=W.useState(""),[u,m]=W.useState(""),{login:w}=Y1(),{toast:E}=Iy(),P=LE(),s=async D=>{D.preventDefault();try{await w(i,u)?(E({title:"Login successful",description:"Welcome to the admin dashboard"}),P("/admin/dashboard")):E({title:"Login failed",description:"Invalid username or password",variant:"destructive"})}catch{E({title:"Error",description:"Something went wrong during login",variant:"destructive"})}};return _.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:_.jsxs(Wi,{className:"w-full max-w-md",children:[_.jsxs(cr,{className:"text-center",children:[_.jsx(ur,{className:"text-2xl font-bold",children:"Admin Login"}),_.jsx(Rn,{children:"Enter your credentials to access the admin dashboard"})]}),_.jsxs(hr,{children:[_.jsxs("form",{onSubmit:s,className:"space-y-4",children:[_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"username",children:"Username"}),_.jsx(Si,{id:"username",type:"text",value:i,onChange:D=>o(D.target.value),required:!0})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsx(Ft,{htmlFor:"password",children:"Password"}),_.jsx(Si,{id:"password",type:"password",value:u,onChange:D=>m(D.target.value),required:!0})]}),_.jsx(Yt,{type:"submit",className:"w-full",children:"Login"})]}),_.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-700",children:[_.jsx("strong",{children:"Demo credentials:"}),_.jsx("br",{}),"Username: admin",_.jsx("br",{}),"Password: admin123"]})]})]})})},PH=()=>{const{pathname:i}=pp();return W.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[i]),null},MH=()=>{const[i,o]=W.useState(!1),[u,m]=W.useState({necessary:!0,analytics:!1,marketing:!1});W.useEffect(()=>{const H=localStorage.getItem("cookie-consent");if(!H)o(!0);else{const G=JSON.parse(H);m(G),G.analytics&&(w(),E())}},[]);const w=()=>{const H="G-XXXXXXXXXX",G=document.createElement("script");G.async=!0,G.src=`https://www.googletagmanager.com/gtag/js?id=${H}`,document.head.appendChild(G),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",H)},E=()=>{const H=document.createElement("script");H.src="https://js.hs-scripts.com/your-hubspot-id.js",H.async=!0,document.body.appendChild(H)},P=()=>{const H={necessary:!0,analytics:!0,marketing:!0};m(H),localStorage.setItem("cookie-consent",JSON.stringify(H)),o(!1),w(),E()},s=()=>{const H={necessary:!0,analytics:!1,marketing:!1};m(H),localStorage.setItem("cookie-consent",JSON.stringify(H)),o(!1)},D=()=>{localStorage.setItem("cookie-consent",JSON.stringify(u)),o(!1),u.analytics&&(w(),E())},O=(H,G)=>{m(U=>({...U,[H]:G}))};return i?_.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",children:_.jsxs(Wi,{className:"mx-auto max-w-4xl border-2 shadow-lg",children:[_.jsxs(cr,{className:"pb-4",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx(XN,{className:"h-5 w-5 text-primary"}),_.jsx(ur,{className:"text-lg",children:"Cookie Preferences"})]}),_.jsx(Yt,{variant:"ghost",size:"sm",onClick:s,className:"h-8 w-8 p-0",children:_.jsx(U1,{className:"h-4 w-4"})})]}),_.jsx(Rn,{children:"We use cookies to enhance your experience, analyze site traffic, and for marketing purposes. You can customize your preferences or accept all cookies."})]}),_.jsx(hr,{className:"space-y-4",children:_.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[_.jsxs("div",{className:"flex gap-2",children:[_.jsx(Yt,{onClick:P,className:"flex-1 sm:flex-none",children:"Accept All"}),_.jsx(Yt,{variant:"outline",onClick:s,className:"flex-1 sm:flex-none",children:"Reject All"})]}),_.jsxs(uo,{children:[_.jsx($E,{asChild:!0,children:_.jsxs(Yt,{variant:"outline",className:"flex items-center gap-2",children:[_.jsx(i1,{className:"h-4 w-4"}),"Customize"]})}),_.jsxs(Zs,{className:"max-w-md",children:[_.jsx(Xs,{children:_.jsx(Ys,{children:"Cookie Preferences"})}),_.jsxs("div",{className:"space-y-6",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx(Ft,{htmlFor:"necessary",children:"Necessary Cookies"}),_.jsx("p",{className:"text-sm text-muted-foreground",children:"Essential for the website to function properly"})]}),_.jsx(sm,{id:"necessary",checked:u.necessary,disabled:!0})]}),_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx(Ft,{htmlFor:"analytics",children:"Analytics Cookies"}),_.jsx("p",{className:"text-sm text-muted-foreground",children:"Help us understand how visitors interact with our website"})]}),_.jsx(sm,{id:"analytics",checked:u.analytics,onCheckedChange:H=>O("analytics",H)})]}),_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"space-y-1",children:[_.jsx(Ft,{htmlFor:"marketing",children:"Marketing Cookies"}),_.jsx("p",{className:"text-sm text-muted-foreground",children:"Used to deliver relevant advertisements"})]}),_.jsx(sm,{id:"marketing",checked:u.marketing,onCheckedChange:H=>O("marketing",H)})]}),_.jsx(Yt,{onClick:D,className:"w-full",children:"Save Preferences"})]})]})]})]})})]})}):null},RH=()=>_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsxs("div",{className:"container mx-auto px-4",children:[_.jsxs(Nr,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[_.jsx(Yl,{className:"w-4 h-4"}),"Back to Home"]}),_.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Privacy Policy"}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information."})]})}),_.jsx("section",{className:"py-16",children:_.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:_.jsxs("div",{className:"prose prose-lg max-w-none",children:[_.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information We Collect"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We collect information you provide directly to us when you use our services, contact us for support, or request information about our programs and offerings. This may include your name, email address, phone number, and other contact information relevant to the services you are requesting."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"How We Use Your Information"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We use the information we collect to:"}),_.jsxs("ul",{className:"text-gray-600 mb-6 space-y-2",children:[_.jsx("li",{children:"• Provide and deliver the services you request"}),_.jsx("li",{children:"• Process service applications and inquiries"}),_.jsx("li",{children:"• Communicate with you about our services and programs"}),_.jsx("li",{children:"• Send you important notices and updates"}),_.jsx("li",{children:"• Improve our services and understand usage patterns"}),_.jsx("li",{children:"• Respond to your questions and provide customer support"})]}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information Sharing"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy or as required by law."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Data Security"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Cookies and Tracking"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We use cookies and similar technologies to enhance your experience, analyze usage, and provide personalized content. You can control cookie settings through your browser."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your Rights"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"You have the right to request access to, correction of, or deletion of your personal information that we have collected through our services. You may also opt out of certain communications from us by contacting us directly."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Children's Privacy"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Our services are not intended for children under 13. We do not knowingly collect personal information from children under 13."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to This Policy"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We may update this privacy policy from time to time. We will notify you of any changes by posting the new policy on this page."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Us"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"If you have any questions about this privacy policy, please contact us at:"}),_.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:_.jsxs("p",{className:"text-gray-600",children:["Email: privacy@company.com",_.jsx("br",{}),"Phone: (555) 123-4567",_.jsx("br",{}),"Address: 123 Main Street, City, State 12345"]})})]})})})]}),kH=()=>_.jsxs("div",{className:"min-h-screen",children:[_.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:_.jsxs("div",{className:"container mx-auto px-4",children:[_.jsxs(Nr,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[_.jsx(Yl,{className:"w-4 h-4"}),"Back to Home"]}),_.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Terms of Service"}),_.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"These terms govern your use of our services and establish the agreement between you and our company."})]})}),_.jsx("section",{className:"py-16",children:_.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:_.jsxs("div",{className:"prose prose-lg max-w-none",children:[_.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acceptance of Terms"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"By using our services, you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use our services."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Description of Services"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We provide professional services including consulting, programs, and solutions tailored to meet your business needs. Our services are delivered through various channels including in-person consultations, digital platforms, and project-based engagements."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Service Agreements"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Specific terms for each service will be outlined in separate service agreements or statements of work. These documents will detail scope, deliverables, timelines, and payment terms for the specific services requested."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Payment Terms"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Payment terms vary by service and will be specified in your service agreement. Generally, payment is due according to the schedule outlined in your agreement. Late payments may result in service suspension or termination."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Intellectual Property"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"All content, materials, and deliverables created specifically for you remain your property. Our proprietary methodologies, tools, and general knowledge remain our intellectual property. Specific ownership terms will be detailed in your service agreement."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Confidentiality"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We respect the confidentiality of your business information and maintain strict confidentiality protocols. We will not disclose your confidential information to third parties without your consent, except as required by law."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Limitation of Liability"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Our liability is limited to the fees paid for the specific service. We are not liable for indirect, incidental, or consequential damages. This limitation applies to the fullest extent permitted by law."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Termination"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Either party may terminate services according to the terms specified in the service agreement. Upon termination, you remain responsible for payment of services rendered up to the termination date."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Governing Law"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"These terms are governed by the laws of the jurisdiction in which our company operates. Any disputes will be resolved through binding arbitration or in the courts of that jurisdiction."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to Terms"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"We may update these terms from time to time. Updated terms will be posted on our website and will take effect immediately upon posting. Continued use of our services constitutes acceptance of the updated terms."}),_.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Information"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"If you have questions about these terms, please contact us:"}),_.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:_.jsxs("p",{className:"text-gray-600",children:["Email: legal@company.com",_.jsx("br",{}),"Phone: (555) 123-4567",_.jsx("br",{}),"Address: 123 Main Street, City, State 12345"]})})]})})})]}),DH=My("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),t3=W.forwardRef(({className:i,variant:o,...u},m)=>_.jsx("div",{ref:m,role:"alert",className:Zr(DH({variant:o}),i),...u}));t3.displayName="Alert";const NH=W.forwardRef(({className:i,...o},u)=>_.jsx("h5",{ref:u,className:Zr("mb-1 font-medium leading-none tracking-tight",i),...o}));NH.displayName="AlertTitle";const i3=W.forwardRef(({className:i,...o},u)=>_.jsx("div",{ref:u,className:Zr("text-sm [&_p]:leading-relaxed",i),...o}));i3.displayName="AlertDescription";const jH=()=>{const[i,o]=W.useState({necessary:!0,analytics:!1,marketing:!1});W.useEffect(()=>{const P=localStorage.getItem("cookie-consent");if(P){const s=JSON.parse(P);o(s),s.analytics&&(u(),m())}},[]);const u=()=>{const P="G-XXXXXXXXXX",s=document.createElement("script");s.async=!0,s.src=`https://www.googletagmanager.com/gtag/js?id=${P}`,document.head.appendChild(s),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",P)},m=()=>{const P=document.createElement("script");P.src="https://js.hs-scripts.com/your-hubspot-id.js",P.async=!0,document.body.appendChild(P)},w=(P,s)=>{const D={...i,[P]:s};o(D),localStorage.setItem("cookie-consent",JSON.stringify(D)),P==="analytics"&&s&&(u(),m())},E=[{id:"necessary",name:"Necessary Cookies",description:"Essential for the website to function properly. These cookies cannot be disabled as they are required for basic website operations.",icon:nV,required:!0,examples:["Session management","Security tokens","Cookie consent preferences"],duration:"Session / 1 year"},{id:"analytics",name:"Analytics Cookies",description:"Help us understand how visitors interact with our website by collecting and reporting information anonymously.",icon:$6,required:!1,examples:["Google Analytics","Page views","User behavior tracking"],duration:"2 years",thirdParty:"Google LLC"},{id:"marketing",name:"Marketing Cookies",description:"Used to deliver relevant advertisements and track the effectiveness of our marketing campaigns.",icon:oV,required:!1,examples:["Ad targeting","Conversion tracking","Remarketing"],duration:"1 year",thirdParty:"Various advertising partners"}];return _.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/5 py-12",children:_.jsx("div",{className:"container mx-auto px-4",children:_.jsxs(Wi,{className:"max-w-4xl mx-auto",children:[_.jsxs(cr,{className:"text-center",children:[_.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[_.jsx(XN,{className:"h-8 w-8 text-primary"}),_.jsx(ur,{className:"text-3xl font-bold text-primary",children:"Cookie Policy"})]}),_.jsxs(Rn,{className:"text-lg",children:["Last updated: ",new Date().toLocaleDateString()]})]}),_.jsxs(hr,{className:"space-y-8",children:[_.jsxs(t3,{children:[_.jsx(K6,{className:"h-4 w-4"}),_.jsx(i3,{children:"You can manage your cookie preferences at any time using the controls below. Changes will be applied immediately and saved to your browser."})]}),_.jsxs("section",{children:[_.jsxs("h2",{className:"text-2xl font-semibold text-primary mb-4 flex items-center gap-2",children:[_.jsx(i1,{className:"h-5 w-5"}),"Manage Your Cookie Preferences"]}),_.jsx("div",{className:"grid gap-6",children:E.map(P=>_.jsxs(Wi,{className:"border-2",children:[_.jsxs(cr,{className:"pb-4",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx(P.icon,{className:"h-5 w-5 text-primary"}),_.jsx(ur,{className:"text-lg",children:P.name}),P.required&&_.jsx(Ls,{variant:"secondary",children:"Required"})]}),_.jsx(sm,{checked:i[P.id],onCheckedChange:s=>w(P.id,s),disabled:P.required})]}),_.jsx(Rn,{className:"text-sm",children:P.description})]}),_.jsx(hr,{className:"pt-0",children:_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[_.jsxs("div",{children:[_.jsx(Ft,{className:"font-medium",children:"Examples:"}),_.jsx("ul",{className:"mt-1 space-y-1 text-muted-foreground",children:P.examples.map((s,D)=>_.jsxs("li",{children:["• ",s]},D))})]}),_.jsxs("div",{children:[_.jsx(Ft,{className:"font-medium",children:"Duration:"}),_.jsx("p",{className:"mt-1 text-muted-foreground",children:P.duration})]}),P.thirdParty&&_.jsxs("div",{children:[_.jsx(Ft,{className:"font-medium",children:"Third Party:"}),_.jsx("p",{className:"mt-1 text-muted-foreground",children:P.thirdParty})]})]})})]},P.id))})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"What Are Cookies"}),_.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Cookies are small text files placed on your device to improve your experience and help us deliver better services."})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"How We Use Cookies"}),_.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-muted-foreground",children:[_.jsx("li",{children:"To ensure our website functions properly and securely"}),_.jsx("li",{children:"To remember your cookie preferences and settings"}),_.jsx("li",{children:"To analyze website usage and improve performance"}),_.jsx("li",{children:"To support marketing and advertising efforts"})]})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Third-Party Services"}),_.jsxs("div",{className:"space-y-4",children:[_.jsxs("div",{children:[_.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Google Analytics"}),_.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Google Analytics helps us understand user behavior anonymously. Data is aggregated and does not personally identify you."}),_.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",_.jsx("a",{href:"https://policies.google.com/technologies/cookies",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Google Cookie Policy"})]})]}),_.jsxs("div",{children:[_.jsx("h3",{className:"font-semibold text-lg mb-2",children:"HubSpot"}),_.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We use HubSpot to manage customer relationships and marketing automation. HubSpot cookies help track conversions and personalize content."}),_.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",_.jsx("a",{href:"https://legal.hubspot.com/cookie-policy",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"HubSpot Cookie Policy"})]})]})]})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Browser Settings"}),_.jsx("p",{className:"text-muted-foreground",children:"You can manage cookies in your browser settings. Disabling all cookies may affect your experience."})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Updates"}),_.jsx("p",{className:"text-muted-foreground",children:"This Cookie Policy may be updated occasionally. Please check back regularly for changes."})]}),_.jsxs("section",{children:[_.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Contact Us"}),_.jsx("p",{className:"text-muted-foreground",children:"For questions about our Cookie Policy, contact us through our contact page."})]})]})]})})})},zH=new cG,LH=()=>_.jsx(fG,{client:zH,children:_.jsx(W8,{children:_.jsxs(C$,{children:[_.jsx(qV,{}),_.jsx(vU,{}),_.jsxs(b$,{children:[_.jsx(PH,{}),_.jsxs("div",{className:"min-h-screen flex flex-col",children:[_.jsx(A$,{}),_.jsx("main",{className:"flex-1",children:_.jsxs(m$,{children:[_.jsx(js,{path:"/",element:_.jsx(Y9,{})}),_.jsx(js,{path:"/programs",element:_.jsx(Mq,{})}),_.jsx(js,{path:"/consultings",element:_.jsx(Rq,{})}),_.jsx(js,{path:"/products",element:_.jsx(kq,{})}),_.jsx(js,{path:"/resources",element:_.jsx(Nq,{})}),_.jsx(js,{path:"/fund",element:_.jsx(Lq,{})}),_.jsx(js,{path:"/case-studies",element:_.jsx(Fq,{})}),_.jsx(js,{path:"/blog",element:_.jsx(Oq,{})}),_.jsx(js,{path:"/blog/:id",element:_.jsx(Bq,{})}),_.jsx(js,{path:"/events",element:_.jsx(Vq,{})}),_.jsx(js,{path:"/contact",element:_.jsx(Uq,{})}),_.jsx(js,{path:"/admin",element:_.jsx(AH,{})}),_.jsx(js,{path:"/admin/dashboard",element:_.jsx(CH,{})}),_.jsx(js,{path:"/privacy-policy",element:_.jsx(RH,{})}),_.jsx(js,{path:"/terms-of-service",element:_.jsx(kH,{})}),_.jsx(js,{path:"/cookie-policy",element:_.jsx(jH,{})}),_.jsx(js,{path:"*",element:_.jsx(IH,{})})]})}),_.jsx(P$,{})]}),_.jsx(MH,{})]})]})})});xN(document.getElementById("root")).render(_.jsx(LH,{}));
